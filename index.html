<!doctype html>
 
<html data-n-head-ssr lang="en" data-n-head="%7B%22lang%22:%7B%22ssr%22:%22en%22%7D%7D">
<meta http-equiv="cache-control" content="no-cache">
<meta name="theme-color" content="#00274e"/>
<link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin>
<meta http-equiv="X-Content-Type-Options" content="nosniff">
<meta http-equiv="X-XSS-Protection" content="1; mode=block">
<link rel="canonical" href="https://abcjon.tk/" />
<meta http-equiv='x-dns-prefetch-control' content='on'>
<link rel="dns-prefetch" href="https://abcjon.tk/">
<link rel="dns-prefetch" href="https://abcjon.tk/">
<link rel="dns-prefetch" href="https://abcjon.tk/">
<script src="/cdn-cgi/apps/head/y6Eaq1GuWIsvmc2nXbGNpGVEQKw.js"></script>
<meta http-equiv="pragma" content="no-cache">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
<link href="https://unpkg.com/nes.css@latest/css/nes.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
<meta http-equiv="X-Frame-Options" content="deny">
<meta http-equiv="X-Frame-Options" content="SAMEORIGIN">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Oswald">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open Sans">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<meta charset="utf-8">
<meta name="robots" content="noindex">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<meta name="google-site-verification" content="2vZoEN7S-HFJccciVeuzqshqXBzAhGQ9Z6BoRZPKyWo" />
<link rel="shortcut icon" type="image/x-icon" href="https://images.squarespace-cdn.com/content/v1/614d25eef23cd4531ac44bab/69fb0e66-8045-42e1-a24d-7aa0f53fc89d/favicon.ico"/>
<meta name="Title" content="ULC" />
	 <head>

	  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
	   <script type="text/javascript">
            navigator.sayswho = (function(){
                var ua= navigator.userAgent, tem,
                M= ua.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i) || [];
                if(/trident/i.test(M[1])){
                    tem=  /\brv[ :]+(\d+)/g.exec(ua) || [];
                    return 'IE '+(tem[1] || '');
                }
                if(M[1]=== 'Chrome'){
                    tem= ua.match(/\b(OPR|Edge)\/(\d+)/);
                    if(tem!= null) return tem.slice(1).join(' ').replace('OPR', 'Opera');
                }
                M= M[2]? [M[1], M[2]]: [navigator.appName, navigator.appVersion, '-?'];
                if((tem= ua.match(/version\/(\d+)/i))!= null) M.splice(1, 1, tem[1]);
                return M.join(' ');
            })();
	 console.log(navigator.sayswho);

                    </script>

	 <script async src="https://www.googletagmanager.com/gtag/js?id=AW-1032787295"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'AW-1032787295');
    </script>
	
	
	  <script>
	function setCookie(name, value, days) {
    var date = new Date();
    date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
    var expires = '; expires=' + date.toGMTString();
    document.cookie = name + '=' + value + expires + ';path=/;domain=abcjon.tk';
}

function getParam(p) {
    var match = RegExp('[?&]' + p + '=([^&]*)').exec(window.location.search);
    return match && decodeURIComponent(match[1].replace(/\+/g, ' '));
}


var gclid = getParam("gclid");
if (gclid != undefined && gclid.length > 0) {
    setCookie("gclid", gclid, 360);
}

var fbclid = getParam("fbclid");
if (fbclid != undefined && fbclid.length > 0) {
    setCookie("fbclid", fbclid, 360);
}
var liclid = getParam("li_fat_id");
if (liclid != undefined && liclid.length > 0) {
    setCookie("li_fat_id", liclid, 360);
}

var campaign = getParam("pk_campaign");
if (campaign != undefined && campaign.length > 0) {
    setCookie("pk_campaign", campaign, 360);
}

var campaignId = getParam("pk_cid");
if (campaignId != undefined && campaignId.length > 0) {
    setCookie("pk_cid", campaignId, 360);
}

var kwd = getParam("pk_keyword");
if (kwd != undefined && kwd.length > 0) {
    setCookie("pk_keyword", kwd, 360);
}
var kwd = getParam("device");
if (kwd != undefined && kwd.length > 0) {
    setCookie("pk_device", kwd, 360);
}

var medium = getParam("pk_medium");
if (medium != undefined && medium.length > 0) {
    setCookie("pk_medium", medium, 360);
}

var source = getParam("pk_source");
if (source != undefined && source.length > 0) {
    setCookie("pk_source", source, 360);
}

// Affiliate
var ref = getParam("ref");
if (ref != undefined && ref.length > 0) {
    $.get("https://api.bunny.net/system/register-affiliate-click?refCode=" + encodeURIComponent(ref), function (data) { });
    setCookie("AffiliateCode", ref, 30);
}

$(document).ready(function () {
    $(document).on('click', 'a[href^="#"]', function (event) {
        event.preventDefault();

        $('html, body').animate({
            scrollTop: $($.attr(this, 'href')).offset().top
        }, 500);
    });


    ; (function ($, win) {
        $.fn.inViewport = function (cb) {
            return this.each(function (i, el) {
                function visPx() {
                    var H = $(this).height(),
                        r = el.getBoundingClientRect(), t = r.top, b = r.bottom;
                    return cb.call(el, Math.max(0, t > 0 ? H - t : (b < H ? b : H)));
                } visPx();
                $(win).on("resize scroll", visPx);
            });
        };
    }(jQuery, window));

    $(".animate__delay").inViewport(function (px) {
        if (px) {
            var animateClass = $(this).data("animate");
            if (!$(this).hasClass(animateClass)) {
                $(this).addClass(animateClass);
            }
        }
    });

    $('.support-mail-link').click(function (event) {
        event.preventDefault();
        zE.activate();
        ga('send', 'event', 'contact', 'email-click', 'footer');
    });

    var referer = document.referrer.toString();
    if (referer != undefined && referer.length > 0 && !referer.includes("bunny.net/")) {
        setCookie("ref_domain", source, 360);
    }
});
	</script>
					<nav class="navbar navbar-expand-md navbar-dark" style="background-color: #3A3F44">
			<a href="/" style="color: white; text-decoration: none;"><img src="https://images.squarespace-cdn.com/content/v1/614d25eef23cd4531ac44bab/69fb0e66-8045-42e1-a24d-7aa0f53fc89d/favicon.ico" width="40" height="40"></a>
			
		</nav>
					<script>

var swfobject=function(){var D="undefined",r="object",S="Shockwave Flash",W="ShockwaveFlash.ShockwaveFlash",q="application/x-shockwave-flash",R="SWFObjectExprInst",x="onreadystatechange",O=window,j=document,t=navigator,T=false,U=[h],o=[],N=[],I=[],l,Q,E,B,J=false,a=false,n,G,m=true,M=function(){var aa=typeof j.getElementById!=D&&typeof j.getElementsByTagName!=D&&typeof j.createElement!=D,ah=t.userAgent.toLowerCase(),Y=t.platform.toLowerCase(),ae=Y?/win/.test(Y):/win/.test(ah),ac=Y?/mac/.test(Y):/mac/.test(ah),af=/webkit/.test(ah)?parseFloat(ah.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")):false,X=!+"\v1",ag=[0,0,0],ab=null;if(typeof t.plugins!=D&&typeof t.plugins[S]==r){ab=t.plugins[S].description;if(ab&&!(typeof t.mimeTypes!=D&&t.mimeTypes[q]&&!t.mimeTypes[q].enabledPlugin)){T=true;X=false;ab=ab.replace(/^.*\s+(\S+\s+\S+$)/,"$1");ag[0]=parseInt(ab.replace(/^(.*)\..*$/,"$1"),10);ag[1]=parseInt(ab.replace(/^.*\.(.*)\s.*$/,"$1"),10);ag[2]=/[a-zA-Z]/.test(ab)?parseInt(ab.replace(/^.*[a-zA-Z]+(.*)$/,"$1"),10):0}}else{if(typeof O.ActiveXObject!=D){try{var ad=new ActiveXObject(W);if(ad){ab=ad.GetVariable("$version");if(ab){X=true;ab=ab.split(" ")[1].split(",");ag=[parseInt(ab[0],10),parseInt(ab[1],10),parseInt(ab[2],10)]}}}catch(Z){}}}return{w3:aa,pv:ag,wk:af,ie:X,win:ae,mac:ac}}(),k=function(){if(!M.w3){return}if((typeof j.readyState!=D&&j.readyState=="complete")||(typeof j.readyState==D&&(j.getElementsByTagName("body")[0]||j.body))){f()}if(!J){if(typeof j.addEventListener!=D){j.addEventListener("DOMContentLoaded",f,false)}if(M.ie&&M.win){j.attachEvent(x,function(){if(j.readyState=="complete"){j.detachEvent(x,arguments.callee);f()}});if(O==top){(function(){if(J){return}try{j.documentElement.doScroll("left")}catch(X){setTimeout(arguments.callee,0);return}f()})()}}if(M.wk){(function(){if(J){return}if(!/loaded|complete/.test(j.readyState)){setTimeout(arguments.callee,0);return}f()})()}s(f)}}();function f(){if(J){return}try{var Z=j.getElementsByTagName("body")[0].appendChild(C("span"));Z.parentNode.removeChild(Z)}catch(aa){return}J=true;var X=U.length;for(var Y=0;Y<X;Y++){U[Y]()}}function K(X){if(J){X()}else{U[U.length]=X}}function s(Y){if(typeof O.addEventListener!=D){O.addEventListener("load",Y,false)}else{if(typeof j.addEventListener!=D){j.addEventListener("load",Y,false)}else{if(typeof O.attachEvent!=D){i(O,"onload",Y)}else{if(typeof O.onload=="function"){var X=O.onload;O.onload=function(){X();Y()}}else{O.onload=Y}}}}}function h(){if(T){V()}else{H()}}function V(){var X=j.getElementsByTagName("body")[0];var aa=C(r);aa.setAttribute("type",q);var Z=X.appendChild(aa);if(Z){var Y=0;(function(){if(typeof Z.GetVariable!=D){var ab=Z.GetVariable("$version");if(ab){ab=ab.split(" ")[1].split(",");M.pv=[parseInt(ab[0],10),parseInt(ab[1],10),parseInt(ab[2],10)]}}else{if(Y<10){Y++;setTimeout(arguments.callee,10);return}}X.removeChild(aa);Z=null;H()})()}else{H()}}function H(){var ag=o.length;if(ag>0){for(var af=0;af<ag;af++){var Y=o[af].id;var ab=o[af].callbackFn;var aa={success:false,id:Y};if(M.pv[0]>0){var ae=c(Y);if(ae){if(F(o[af].swfVersion)&&!(M.wk&&M.wk<312)){w(Y,true);if(ab){aa.success=true;aa.ref=z(Y);ab(aa)}}else{if(o[af].expressInstall&&A()){var ai={};ai.data=o[af].expressInstall;ai.width=ae.getAttribute("width")||"0";ai.height=ae.getAttribute("height")||"0";if(ae.getAttribute("class")){ai.styleclass=ae.getAttribute("class")}if(ae.getAttribute("align")){ai.align=ae.getAttribute("align")}var ah={};var X=ae.getElementsByTagName("param");var ac=X.length;for(var ad=0;ad<ac;ad++){if(X[ad].getAttribute("name").toLowerCase()!="movie"){ah[X[ad].getAttribute("name")]=X[ad].getAttribute("value")}}P(ai,ah,Y,ab)}else{p(ae);if(ab){ab(aa)}}}}}else{w(Y,true);if(ab){var Z=z(Y);if(Z&&typeof Z.SetVariable!=D){aa.success=true;aa.ref=Z}ab(aa)}}}}}function z(aa){var X=null;var Y=c(aa);if(Y&&Y.nodeName=="OBJECT"){if(typeof Y.SetVariable!=D){X=Y}else{var Z=Y.getElementsByTagName(r)[0];if(Z){X=Z}}}return X}function A(){return !a&&F("6.0.65")&&(M.win||M.mac)&&!(M.wk&&M.wk<312)}function P(aa,ab,X,Z){a=true;E=Z||null;B={success:false,id:X};var ae=c(X);if(ae){if(ae.nodeName=="OBJECT"){l=g(ae);Q=null}else{l=ae;Q=X}aa.id=R;if(typeof aa.width==D||(!/%$/.test(aa.width)&&parseInt(aa.width,10)<310)){aa.width="310"}if(typeof aa.height==D||(!/%$/.test(aa.height)&&parseInt(aa.height,10)<137)){aa.height="137"}j.title=j.title.slice(0,47)+" - Flash Player Installation";var ad=M.ie&&M.win?"ActiveX":"PlugIn",ac="MMredirectURL="+O.location.toString().replace(/&/g,"%26")+"&MMplayerType="+ad+"&MMdoctitle="+j.title;if(typeof ab.flashvars!=D){ab.flashvars+="&"+ac}else{ab.flashvars=ac}if(M.ie&&M.win&&ae.readyState!=4){var Y=C("div");X+="SWFObjectNew";Y.setAttribute("id",X);ae.parentNode.insertBefore(Y,ae);ae.style.display="none";(function(){if(ae.readyState==4){ae.parentNode.removeChild(ae)}else{setTimeout(arguments.callee,10)}})()}u(aa,ab,X)}}function p(Y){if(M.ie&&M.win&&Y.readyState!=4){var X=C("div");Y.parentNode.insertBefore(X,Y);X.parentNode.replaceChild(g(Y),X);Y.style.display="none";(function(){if(Y.readyState==4){Y.parentNode.removeChild(Y)}else{setTimeout(arguments.callee,10)}})()}else{Y.parentNode.replaceChild(g(Y),Y)}}function g(ab){var aa=C("div");if(M.win&&M.ie){aa.innerHTML=ab.innerHTML}else{var Y=ab.getElementsByTagName(r)[0];if(Y){var ad=Y.childNodes;if(ad){var X=ad.length;for(var Z=0;Z<X;Z++){if(!(ad[Z].nodeType==1&&ad[Z].nodeName=="PARAM")&&!(ad[Z].nodeType==8)){aa.appendChild(ad[Z].cloneNode(true))}}}}}return aa}function u(ai,ag,Y){var X,aa=c(Y);if(M.wk&&M.wk<312){return X}if(aa){if(typeof ai.id==D){ai.id=Y}if(M.ie&&M.win){var ah="";for(var ae in ai){if(ai[ae]!=Object.prototype[ae]){if(ae.toLowerCase()=="data"){ag.movie=ai[ae]}else{if(ae.toLowerCase()=="styleclass"){ah+=' class="'+ai[ae]+'"'}else{if(ae.toLowerCase()!="classid"){ah+=" "+ae+'="'+ai[ae]+'"'}}}}}var af="";for(var ad in ag){if(ag[ad]!=Object.prototype[ad]){af+='<param name="'+ad+'" value="'+ag[ad]+'" />'}}aa.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+ah+">"+af+"</object>";N[N.length]=ai.id;X=c(ai.id)}else{var Z=C(r);Z.setAttribute("type",q);for(var ac in ai){if(ai[ac]!=Object.prototype[ac]){if(ac.toLowerCase()=="styleclass"){Z.setAttribute("class",ai[ac])}else{if(ac.toLowerCase()!="classid"){Z.setAttribute(ac,ai[ac])}}}}for(var ab in ag){if(ag[ab]!=Object.prototype[ab]&&ab.toLowerCase()!="movie"){e(Z,ab,ag[ab])}}aa.parentNode.replaceChild(Z,aa);X=Z}}return X}function e(Z,X,Y){var aa=C("param");aa.setAttribute("name",X);aa.setAttribute("value",Y);Z.appendChild(aa)}function y(Y){var X=c(Y);if(X&&X.nodeName=="OBJECT"){if(M.ie&&M.win){X.style.display="none";(function(){if(X.readyState==4){b(Y)}else{setTimeout(arguments.callee,10)}})()}else{X.parentNode.removeChild(X)}}}function b(Z){var Y=c(Z);if(Y){for(var X in Y){if(typeof Y[X]=="function"){Y[X]=null}}Y.parentNode.removeChild(Y)}}function c(Z){var X=null;try{X=j.getElementById(Z)}catch(Y){}return X}function C(X){return j.createElement(X)}function i(Z,X,Y){Z.attachEvent(X,Y);I[I.length]=[Z,X,Y]}function F(Z){var Y=M.pv,X=Z.split(".");X[0]=parseInt(X[0],10);X[1]=parseInt(X[1],10)||0;X[2]=parseInt(X[2],10)||0;return(Y[0]>X[0]||(Y[0]==X[0]&&Y[1]>X[1])||(Y[0]==X[0]&&Y[1]==X[1]&&Y[2]>=X[2]))?true:false}function v(ac,Y,ad,ab){if(M.ie&&M.mac){return}var aa=j.getElementsByTagName("head")[0];if(!aa){return}var X=(ad&&typeof ad=="string")?ad:"screen";if(ab){n=null;G=null}if(!n||G!=X){var Z=C("style");Z.setAttribute("type","text/css");Z.setAttribute("media",X);n=aa.appendChild(Z);if(M.ie&&M.win&&typeof j.styleSheets!=D&&j.styleSheets.length>0){n=j.styleSheets[j.styleSheets.length-1]}G=X}if(M.ie&&M.win){if(n&&typeof n.addRule==r){n.addRule(ac,Y)}}else{if(n&&typeof j.createTextNode!=D){n.appendChild(j.createTextNode(ac+" {"+Y+"}"))}}}function w(Z,X){if(!m){return}var Y=X?"visible":"hidden";if(J&&c(Z)){c(Z).style.visibility=Y}else{v("#"+Z,"visibility:"+Y)}}function L(Y){var Z=/[\\\"<>\.;]/;var X=Z.exec(Y)!=null;return X&&typeof encodeURIComponent!=D?encodeURIComponent(Y):Y}var d=function(){if(M.ie&&M.win){window.attachEvent("onunload",function(){var ac=I.length;for(var ab=0;ab<ac;ab++){I[ab][0].detachEvent(I[ab][1],I[ab][2])}var Z=N.length;for(var aa=0;aa<Z;aa++){y(N[aa])}for(var Y in M){M[Y]=null}M=null;for(var X in swfobject){swfobject[X]=null}swfobject=null})}}();return{registerObject:function(ab,X,aa,Z){if(M.w3&&ab&&X){var Y={};Y.id=ab;Y.swfVersion=X;Y.expressInstall=aa;Y.callbackFn=Z;o[o.length]=Y;w(ab,false)}else{if(Z){Z({success:false,id:ab})}}},getObjectById:function(X){if(M.w3){return z(X)}},embedSWF:function(ab,ah,ae,ag,Y,aa,Z,ad,af,ac){var X={success:false,id:ah};if(M.w3&&!(M.wk&&M.wk<312)&&ab&&ah&&ae&&ag&&Y){w(ah,false);K(function(){ae+="";ag+="";var aj={};if(af&&typeof af===r){for(var al in af){aj[al]=af[al]}}aj.data=ab;aj.width=ae;aj.height=ag;var am={};if(ad&&typeof ad===r){for(var ak in ad){am[ak]=ad[ak]}}if(Z&&typeof Z===r){for(var ai in Z){if(typeof am.flashvars!=D){am.flashvars+="&"+ai+"="+Z[ai]}else{am.flashvars=ai+"="+Z[ai]}}}if(F(Y)){var an=u(aj,am,ah);if(aj.id==ah){w(ah,true)}X.success=true;X.ref=an}else{if(aa&&A()){aj.data=aa;P(aj,am,ah,ac);return}else{w(ah,true)}}if(ac){ac(X)}})}else{if(ac){ac(X)}}},switchOffAutoHideShow:function(){m=false},ua:M,getFlashPlayerVersion:function(){return{major:M.pv[0],minor:M.pv[1],release:M.pv[2]}},hasFlashPlayerVersion:F,createSWF:function(Z,Y,X){if(M.w3){return u(Z,Y,X)}else{return undefined}},showExpressInstall:function(Z,aa,X,Y){if(M.w3&&A()){P(Z,aa,X,Y)}},removeSWF:function(X){if(M.w3){y(X)}},createCSS:function(aa,Z,Y,X){if(M.w3){v(aa,Z,Y,X)}},addDomLoadEvent:K,addLoadEvent:s,getQueryParamValue:function(aa){var Z=j.location.search||j.location.hash;if(Z){if(/\?/.test(Z)){Z=Z.split("?")[1]}if(aa==null){return L(Z)}var Y=Z.split("&");for(var X=0;X<Y.length;X++){if(Y[X].substring(0,Y[X].indexOf("="))==aa){return L(Y[X].substring((Y[X].indexOf("=")+1)))}}}return""},expressInstallCallback:function(){if(a){var X=c(R);if(X&&l){X.parentNode.replaceChild(l,X);if(Q){w(Q,true);if(M.ie&&M.win){l.style.display="block"}}if(E){E(B)}}a=false}}}}();
	</script>
	<script language="javascript" type="text/javascript">
     var style = document.createElement('style');
     style.type = "text/css";
     style.id = "antiClickjack";
     style.innerHTML = "body{display:none !important;}";
     document.head.appendChild(style);

     if (self === top) {
         var antiClickjack = document.getElementById("antiClickjack");
         antiClickjack.parentNode.removeChild(antiClickjack);
     } else {
         top.location = self.location;
     }
</script>
	<script type="text/javascript">
    if (self === top) {
        var antiClickjack = document.getElementById("antiClickjack");
        antiClickjack.parentNode.removeChild(antiClickjack);
    } else {
        top.location = self.location;
    }
</script>

	<script>
'use strict';(function(){function m(d,e,b){return{multiElement:!0,transclude:"element",priority:600,terminal:!0,restrict:"A",$$tlb:!0,link:function(c,a,f,h,k){var g=new n(c,a,f,h,k,e);c.deregister=b.$on("authChanged",function(a,e){g.handle(e)});c.$on("$destroy",function(){c.deregister()});g.handle(d.isAuthenticated())}}}function p(d,e,b){return{multiElement:!0,transclude:"element",priority:600,terminal:!0,restrict:"A",$$tlb:!0,link:function(c,a,f,h,k){var g=new n(c,a,f,h,k,e);c.deregister=b.$on("authChanged",
function(a,e){g.handle(!e)});c.$on("$destroy",function(){c.deregister()});g.handle(!d.isAuthenticated())}}}function q(d){return{link:function(e,b,c){var a=b.css("display"),f=c.ngPermissionType,h=c.ngIfPermission.split(",");e.$watch(function(){return d.getPermissions()},function(){d.getPermissionValidation(f)(h)?b.css("display",a):b.css("display","none")},!0)},restrict:"A"}}function r(d,e){return{link:function(b,c,a){var f=c.css("display"),h=a.ngPermissionType,k=function(a){d.hasPermission(a)||d.getPermissionValidation(h)(a)?
c.css("display",f):c.css("display","none")};b.$watch(function(){return e(a.ngIfPermissionModel)(b)},function(a){k(a)});b.$watch(function(){return d.getPermissions()},function(){var d=e(a.ngIfPermissionModel)(b);k(d)},!0)},restrict:"A"}}function t(d){return{link:function(e,b,c){var a=c.ngPermissionType,f=c.ngEnabledPermission.split(",");e.$watch(function(){return d.getPermissions()},function(){d.getPermissionValidation(a)(f)?b.removeAttr("disabled"):b.attr("disabled","true")},!0)},restrict:"A"}}function u(d){return{link:function(e,
b,c){b.bind("click",d.logout)},restrict:"A"}}function v(d){return{link:function(e,b,c){e.$watch(function(){return d.getUser()},function(a){b.text(a[c.ngBindUser])},!0)},restrict:"A"}}function w(d,e){return{link:function(b,c,a,f){c.bind("submit",function(){var f=a.ngSubmitLogin,k=c.find("input"),g={};angular.forEach(k,function(a){"submit"!==a.type&&a.name&&(g[a.name]=a.value)});e.loginByUrl(f,g).then(function(a){d.$broadcast("ng-security:login:success");b.ngLoginSuccess({$response:a})}).catch(function(a){d.$broadcast("ng-security:login:error");
b.ngLoginError({$response:a})})})},restrict:"A",scope:{ngLoginSuccess:"&",ngLoginError:"&"},require:"^form"}}function x(d){return{link:function(e,b,c,a){var f=b.css("display");b.css("display","none");d.$on("ng-security:login:success",function(){b.css("display",f)});d.$on("ng-security:login:error",function(){b.css("display","none")})},restrict:"AEC"}}function y(d){return{link:function(e,b,c,a){var f=b.css("display");b.css("display","none");d.$on("ng-security:login:success",function(){b.css("display",
"none")});d.$on("ng-security:login:error",function(){b.css("display",f)})},restrict:"AEC"}}function n(d,e,b,c,a,f){function h(a){for(var e=a[0],d=a[a.length-1],b,c=1;e!==d&&(e=e.nextSibling);c++)if(b||a[c]!==e)b||(b=jqLite(slice.call(a,0,c))),b.push(e);return b||a}var k,g,l;this.handle=function(b){b?g||a(function(a,b){g=b;a[a.length++]=document.createComment(" end ng-securityIf");k={clone:a};f.enter(a,e.parent(),e)}):(l&&(l.remove(),l=null),g&&(g.$destroy(),g=null),k&&(l=h(k.clone),f.leave(l).then(function(){l=
null}),k=null))}}function z(d,e,b,c,a){var f={login:function(){h[a.strategy].apply(this,arguments);return d.$emit("authChanged",f.isAuthenticated())},loginByUrl:function(a,e){return b(function(b,h){c.post(a,e).success(function(a){f.login(a.token,a.user,a.permissions);d.$emit("authChanged",f.isAuthenticated());b(a)}).error(h)})},logout:function(){e.remove(a.storageName.token);e.remove(a.storageName.user);e.remove(a.storageName.permissions);d.$emit("authChanged",f.isAuthenticated())},hasPermission:function(b){var d=
e.getObject(a.storageName.permissions);return d?-1!==d.indexOf(b):!1},hasAllPermission:function(b){var d=e.getObject(a.storageName.permissions),c=!0;b&&d?angular.forEach(b,function(a){-1===d.indexOf(a)&&(c=!1)}):c=!1;return c},hasAnyPermission:function(b){var d=e.getObject(a.storageName.permissions),c=!1;b&&d&&angular.forEach(b,function(a){-1!==d.indexOf(a)&&(c=!0)});return c},getPermissionValidation:function(a){var b={ANY:f.hasAnyPermission,ALL:f.hasAllPermission};a||(a="ANY");return b[a]},isAuthenticated:function(){return!!e.get(a.storageName.token)},
getUser:function(){return e.getObject(a.storageName.user)},getPermissions:function(){return e.getObject(a.storageName.permissions)}},h={jwt:function(b,d){var c;c=b.split(".")[1];if(2===c.length%4)c+="==";else if(3===c.length%4)c+="=";else if(0!==c.length%4)throw"Invalid token string.";c=JSON.parse(atob(c));e.put(a.storageName.token,a.token.prefix+b);e.putObject(a.storageName.user,c);e.putObject(a.storageName.permissions,d)},simple:function(b,c,d){e.put(a.storageName.token,a.token.prefix+b);e.putObject(a.storageName.user,
c);e.putObject(a.storageName.permissions,d)}};return f}function A(d,e,b,c){return{request:function(a){a.headers[c.token.header]=b.get(c.storageName.token);return a},responseError:function(a){var b=c.responseErrorName;b[a.status]&&d.$broadcast(b[a.status],a);return e.reject(a)}}}angular.module("ngSecurity",["ngCookies"]);angular.module("ngSecurity").directive("ngIfAuthenticated",m).directive("ngIfAnonymous",p).directive("ngIfPermission",q).directive("ngIfPermissionModel",r).directive("ngEnabledPermission",
t).directive("ngClickLogout",u).directive("ngBindUser",v).directive("ngSubmitLogin",w).directive("ngShowLoginSuccess",x).directive("ngShowLoginError",y);m.$inject=["$security","$animate","$rootScope"];p.$inject=["$security","$animate","$rootScope"];q.$inject=["$security"];r.$inject=["$security","$parse"];t.$inject=["$security"];u.$inject=["$security"];v.$inject=["$security"];w.$inject=["$rootScope","$security"];x.$inject=["$rootScope"];y.$inject=["$rootScope"];angular.module("ngSecurity").provider("$securityConfig",
function(){var d={},e={strategy:"simple",token:{header:"Authorization",prefix:""},storageName:{token:"ng-security-authorization",user:"ng-security-user",permissions:"ng-security-permissions"},responseErrorName:{401:"unauthenticated",403:"permissionDenied"}};d.$get=function(){return e};d.configure=function(b){e=angular.merge(e,b)};return d});angular.module("ngSecurity").factory("$security",z).factory("$securityInterceptor",A);z.$inject=["$rootScope","$cookies","$q","$http","$securityConfig"];A.$inject=
["$rootScope","$q","$cookies","$securityConfig"]}).call(window);
	</script>

	<script>

(function(root) {
'use strict';
var secureFilters = {};
secureFilters.constructor = function secureFilters(){};

var TO_CONFIGURE = ['html','js','jsAttr','uri','jsObj','css','style'];

secureFilters.configure = function(ejs) {
  ejs.filters = ejs.filters || {};
  for (var i = 0; i < TO_CONFIGURE.length; i++) {
    var filterName = TO_CONFIGURE[i];
    ejs.filters[filterName] = secureFilters[filterName];
  }
  return ejs;
};

var QUOT = /\x22/g; // "
var APOS = /\x27/g; // '
var AST = /\*/g;
var TILDE = /~/g;
var BANG = /!/g;
var LPAREN = /\(/g;
var RPAREN = /\)/g;
var CDATA_CLOSE = /\]\](?:>|\\x3E|\\u003E)/gi;

var JS_NOT_WHITELISTED = /[^,\-\.0-9A-Z_a-z]/g;

var JSON_NOT_WHITELISTED = /[^\x22,\-\.0-9:A-Z\[\x5C\]_a-z{}]/g;

var HTML_CONTROL = /[\x00-\x08\x0B\x0C\x0E-\x1F\x7F-\x9F]/g;

var HTML_NOT_WHITELISTED = /[^\t\n\v\f\r ,\.0-9A-Z_a-z\-\u00A0-\uFFFF]/g;

var CSS_NOT_WHITELISTED = /[^a-zA-Z0-9\uD800-\uDFFF]/g;

secureFilters.html = function(val) {
  var str = String(val);
  str = str.replace(HTML_CONTROL, ' ');
  return str.replace(HTML_NOT_WHITELISTED, function(match) {
    var code = match.charCodeAt(0);
    switch(code) {
 
    case 0x22:
      return '&quot;';
    case 0x26:
      return '&amp;';
    case 0x3C:
      return '&lt;';
    case 0x3E:
      return '&gt;';

    default:
    
      if (code < 100) {
        var dec = code.toString(10);
        return '&#'+dec+';';
      } else {
     
        var hex = code.toString(16).toUpperCase();
        return '&#x'+hex+';';
      }
    }
  });
};

function jsSlashEncoder(charStr) {
  var code = charStr.charCodeAt(0);
  var hex = code.toString(16).toUpperCase();
  if (code < 0x80) { // ASCII
    if (hex.length === 1) {
      return '\\x0'+hex;
    } else {
      return '\\x'+hex;
    }
  } else { // Unicode
    switch(hex.length) {
      case 2:
        return '\\u00'+hex;
      case 3:
        return '\\u0'+hex;
      case 4:
        return '\\u'+hex;
      default:
        
        return '\\uFFFD';
    }
  }

}


secureFilters.js = function(val) {
  var str = String(val);
  return str.replace(JS_NOT_WHITELISTED, jsSlashEncoder);
};

secureFilters.jsAttr = function(val) {
  return secureFilters.html(secureFilters.js(val));
};

secureFilters.uri = function(val) {

  var encode = encodeURIComponent(String(val));
  return encode
    .replace(BANG, '%21')
    .replace(QUOT, '%27')
    .replace(APOS, '%27')
    .replace(LPAREN, '%28')
    .replace(RPAREN, '%29')
    .replace(AST, '%2A')
    .replace(TILDE, '%7E');
};

secureFilters.json = function(val) {
    var str = String(val);
    return str.replace(JSON_NOT_WHITELISTED, jsSlashEncoder)

    .replace(CDATA_CLOSE, '\\x5D\\x5D\\x3E');
};

secureFilters.jsObj = function(val) {
  return secureFilters.json(JSON.stringify(val));
};

secureFilters.css = function(val) {
  var str = String(val);
  return str.replace(CSS_NOT_WHITELISTED, function(match) {
    var code = match.charCodeAt(0);
    if (code === 0) {
      return '\\fffd '; // REPLACEMENT CHARACTER U+FFFD
    } else {
      var hex = code.toString(16).toLowerCase();
      return '\\'+hex+' ';
    }
  });
};

secureFilters.style = function(val) {
  return secureFilters.html(secureFilters.css(val));
};


if (typeof define !== 'undefined' && define.amd) {
  define([], function () {
    return secureFilters;
  });
}

else if (typeof module !== 'undefined' && module.exports) {
  module.exports = secureFilters;
}

else {
  root.secureFilters = secureFilters;
}

}(this));
	</script>
<script>
	!function(t){!function(t){"use strict";const r="(0?\\d+|0x[a-f0-9]+)",e={fourOctet:new RegExp(`^${r}\\.${r}\\.${r}\\.${r}$`,"i"),threeOctet:new RegExp(`^${r}\\.${r}\\.${r}$`,"i"),twoOctet:new RegExp(`^${r}\\.${r}$`,"i"),longValue:new RegExp(`^${r}$`,"i")},n=new RegExp("^0[0-7]+$","i"),i=new RegExp("^0x[a-f0-9]+$","i"),o="(?:[0-9a-f]+::?)+",s={zoneIndex:new RegExp("%[0-9a-z]{1,}","i"),native:new RegExp(`^(::)?(${o})?([0-9a-f]+)?(::)?(%[0-9a-z]{1,})?$`,"i"),deprecatedTransitional:new RegExp(`^(?:::)(${r}\\.${r}\\.${r}\\.${r}(%[0-9a-z]{1,})?)$`,"i"),transitional:new RegExp(`^((?:${o})|(?:::)(?:${o})?)${r}\\.${r}\\.${r}\\.${r}(%[0-9a-z]{1,})?$`,"i")};function a(t,r){if(t.indexOf("::")!==t.lastIndexOf("::"))return null;let e,n,i=0,o=-1,a=(t.match(s.zoneIndex)||[])[0];for(a&&(a=a.substring(1),t=t.replace(/%.+$/,""));(o=t.indexOf(":",o+1))>=0;)i++;if("::"===t.substr(0,2)&&i--,"::"===t.substr(-2,2)&&i--,i>r)return null;for(n=r-i,e=":";n--;)e+="0:";return":"===(t=t.replace("::",e))[0]&&(t=t.slice(1)),":"===t[t.length-1]&&(t=t.slice(0,-1)),{parts:r=function(){const r=t.split(":"),e=[];for(let t=0;t<r.length;t++)e.push(parseInt(r[t],16));return e}(),zoneId:a}}function p(t,r,e,n){if(t.length!==r.length)throw new Error("ipaddr: cannot match CIDR for objects with different lengths");let i,o=0;for(;n>0;){if((i=e-n)<0&&(i=0),t[o]>>i!=r[o]>>i)return!1;n-=e,o+=1}return!0}function u(t){if(i.test(t))return parseInt(t,16);if("0"===t[0]&&!isNaN(parseInt(t[1],10))){if(n.test(t))return parseInt(t,8);throw new Error(`ipaddr: cannot parse ${t} as octal`)}return parseInt(t,10)}function d(t,r){for(;t.length<r;)t=`0${t}`;return t}const h={};h.IPv4=function(){function t(t){if(4!==t.length)throw new Error("ipaddr: ipv4 octet count should be 4");let r,e;for(r=0;r<t.length;r++)if(!(0<=(e=t[r])&&e<=255))throw new Error("ipaddr: ipv4 octet should fit in 8 bits");this.octets=t}return t.prototype.SpecialRanges={unspecified:[[new t([0,0,0,0]),8]],broadcast:[[new t([255,255,255,255]),32]],multicast:[[new t([224,0,0,0]),4]],linkLocal:[[new t([169,254,0,0]),16]],loopback:[[new t([127,0,0,0]),8]],carrierGradeNat:[[new t([100,64,0,0]),10]],private:[[new t([10,0,0,0]),8],[new t([172,16,0,0]),12],[new t([192,168,0,0]),16]],reserved:[[new t([192,0,0,0]),24],[new t([192,0,2,0]),24],[new t([192,88,99,0]),24],[new t([198, 18, 0, 0]), 15],[new t([198,51,100,0]),24],[new t([203,0,113,0]),24],[new t([240,0,0,0]),4]]},t.prototype.kind=function(){return"ipv4"},t.prototype.match=function(t,r){let e;if(void 0===r&&(t=(e=t)[0],r=e[1]),"ipv4"!==t.kind())throw new Error("ipaddr: cannot match ipv4 address with non-ipv4 one");return p(this.octets,t.octets,8,r)},t.prototype.prefixLengthFromSubnetMask=function(){let t=0,r=!1;const e={0:8,128:7,192:6,224:5,240:4,248:3,252:2,254:1,255:0};let n,i,o;for(n=3;n>=0;n-=1){if(!((i=this.octets[n])in e))return null;if(o=e[i],r&&0!==o)return null;8!==o&&(r=!0),t+=o}return 32-t},t.prototype.range=function(){return h.subnetMatch(this,this.SpecialRanges)},t.prototype.toByteArray=function(){return this.octets.slice(0)},t.prototype.toIPv4MappedAddress=function(){return h.IPv6.parse(`::ffff:${this.toString()}`)},t.prototype.toNormalizedString=function(){return this.toString()},t.prototype.toString=function(){return this.octets.join(".")},t}(),h.IPv4.broadcastAddressFromCIDR=function(t){try{const r=this.parseCIDR(t),e=r[0].toByteArray(),n=this.subnetMaskFromPrefixLength(r[1]).toByteArray(),i=[];let o=0;for(;o<4;)i.push(parseInt(e[o],10)|255^parseInt(n[o],10)),o++;return new this(i)}catch(t){throw new Error("ipaddr: the address does not have IPv4 CIDR format")}},h.IPv4.isIPv4=function(t){return null!==this.parser(t)},h.IPv4.isValid=function(t){try{return new this(this.parser(t)),!0}catch(t){return!1}},h.IPv4.isValidFourPartDecimal=function(t){return!(!h.IPv4.isValid(t)||!t.match(/^(0|[1-9]\d*)(\.(0|[1-9]\d*)){3}$/))},h.IPv4.networkAddressFromCIDR=function(t){let r,e,n,i,o;try{for(n=(r=this.parseCIDR(t))[0].toByteArray(),o=this.subnetMaskFromPrefixLength(r[1]).toByteArray(),i=[],e=0;e<4;)i.push(parseInt(n[e],10)&parseInt(o[e],10)),e++;return new this(i)}catch(t){throw new Error("ipaddr: the address does not have IPv4 CIDR format")}},h.IPv4.parse=function(t){const r=this.parser(t);if(null===r)throw new Error("ipaddr: string is not formatted like an IPv4 Address");return new this(r)},h.IPv4.parseCIDR=function(t){let r;if(r=t.match(/^(.+)\/(\d+)$/)){const t=parseInt(r[2]);if(t>=0&&t<=32){const e=[this.parse(r[1]),t];return Object.defineProperty(e,"toString",{value:function(){return this.join("/")}}),e}}throw new Error("ipaddr: string is not formatted like an IPv4 CIDR range")},h.IPv4.parser=function(t){let r,n,i;if(r=t.match(e.fourOctet))return function(){const t=r.slice(1,6),e=[];for(let r=0;r<t.length;r++)n=t[r],e.push(u(n));return e}();if(r=t.match(e.longValue)){if((i=u(r[1]))>4294967295||i<0)throw new Error("ipaddr: address outside defined range");return function(){const t=[];let r;for(r=0;r<=24;r+=8)t.push(i>>r&255);return t}().reverse()}return(r=t.match(e.twoOctet))?function(){const t=r.slice(1,4),e=[];if((i=u(t[1]))>16777215||i<0)throw new Error("ipaddr: address outside defined range");return e.push(u(t[0])),e.push(i>>16&255),e.push(i>>8&255),e.push(255&i),e}():(r=t.match(e.threeOctet))?function(){const t=r.slice(1,5),e=[];if((i=u(t[2]))>65535||i<0)throw new Error("ipaddr: address outside defined range");return e.push(u(t[0])),e.push(u(t[1])),e.push(i>>8&255),e.push(255&i),e}():null},h.IPv4.subnetMaskFromPrefixLength=function(t){if((t=parseInt(t))<0||t>32)throw new Error("ipaddr: invalid IPv4 prefix length");const r=[0,0,0,0];let e=0;const n=Math.floor(t/8);for(;e<n;)r[e]=255,e++;return n<4&&(r[n]=Math.pow(2,t%8)-1<<8-t%8),new this(r)},h.IPv6=function(){function t(t,r){let e,n;if(16===t.length)for(this.parts=[],e=0;e<=14;e+=2)this.parts.push(t[e]<<8|t[e+1]);else{if(8!==t.length)throw new Error("ipaddr: ipv6 part count should be 8 or 16");this.parts=t}for(e=0;e<this.parts.length;e++)if(!(0<=(n=this.parts[e])&&n<=65535))throw new Error("ipaddr: ipv6 part should fit in 16 bits");r&&(this.zoneId=r)}return t.prototype.SpecialRanges={unspecified:[new t([0,0,0,0,0,0,0,0]),128],linkLocal:[new t([65152,0,0,0,0,0,0,0]),10],multicast:[new t([65280,0,0,0,0,0,0,0]),8],loopback:[new t([0,0,0,0,0,0,0,1]),128],uniqueLocal:[new t([64512,0,0,0,0,0,0,0]),7],ipv4Mapped:[new t([0,0,0,0,0,65535,0,0]),96],rfc6145:[new t([0,0,0,0,65535,0,0,0]),96],rfc6052:[new t([100,65435,0,0,0,0,0,0]),96],"6to4":[new t([8194,0,0,0,0,0,0,0]),16],teredo:[new t([8193,0,0,0,0,0,0,0]),32],reserved:[[new t([8193,3512,0,0,0,0,0,0]),32]]},t.prototype.isIPv4MappedAddress=function(){return"ipv4Mapped"===this.range()},t.prototype.kind=function(){return"ipv6"},t.prototype.match=function(t,r){let e;if(void 0===r&&(t=(e=t)[0],r=e[1]),"ipv6"!==t.kind())throw new Error("ipaddr: cannot match ipv6 address with non-ipv6 one");return p(this.parts,t.parts,16,r)},t.prototype.prefixLengthFromSubnetMask=function(){let t=0,r=!1;const e={0:16,32768:15,49152:14,57344:13,61440:12,63488:11,64512:10,65024:9,65280:8,65408:7,65472:6,65504:5,65520:4,65528:3,65532:2,65534:1,65535:0};let n,i;for(let o=7;o>=0;o-=1){if(!((n=this.parts[o])in e))return null;if(i=e[n],r&&0!==i)return null;16!==i&&(r=!0),t+=i}return 128-t},t.prototype.range=function(){return h.subnetMatch(this,this.SpecialRanges)},t.prototype.toByteArray=function(){let t;const r=[],e=this.parts;for(let n=0;n<e.length;n++)t=e[n],r.push(t>>8),r.push(255&t);return r},t.prototype.toFixedLengthString=function(){const t=function(){const t=[];for(let r=0;r<this.parts.length;r++)t.push(d(this.parts[r].toString(16),4));return t}.call(this).join(":");let r="";return this.zoneId&&(r=`%${this.zoneId}`),t+r},t.prototype.toIPv4Address=function(){if(!this.isIPv4MappedAddress())throw new Error("ipaddr: trying to convert a generic ipv6 address to ipv4");const t=this.parts.slice(-2),r=t[0],e=t[1];return new h.IPv4([r>>8,255&r,e>>8,255&e])},t.prototype.toNormalizedString=function(){const t=function(){const t=[];for(let r=0;r<this.parts.length;r++)t.push(this.parts[r].toString(16));return t}.call(this).join(":");let r="";return this.zoneId&&(r=`%${this.zoneId}`),t+r},t.prototype.toRFC5952String=function(){const t=/((^|:)(0(:|$)){2,})/g,r=this.toNormalizedString();let e,n=0,i=-1;for(;e=t.exec(r);)e[0].length>i&&(n=e.index,i=e[0].length);return i<0?r:`${r.substring(0,n)}::${r.substring(n+i)}`},t.prototype.toString=function(){return this.toNormalizedString().replace(/((^|:)(0(:|$))+)/,"::")},t}(),h.IPv6.broadcastAddressFromCIDR=function(t){try{const r=this.parseCIDR(t),e=r[0].toByteArray(),n=this.subnetMaskFromPrefixLength(r[1]).toByteArray(),i=[];let o=0;for(;o<16;)i.push(parseInt(e[o],10)|255^parseInt(n[o],10)),o++;return new this(i)}catch(t){throw new Error(`ipaddr: the address does not have IPv6 CIDR format (${t})`)}},h.IPv6.isIPv6=function(t){return null!==this.parser(t)},h.IPv6.isValid=function(t){if("string"==typeof t&&-1===t.indexOf(":"))return!1;try{const r=this.parser(t);return new this(r.parts,r.zoneId),!0}catch(t){return!1}},h.IPv6.networkAddressFromCIDR=function(t){let r,e,n,i,o;try{for(n=(r=this.parseCIDR(t))[0].toByteArray(),o=this.subnetMaskFromPrefixLength(r[1]).toByteArray(),i=[],e=0;e<16;)i.push(parseInt(n[e],10)&parseInt(o[e],10)),e++;return new this(i)}catch(t){throw new Error(`ipaddr: the address does not have IPv6 CIDR format (${t})`)}},h.IPv6.parse=function(t){const r=this.parser(t);if(null===r.parts)throw new Error("ipaddr: string is not formatted like an IPv6 Address");return new this(r.parts,r.zoneId)},h.IPv6.parseCIDR=function(t){let r,e,n;if((e=t.match(/^(.+)\/(\d+)$/))&&(r=parseInt(e[2]))>=0&&r<=128)return n=[this.parse(e[1]),r],Object.defineProperty(n,"toString",{value:function(){return this.join("/")}}),n;throw new Error("ipaddr: string is not formatted like an IPv6 CIDR range")},h.IPv6.parser=function(t){let r,e,n,i,o,p;if(n=t.match(s.deprecatedTransitional))return this.parser(`::ffff:${n[1]}`);if(s.native.test(t))return a(t,8);if((n=t.match(s.transitional))&&(p=n[6]||"",(r=a(n[1].slice(0,-1)+p,6)).parts)){for(o=[parseInt(n[2]),parseInt(n[3]),parseInt(n[4]),parseInt(n[5])],e=0;e<o.length;e++)if(!(0<=(i=o[e])&&i<=255))return null;return r.parts.push(o[0]<<8|o[1]),r.parts.push(o[2]<<8|o[3]),{parts:r.parts,zoneId:r.zoneId}}return null},h.IPv6.subnetMaskFromPrefixLength=function(t){if((t=parseInt(t))<0||t>128)throw new Error("ipaddr: invalid IPv6 prefix length");const r=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];let e=0;const n=Math.floor(t/8);for(;e<n;)r[e]=255,e++;return n<16&&(r[n]=Math.pow(2,t%8)-1<<8-t%8),new this(r)},h.fromByteArray=function(t){const r=t.length;if(4===r)return new h.IPv4(t);if(16===r)return new h.IPv6(t);throw new Error("ipaddr: the binary input is neither an IPv6 nor IPv4 address")},h.isValid=function(t){return h.IPv6.isValid(t)||h.IPv4.isValid(t)},h.parse=function(t){if(h.IPv6.isValid(t))return h.IPv6.parse(t);if(h.IPv4.isValid(t))return h.IPv4.parse(t);throw new Error("ipaddr: the address has neither IPv6 nor IPv4 format")},h.parseCIDR=function(t){try{return h.IPv6.parseCIDR(t)}catch(r){try{return h.IPv4.parseCIDR(t)}catch(t){throw new Error("ipaddr: the address has neither IPv6 nor IPv4 CIDR format")}}},h.process=function(t){const r=this.parse(t);return"ipv6"===r.kind()&&r.isIPv4MappedAddress()?r.toIPv4Address():r},h.subnetMatch=function(t,r,e){let n,i,o,s;for(i in void 0!==e&&null!==e||(e="unicast"),r)if(Object.prototype.hasOwnProperty.call(r,i))for(!(o=r[i])[0]||o[0]instanceof Array||(o=[o]),n=0;n<o.length;n++)if(s=o[n],t.kind()===s[0].kind()&&t.match.apply(t,s))return i;return e},"undefined"!=typeof module&&module.exports?module.exports=h:t.ipaddr=h}(this)}("undefined"==typeof window?window={}:window);
	</script>
	  <script>
	  /*! For license information please see sdk.js.LICENSE.txt */
!function(t, e) {
    if ("object" == typeof exports && "object" == typeof module)
        module.exports = e();
    else if ("function" == typeof define && define.amd)
        define([], e);
    else {
        var r = e();
        for (var n in r)
            ("object" == typeof exports ? exports : t)[n] = r[n]
    }
}(self, (function() {
    return (()=>{
        var t = {
            7757: (t,e,r)=>{
                t.exports = r(5666)
            }
            ,
            3542: function(t, e, r) {
                !function(t, e, r) {
                    "use strict";
                    r = r && r.hasOwnProperty("default") ? r.default : r;
                    var n, o, i, a, s, c = function(t) {
                        return t instanceof Error ? {
                            message: t.toString(),
                            stackTrace: t.stack
                        } : {}
                    };
                    !function(t) {
                        t.LOG_LEVEL_REQUEST = "requests",
                        t.LOG_LEVEL_DEBUG = "debug",
                        t.LOG_LEVEL_INFO = "info",
                        t.LOG_LEVEL_WARNING = "warning",
                        t.LOG_LEVEL_ERROR = "error",
                        t.LOG_LEVEL_CRITICAL = "critical"
                    }(i || (i = {})),
                    function(t) {
                        t[t.LOG_LEVEL_REQUEST = 5] = "LOG_LEVEL_REQUEST",
                        t[t.LOG_LEVEL_DEBUG = 4] = "LOG_LEVEL_DEBUG",
                        t[t.LOG_LEVEL_INFO = 3] = "LOG_LEVEL_INFO",
                        t[t.LOG_LEVEL_WARNING = 2] = "LOG_LEVEL_WARNING",
                        t[t.LOG_LEVEL_ERROR = 1] = "LOG_LEVEL_ERROR",
                        t[t.LOG_LEVEL_CRITICAL = 0] = "LOG_LEVEL_CRITICAL"
                    }(a || (a = {})),
                    function(t) {
                        t.LOG_ALIAS = "log",
                        t.WARN_ALIAS = "warn",
                        t.ERROR_ALIAS = "error"
                    }(s || (s = {}));
                    var u = ((n = {})[i.LOG_LEVEL_REQUEST] = a.LOG_LEVEL_REQUEST,
                    n[i.LOG_LEVEL_DEBUG] = a.LOG_LEVEL_DEBUG,
                    n[i.LOG_LEVEL_INFO] = a.LOG_LEVEL_INFO,
                    n[i.LOG_LEVEL_WARNING] = a.LOG_LEVEL_WARNING,
                    n[i.LOG_LEVEL_ERROR] = a.LOG_LEVEL_ERROR,
                    n[i.LOG_LEVEL_CRITICAL] = a.LOG_LEVEL_CRITICAL,
                    n)
                      , l = ((o = {})[s.LOG_ALIAS] = i.LOG_LEVEL_INFO,
                    o[s.WARN_ALIAS] = i.LOG_LEVEL_WARNING,
                    o[s.ERROR_ALIAS] = i.LOG_LEVEL_ERROR,
                    {
                        0: "#9b0010",
                        1: "#9b0010",
                        2: "#a8a602",
                        3: "#636363",
                        4: "#636363",
                        5: "#636363"
                    })
                      , f = Object.keys(u).reduce((function(t, r) {
                        var n;
                        return e.__assign({}, t, ((n = {})[u[r]] = r.toUpperCase(),
                        n))
                    }
                    ), {})
                      , p = function() {
                        function t(e, r) {
                            var n = e.level
                              , o = void 0 === n ? "warning" : n;
                            this.listeners = {
                                log: []
                            },
                            this.level = t.getLevel(o),
                            this.listeners = {
                                log: []
                            },
                            this.setFatalReporter(r)
                        }
                        return t.getLevel = function(t, e) {
                            return e ? void 0 !== u[e] ? u[e] : u.warning : "number" == typeof t ? t : void 0 !== u[t] ? u[t] : u.warning
                        }
                        ,
                        t.prototype.setFatalReporter = function(t) {
                            this.fatalReporter = t
                        }
                        ,
                        t.prototype.createConsola = function(t) {
                            this.consola = r.create(t)
                        }
                        ,
                        t.prototype.log = function(e) {
                            void 0 === e && (e = {});
                            var r = t.getLevel(void 0 === e.level ? 1 : e.level, e.levelName);
                            if (void 0 !== r && r <= this.level) {
                                var n = new Date
                                  , o = {};
                                e.exception && e.exception instanceof Error && (o = c(e.exception)),
                                e.message && e.message instanceof Error && (o = c(e.message)),
                                Object.assign(e, o),
                                e.level = r,
                                e.levelName = f[r],
                                e.timestamp || (e.timestamp = n.getTime());
                                try {
                                    this.consola.log(e)
                                } catch (t) {
                                    this.fatalReporter(t.toString())
                                }
                                this.emit("log", e)
                            }
                        }
                        ,
                        t.prototype.on = function(t, e) {
                            this.listeners[t] && this.listeners[t].push(e)
                        }
                        ,
                        t.prototype.emit = function(t, e) {
                            try {
                                this.listeners[t].forEach((function(t) {
                                    return t(e)
                                }
                                ))
                            } catch (e) {
                                this.consola.log({
                                    message: "Error while emitting event " + t + ": " + e,
                                    level: "FATAL"
                                })
                            }
                        }
                        ,
                        t
                    }()
                      , h = function() {
                        function t(t) {
                            var e = t.token;
                            this.apiUrl = t.apiUrl,
                            this.token = e
                        }
                        return t.prototype.write = function(t) {
                            if (this.apiUrl && this.token && "object" == typeof t && Object.keys(t).length) {
                                var e = new XMLHttpRequest;
                                t.client_ts = t.ts,
                                e.open("POST", this.apiUrl),
                                e.setRequestHeader("Content-Type", "application/json"),
                                e.setRequestHeader("Log-Authorization", "Basic " + this.token),
                                e.send(JSON.stringify([t]))
                            }
                        }
                        ,
                        t
                    }()
                      , d = function() {
                        function t() {}
                        return t.prototype.write = function(t) {
                            void 0 === t && (t = {}),
                            process.stdout && process.stdout.write(JSON.stringify(t) + "\n")
                        }
                        ,
                        t
                    }()
                      , v = function() {
                        function t(t) {
                            this.stream = null != t ? t : new d
                        }
                        return t.prototype.log = function(t) {
                            var r = t.levelName
                              , n = t.args
                              , o = t.exception
                              , i = t.timestamp
                              , a = t.payload
                              , s = e.__rest(t, ["levelName", "args", "exception", "timestamp", "payload"])
                              , u = o ? c(o) : {}
                              , l = i || Date.now();
                            s.message = n && n[0],
                            delete s.date,
                            delete s.debugInfo,
                            this.stream.write(e.__assign({}, u, s, a, {
                                level: r,
                                ts: new Date(l).toISOString()
                            }))
                        }
                        ,
                        t
                    }()
                      , y = function() {
                        function t() {}
                        return t.prototype.log = function(t) {
                            void 0 === t && (t = {});
                            var r = t.level <= 1 ? console.error : console.log
                              , n = t.args
                              , o = t.level
                              , i = t.levelName
                              , a = e.__rest(t, ["args", "level", "levelName"]);
                            r("%c[" + i.toUpperCase() + "]", "color: #ffffff; font-weight: bold; background-color: " + l[o] + ";", n && n[0]),
                            Object.keys(a).length && console.groupCollapsed && this.groupCollapsed("Additional info", (function(t) {
                                (0,
                                t.log)(a)
                            }
                            ))
                        }
                        ,
                        t.prototype.groupCollapsed = function(t, e) {
                            var r = console.groupCollapsed;
                            this.createGroupLogger(r, t, e)
                        }
                        ,
                        t.prototype.createGroupLogger = function(t, e, r) {
                            var n;
                            if (t("%c[DEBUG]:", "color: #00BFFE; font-weight: bold", e),
                            r) {
                                var o = r(console);
                                console.groupEnd(),
                                n = o
                            }
                            return n
                        }
                        ,
                        t
                    }()
                      , g = function(t) {
                        function r(e) {
                            void 0 === e && (e = {});
                            var n = t.call(this, e, console.error) || this
                              , o = r.generateConsolaParams(e);
                            return n.createConsola(o),
                            n
                        }
                        return e.__extends(r, t),
                        r.generateConsolaParams = function(t) {
                            var e = t.isBot
                              , r = new h({
                                apiUrl: t.apiUrl,
                                token: t.token
                            })
                              , n = [new y];
                            return e || n.push(new v(r)),
                            {
                                reporters: n
                            }
                        }
                        ,
                        r
                    }(p);
                    t.ClientLogger = g
                }(e, r(655), r(4652))
            },
            4652: function(t) {
                t.exports = function() {
                    "use strict";
                    function t(t, e) {
                        if (!(t instanceof e))
                            throw new TypeError("Cannot call a class as a function")
                    }
                    function e(t, e) {
                        for (var r = 0; r < e.length; r++) {
                            var n = e[r];
                            n.enumerable = n.enumerable || !1,
                            n.configurable = !0,
                            "value"in n && (n.writable = !0),
                            Object.defineProperty(t, n.key, n)
                        }
                    }
                    function r(t, r, n) {
                        return r && e(t.prototype, r),
                        n && e(t, n),
                        t
                    }
                    function n(t, e, r) {
                        return e in t ? Object.defineProperty(t, e, {
                            value: r,
                            enumerable: !0,
                            configurable: !0,
                            writable: !0
                        }) : t[e] = r,
                        t
                    }
                    function o(t, e) {
                        var r = Object.keys(t);
                        if (Object.getOwnPropertySymbols) {
                            var n = Object.getOwnPropertySymbols(t);
                            e && (n = n.filter((function(e) {
                                return Object.getOwnPropertyDescriptor(t, e).enumerable
                            }
                            ))),
                            r.push.apply(r, n)
                        }
                        return r
                    }
                    function i(t) {
                        for (var e = 1; e < arguments.length; e++) {
                            var r = null != arguments[e] ? arguments[e] : {};
                            e % 2 ? o(Object(r), !0).forEach((function(e) {
                                n(t, e, r[e])
                            }
                            )) : Object.getOwnPropertyDescriptors ? Object.defineProperties(t, Object.getOwnPropertyDescriptors(r)) : o(Object(r)).forEach((function(e) {
                                Object.defineProperty(t, e, Object.getOwnPropertyDescriptor(r, e))
                            }
                            ))
                        }
                        return t
                    }
                    function a(t) {
                        return function(t) {
                            if (Array.isArray(t))
                                return c(t)
                        }(t) || function(t) {
                            if ("undefined" != typeof Symbol && Symbol.iterator in Object(t))
                                return Array.from(t)
                        }(t) || s(t) || function() {
                            throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")
                        }()
                    }
                    function s(t, e) {
                        if (t) {
                            if ("string" == typeof t)
                                return c(t, e);
                            var r = Object.prototype.toString.call(t).slice(8, -1);
                            return "Object" === r && t.constructor && (r = t.constructor.name),
                            "Map" === r || "Set" === r ? Array.from(t) : "Arguments" === r || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r) ? c(t, e) : void 0
                        }
                    }
                    function c(t, e) {
                        (null == e || e > t.length) && (e = t.length);
                        for (var r = 0, n = new Array(e); r < e; r++)
                            n[r] = t[r];
                        return n
                    }
                    function u(t) {
                        if ("undefined" == typeof Symbol || null == t[Symbol.iterator]) {
                            if (Array.isArray(t) || (t = s(t))) {
                                var e = 0
                                  , r = function() {};
                                return {
                                    s: r,
                                    n: function() {
                                        return e >= t.length ? {
                                            done: !0
                                        } : {
                                            done: !1,
                                            value: t[e++]
                                        }
                                    },
                                    e: function(t) {
                                        throw t
                                    },
                                    f: r
                                }
                            }
                            throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")
                        }
                        var n, o, i = !0, a = !1;
                        return {
                            s: function() {
                                n = t[Symbol.iterator]()
                            },
                            n: function() {
                                var t = n.next();
                                return i = t.done,
                                t
                            },
                            e: function(t) {
                                a = !0,
                                o = t
                            },
                            f: function() {
                                try {
                                    i || null == n.return || n.return()
                                } finally {
                                    if (a)
                                        throw o
                                }
                            }
                        }
                    }
                    var l = {};
                    l[l.Fatal = 0] = "Fatal",
                    l[l.Error = 0] = "Error",
                    l[l.Warn = 1] = "Warn",
                    l[l.Log = 2] = "Log",
                    l[l.Info = 3] = "Info",
                    l[l.Success = 3] = "Success",
                    l[l.Debug = 4] = "Debug",
                    l[l.Trace = 5] = "Trace",
                    l[l.Silent = -1 / 0] = "Silent",
                    l[l.Verbose = 1 / 0] = "Verbose";
                    var f = {
                        silent: {
                            level: -1
                        },
                        fatal: {
                            level: l.Fatal
                        },
                        error: {
                            level: l.Error
                        },
                        warn: {
                            level: l.Warn
                        },
                        log: {
                            level: l.Log
                        },
                        info: {
                            level: l.Info
                        },
                        success: {
                            level: l.Success
                        },
                        debug: {
                            level: l.Debug
                        },
                        trace: {
                            level: l.Trace
                        },
                        verbose: {
                            level: l.Trace
                        },
                        ready: {
                            level: l.Info
                        },
                        start: {
                            level: l.Info
                        }
                    }
                      , p = !1
                      , h = []
                      , d = function() {
                        function e() {
                            var r = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : {};
                            for (var n in t(this, e),
                            this._reporters = r.reporters || [],
                            this._types = r.types || f,
                            this.level = void 0 !== r.level ? r.level : 3,
                            this._defaults = r.defaults || {},
                            this._async = void 0 !== r.async ? r.async : void 0,
                            this._stdout = r.stdout,
                            this._stderr = r.stderr,
                            this._mockFn = r.mockFn,
                            this._throttle = r.throttle || 1e3,
                            this._throttleMin = r.throttleMin || 5,
                            this._types) {
                                var o = i(i({
                                    type: n
                                }, this._types[n]), this._defaults);
                                this[n] = this._wrapLogFn(o),
                                this[n].raw = this._wrapLogFn(o, !0)
                            }
                            this._mockFn && this.mockTypes(),
                            this._lastLogSerialized = void 0,
                            this._lastLog = void 0,
                            this._lastLogTime = void 0,
                            this._lastLogCount = 0,
                            this._throttleTimeout = void 0
                        }
                        return r(e, [{
                            key: "create",
                            value: function(t) {
                                return new e(Object.assign({
                                    reporters: this._reporters,
                                    level: this.level,
                                    types: this._types,
                                    defaults: this._defaults,
                                    stdout: this._stdout,
                                    stderr: this._stderr,
                                    mockFn: this._mockFn
                                }, t))
                            }
                        }, {
                            key: "withDefaults",
                            value: function(t) {
                                return this.create({
                                    defaults: Object.assign({}, this._defaults, t)
                                })
                            }
                        }, {
                            key: "withTag",
                            value: function(t) {
                                return this.withDefaults({
                                    tag: this._defaults.tag ? this._defaults.tag + ":" + t : t
                                })
                            }
                        }, {
                            key: "addReporter",
                            value: function(t) {
                                return this._reporters.push(t),
                                this
                            }
                        }, {
                            key: "removeReporter",
                            value: function(t) {
                                if (t) {
                                    var e = this._reporters.indexOf(t);
                                    if (e >= 0)
                                        return this._reporters.splice(e, 1)
                                } else
                                    this._reporters.splice(0);
                                return this
                            }
                        }, {
                            key: "setReporters",
                            value: function(t) {
                                return this._reporters = Array.isArray(t) ? t : [t],
                                this
                            }
                        }, {
                            key: "wrapAll",
                            value: function() {
                                this.wrapConsole(),
                                this.wrapStd()
                            }
                        }, {
                            key: "restoreAll",
                            value: function() {
                                this.restoreConsole(),
                                this.restoreStd()
                            }
                        }, {
                            key: "wrapConsole",
                            value: function() {
                                for (var t in this._types)
                                    console["__" + t] || (console["__" + t] = console[t]),
                                    console[t] = this[t].raw
                            }
                        }, {
                            key: "restoreConsole",
                            value: function() {
                                for (var t in this._types)
                                    console["__" + t] && (console[t] = console["__" + t],
                                    delete console["__" + t])
                            }
                        }, {
                            key: "wrapStd",
                            value: function() {
                                this._wrapStream(this.stdout, "log"),
                                this._wrapStream(this.stderr, "log")
                            }
                        }, {
                            key: "_wrapStream",
                            value: function(t, e) {
                                var r = this;
                                t && (t.__write || (t.__write = t.write),
                                t.write = function(t) {
                                    r[e].raw(String(t).trim())
                                }
                                )
                            }
                        }, {
                            key: "restoreStd",
                            value: function() {
                                this._restoreStream(this.stdout),
                                this._restoreStream(this.stderr)
                            }
                        }, {
                            key: "_restoreStream",
                            value: function(t) {
                                t && t.__write && (t.write = t.__write,
                                delete t.__write)
                            }
                        }, {
                            key: "pauseLogs",
                            value: function() {
                                p = !0
                            }
                        }, {
                            key: "resumeLogs",
                            value: function() {
                                p = !1;
                                var t, e = u(h.splice(0));
                                try {
                                    for (e.s(); !(t = e.n()).done; ) {
                                        var r = t.value;
                                        r[0]._logFn(r[1], r[2])
                                    }
                                } catch (t) {
                                    e.e(t)
                                } finally {
                                    e.f()
                                }
                            }
                        }, {
                            key: "mockTypes",
                            value: function(t) {
                                if (this._mockFn = t || this._mockFn,
                                "function" == typeof this._mockFn)
                                    for (var e in this._types)
                                        this[e] = this._mockFn(e, this._types[e]) || this[e],
                                        this[e].raw = this[e]
                            }
                        }, {
                            key: "_wrapLogFn",
                            value: function(t, e) {
                                var r = this;
                                return function() {
                                    for (var n = arguments.length, o = new Array(n), i = 0; i < n; i++)
                                        o[i] = arguments[i];
                                    if (!p)
                                        return r._logFn(t, o, e);
                                    h.push([r, t, o, e])
                                }
                            }
                        }, {
                            key: "_logFn",
                            value: function(t, e, r) {
                                var n = this;
                                if (t.level > this.level)
                                    return !!this._async && Promise.resolve(!1);
                                var o = Object.assign({
                                    date: new Date,
                                    args: []
                                }, t);
                                !r && 1 === e.length && function(t) {
                                    return e = t,
                                    !("[object Object]" !== Object.prototype.toString.call(e) || !t.message && !t.args || t.stack);
                                    var e
                                }(e[0]) ? Object.assign(o, e[0]) : o.args = Array.from(e),
                                o.message && (o.args.unshift(o.message),
                                delete o.message),
                                o.additional && (Array.isArray(o.additional) || (o.additional = o.additional.split("\n")),
                                o.args.push("\n" + o.additional.join("\n")),
                                delete o.additional),
                                o.type = "string" == typeof o.type ? o.type.toLowerCase() : "",
                                o.tag = "string" == typeof o.tag ? o.tag.toLowerCase() : "";
                                var s = function() {
                                    var t = arguments.length > 0 && void 0 !== arguments[0] && arguments[0]
                                      , e = n._lastLogCount - n._throttleMin;
                                    if (n._lastLog && e > 0) {
                                        var r = a(n._lastLog.args);
                                        e > 1 && r.push("(repeated ".concat(e, " times)")),
                                        n._log(i(i({}, n._lastLog), {}, {
                                            args: r
                                        })),
                                        n._lastLogCount = 1
                                    }
                                    if (t) {
                                        if (n._lastLog = o,
                                        n._async)
                                            return n._logAsync(o);
                                        n._log(o)
                                    }
                                };
                                clearTimeout(this._throttleTimeout);
                                var c = this._lastLogTime ? o.date - this._lastLogTime : 0;
                                if (this._lastLogTime = o.date,
                                c < this._throttle)
                                    try {
                                        var u = JSON.stringify([o.type, o.tag, o.args])
                                          , l = this._lastLogSerialized === u;
                                        if (this._lastLogSerialized = u,
                                        l && (this._lastLogCount++,
                                        this._lastLogCount > this._throttleMin))
                                            return void (this._throttleTimeout = setTimeout(s, this._throttle))
                                    } catch (t) {}
                                s(!0)
                            }
                        }, {
                            key: "_log",
                            value: function(t) {
                                var e, r = u(this._reporters);
                                try {
                                    for (r.s(); !(e = r.n()).done; )
                                        e.value.log(t, {
                                            async: !1,
                                            stdout: this.stdout,
                                            stderr: this.stderr
                                        })
                                } catch (t) {
                                    r.e(t)
                                } finally {
                                    r.f()
                                }
                            }
                        }, {
                            key: "_logAsync",
                            value: function(t) {
                                var e = this;
                                return Promise.all(this._reporters.map((function(r) {
                                    return r.log(t, {
                                        async: !0,
                                        stdout: e.stdout,
                                        stderr: e.stderr
                                    })
                                }
                                )))
                            }
                        }, {
                            key: "stdout",
                            get: function() {
                                return this._stdout || console._stdout
                            }
                        }, {
                            key: "stderr",
                            get: function() {
                                return this._stderr || console._stderr
                            }
                        }]),
                        e
                    }();
                    d.prototype.add = d.prototype.addReporter,
                    d.prototype.remove = d.prototype.removeReporter,
                    d.prototype.clear = d.prototype.removeReporter,
                    d.prototype.withScope = d.prototype.withTag,
                    d.prototype.mock = d.prototype.mockTypes,
                    d.prototype.pause = d.prototype.pauseLogs,
                    d.prototype.resume = d.prototype.resumeLogs;
                    var v, y = function() {
                        function e(r) {
                            t(this, e),
                            this.options = Object.assign({}, r),
                            this.defaultColor = "#7f8c8d",
                            this.levelColorMap = {
                                0: "#c0392b",
                                1: "#f39c12",
                                3: "#00BCD4"
                            },
                            this.typeColorMap = {
                                success: "#2ecc71"
                            }
                        }
                        return r(e, [{
                            key: "log",
                            value: function(t) {
                                var e = t.level < 1 ? console.__error || console.error : 1 === t.level && console.warn ? console.__warn || console.warn : console.__log || console.log
                                  , r = "log" !== t.type ? t.type : ""
                                  , n = t.tag ? t.tag : ""
                                  , o = this.typeColorMap[t.type] || this.levelColorMap[t.level] || this.defaultColor
                                  , i = "\n      background: ".concat(o, ";\n      border-radius: 0.5em;\n      color: white;\n      font-weight: bold;\n      padding: 2px 0.5em;\n    ")
                                  , s = "%c".concat([n, r].filter(Boolean).join(":"));
                                "string" == typeof t.args[0] ? e.apply(void 0, ["".concat(s, "%c ").concat(t.args[0]), i, ""].concat(a(t.args.slice(1)))) : e.apply(void 0, [s, i].concat(a(t.args)))
                            }
                        }]),
                        e
                    }();
                    return "undefined" != typeof window && window.consola || ((v = new d({
                        reporters: [new y]
                    })).Consola = d,
                    v.LogLevel = l,
                    v.BrowserReporter = y,
                    v)
                }()
            },
            1989: (t,e,r)=>{
                var n = r(1789)
                  , o = r(401)
                  , i = r(7667)
                  , a = r(1327)
                  , s = r(1866);
                function c(t) {
                    var e = -1
                      , r = null == t ? 0 : t.length;
                    for (this.clear(); ++e < r; ) {
                        var n = t[e];
                        this.set(n[0], n[1])
                    }
                }
                c.prototype.clear = n,
                c.prototype.delete = o,
                c.prototype.get = i,
                c.prototype.has = a,
                c.prototype.set = s,
                t.exports = c
            }
            ,
            8407: (t,e,r)=>{
                var n = r(7040)
                  , o = r(4125)
                  , i = r(2117)
                  , a = r(7518)
                  , s = r(4705);
                function c(t) {
                    var e = -1
                      , r = null == t ? 0 : t.length;
                    for (this.clear(); ++e < r; ) {
                        var n = t[e];
                        this.set(n[0], n[1])
                    }
                }
                c.prototype.clear = n,
                c.prototype.delete = o,
                c.prototype.get = i,
                c.prototype.has = a,
                c.prototype.set = s,
                t.exports = c
            }
            ,
            7071: (t,e,r)=>{
                var n = r(852)(r(5639), "Map");
                t.exports = n
            }
            ,
            3369: (t,e,r)=>{
                var n = r(4785)
                  , o = r(1285)
                  , i = r(6e3)
                  , a = r(9916)
                  , s = r(5265);
                function c(t) {
                    var e = -1
                      , r = null == t ? 0 : t.length;
                    for (this.clear(); ++e < r; ) {
                        var n = t[e];
                        this.set(n[0], n[1])
                    }
                }
                c.prototype.clear = n,
                c.prototype.delete = o,
                c.prototype.get = i,
                c.prototype.has = a,
                c.prototype.set = s,
                t.exports = c
            }
            ,
            2705: (t,e,r)=>{
                var n = r(5639).Symbol;
                t.exports = n
            }
            ,
            9932: t=>{
                t.exports = function(t, e) {
                    for (var r = -1, n = null == t ? 0 : t.length, o = Array(n); ++r < n; )
                        o[r] = e(t[r], r, t);
                    return o
                }
            }
            ,
            8470: (t,e,r)=>{
                var n = r(7813);
                t.exports = function(t, e) {
                    for (var r = t.length; r--; )
                        if (n(t[r][0], e))
                            return r;
                    return -1
                }
            }
            ,
            7786: (t,e,r)=>{
                var n = r(1811)
                  , o = r(327);
                t.exports = function(t, e) {
                    for (var r = 0, i = (e = n(e, t)).length; null != t && r < i; )
                        t = t[o(e[r++])];
                    return r && r == i ? t : void 0
                }
            }
            ,
            4239: (t,e,r)=>{
                var n = r(2705)
                  , o = r(9607)
                  , i = r(2333)
                  , a = n ? n.toStringTag : void 0;
                t.exports = function(t) {
                    return null == t ? void 0 === t ? "[object Undefined]" : "[object Null]" : a && a in Object(t) ? o(t) : i(t)
                }
            }
            ,
            8458: (t,e,r)=>{
                var n = r(3560)
                  , o = r(5346)
                  , i = r(3218)
                  , a = r(346)
                  , s = /^\[object .+?Constructor\]$/
                  , c = Function.prototype
                  , u = Object.prototype
                  , l = c.toString
                  , f = u.hasOwnProperty
                  , p = RegExp("^" + l.call(f).replace(/[\\^$.*+?()[\]{}|]/g, "\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g, "$1.*?") + "$");
                t.exports = function(t) {
                    return !(!i(t) || o(t)) && (n(t) ? p : s).test(a(t))
                }
            }
            ,
            531: (t,e,r)=>{
                var n = r(2705)
                  , o = r(9932)
                  , i = r(1469)
                  , a = r(3448)
                  , s = n ? n.prototype : void 0
                  , c = s ? s.toString : void 0;
                t.exports = function t(e) {
                    if ("string" == typeof e)
                        return e;
                    if (i(e))
                        return o(e, t) + "";
                    if (a(e))
                        return c ? c.call(e) : "";
                    var r = e + "";
                    return "0" == r && 1 / e == -1 / 0 ? "-0" : r
                }
            }
            ,
            1811: (t,e,r)=>{
                var n = r(1469)
                  , o = r(5403)
                  , i = r(5514)
                  , a = r(9833);
                t.exports = function(t, e) {
                    return n(t) ? t : o(t, e) ? [t] : i(a(t))
                }
            }
            ,
            4429: (t,e,r)=>{
                var n = r(5639)["__core-js_shared__"];
                t.exports = n
            }
            ,
            1957: (t,e,r)=>{
                var n = "object" == typeof r.g && r.g && r.g.Object === Object && r.g;
                t.exports = n
            }
            ,
            5050: (t,e,r)=>{
                var n = r(7019);
                t.exports = function(t, e) {
                    var r = t.__data__;
                    return n(e) ? r["string" == typeof e ? "string" : "hash"] : r.map
                }
            }
            ,
            852: (t,e,r)=>{
                var n = r(8458)
                  , o = r(7801);
                t.exports = function(t, e) {
                    var r = o(t, e);
                    return n(r) ? r : void 0
                }
            }
            ,
            9607: (t,e,r)=>{
                var n = r(2705)
                  , o = Object.prototype
                  , i = o.hasOwnProperty
                  , a = o.toString
                  , s = n ? n.toStringTag : void 0;
                t.exports = function(t) {
                    var e = i.call(t, s)
                      , r = t[s];
                    try {
                        t[s] = void 0;
                        var n = !0
                    } catch (t) {}
                    var o = a.call(t);
                    return n && (e ? t[s] = r : delete t[s]),
                    o
                }
            }
            ,
            7801: t=>{
                t.exports = function(t, e) {
                    return null == t ? void 0 : t[e]
                }
            }
            ,
            1789: (t,e,r)=>{
                var n = r(4536);
                t.exports = function() {
                    this.__data__ = n ? n(null) : {},
                    this.size = 0
                }
            }
            ,
            401: t=>{
                t.exports = function(t) {
                    var e = this.has(t) && delete this.__data__[t];
                    return this.size -= e ? 1 : 0,
                    e
                }
            }
            ,
            7667: (t,e,r)=>{
                var n = r(4536)
                  , o = Object.prototype.hasOwnProperty;
                t.exports = function(t) {
                    var e = this.__data__;
                    if (n) {
                        var r = e[t];
                        return "__lodash_hash_undefined__" === r ? void 0 : r
                    }
                    return o.call(e, t) ? e[t] : void 0
                }
            }
            ,
            1327: (t,e,r)=>{
                var n = r(4536)
                  , o = Object.prototype.hasOwnProperty;
                t.exports = function(t) {
                    var e = this.__data__;
                    return n ? void 0 !== e[t] : o.call(e, t)
                }
            }
            ,
            1866: (t,e,r)=>{
                var n = r(4536);
                t.exports = function(t, e) {
                    var r = this.__data__;
                    return this.size += this.has(t) ? 0 : 1,
                    r[t] = n && void 0 === e ? "__lodash_hash_undefined__" : e,
                    this
                }
            }
            ,
            5403: (t,e,r)=>{
                var n = r(1469)
                  , o = r(3448)
                  , i = /\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/
                  , a = /^\w*$/;
                t.exports = function(t, e) {
                    if (n(t))
                        return !1;
                    var r = typeof t;
                    return !("number" != r && "symbol" != r && "boolean" != r && null != t && !o(t)) || (a.test(t) || !i.test(t) || null != e && t in Object(e))
                }
            }
            ,
            7019: t=>{
                t.exports = function(t) {
                    var e = typeof t;
                    return "string" == e || "number" == e || "symbol" == e || "boolean" == e ? "__proto__" !== t : null === t
                }
            }
            ,
            5346: (t,e,r)=>{
                var n, o = r(4429), i = (n = /[^.]+$/.exec(o && o.keys && o.keys.IE_PROTO || "")) ? "Symbol(src)_1." + n : "";
                t.exports = function(t) {
                    return !!i && i in t
                }
            }
            ,
            7040: t=>{
                t.exports = function() {
                    this.__data__ = [],
                    this.size = 0
                }
            }
            ,
            4125: (t,e,r)=>{
                var n = r(8470)
                  , o = Array.prototype.splice;
                t.exports = function(t) {
                    var e = this.__data__
                      , r = n(e, t);
                    return !(r < 0) && (r == e.length - 1 ? e.pop() : o.call(e, r, 1),
                    --this.size,
                    !0)
                }
            }
            ,
            2117: (t,e,r)=>{
                var n = r(8470);
                t.exports = function(t) {
                    var e = this.__data__
                      , r = n(e, t);
                    return r < 0 ? void 0 : e[r][1]
                }
            }
            ,
            7518: (t,e,r)=>{
                var n = r(8470);
                t.exports = function(t) {
                    return n(this.__data__, t) > -1
                }
            }
            ,
            4705: (t,e,r)=>{
                var n = r(8470);
                t.exports = function(t, e) {
                    var r = this.__data__
                      , o = n(r, t);
                    return o < 0 ? (++this.size,
                    r.push([t, e])) : r[o][1] = e,
                    this
                }
            }
            ,
            4785: (t,e,r)=>{
                var n = r(1989)
                  , o = r(8407)
                  , i = r(7071);
                t.exports = function() {
                    this.size = 0,
                    this.__data__ = {
                        hash: new n,
                        map: new (i || o),
                        string: new n
                    }
                }
            }
            ,
            1285: (t,e,r)=>{
                var n = r(5050);
                t.exports = function(t) {
                    var e = n(this, t).delete(t);
                    return this.size -= e ? 1 : 0,
                    e
                }
            }
            ,
            6e3: (t,e,r)=>{
                var n = r(5050);
                t.exports = function(t) {
                    return n(this, t).get(t)
                }
            }
            ,
            9916: (t,e,r)=>{
                var n = r(5050);
                t.exports = function(t) {
                    return n(this, t).has(t)
                }
            }
            ,
            5265: (t,e,r)=>{
                var n = r(5050);
                t.exports = function(t, e) {
                    var r = n(this, t)
                      , o = r.size;
                    return r.set(t, e),
                    this.size += r.size == o ? 0 : 1,
                    this
                }
            }
            ,
            4523: (t,e,r)=>{
                var n = r(8306);
                t.exports = function(t) {
                    var e = n(t, (function(t) {
                        return 500 === r.size && r.clear(),
                        t
                    }
                    ))
                      , r = e.cache;
                    return e
                }
            }
            ,
            4536: (t,e,r)=>{
                var n = r(852)(Object, "create");
                t.exports = n
            }
            ,
            2333: t=>{
                var e = Object.prototype.toString;
                t.exports = function(t) {
                    return e.call(t)
                }
            }
            ,
            5639: (t,e,r)=>{
                var n = r(1957)
                  , o = "object" == typeof self && self && self.Object === Object && self
                  , i = n || o || Function("return this")();
                t.exports = i
            }
            ,
            5514: (t,e,r)=>{
                var n = r(4523)
                  , o = /[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g
                  , i = /\\(\\)?/g
                  , a = n((function(t) {
                    var e = [];
                    return 46 === t.charCodeAt(0) && e.push(""),
                    t.replace(o, (function(t, r, n, o) {
                        e.push(n ? o.replace(i, "$1") : r || t)
                    }
                    )),
                    e
                }
                ));
                t.exports = a
            }
            ,
            327: (t,e,r)=>{
                var n = r(3448);
                t.exports = function(t) {
                    if ("string" == typeof t || n(t))
                        return t;
                    var e = t + "";
                    return "0" == e && 1 / t == -1 / 0 ? "-0" : e
                }
            }
            ,
            346: t=>{
                var e = Function.prototype.toString;
                t.exports = function(t) {
                    if (null != t) {
                        try {
                            return e.call(t)
                        } catch (t) {}
                        try {
                            return t + ""
                        } catch (t) {}
                    }
                    return ""
                }
            }
            ,
            7813: t=>{
                t.exports = function(t, e) {
                    return t === e || t != t && e != e
                }
            }
            ,
            7361: (t,e,r)=>{
                var n = r(7786);
                t.exports = function(t, e, r) {
                    var o = null == t ? void 0 : n(t, e);
                    return void 0 === o ? r : o
                }
            }
            ,
            1469: t=>{
                var e = Array.isArray;
                t.exports = e
            }
            ,
            3560: (t,e,r)=>{
                var n = r(4239)
                  , o = r(3218);
                t.exports = function(t) {
                    if (!o(t))
                        return !1;
                    var e = n(t);
                    return "[object Function]" == e || "[object GeneratorFunction]" == e || "[object AsyncFunction]" == e || "[object Proxy]" == e
                }
            }
            ,
            3218: t=>{
                t.exports = function(t) {
                    var e = typeof t;
                    return null != t && ("object" == e || "function" == e)
                }
            }
            ,
            7005: t=>{
                t.exports = function(t) {
                    return null != t && "object" == typeof t
                }
            }
            ,
            3448: (t,e,r)=>{
                var n = r(4239)
                  , o = r(7005);
                t.exports = function(t) {
                    return "symbol" == typeof t || o(t) && "[object Symbol]" == n(t)
                }
            }
            ,
            8306: (t,e,r)=>{
                var n = r(3369);
                function o(t, e) {
                    if ("function" != typeof t || null != e && "function" != typeof e)
                        throw new TypeError("Expected a function");
                    var r = function() {
                        var n = arguments
                          , o = e ? e.apply(this, n) : n[0]
                          , i = r.cache;
                        if (i.has(o))
                            return i.get(o);
                        var a = t.apply(this, n);
                        return r.cache = i.set(o, a) || i,
                        a
                    };
                    return r.cache = new (o.Cache || n),
                    r
                }
                o.Cache = n,
                t.exports = o
            }
            ,
            9833: (t,e,r)=>{
                var n = r(531);
                t.exports = function(t) {
                    return null == t ? "" : n(t)
                }
            }
            ,
            5666: t=>{
                var e = function(t) {
                    "use strict";
                    var e = Object.prototype
                      , r = e.hasOwnProperty
                      , n = "function" == typeof Symbol ? Symbol : {}
                      , o = n.iterator || "@@iterator"
                      , i = n.asyncIterator || "@@asyncIterator"
                      , a = n.toStringTag || "@@toStringTag";
                    function s(t, e, r) {
                        return Object.defineProperty(t, e, {
                            value: r,
                            enumerable: !0,
                            configurable: !0,
                            writable: !0
                        }),
                        t[e]
                    }
                    try {
                        s({}, "")
                    } catch (t) {
                        s = function(t, e, r) {
                            return t[e] = r
                        }
                    }
                    function c(t, e, r, n) {
                        var o = e && e.prototype instanceof f ? e : f
                          , i = Object.create(o.prototype)
                          , a = new E(n || []);
                        return i._invoke = function(t, e, r) {
                            var n = "suspendedStart";
                            return function(o, i) {
                                if ("executing" === n)
                                    throw new Error("Generator is already running");
                                if ("completed" === n) {
                                    if ("throw" === o)
                                        throw i;
                                    return x()
                                }
                                for (r.method = o,
                                r.arg = i; ; ) {
                                    var a = r.delegate;
                                    if (a) {
                                        var s = m(a, r);
                                        if (s) {
                                            if (s === l)
                                                continue;
                                            return s
                                        }
                                    }
                                    if ("next" === r.method)
                                        r.sent = r._sent = r.arg;
                                    else if ("throw" === r.method) {
                                        if ("suspendedStart" === n)
                                            throw n = "completed",
                                            r.arg;
                                        r.dispatchException(r.arg)
                                    } else
                                        "return" === r.method && r.abrupt("return", r.arg);
                                    n = "executing";
                                    var c = u(t, e, r);
                                    if ("normal" === c.type) {
                                        if (n = r.done ? "completed" : "suspendedYield",
                                        c.arg === l)
                                            continue;
                                        return {
                                            value: c.arg,
                                            done: r.done
                                        }
                                    }
                                    "throw" === c.type && (n = "completed",
                                    r.method = "throw",
                                    r.arg = c.arg)
                                }
                            }
                        }(t, r, a),
                        i
                    }
                    function u(t, e, r) {
                        try {
                            return {
                                type: "normal",
                                arg: t.call(e, r)
                            }
                        } catch (t) {
                            return {
                                type: "throw",
                                arg: t
                            }
                        }
                    }
                    t.wrap = c;
                    var l = {};
                    function f() {}
                    function p() {}
                    function h() {}
                    var d = {};
                    d[o] = function() {
                        return this
                    }
                    ;
                    var v = Object.getPrototypeOf
                      , y = v && v(v(O([])));
                    y && y !== e && r.call(y, o) && (d = y);
                    var g = h.prototype = f.prototype = Object.create(d);
                    function _(t) {
                        ["next", "throw", "return"].forEach((function(e) {
                            s(t, e, (function(t) {
                                return this._invoke(e, t)
                            }
                            ))
                        }
                        ))
                    }
                    function w(t, e) {
                        var n;
                        this._invoke = function(o, i) {
                            function a() {
                                return new e((function(n, a) {
                                    !function n(o, i, a, s) {
                                        var c = u(t[o], t, i);
                                        if ("throw" !== c.type) {
                                            var l = c.arg
                                              , f = l.value;
                                            return f && "object" == typeof f && r.call(f, "__await") ? e.resolve(f.__await).then((function(t) {
                                                n("next", t, a, s)
                                            }
                                            ), (function(t) {
                                                n("throw", t, a, s)
                                            }
                                            )) : e.resolve(f).then((function(t) {
                                                l.value = t,
                                                a(l)
                                            }
                                            ), (function(t) {
                                                return n("throw", t, a, s)
                                            }
                                            ))
                                        }
                                        s(c.arg)
                                    }(o, i, n, a)
                                }
                                ))
                            }
                            return n = n ? n.then(a, a) : a()
                        }
                    }
                    function m(t, e) {
                        var r = t.iterator[e.method];
                        if (void 0 === r) {
                            if (e.delegate = null,
                            "throw" === e.method) {
                                if (t.iterator.return && (e.method = "return",
                                e.arg = void 0,
                                m(t, e),
                                "throw" === e.method))
                                    return l;
                                e.method = "throw",
                                e.arg = new TypeError("The iterator does not provide a 'throw' method")
                            }
                            return l
                        }
                        var n = u(r, t.iterator, e.arg);
                        if ("throw" === n.type)
                            return e.method = "throw",
                            e.arg = n.arg,
                            e.delegate = null,
                            l;
                        var o = n.arg;
                        return o ? o.done ? (e[t.resultName] = o.value,
                        e.next = t.nextLoc,
                        "return" !== e.method && (e.method = "next",
                        e.arg = void 0),
                        e.delegate = null,
                        l) : o : (e.method = "throw",
                        e.arg = new TypeError("iterator result is not an object"),
                        e.delegate = null,
                        l)
                    }
                    function b(t) {
                        var e = {
                            tryLoc: t[0]
                        };
                        1 in t && (e.catchLoc = t[1]),
                        2 in t && (e.finallyLoc = t[2],
                        e.afterLoc = t[3]),
                        this.tryEntries.push(e)
                    }
                    function L(t) {
                        var e = t.completion || {};
                        e.type = "normal",
                        delete e.arg,
                        t.completion = e
                    }
                    function E(t) {
                        this.tryEntries = [{
                            tryLoc: "root"
                        }],
                        t.forEach(b, this),
                        this.reset(!0)
                    }
                    function O(t) {
                        if (t) {
                            var e = t[o];
                            if (e)
                                return e.call(t);
                            if ("function" == typeof t.next)
                                return t;
                            if (!isNaN(t.length)) {
                                var n = -1
                                  , i = function e() {
                                    for (; ++n < t.length; )
                                        if (r.call(t, n))
                                            return e.value = t[n],
                                            e.done = !1,
                                            e;
                                    return e.value = void 0,
                                    e.done = !0,
                                    e
                                };
                                return i.next = i
                            }
                        }
                        return {
                            next: x
                        }
                    }
                    function x() {
                        return {
                            value: void 0,
                            done: !0
                        }
                    }
                    return p.prototype = g.constructor = h,
                    h.constructor = p,
                    p.displayName = s(h, a, "GeneratorFunction"),
                    t.isGeneratorFunction = function(t) {
                        var e = "function" == typeof t && t.constructor;
                        return !!e && (e === p || "GeneratorFunction" === (e.displayName || e.name))
                    }
                    ,
                    t.mark = function(t) {
                        return Object.setPrototypeOf ? Object.setPrototypeOf(t, h) : (t.__proto__ = h,
                        s(t, a, "GeneratorFunction")),
                        t.prototype = Object.create(g),
                        t
                    }
                    ,
                    t.awrap = function(t) {
                        return {
                            __await: t
                        }
                    }
                    ,
                    _(w.prototype),
                    w.prototype[i] = function() {
                        return this
                    }
                    ,
                    t.AsyncIterator = w,
                    t.async = function(e, r, n, o, i) {
                        void 0 === i && (i = Promise);
                        var a = new w(c(e, r, n, o),i);
                        return t.isGeneratorFunction(r) ? a : a.next().then((function(t) {
                            return t.done ? t.value : a.next()
                        }
                        ))
                    }
                    ,
                    _(g),
                    s(g, a, "Generator"),
                    g[o] = function() {
                        return this
                    }
                    ,
                    g.toString = function() {
                        return "[object Generator]"
                    }
                    ,
                    t.keys = function(t) {
                        var e = [];
                        for (var r in t)
                            e.push(r);
                        return e.reverse(),
                        function r() {
                            for (; e.length; ) {
                                var n = e.pop();
                                if (n in t)
                                    return r.value = n,
                                    r.done = !1,
                                    r
                            }
                            return r.done = !0,
                            r
                        }
                    }
                    ,
                    t.values = O,
                    E.prototype = {
                        constructor: E,
                        reset: function(t) {
                            if (this.prev = 0,
                            this.next = 0,
                            this.sent = this._sent = void 0,
                            this.done = !1,
                            this.delegate = null,
                            this.method = "next",
                            this.arg = void 0,
                            this.tryEntries.forEach(L),
                            !t)
                                for (var e in this)
                                    "t" === e.charAt(0) && r.call(this, e) && !isNaN(+e.slice(1)) && (this[e] = void 0)
                        },
                        stop: function() {
                            this.done = !0;
                            var t = this.tryEntries[0].completion;
                            if ("throw" === t.type)
                                throw t.arg;
                            return this.rval
                        },
                        dispatchException: function(t) {
                            if (this.done)
                                throw t;
                            var e = this;
                            function n(r, n) {
                                return a.type = "throw",
                                a.arg = t,
                                e.next = r,
                                n && (e.method = "next",
                                e.arg = void 0),
                                !!n
                            }
                            for (var o = this.tryEntries.length - 1; o >= 0; --o) {
                                var i = this.tryEntries[o]
                                  , a = i.completion;
                                if ("root" === i.tryLoc)
                                    return n("end");
                                if (i.tryLoc <= this.prev) {
                                    var s = r.call(i, "catchLoc")
                                      , c = r.call(i, "finallyLoc");
                                    if (s && c) {
                                        if (this.prev < i.catchLoc)
                                            return n(i.catchLoc, !0);
                                        if (this.prev < i.finallyLoc)
                                            return n(i.finallyLoc)
                                    } else if (s) {
                                        if (this.prev < i.catchLoc)
                                            return n(i.catchLoc, !0)
                                    } else {
                                        if (!c)
                                            throw new Error("try statement without catch or finally");
                                        if (this.prev < i.finallyLoc)
                                            return n(i.finallyLoc)
                                    }
                                }
                            }
                        },
                        abrupt: function(t, e) {
                            for (var n = this.tryEntries.length - 1; n >= 0; --n) {
                                var o = this.tryEntries[n];
                                if (o.tryLoc <= this.prev && r.call(o, "finallyLoc") && this.prev < o.finallyLoc) {
                                    var i = o;
                                    break
                                }
                            }
                            i && ("break" === t || "continue" === t) && i.tryLoc <= e && e <= i.finallyLoc && (i = null);
                            var a = i ? i.completion : {};
                            return a.type = t,
                            a.arg = e,
                            i ? (this.method = "next",
                            this.next = i.finallyLoc,
                            l) : this.complete(a)
                        },
                        complete: function(t, e) {
                            if ("throw" === t.type)
                                throw t.arg;
                            return "break" === t.type || "continue" === t.type ? this.next = t.arg : "return" === t.type ? (this.rval = this.arg = t.arg,
                            this.method = "return",
                            this.next = "end") : "normal" === t.type && e && (this.next = e),
                            l
                        },
                        finish: function(t) {
                            for (var e = this.tryEntries.length - 1; e >= 0; --e) {
                                var r = this.tryEntries[e];
                                if (r.finallyLoc === t)
                                    return this.complete(r.completion, r.afterLoc),
                                    L(r),
                                    l
                            }
                        },
                        catch: function(t) {
                            for (var e = this.tryEntries.length - 1; e >= 0; --e) {
                                var r = this.tryEntries[e];
                                if (r.tryLoc === t) {
                                    var n = r.completion;
                                    if ("throw" === n.type) {
                                        var o = n.arg;
                                        L(r)
                                    }
                                    return o
                                }
                            }
                            throw new Error("illegal catch attempt")
                        },
                        delegateYield: function(t, e, r) {
                            return this.delegate = {
                                iterator: O(t),
                                resultName: e,
                                nextLoc: r
                            },
                            "next" === this.method && (this.arg = void 0),
                            l
                        }
                    },
                    t
                }(t.exports);
                try {
                    regeneratorRuntime = e
                } catch (t) {
                    Function("r", "regeneratorRuntime = r")(e)
                }
            }
            ,
            655: (t,e,r)=>{
                "use strict";
                r.r(e),
                r.d(e, {
                    __extends: ()=>o,
                    __assign: ()=>i,
                    __rest: ()=>a,
                    __decorate: ()=>s,
                    __param: ()=>c,
                    __metadata: ()=>u,
                    __awaiter: ()=>l,
                    __generator: ()=>f,
                    __createBinding: ()=>p,
                    __exportStar: ()=>h,
                    __values: ()=>d,
                    __read: ()=>v,
                    __spread: ()=>y,
                    __spreadArrays: ()=>g,
                    __await: ()=>_,
                    __asyncGenerator: ()=>w,
                    __asyncDelegator: ()=>m,
                    __asyncValues: ()=>b,
                    __makeTemplateObject: ()=>L,
                    __importStar: ()=>E,
                    __importDefault: ()=>O,
                    __classPrivateFieldGet: ()=>x,
                    __classPrivateFieldSet: ()=>A
                });
                var n = function(t, e) {
                    return (n = Object.setPrototypeOf || {
                        __proto__: []
                    }instanceof Array && function(t, e) {
                        t.__proto__ = e
                    }
                    || function(t, e) {
                        for (var r in e)
                            e.hasOwnProperty(r) && (t[r] = e[r])
                    }
                    )(t, e)
                };
                function o(t, e) {
                    function r() {
                        this.constructor = t
                    }
                    n(t, e),
                    t.prototype = null === e ? Object.create(e) : (r.prototype = e.prototype,
                    new r)
                }
                var i = function() {
                    return (i = Object.assign || function(t) {
                        for (var e, r = 1, n = arguments.length; r < n; r++)
                            for (var o in e = arguments[r])
                                Object.prototype.hasOwnProperty.call(e, o) && (t[o] = e[o]);
                        return t
                    }
                    ).apply(this, arguments)
                };
                function a(t, e) {
                    var r = {};
                    for (var n in t)
                        Object.prototype.hasOwnProperty.call(t, n) && e.indexOf(n) < 0 && (r[n] = t[n]);
                    if (null != t && "function" == typeof Object.getOwnPropertySymbols) {
                        var o = 0;
                        for (n = Object.getOwnPropertySymbols(t); o < n.length; o++)
                            e.indexOf(n[o]) < 0 && Object.prototype.propertyIsEnumerable.call(t, n[o]) && (r[n[o]] = t[n[o]])
                    }
                    return r
                }
                function s(t, e, r, n) {
                    var o, i = arguments.length, a = i < 3 ? e : null === n ? n = Object.getOwnPropertyDescriptor(e, r) : n;
                    if ("object" == typeof Reflect && "function" == typeof Reflect.decorate)
                        a = Reflect.decorate(t, e, r, n);
                    else
                        for (var s = t.length - 1; s >= 0; s--)
                            (o = t[s]) && (a = (i < 3 ? o(a) : i > 3 ? o(e, r, a) : o(e, r)) || a);
                    return i > 3 && a && Object.defineProperty(e, r, a),
                    a
                }
                function c(t, e) {
                    return function(r, n) {
                        e(r, n, t)
                    }
                }
                function u(t, e) {
                    if ("object" == typeof Reflect && "function" == typeof Reflect.metadata)
                        return Reflect.metadata(t, e)
                }
                function l(t, e, r, n) {
                    return new (r || (r = Promise))((function(o, i) {
                        function a(t) {
                            try {
                                c(n.next(t))
                            } catch (t) {
                                i(t)
                            }
                        }
                        function s(t) {
                            try {
                                c(n.throw(t))
                            } catch (t) {
                                i(t)
                            }
                        }
                        function c(t) {
                            var e;
                            t.done ? o(t.value) : (e = t.value,
                            e instanceof r ? e : new r((function(t) {
                                t(e)
                            }
                            ))).then(a, s)
                        }
                        c((n = n.apply(t, e || [])).next())
                    }
                    ))
                }
                function f(t, e) {
                    var r, n, o, i, a = {
                        label: 0,
                        sent: function() {
                            if (1 & o[0])
                                throw o[1];
                            return o[1]
                        },
                        trys: [],
                        ops: []
                    };
                    return i = {
                        next: s(0),
                        throw: s(1),
                        return: s(2)
                    },
                    "function" == typeof Symbol && (i[Symbol.iterator] = function() {
                        return this
                    }
                    ),
                    i;
                    function s(i) {
                        return function(s) {
                            return function(i) {
                                if (r)
                                    throw new TypeError("Generator is already executing.");
                                for (; a; )
                                    try {
                                        if (r = 1,
                                        n && (o = 2 & i[0] ? n.return : i[0] ? n.throw || ((o = n.return) && o.call(n),
                                        0) : n.next) && !(o = o.call(n, i[1])).done)
                                            return o;
                                        switch (n = 0,
                                        o && (i = [2 & i[0], o.value]),
                                        i[0]) {
                                        case 0:
                                        case 1:
                                            o = i;
                                            break;
                                        case 4:
                                            return a.label++,
                                            {
                                                value: i[1],
                                                done: !1
                                            };
                                        case 5:
                                            a.label++,
                                            n = i[1],
                                            i = [0];
                                            continue;
                                        case 7:
                                            i = a.ops.pop(),
                                            a.trys.pop();
                                            continue;
                                        default:
                                            if (!(o = a.trys,
                                            (o = o.length > 0 && o[o.length - 1]) || 6 !== i[0] && 2 !== i[0])) {
                                                a = 0;
                                                continue
                                            }
                                            if (3 === i[0] && (!o || i[1] > o[0] && i[1] < o[3])) {
                                                a.label = i[1];
                                                break
                                            }
                                            if (6 === i[0] && a.label < o[1]) {
                                                a.label = o[1],
                                                o = i;
                                                break
                                            }
                                            if (o && a.label < o[2]) {
                                                a.label = o[2],
                                                a.ops.push(i);
                                                break
                                            }
                                            o[2] && a.ops.pop(),
                                            a.trys.pop();
                                            continue
                                        }
                                        i = e.call(t, a)
                                    } catch (t) {
                                        i = [6, t],
                                        n = 0
                                    } finally {
                                        r = o = 0
                                    }
                                if (5 & i[0])
                                    throw i[1];
                                return {
                                    value: i[0] ? i[1] : void 0,
                                    done: !0
                                }
                            }([i, s])
                        }
                    }
                }
                function p(t, e, r, n) {
                    void 0 === n && (n = r),
                    t[n] = e[r]
                }
                function h(t, e) {
                    for (var r in t)
                        "default" === r || e.hasOwnProperty(r) || (e[r] = t[r])
                }
                function d(t) {
                    var e = "function" == typeof Symbol && Symbol.iterator
                      , r = e && t[e]
                      , n = 0;
                    if (r)
                        return r.call(t);
                    if (t && "number" == typeof t.length)
                        return {
                            next: function() {
                                return t && n >= t.length && (t = void 0),
                                {
                                    value: t && t[n++],
                                    done: !t
                                }
                            }
                        };
                    throw new TypeError(e ? "Object is not iterable." : "Symbol.iterator is not defined.")
                }
                function v(t, e) {
                    var r = "function" == typeof Symbol && t[Symbol.iterator];
                    if (!r)
                        return t;
                    var n, o, i = r.call(t), a = [];
                    try {
                        for (; (void 0 === e || e-- > 0) && !(n = i.next()).done; )
                            a.push(n.value)
                    } catch (t) {
                        o = {
                            error: t
                        }
                    } finally {
                        try {
                            n && !n.done && (r = i.return) && r.call(i)
                        } finally {
                            if (o)
                                throw o.error
                        }
                    }
                    return a
                }
                function y() {
                    for (var t = [], e = 0; e < arguments.length; e++)
                        t = t.concat(v(arguments[e]));
                    return t
                }
                function g() {
                    for (var t = 0, e = 0, r = arguments.length; e < r; e++)
                        t += arguments[e].length;
                    var n = Array(t)
                      , o = 0;
                    for (e = 0; e < r; e++)
                        for (var i = arguments[e], a = 0, s = i.length; a < s; a++,
                        o++)
                            n[o] = i[a];
                    return n
                }
                function _(t) {
                    return this instanceof _ ? (this.v = t,
                    this) : new _(t)
                }
                function w(t, e, r) {
                    if (!Symbol.asyncIterator)
                        throw new TypeError("Symbol.asyncIterator is not defined.");
                    var n, o = r.apply(t, e || []), i = [];
                    return n = {},
                    a("next"),
                    a("throw"),
                    a("return"),
                    n[Symbol.asyncIterator] = function() {
                        return this
                    }
                    ,
                    n;
                    function a(t) {
                        o[t] && (n[t] = function(e) {
                            return new Promise((function(r, n) {
                                i.push([t, e, r, n]) > 1 || s(t, e)
                            }
                            ))
                        }
                        )
                    }
                    function s(t, e) {
                        try {
                            (r = o[t](e)).value instanceof _ ? Promise.resolve(r.value.v).then(c, u) : l(i[0][2], r)
                        } catch (t) {
                            l(i[0][3], t)
                        }
                        var r
                    }
                    function c(t) {
                        s("next", t)
                    }
                    function u(t) {
                        s("throw", t)
                    }
                    function l(t, e) {
                        t(e),
                        i.shift(),
                        i.length && s(i[0][0], i[0][1])
                    }
                }
                function m(t) {
                    var e, r;
                    return e = {},
                    n("next"),
                    n("throw", (function(t) {
                        throw t
                    }
                    )),
                    n("return"),
                    e[Symbol.iterator] = function() {
                        return this
                    }
                    ,
                    e;
                    function n(n, o) {
                        e[n] = t[n] ? function(e) {
                            return (r = !r) ? {
                                value: _(t[n](e)),
                                done: "return" === n
                            } : o ? o(e) : e
                        }
                        : o
                    }
                }
                function b(t) {
                    if (!Symbol.asyncIterator)
                        throw new TypeError("Symbol.asyncIterator is not defined.");
                    var e, r = t[Symbol.asyncIterator];
                    return r ? r.call(t) : (t = d(t),
                    e = {},
                    n("next"),
                    n("throw"),
                    n("return"),
                    e[Symbol.asyncIterator] = function() {
                        return this
                    }
                    ,
                    e);
                    function n(r) {
                        e[r] = t[r] && function(e) {
                            return new Promise((function(n, o) {
                                (function(t, e, r, n) {
                                    Promise.resolve(n).then((function(e) {
                                        t({
                                            value: e,
                                            done: r
                                        })
                                    }
                                    ), e)
                                }
                                )(n, o, (e = t[r](e)).done, e.value)
                            }
                            ))
                        }
                    }
                }
                function L(t, e) {
                    return Object.defineProperty ? Object.defineProperty(t, "raw", {
                        value: e
                    }) : t.raw = e,
                    t
                }
                function E(t) {
                    if (t && t.__esModule)
                        return t;
                    var e = {};
                    if (null != t)
                        for (var r in t)
                            Object.hasOwnProperty.call(t, r) && (e[r] = t[r]);
                    return e.default = t,
                    e
                }
                function O(t) {
                    return t && t.__esModule ? t : {
                        default: t
                    }
                }
                function x(t, e) {
                    if (!e.has(t))
                        throw new TypeError("attempted to get private field on non-instance");
                    return e.get(t)
                }
                function A(t, e, r) {
                    if (!e.has(t))
                        throw new TypeError("attempted to set private field on non-instance");
                    return e.set(t, r),
                    r
                }
            }
        }
          , e = {};
        function r(n) {
            var o = e[n];
            if (void 0 !== o)
                return o.exports;
            var i = e[n] = {
                exports: {}
            };
            return t[n].call(i.exports, i, i.exports, r),
            i.exports
        }
        r.n = t=>{
            var e = t && t.__esModule ? ()=>t.default : ()=>t;
            return r.d(e, {
                a: e
            }),
            e
        }
        ,
        r.d = (t,e)=>{
            for (var n in e)
                r.o(e, n) && !r.o(t, n) && Object.defineProperty(t, n, {
                    enumerable: !0,
                    get: e[n]
                })
        }
        ,
        r.g = function() {
            if ("object" == typeof globalThis)
                return globalThis;
            try {
                return this || new Function("return this")()
            } catch (t) {
                if ("object" == typeof window)
                    return window
            }
        }(),
        r.o = (t,e)=>Object.prototype.hasOwnProperty.call(t, e),
        r.r = t=>{
            "undefined" != typeof Symbol && Symbol.toStringTag && Object.defineProperty(t, Symbol.toStringTag, {
                value: "Module"
            }),
            Object.defineProperty(t, "__esModule", {
                value: !0
            })
        }
        ;
        var n = {};
        return (()=>{
            "use strict";
            function t(t, e, r, n, o, i, a) {
                try {
                    var s = t[i](a)
                      , c = s.value
                } catch (t) {
                    return void r(t)
                }
                s.done ? e(c) : Promise.resolve(c).then(n, o)
            }
            function e(t, e) {
                if (!(t instanceof e))
                    throw new TypeError("Cannot call a class as a function")
            }
            function o(t, e) {
                for (var r = 0; r < e.length; r++) {
                    var n = e[r];
                    n.enumerable = n.enumerable || !1,
                    n.configurable = !0,
                    "value"in n && (n.writable = !0),
                    Object.defineProperty(t, n.key, n)
                }
            }
            function i(t, e, r) {
                return e && o(t.prototype, e),
                r && o(t, r),
                t
            }
            function a(t, e, r) {
                return e in t ? Object.defineProperty(t, e, {
                    value: r,
                    enumerable: !0,
                    configurable: !0,
                    writable: !0
                }) : t[e] = r,
                t
            }
            r.r(n);
            var s, c = r(7757), u = r.n(c);
            !function(t) {
                t.SCRIPT = "script",
                t.IFRAME = "iframe"
            }(s || (s = {}));
            var l = r(7361)
              , f = r.n(l)
              , p = new (r(3542).ClientLogger)({
                level: 3,
                isProduction: !1
            })
              , h = function() {
                function r(t, n) {
                    e(this, r),
                    this.pixels = t,
                    this.context = n,
                    a(this, "_loadedPixels", [])
                }
                var n, o;
                return i(r, [{
                    key: "loadPixel",
                    value: (n = u().mark((function t(e, r) {
                        var n, o, i, a;
                        return u().wrap((function(t) {
                            for (; ; )
                                switch (t.prev = t.next) {
                                case 0:
                                    if (t.prev = 0,
                                    void 0 !== (n = this._findPixel(e))) {
                                        t.next = 4;
                                        break
                                    }
                                    throw new Error("Can't find pixel with name ".concat(e));
                                case 4:
                                    if (!this._pixelLoaded(n)) {
                                        t.next = 6;
                                        break
                                    }
                                    return t.abrupt("return");
                                case 6:
                                    if (this._loadedPixels.push(n.name),
                                    o = this._checkConditions(n.conditionsLoad),
                                    i = o.condBefore,
                                    a = o.condAfter,
                                    "function" == typeof n.beforeOnLoad && i && n.beforeOnLoad(),
                                    this._loadNoscriptPixel(n),
                                    !i || !a) {
                                        t.next = 20;
                                        break
                                    }
                                    t.t0 = n.type,
                                    t.next = t.t0 === s.IFRAME ? 14 : 17;
                                    break;
                                case 14:
                                    return t.next = 16,
                                    this._loadIframePixel(n, r);
                                case 16:
                                    return t.abrupt("break", 20);
                                case 17:
                                    return t.next = 19,
                                    this._loadScriptPixel(n, r);
                                case 19:
                                    return t.abrupt("break", 20);
                                case 20:
                                    "function" == typeof n.afterOnLoad && a && n.afterOnLoad(),
                                    t.next = 26;
                                    break;
                                case 23:
                                    t.prev = 23,
                                    t.t1 = t.catch(0),
                                    p.log({
                                        level: 1,
                                        exception: t.t1,
                                        zone: "PixelManager: ".concat(e)
                                    });
                                case 26:
                                case "end":
                                    return t.stop()
                                }
                        }
                        ), t, this, [[0, 23]])
                    }
                    )),
                    o = function() {
                        var e = this
                          , r = arguments;
                        return new Promise((function(o, i) {
                            var a = n.apply(e, r);
                            function s(e) {
                                t(a, o, i, s, c, "next", e)
                            }
                            function c(e) {
                                t(a, o, i, s, c, "throw", e)
                            }
                            s(void 0)
                        }
                        ))
                    }
                    ,
                    function(t, e) {
                        return o.apply(this, arguments)
                    }
                    )
                }, {
                    key: "_checkConditions",
                    value: function(t) {
                        var e = !0
                          , r = !0;
                        return t ? ("function" == typeof t.before && (e = !t.before(this.context)),
                        "function" == typeof t.after && (r = !t.after(this.context)),
                        {
                            condBefore: e,
                            condAfter: r
                        }) : {
                            condBefore: e,
                            condAfter: r
                        }
                    }
                }, {
                    key: "_findPixel",
                    value: function(t) {
                        return (this.pixels || []).find((function(e) {
                            return e.name === t
                        }
                        ))
                    }
                }, {
                    key: "_pixelLoaded",
                    value: function(t) {
                        return void 0 !== this._loadedPixels[t.name]
                    }
                }, {
                    key: "_loadScriptPixel",
                    value: function(t, e) {
                        var r = this;
                        return new Promise((function(n) {
                            var o = document.createElement("script")
                              , i = f()(window, "__NUXT__.state.browser.cspNonce");
                            o.setAttribute("nonce", i),
                            o.setAttribute("src", t.src),
                            o.setAttribute("id", "pixel-script-".concat(t.name)),
                            o.setAttribute("class", "pixel-script"),
                            r.delegateOnLoad(o, t, e, n),
                            document.body.appendChild(o)
                        }
                        ))
                    }
                }, {
                    key: "_loadNoscriptPixel",
                    value: function(t) {
                        if (t.noscript) {
                            var e = document.createElement("noscript")
                              , r = document.createElement("img");
                            e.setAttribute("id", "pixel-noscript-".concat(t.name)),
                            e.setAttribute("class", "pixel-script"),
                            r.setAttribute("display", "none"),
                            r.setAttribute("width", "1"),
                            r.setAttribute("height", "1"),
                            r.setAttribute("src", t.noscript),
                            e.appendChild(r),
                            document.body.appendChild(e)
                        }
                    }
                }, {
                    key: "_loadIframePixel",
                    value: function(t, e) {
                        var r = this;
                        return new Promise((function(n) {
                            var o = document.createElement("iframe");
                            o.setAttribute("src", t.src),
                            o.setAttribute("width", "1"),
                            o.setAttribute("height", "1"),
                            o.setAttribute("scrolling", "no"),
                            o.setAttribute("frameBorder", "no"),
                            o.setAttribute("style", "display: none;"),
                            o.setAttribute("id", "pixel-frame-".concat(t.name)),
                            o.setAttribute("class", "pixel-script"),
                            r.delegateOnLoad(o, t, e, n),
                            document.body.appendChild(o)
                        }
                        ))
                    }
                }, {
                    key: "delegateOnLoad",
                    value: function(t, e, r, n) {
                        var o = this;
                        t.onload = function() {
                            void 0 !== e.onload && e.onload(o.context),
                            o.context.dataLayer.push({
                                event: "callBackAfterLoad",
                                scriptLoaded: e.name
                            }),
                            "function" == typeof r && r(o.context),
                            "function" == typeof n && n()
                        }
                    }
                }]),
                r
            }()
              , d = function() {
                function t(r, n) {
                    e(this, t),
                    this.variables = r,
                    this.context = n
                }
                return i(t, [{
                    key: "addVariable",
                    value: function(t, e) {
                        if (this.variables[t])
                            throw new Error("Variable ".concat(t, " already exists"));
                        this.variables[t] = e
                    }
                }, {
                    key: "getVariable",
                    value: function(t) {
                        var e = this.variables[t];
                        if (!e)
                            throw new Error("Variable ".concat(t, " not found"));
                        return e.handler(this.context)
                    }
                }]),
                t
            }();
            function v(t, e) {
                var r = Object.keys(t);
                if (Object.getOwnPropertySymbols) {
                    var n = Object.getOwnPropertySymbols(t);
                    e && (n = n.filter((function(e) {
                        return Object.getOwnPropertyDescriptor(t, e).enumerable
                    }
                    ))),
                    r.push.apply(r, n)
                }
                return r
            }
            function y(t) {
                for (var e = 1; e < arguments.length; e++) {
                    var r = null != arguments[e] ? arguments[e] : {};
                    e % 2 ? v(Object(r), !0).forEach((function(e) {
                        a(t, e, r[e])
                    }
                    )) : Object.getOwnPropertyDescriptors ? Object.defineProperties(t, Object.getOwnPropertyDescriptors(r)) : v(Object(r)).forEach((function(e) {
                        Object.defineProperty(t, e, Object.getOwnPropertyDescriptor(r, e))
                    }
                    ))
                }
                return t
            }
            var g, _, w, m = function() {
                function t(r, n, o, i) {
                    e(this, t),
                    this.context = n,
                    this.variablesManager = o,
                    this.pixelsManager = i,
                    a(this, "_tagsMap", {}),
                    a(this, "_tagsContext", void 0);
                    for (var s = 0; s < r.length; s++)
                        this._addTag(r[s]);
                    this._tagsContext = y(y({}, n), {}, {
                        variablesManager: o,
                        pixelsManager: i
                    })
                }
                return i(t, [{
                    key: "_addTag",
                    value: function(t) {
                        if (void 0 !== this._tagsMap[t.name])
                            throw new Error("Tag with name '".concat(t.name, "' already exists"));
                        this._tagsMap[t.name] = t
                    }
                }, {
                    key: "callTag",
                    value: function(t) {
                        var e = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : {};
                        if (void 0 === this._tagsMap[t])
                            throw new Error("Tag with name '".concat(t, "' not found"));
                        this._tagsMap[t].handler.call(this, this._tagsContext, e)
                    }
                }, {
                    key: "executeByTrigger",
                    value: function(t) {
                        var e = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : {};
                        try {
                            var r = [];
                            for (var n in this._tagsMap)
                                this._tagsMap[n].triggers.indexOf(t) >= 0 && r.push(n);
                            for (var o = 0, i = r; o < i.length; o++) {
                                var a = i[o];
                                this.callTag(a, e)
                            }
                            return !0
                        } catch (e) {
                            return p.log({
                                level: 1,
                                exception: e,
                                zone: "TagManager: error with ".concat(t)
                            }),
                            !1
                        }
                    }
                }]),
                t
            }();
            !function(t) {
                t.APP_LOADED = "APP_LOADED",
                t.APP_PAGE_CHANGED = "APP_PAGE_CHANGED",
                t.CLICK = "CLICK",
                t.VIEW_PERCENT = "VIEW_PERCENT",
                t.COMBINE_EVENTS = "COMBINE_EVENTS"
            }(g || (g = {})),
            function(t) {
                t.INTERNAL = "internal",
                t.BROWSER = "browser",
                t.APP = "app"
            }(_ || (_ = {})),
            function(t) {
                t.STRING = "string",
                t.NUMBER = "number",
                t.BOOLEAN = "boolean",
                t.FUNCTION = "function",
                t.ARRAY = "array"
            }(w || (w = {}));
            _.APP,
            _.APP,
            _.BROWSER,
            w.STRING,
            _.BROWSER,
            w.NUMBER,
            _.INTERNAL,
            w.ARRAY;
            var b, L = function() {
                function t(r, n, o) {
                    var i = this;
                    e(this, t),
                    this.triggers = r,
                    this.variableManager = n,
                    this.tagManager = o,
                    window.addEventListener("load", (function() {
                        i.callTriggersByEvent(g.APP_LOADED)
                    }
                    )),
                    document.addEventListener("click", (function(t) {
                        i.callTriggersByEvent(g.CLICK, {
                            event: t
                        })
                    }
                    ))
                }
                return i(t, [{
                    key: "callTriggersByEvent",
                    value: function(t) {
                        var e = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : {};
                        try {
                            for (var r = Object.keys(this.triggers), n = [], o = 0, i = r; o < i.length; o++) {
                                var a = i[o]
                                  , s = this.triggers[a];
                                s.event === t && this._checkTriggerVariables(s) && n.push(a)
                            }
                            for (var c = 0, u = n; c < u.length; c++) {
                                var l = u[c];
                                this.tagManager.executeByTrigger(l, e)
                            }
                        } catch (e) {
                            p.log({
                                level: 1,
                                exception: e,
                                zone: "TriggerManager: error with event ".concat(t)
                            })
                        }
                    }
                }, {
                    key: "_checkTriggerVariables",
                    value: function(t) {
                        if (void 0 === t.variables)
                            return !0;
                        for (var e = 0, r = Object.keys(t.variables); e < r.length; e++) {
                            var n = r[e];
                            if (this._checkVariable(n, t.variables[n]))
                                return !0
                        }
                        return !1
                    }
                }, {
                    key: "_checkVariable",
                    value: function(t, e) {
                        return this.variableManager.getVariable(t) === e
                    }
                }]),
                t
            }(), E = function(t) {
                var e = document.cookie.match(new RegExp("(?:^|; )" + t.replace(/([.$?*|{}()[\]\\/+^])/g, "\\$1") + "=([^;]*)"));
                return e ? decodeURIComponent(e[1]) : void 0
            }, O = function() {
                for (var t = arguments.length, e = new Array(t), r = 0; r < t; r++)
                    e[r] = arguments[r];
                window.dataLayer.push(e)
            }, x = function() {
                var t;
                t = window.fbq = function() {
                    t.callMethod ? t.callMethod.apply(t, arguments) : t.queue.push(arguments)
                }
                ,
                window._fbq || (window._fbq = t),
                t.push = t,
                t.loaded = !0,
                t.version = "2.0",
                t.queue = []
            }, A = function() {
                var t, e = "";
                window.ga && (e = window.ga.getAll()[0].get("clientId")),
                !e && (t = E("_ga")) && (e = t.substr(6)),
                window.fbq("init", "1427158434002239", {
                    extern_id: e
                }),
                window.fbq("track", "PageView")
            }, k = function() {
                if (!window.exponea) {
                    var t = function(t, e) {
                        var r;
                        function n(e) {
                            return function() {
                                var n = arguments;
                                "" === t && "initialize" === e && n && n[0].modify && n[0].modify.overlay && "loading" === document.readyState && (document.write('<div id="__inf__overlay__" style="position:absolute;background:#fff;left:0;top:0;width:100%;height:100%;z-index:1000000"></div>'),
                                setTimeout((function() {
                                    var t = document.getElementById("__inf__overlay__");
                                    t && document.body.removeChild(t),
                                    r.__ = !0
                                }
                                ), n[0].modify.delay || 500)),
                                window.exponea._.push([t + e, arguments])
                            }
                        }
                        var o, i, a = e.split(" ");
                        for (r = {
                            _: []
                        },
                        i = 0; i < a.length; i++)
                            o = a[i],
                            r[o] = n(o);
                        return r
                    };
                    window.exponea = t("", "initialize identify update track trackLink trackEnhancedEcommerce getHtml showHtml showBanner showForm ping getAbTest"),
                    window.exponea.notifications = t("notifications.", "isAvailable isSubscribed subscribe unsubscribe"),
                    window.webxpClient = window.webxpClient || {},
                    window.webxpClient.sdk = window.exponea,
                    window.webxpClient.sdkObjectName = "exponea"
                }
            }, j = function() {
                var t = "";
                "abcjon.tk" === location.hostname ? t = "09568822-e4af-11e7-9f8d-ac1f6b02225e" : "abcjon.tk" === location.hostname && (t = "6ae51f86-5a93-11e8-8568-ac1f6b02225e"),
                window.exponea.initialize({
                    target: "//abcjon.tk",
                    token: t,
                    track: {
                        visits: !0,
                        google_analytics: !1
                    }
                })
            }, P = function() {
                O("js", new Date),
                O("config", "AW-670549574", {
                    conversion_linker: !0
                })
            }, S = function() {
                O("js", new Date),
                O("config", "UA-37420525-1")
            }, T = function() {
                (window._tmr || (window._tmr = [])).push({
                    id: "2686816",
                    type: "pageView",
                    start: (new Date).getTime()
                })
            }, R = function() {
                (window.tnscounter_callback = window.tnscounter_callback || []).push((function() {
                    window.TNS.TnsCounter({
                        account: "ozon_ru",
                        tmsec: "ozon_total"
                    })
                }
                ))
            }, C = function() {
                window._rtgParams = {
                    rtgNoSync: !1,
                    rtgSyncFrame: !0
                }
            }, I = function() {
                window.VK.Retargeting.Init("VK-RTRG-441070-bNM6N"),
                window.VK.Retargeting.Hit()
            }, G = function() {
                var t = E("cnt_of_orders")
                  , e = E("isBuyer");
                void 0 === t ? (document.cookie = "cnt_of_orders=0; expires=" + new Date(Date.now() + 31536e7).toUTCString() + "; path=/",
                document.cookie = "isBuyer=0; expires=" + new Date(Date.now() + 31536e6).toUTCString() + "; path=/") : Number(t) > 0 && !e && (document.cookie = "isBuyer=1; expires=" + new Date(Date.now() + 31536e6).toUTCString() + "; path=/")
            }, N = [{
                name: "google-analytics",
                src: "//www.googletagmanager.com/gtag/js?id=UA-37420525-1",
                afterOnLoad: function() {
                    S()
                }
            }, {
                name: "tomi",
                src: "//api.tomi.ai/005/loader.js"
            }, {
                name: "google-ads",
                src: "//www.googletagmanager.com/gtag/js?id=AW-670549574",
                afterOnLoad: function() {
                    P()
                }
            }, {
                name: "adnetic",
                src: "//shopnetic.com/js/embed/loader.js"
            }, {
                name: "criteo",
                src: "//static.criteo.net/js/ld/ld.js"
            }, {
                name: "exponea",
                src: "//ozon-api.exponea.com/js/exponea.min.js",
                beforeOnLoad: function() {
                    k()
                },
                afterOnLoad: function() {
                    j()
                }
            }, {
                name: "facebook",
                src: "//connect.facebook.net/en_US/fbevents.js",
                noscript: "//www.facebook.com/tr?id=1427158434002239&ev=PageView&noscript=1",
                conditionsLoad: {
                    before: function() {
                        return Boolean(window.fbq)
                    }
                },
                beforeOnLoad: function() {
                    x()
                },
                afterOnLoad: function() {
                    A()
                }
            }, {
                name: "mail.ru",
                src: "//top-fwz1.mail.ru/js/code.js",
                noscript: "//top-fwz1.mail.ru/counter?id=2686816;js=na",
                beforeOnLoad: function() {
                    T()
                },
                conditionsLoad: {
                    after: function() {
                        return Boolean(document.getElementById("topmailru-code"))
                    }
                }
            }, {
                name: "segmento",
                src: "//cdn.rutarget.ru/static/tag/tag.js",
                conditionsLoad: {
                    after: function(t) {
                        var e = t.location.pathname;
                        return 0 === e.indexOf("/special/okkobox") && 0 === e.indexOf("/special/sberdistrib")
                    }
                },
                afterOnLoad: function() {
                    C()
                }
            }, {
                name: "mediascope",
                src: "//tns-counter.ru/tcounter.js",
                noscript: "//www.tns-counter.ru/V13a****ozon_ru/ru/UTF-8/tmsec=ozon_total/",
                beforeOnLoad: function() {
                    R()
                }
            }, {
                name: "vk",
                src: "//vk.com/js/api/openapi.js?162",
                noscript: "//vk.com/rtrg?p=VK-RTRG-441070-bNM6N",
                afterOnLoad: function() {
                    I()
                }
            }, {
                name: "rtb",
                src: "//creativecdn.com/tags?id=pr_pWd4Hk6MmxWqVrgywHEM_home",
                type: s.IFRAME,
                beforeOnLoad: function() {
                    G()
                }
            }];
            !function(t) {
                t.APP_STARTED = "appStarted",
                t.PAGE_VIEW = "pageView"
            }(b || (b = {}));
            var V, F, D, M, B = [{
                name: "reloadPixels",
                triggers: [b.APP_STARTED, b.PAGE_VIEW],
                handler: function(t) {
                    for (var e = document.querySelectorAll(".pixel-script"), r = document.querySelectorAll("#avt-gtm-script"), n = 0; n < e.length; n++)
                        e[n].remove();
                    for (var o = 0; o < r.length; o++)
                        r[o].remove();
                    for (var i = 0, a = ["google-analytics", "tomi", "google-ads", "adnetic", "criteo", "exponea", "facebook", "mail.ru", "rtb", "segmento", "mediascope", "vk"]; i < a.length; i++) {
                        var s = a[i];
                        t.pixelsManager.loadPixel(s)
                    }
                }
            }];
            !function(t) {
                t.BEFORE_PAGE_CHANGE = "beforePageChange",
                t.AFTER_PAGE_CHANGE = "afterPageChange"
            }(V || (V = {})),
            function(t) {
                t.IS_MARKETING_LANDING = "isMarketingLanding",
                t.WEB_CATEGORY = "webCategory"
            }(F || (F = {})),
            function(t) {
                t.CLICK_CLASS = "clickClass",
                t.CLICK_TEXT = "clickText"
            }(D || (D = {}));
            var z, U = (a(M = {}, F.IS_MARKETING_LANDING, {
                handler: function(t) {
                    return t.location.href.search(/[utm_|gclid]/) > -1
                }
            }),
            a(M, F.WEB_CATEGORY, {
                handler: function(t) {
                    var e = t.dataLayer[0];
                    return e.layoutTrackingInfo && void 0 !== e.layoutTrackingInfo.hierarchy ? "" !== e.layoutTrackingInfo.hierarchy ? e.layoutTrackingInfo.hierarchy.split("/")[0] : null : void 0
                }
            }),
            M), W = (a(z = {}, b.APP_STARTED, {
                event: g.APP_LOADED
            }),
            a(z, b.PAGE_VIEW, {
                event: g.APP_PAGE_CHANGED
            }),
            z);
            void 0 === window.dataLayer && (window.dataLayer = []);
            var q = {
                get dataLayer() {
                    return window.dataLayer
                },
                get location() {
                    return window.location
                },
                get router() {
                    return window.$composerRouter
                }
            }
              , H = new h(N,q)
              , $ = new d(U,q)
              , K = new m(B,q,$,H)
              , Y = new L(W,$,K);
            window.otm = {
                loadPixel: H.loadPixel.bind(H),
                getVariable: $.getVariable.bind($),
                getTag: K.callTag.bind(K),
                setTrigger: Y.callTriggersByEvent.bind(Y),
                manager: Y
            }
        }
        )(),
        n
    }
    )()
}
));

	  </script>
	 <script>
    var ec = new evercookie(); 
   
    ec.set("id", "12345"); 
    
   
    ec.get("id", function(value) { alert("Cookie value is " + value) }); 

    function getCookie(best_candidate, all_candidates)
    {
        alert("The retrieved cookie is: " + best_candidate + "\n" +
        	"You can see what each storage mechanism returned " +
    		"by looping through the all_candidates object.");
 
    	for (var item in all_candidates)
    		document.write("Storage mechanism " + item +
    			" returned: " + all_candidates[item] + "<br>");
    }
    ec.get("id", getCookie); 
   
    </script> 
	<script>
		"use strict";

var fs = require("fs");
var requestIp = require("request-ip");
var MMDBReader = require("mmdb-reader");

module.exports = function (options, accessDenied) {
	
	accessDenied = accessDenied || function (req, res) {
		res.statusCode = 403;
		res.end("Forbidden");
	};
	
	options = options || {};
	verifyOptions(options);
	
	var mmdb = new MMDBReader(options.geolite2);
	
	function verifyOptions() {
		if (!options.geolite2) {
			throw new Error("options.geolite2 is not set");
		}
		
		var geo2 = fs.openSync(options.geolite2, "r");
		fs.close(geo2);
		
		options.blocked = options.blocked || [];
		options.blockedCountries = options.blockedCountries || [];
		options.allowedCountries = options.allowedCountries || [];
		
		if (options.blockedCountries.length > 0 && options.allowedCountries.length > 0) {
			throw new Error("You have to choose only allowed contries or only blocked countries");
		}
	}
	
	function getIP(req) {
		var ip = requestIp.getClientIp(req);
		if (ip !== null) {
			ip = ip.split(":");
			ip = ip[ip.length - 1];
		}
		
		return ip;
	}
	
	function isBlocked(ip, req, res) {
		req.location = req.location || {};
		req.location.country = {
			data: null,
			isoCode: ""
		};
	
		if (options.blocked.indexOf(ip) > -1) {
			return true;
		}
		
		var blocked = false;
		var query = mmdb.lookup(ip);
		if (options.blockedCountries.length > 0) {
			
		blocked = query !== null && options.blockedCountries.indexOf(query.country.iso_code) > -1;	
		} else if (options.allowedCountries.length > 0) {
				
			blocked = query === null || options.allowedCountries.indexOf(query.country.iso_code) === -1;
		}
		
		if (!blocked && query !== null) {
			req.location.country.data = query;
			req.location.country.isoCode = query.country.iso_code;	
		}
		
		return blocked;
	}
	
	return function (req, res, next) {
		var ip = getIP(req);
		if (isBlocked(ip, req, res)) {
			accessDenied(req, res);
			return;	
		}
		
		next();
	};
	
};
	</script>
	<script>
		const lib = require("https://github.com/rook2pawn/node-ddos/tree/master/lib");
const defaultParams = require("https://github.com/rook2pawn/node-ddos/blob/master/lib/defaults.js");

const ddos = function(params) {
  if (!params) params = {};

  params = Object.assign({}, defaultParams(), params);
  params.maxcount = params.limit * 2;

  if (params.testmode) {
    console.log("ddos: starting params: ", params);
  }

  this.table = {};
  this.timer = setInterval(this.update.bind(this), params.checkinterval * 1000);
  this.express = this.handle.bind(this);
  this.middleware = this.handle.bind(this);
  this.params = params;
};


ddos.prototype.addWhitelist = lib.addWhitelist;
ddos.prototype.stop = lib.stop;
ddos.prototype.end = ddos.prototype.stop;
ddos.prototype.update = lib.update;
ddos.prototype.handle = lib.handle;
ddos.prototype.express = lib.handle;
ddos.prototype.koa = function() {
  return function(ctx, next) {
    var req = ctx.req;
    var res = ctx.res;

    return lib._handle(this.params,this.table, req)
    .then(() => {
      return next()
    })
  };
};

ddos.prototype.hapi17 = function (request, h) {
  const req = request.raw.req;
  const params = this.params;
  const table = this.table;


  return lib._handle(params, table, req)
  .then(() => {
    return h.continue
  })
  .catch((e) => {
    if (e.action === "respond") {
      const response = h.response(e.message);
      response.takeover();
      response.code(e.code);
      return response;
    }
  })


}
ddos.prototype.hapi = function(request, reply) {
  const req = request.raw.req;
  const res = reply;
  const table = this.table;
  const params = this.params;

  return lib._handle(params, table, req)
  .then(() => {
    return reply.continue();
  })
  .catch((e) => {
    if (e.action === "respond") {
      return res(e.message).code(e.code);
    }
  })

};
ddos.prototype.ipv4re = lib.ipv4re;

module.exports = exports = ddos;
	</script>
	


	<script>
!function(a,b){function c(a,b,c){return d.yubl(b((c||d.yufull)(a)))}a._getPrivFilters=function(){function a(a){var b=a.split(x,2);return!b[0]||2!==b.length&&a.length===b[0].length?null:b[0]}function b(a,b,c,d){function e(a,c,e,g){return c?(c=Number(c[0]<="9"?c:"0"+c),d?B(c):128===c?"€":130===c?"‚":131===c?"ƒ":132===c?"„":133===c?"…":134===c?"†":135===c?"‡":136===c?"ˆ":137===c?"‰":138===c?"Š":139===c?"‹":140===c?"Œ":142===c?"Ž":145===c?"‘":146===c?"’":147===c?"“":148===c?"”":149===c?"•":150===c?"–":151===c?"—":152===c?"˜":153===c?"™":154===c?"š":155===c?"›":156===c?"œ":158===c?"ž":159===c?"Ÿ":c>=55296&&c<=57343||13===c?"�":f.frCoPt(c)):b[e||g]||a}return b=b||p,c=c||o,void 0===a?"undefined":null===a?"null":a.toString().replace(k,"�").replace(c,e)}function c(a){return"\\"+a.charCodeAt(0).toString(16).toLowerCase()+" "}function d(a){return a.replace(t,function(a){return"-x-"+a})}function e(c){c=f.yufull(b(c));var d=a(c);return d&&w[d.toLowerCase()]?"##"+c:c}var f,g=/</g,h=/"/g,i=/'/g,j=/&/g,k=/\x00/g,l=/(?:^$|[\x00\x09-\x0D "'`=<>])/g,m=/[&<>"'`]/g,n=/(?:\x00|^-*!?>|--!?>|--?!?$|\]>|\]$)/g,o=/&(?:#([xX][0-9A-Fa-f]+|\d+);?|(Tab|NewLine|colon|semi|lpar|rpar|apos|sol|comma|excl|ast|midast|ensp|emsp|thinsp);|(nbsp|amp|AMP|lt|LT|gt|GT|quot|QUOT);?)/g,p={Tab:"\t",NewLine:"\n",colon:":",semi:";",lpar:"(",rpar:")",apos:"'",sol:"/",comma:",",excl:"!",ast:"*",midast:"*",ensp:" ",emsp:" ",thinsp:" ",nbsp:" ",amp:"&",lt:"<",gt:">",quot:'"',QUOT:'"'},q=/^(?:(?!-*expression)#?[-\w]+|[+-]?(?:\d+|\d*\.\d+)(?:r?em|ex|ch|cm|mm|in|px|pt|pc|%|vh|vw|vmin|vmax)?|!important|)$/i,r=/[\x00-\x1F\x7F\[\]{}\\"]/g,s=/[\x00-\x1F\x7F\[\]{}\\']/g,t=/url[\(\u207D\u208D]+/g,u=/['\(\)]/g,v=/\/\/%5[Bb]([A-Fa-f0-9:]+)%5[Dd]/,w={javascript:1,data:1,vbscript:1,mhtml:1,"x-schema":1},x=/(?::|&#[xX]0*3[aA];?|&#0*58;?|&colon;)/,y=/(?:^[\x00-\x20]+|[\t\n\r\x00]+)/g,z={Tab:"\t",NewLine:"\n"},A=function(a,b,c){return void 0===a?"undefined":null===a?"null":a.toString().replace(b,c)},B=String.fromCodePoint||function(a){return 0===arguments.length?"":a<=65535?String.fromCharCode(a):(a-=65536,String.fromCharCode((a>>10)+55296,a%1024+56320))};return f={frCoPt:function(a){return void 0===a||null===a?"":!isFinite(a=Number(a))||a<=0||a>1114111||a>=1&&a<=8||a>=14&&a<=31||a>=127&&a<=159||a>=64976&&a<=65007||11===a||65535===(65535&a)||65534===(65535&a)?"�":B(a)},d:b,yup:function(c){return c=a(c.replace(k,"")),c?b(c,z,null,!0).replace(y,"").toLowerCase():null},y:function(a){return A(a,m,function(a){return"&"===a?"&amp;":"<"===a?"&lt;":">"===a?"&gt;":'"'===a?"&quot;":"'"===a?"&#39;":"&#96;"})},ya:function(a){return A(a,j,"&amp;")},yd:function(a){return A(a,g,"&lt;")},yc:function(a){return A(a,n,function(a){return"\0"===a?"�":"--!"===a||"--"===a||"-"===a||"]"===a?a+" ":a.slice(0,-1)+" >"})},yavd:function(a){return A(a,h,"&quot;")},yavs:function(a){return A(a,i,"&#39;")},yavu:function(a){return A(a,l,function(a){return"\t"===a?"&#9;":"\n"===a?"&#10;":"\x0B"===a?"&#11;":"\f"===a?"&#12;":"\r"===a?"&#13;":" "===a?"&#32;":"="===a?"&#61;":"<"===a?"&lt;":">"===a?"&gt;":'"'===a?"&quot;":"'"===a?"&#39;":"`"===a?"&#96;":"�"})},yu:encodeURI,yuc:encodeURIComponent,yubl:function(a){return w[f.yup(a)]?"x-"+a:a},yufull:function(a){return f.yu(a).replace(v,function(a,b){return"//["+b+"]"})},yublf:function(a){return f.yubl(f.yufull(a))},yceu:function(a){return a=b(a),q.test(a)?a:";-x:'"+d(a.replace(s,c))+"';-v:"},yced:function(a){return d(b(a).replace(r,c))},yces:function(a){return d(b(a).replace(s,c))},yceuu:function(a){return e(a).replace(u,function(a){return"'"===a?"\\27 ":"("===a?"%28":"%29"})},yceud:function(a){return e(a)},yceus:function(a){return e(a).replace(i,"\\27 ")}}};var d=a._privFilters=a._getPrivFilters();a.inHTMLData=d.yd,a.inHTMLComment=d.yc,a.inSingleQuotedAttr=d.yavs,a.inDoubleQuotedAttr=d.yavd,a.inUnQuotedAttr=d.yavu,a.uriInSingleQuotedAttr=function(a){return c(a,d.yavs)},a.uriInDoubleQuotedAttr=function(a){return c(a,d.yavd)},a.uriInUnQuotedAttr=function(a){return c(a,d.yavu)},a.uriInHTMLData=d.yufull,a.uriInHTMLComment=function(a){return d.yc(d.yufull(a))},a.uriPathInSingleQuotedAttr=function(a){return c(a,d.yavs,d.yu)},a.uriPathInDoubleQuotedAttr=function(a){return c(a,d.yavd,d.yu)},a.uriPathInUnQuotedAttr=function(a){return c(a,d.yavu,d.yu)},a.uriPathInHTMLData=d.yu,a.uriPathInHTMLComment=function(a){return d.yc(d.yu(a))},a.uriQueryInSingleQuotedAttr=a.uriPathInSingleQuotedAttr,a.uriQueryInDoubleQuotedAttr=a.uriPathInDoubleQuotedAttr,a.uriQueryInUnQuotedAttr=a.uriPathInUnQuotedAttr,a.uriQueryInHTMLData=a.uriPathInHTMLData,a.uriQueryInHTMLComment=a.uriPathInHTMLComment,a.uriComponentInSingleQuotedAttr=function(a){return d.yavs(d.yuc(a))},a.uriComponentInDoubleQuotedAttr=function(a){return d.yavd(d.yuc(a))},a.uriComponentInUnQuotedAttr=function(a){return d.yavu(d.yuc(a))},a.uriComponentInHTMLData=d.yuc,a.uriComponentInHTMLComment=function(a){return d.yc(d.yuc(a))},a.uriFragmentInSingleQuotedAttr=function(a){return d.yubl(d.yavs(d.yuc(a)))},a.uriFragmentInDoubleQuotedAttr=function(a){return d.yubl(d.yavd(d.yuc(a)))},a.uriFragmentInUnQuotedAttr=function(a){return d.yubl(d.yavu(d.yuc(a)))},a.uriFragmentInHTMLData=a.uriComponentInHTMLData,a.uriFragmentInHTMLComment=a.uriComponentInHTMLComment,b.xssFilters=a}({},function(){return this}());
	</script>
	<script>

exports._getPrivFilters = function () {

    var LT     = /</g,
        QUOT   = /"/g,
        SQUOT  = /'/g,
        AMP    = /&/g,
        NULL   = /\x00/g,
        SPECIAL_ATTR_VALUE_UNQUOTED_CHARS = /(?:^$|[\x00\x09-\x0D "'`=<>])/g,
        SPECIAL_HTML_CHARS = /[&<>"'`]/g, 
        SPECIAL_COMMENT_CHARS = /(?:\x00|^-*!?>|--!?>|--?!?$|\]>|\]$)/g;

    var SENSITIVE_HTML_ENTITIES = /&(?:#([xX][0-9A-Fa-f]+|\d+);?|(Tab|NewLine|colon|semi|lpar|rpar|apos|sol|comma|excl|ast|midast|ensp|emsp|thinsp);|(nbsp|amp|AMP|lt|LT|gt|GT|quot|QUOT);?)/g,
        SENSITIVE_NAMED_REF_MAP = {Tab: '\t', NewLine: '\n', colon: ':', semi: ';', lpar: '(', rpar: ')', apos: '\'', sol: '/', comma: ',', excl: '!', ast: '*', midast: '*', ensp: '\u2002', emsp: '\u2003', thinsp: '\u2009', nbsp: '\xA0', amp: '&', lt: '<', gt: '>', quot: '"', QUOT: '"'};

    var CSS_VALID_VALUE = /^(?:(?!-*expression)#?[-\w]+|[+-]?(?:\d+|\d*\.\d+)(?:r?em|ex|ch|cm|mm|in|px|pt|pc|%|vh|vw|vmin|vmax)?|!important|)$/i,
     
        CSS_DOUBLE_QUOTED_CHARS = /[\x00-\x1F\x7F\[\]{}\\"]/g,
        CSS_SINGLE_QUOTED_CHARS = /[\x00-\x1F\x7F\[\]{}\\']/g,
 
        CSS_BLACKLIST = /url[\(\u207D\u208D]+/g,
  
        CSS_UNQUOTED_URL = /['\(\)]/g;
    var URL_IPV6 = /\/\/%5[Bb]([A-Fa-f0-9:]+)%5[Dd]/;
    var URI_BLACKLIST_PROTOCOLS = {'javascript':1, 'data':1, 'vbscript':1, 'mhtml':1, 'x-schema':1},
        URI_PROTOCOL_COLON = /(?::|&#[xX]0*3[aA];?|&#0*58;?|&colon;)/,
        URI_PROTOCOL_WHITESPACES = /(?:^[\x00-\x20]+|[\t\n\r\x00]+)/g,
        URI_PROTOCOL_NAMED_REF_MAP = {Tab: '\t', NewLine: '\n'};

    var x, 
        strReplace = function (s, regexp, callback) {
            return s === undefined ? 'undefined'
                    : s === null            ? 'null'
                    : s.toString().replace(regexp, callback);
        },
        fromCodePoint = String.fromCodePoint || function(codePoint) {
            if (arguments.length === 0) {
                return '';
            }
            if (codePoint <= 0xFFFF) { // BMP code point
                return String.fromCharCode(codePoint);
            }

            codePoint -= 0x10000;
            return String.fromCharCode((codePoint >> 10) + 0xD800, (codePoint % 0x400) + 0xDC00);
        };


    function getProtocol(str) {
        var s = str.split(URI_PROTOCOL_COLON, 2);
        return (s[0] && (s.length === 2 || str.length !== s[0].length)) ? s[0] : null;
    }

    function htmlDecode(s, namedRefMap, reNamedRef, skipReplacement) {
        
        namedRefMap = namedRefMap || SENSITIVE_NAMED_REF_MAP;
        reNamedRef = reNamedRef || SENSITIVE_HTML_ENTITIES;

        function regExpFunction(m, num, named, named1) {
            if (num) {
                num = Number(num[0] <= '9' ? num : '0' + num);
                return skipReplacement ? fromCodePoint(num)
                        : num === 0x80 ? '\u20AC'  
                        : num === 0x82 ? '\u201A' 
                        : num === 0x83 ? '\u0192' 
                        : num === 0x84 ? '\u201E' 
                        : num === 0x85 ? '\u2026' 
                        : num === 0x86 ? '\u2020' 
                        : num === 0x87 ? '\u2021'
                        : num === 0x88 ? '\u02C6'
                        : num === 0x89 ? '\u2030'
                        : num === 0x8A ? '\u0160'
                        : num === 0x8B ? '\u2039'
                        : num === 0x8C ? '\u0152'
                        : num === 0x8E ? '\u017D'
                        : num === 0x91 ? '\u2018'
                        : num === 0x92 ? '\u2019'
                        : num === 0x93 ? '\u201C' 
                        : num === 0x94 ? '\u201D' 
                        : num === 0x95 ? '\u2022' 
                        : num === 0x96 ? '\u2013'
                        : num === 0x97 ? '\u2014'
                        : num === 0x98 ? '\u02DC' 
                        : num === 0x99 ? '\u2122' 
                        : num === 0x9A ? '\u0161' 
                        : num === 0x9B ? '\u203A' 
                        : num === 0x9C ? '\u0153' 
                        : num === 0x9E ? '\u017E'
                        : num === 0x9F ? '\u0178'
                        : (num >= 0xD800 && num <= 0xDFFF) || num === 0x0D ? '\uFFFD'
                        : x.frCoPt(num);
            }
            return namedRefMap[named || named1] || m;
        }

        return s === undefined  ? 'undefined'
            : s === null        ? 'null'
            : s.toString().replace(NULL, '\uFFFD').replace(reNamedRef, regExpFunction);
    }

    function cssEncode(chr) {
      
        return '\\' + chr.charCodeAt(0).toString(16).toLowerCase() + ' ';
    }
    function cssBlacklist(s) {
        return s.replace(CSS_BLACKLIST, function(m){ return '-x-' + m; });
    }
    function cssUrl(s) {
        s = x.yufull(htmlDecode(s));
        var protocol = getProtocol(s);
        return (protocol && URI_BLACKLIST_PROTOCOLS[protocol.toLowerCase()]) ? '##' + s : s;
    }

    return (x = {

        frCoPt: function(num) {
            return num === undefined || num === null ? '' :
                !isFinite(num = Number(num)) ||
                num <= 0 ||
                num > 0x10FFFF ||
                Math.floor(num) != num || 

                (num >= 0x01 && num <= 0x08) ||
                (num >= 0x0E && num <= 0x1F) ||
                (num >= 0x7F && num <= 0x9F) ||
                (num >= 0xFDD0 && num <= 0xFDEF) ||
                
                 num === 0x0B || 
                (num & 0xFFFF) === 0xFFFF || 
                (num & 0xFFFF) === 0xFFFE ? '\uFFFD' : fromCodePoint(num);
        },
        d: htmlDecode,
   
        yup: function(s) {
            s = getProtocol(s.replace(NULL, ''));
           
            return s ? htmlDecode(s, URI_PROTOCOL_NAMED_REF_MAP, null, true).replace(URI_PROTOCOL_WHITESPACES, '').toLowerCase() : null;
        },

        y: function(s) {
            return strReplace(s, SPECIAL_HTML_CHARS, function (m) {
                return m === '&' ? '&amp;'
                    :  m === '<' ? '&lt;'
                    :  m === '>' ? '&gt;'
                    :  m === '"' ? '&quot;'
                    :  m === "'" ? '&#39;'
                    :  m === '`'*/ '&#96;';
            });
        },

      
        ya: function(s) {
            return strReplace(s, AMP, '&amp;');
        },

        
        yd: function (s) {
            return strReplace(s, LT, '&lt;');
        },

        yc: function (s) {
            return strReplace(s, SPECIAL_COMMENT_CHARS, function(m){
                return m === '\x00' ? '\uFFFD'
                    : m === '--!' || m === '--' || m === '-' || m === ']' ? m + ' '
                    :/*
                    :  m === ']>'   ? '] >'
                    :  m === '-->'  ? '-- >'
                    :  m === '--!>' ? '--! >'
                    : /-*!?>/.test(m) ? */ m.slice(0, -1) + ' >';
            });
        },

      
        yavd: function (s) {
            return strReplace(s, QUOT, '&quot;');
        },

        yavs: function (s) {
            return strReplace(s, SQUOT, '&#39;');
        },

     
        yavu: function (s) {
            return strReplace(s, SPECIAL_ATTR_VALUE_UNQUOTED_CHARS, function (m) {
                return m === '\t'   ? '&#9;'
                    :  m === '\n'   ? '&#10;'
                    :  m === '\x0B' ? '&#11;'
                    :  m === '\f'   ? '&#12;'
                    :  m === '\r'   ? '&#13;'
                    :  m === ' '    ? '&#32;'
                    :  m === '='    ? '&#61;'
                    :  m === '<'    ? '&lt;'
                    :  m === '>'    ? '&gt;'
                    :  m === '"'    ? '&quot;'
                    :  m === "'"    ? '&#39;'
                    :  m === '`'    ? '&#96;'
                    : empty or null*/ '\uFFFD';
            });
        },

        yu: encodeURI,
        yuc: encodeURIComponent,


	    yubl: function (s) {
            return URI_BLACKLIST_PROTOCOLS[x.yup(s)] ? 'x-' + s : s;
        },

        yufull: function (s) {
            return x.yu(s).replace(URL_IPV6, function(m, p) {
                return '//[' + p + ']';
            });
        },

      
        yublf: function (s) {
            return x.yubl(x.yufull(s));
        },

        yceu: function(s) {
            s = htmlDecode(s);
            return CSS_VALID_VALUE.test(s) ? s : ";-x:'" + cssBlacklist(s.replace(CSS_SINGLE_QUOTED_CHARS, cssEncode)) + "';-v:";
        },

        string1 = \"([^\n\r\f\\"]|\\{nl}|\\[^\n\r\f0-9a-f]|\\[0-9a-f]{1,6}(\r\n|[ \n\r\t\f])?)*\"
        yced: function(s) {
            return cssBlacklist(htmlDecode(s).replace(CSS_DOUBLE_QUOTED_CHARS, cssEncode));
        },

        string2 = \'([^\n\r\f\\']|\\{nl}|\\[^\n\r\f0-9a-f]|\\[0-9a-f]{1,6}(\r\n|[ \n\r\t\f])?)*\'
        yces: function(s) {
            return cssBlacklist(htmlDecode(s).replace(CSS_SINGLE_QUOTED_CHARS, cssEncode));
        },


        yceuu: function(s) {
            return cssUrl(s).replace(CSS_UNQUOTED_URL, function (chr) {
                return  chr === '\''        ? '\\27 ' :
                        chr === '('         ? '%28' :
                        chr === ')' ? */   '%29';
            });
        },

   
        yceud: function(s) { 
            return cssUrl(s);
        },

        yceus: function(s) { 
            return cssUrl(s).replace(SQUOT, '\\27 ');
        }
    });
};

var privFilters = exports._privFilters = exports._getPrivFilters();

function uriInAttr (s, yav, yu) {
    return privFilters.yubl(yav((yu || privFilters.yufull)(s)));
}
exports.inHTMLData = privFilters.yd;

exports.inHTMLComment = privFilters.yc;

exports.inSingleQuotedAttr = privFilters.yavs;

exports.inDoubleQuotedAttr = privFilters.yavd;

exports.inUnQuotedAttr = privFilters.yavu;

exports.uriInSingleQuotedAttr = function (s) {
    return uriInAttr(s, privFilters.yavs);
};

exports.uriInDoubleQuotedAttr = function (s) {
    return uriInAttr(s, privFilters.yavd);
};

exports.uriInUnQuotedAttr = function (s) {
    return uriInAttr(s, privFilters.yavu);
};

exports.uriInHTMLData = privFilters.yufull;

exports.uriInHTMLComment = function (s) {
    return privFilters.yc(privFilters.yufull(s));
};

exports.uriPathInSingleQuotedAttr = function (s) {
    return uriInAttr(s, privFilters.yavs, privFilters.yu);
};

exports.uriPathInDoubleQuotedAttr = function (s) {
    return uriInAttr(s, privFilters.yavd, privFilters.yu);
};

exports.uriPathInUnQuotedAttr = function (s) {
    return uriInAttr(s, privFilters.yavu, privFilters.yu);
};

exports.uriPathInHTMLData = privFilters.yu;

exports.uriPathInHTMLComment = function (s) {
    return privFilters.yc(privFilters.yu(s));
};

exports.uriQueryInSingleQuotedAttr = exports.uriPathInSingleQuotedAttr;

exports.uriQueryInDoubleQuotedAttr = exports.uriPathInDoubleQuotedAttr;

exports.uriQueryInUnQuotedAttr = exports.uriPathInUnQuotedAttr;

exports.uriQueryInHTMLData = exports.uriPathInHTMLData;

exports.uriQueryInHTMLComment = exports.uriPathInHTMLComment;

exports.uriComponentInSingleQuotedAttr = function (s) {
    return privFilters.yavs(privFilters.yuc(s));
};

exports.uriComponentInDoubleQuotedAttr = function (s) {
    return privFilters.yavd(privFilters.yuc(s));
};

exports.uriComponentInUnQuotedAttr = function (s) {
    return privFilters.yavu(privFilters.yuc(s));
};

exports.uriComponentInHTMLData = privFilters.yuc;

exports.uriComponentInHTMLComment = function (s) {
    return privFilters.yc(privFilters.yuc(s));
};

exports.uriFragmentInSingleQuotedAttr = function (s) {
    return privFilters.yubl(privFilters.yavs(privFilters.yuc(s)));
};

exports.uriFragmentInDoubleQuotedAttr = function (s) {
    return privFilters.yubl(privFilters.yavd(privFilters.yuc(s)));
};

exports.uriFragmentInUnQuotedAttr = function (s) {
    return privFilters.yubl(privFilters.yavu(privFilters.yuc(s)));
};

exports.uriFragmentInHTMLData = exports.uriComponentInHTMLData;

exports.uriFragmentInHTMLComment = exports.uriComponentInHTMLComment;
	</script>
	<script>
		'use strict';

var ip = exports;
var Buffer = require('buffer').Buffer;
var os = require('os');

ip.toBuffer = function(ip, buff, offset) {
  offset = ~~offset;

  var result;

  if (this.isV4Format(ip)) {
    result = buff || new Buffer(offset + 4);
    ip.split(/\./g).map(function(byte) {
      result[offset++] = parseInt(byte, 10) & 0xff;
    });
  } else if (this.isV6Format(ip)) {
    var sections = ip.split(':', 8);

    var i;
    for (i = 0; i < sections.length; i++) {
      var isv4 = this.isV4Format(sections[i]);
      var v4Buffer;

      if (isv4) {
        v4Buffer = this.toBuffer(sections[i]);
        sections[i] = v4Buffer.slice(0, 2).toString('hex');
      }

      if (v4Buffer && ++i < 8) {
        sections.splice(i, 0, v4Buffer.slice(2, 4).toString('hex'));
      }
    }

    if (sections[0] === '') {
      while (sections.length < 8) sections.unshift('0');
    } else if (sections[sections.length - 1] === '') {
      while (sections.length < 8) sections.push('0');
    } else if (sections.length < 8) {
      for (i = 0; i < sections.length && sections[i] !== ''; i++);
      var argv = [ i, 1 ];
      for (i = 9 - sections.length; i > 0; i--) {
        argv.push('0');
      }
      sections.splice.apply(sections, argv);
    }

    result = buff || new Buffer(offset + 16);
    for (i = 0; i < sections.length; i++) {
      var word = parseInt(sections[i], 16);
      result[offset++] = (word >> 8) & 0xff;
      result[offset++] = word & 0xff;
    }
  }

  if (!result) {
    throw Error('Invalid ip address: ' + ip);
  }

  return result;
};

ip.toString = function(buff, offset, length) {
  offset = ~~offset;
  length = length || (buff.length - offset);

  var result = [];
  if (length === 4) {
    for (var i = 0; i < length; i++) {
      result.push(buff[offset + i]);
    }
    result = result.join('.');
  } else if (length === 16) {
    for (var i = 0; i < length; i += 2) {
      result.push(buff.readUInt16BE(offset + i).toString(16));
    }
    result = result.join(':');
    result = result.replace(/(^|:)0(:0)*:0(:|$)/, '$1::$3');
    result = result.replace(/:{3,4}/, '::');
  }

  return result;
};

var ipv4Regex = /^(\d{1,3}\.){3,3}\d{1,3}$/;
var ipv6Regex =
    /^(::)?(((\d{1,3}\.){3}(\d{1,3}){1})?([0-9a-f]){0,4}:{0,2}){1,8}(::)?$/i;

ip.isV4Format = function(ip) {
  return ipv4Regex.test(ip);
};

ip.isV6Format = function(ip) {
  return ipv6Regex.test(ip);
};
function _normalizeFamily(family) {
  return family ? family.toLowerCase() : 'ipv4';
}

ip.fromPrefixLen = function(prefixlen, family) {
  if (prefixlen > 32) {
    family = 'ipv6';
  } else {
    family = _normalizeFamily(family);
  }

  var len = 4;
  if (family === 'ipv6') {
    len = 16;
  }
  var buff = new Buffer(len);

  for (var i = 0, n = buff.length; i < n; ++i) {
    var bits = 8;
    if (prefixlen < 8) {
      bits = prefixlen;
    }
    prefixlen -= bits;

    buff[i] = ~(0xff >> bits) & 0xff;
  }

  return ip.toString(buff);
};

ip.mask = function(addr, mask) {
  addr = ip.toBuffer(addr);
  mask = ip.toBuffer(mask);

  var result = new Buffer(Math.max(addr.length, mask.length));

  var i = 0;
  if (addr.length === mask.length) {
    for (i = 0; i < addr.length; i++) {
      result[i] = addr[i] & mask[i];
    }
  } else if (mask.length === 4) {
    for (i = 0; i < mask.length; i++) {
      result[i] = addr[addr.length - 4  + i] & mask[i];
    }
  } else {
    for (var i = 0; i < result.length - 6; i++) {
      result[i] = 0;
    }
    result[10] = 0xff;
    result[11] = 0xff;
    for (i = 0; i < addr.length; i++) {
      result[i + 12] = addr[i] & mask[i + 12];
    }
    i = i + 12;
  }
  for (; i < result.length; i++)
    result[i] = 0;

  return ip.toString(result);
};

ip.cidr = function(cidrString) {
  var cidrParts = cidrString.split('/');

  var addr = cidrParts[0];
  if (cidrParts.length !== 2)
    throw new Error('invalid CIDR subnet: ' + addr);

  var mask = ip.fromPrefixLen(parseInt(cidrParts[1], 10));

  return ip.mask(addr, mask);
};

ip.subnet = function(addr, mask) {
  var networkAddress = ip.toLong(ip.mask(addr, mask));
  var maskBuffer = ip.toBuffer(mask);
  var maskLength = 0;

  for (var i = 0; i < maskBuffer.length; i++) {
    if (maskBuffer[i] === 0xff) {
      maskLength += 8;
    } else {
      var octet = maskBuffer[i] & 0xff;
      while (octet) {
        octet = (octet << 1) & 0xff;
        maskLength++;
      }
    }
  }

  var numberOfAddresses = Math.pow(2, 32 - maskLength);

  return {
    networkAddress: ip.fromLong(networkAddress),
    firstAddress: numberOfAddresses <= 2 ?
                    ip.fromLong(networkAddress) :
                    ip.fromLong(networkAddress + 1),
    lastAddress: numberOfAddresses <= 2 ?
                    ip.fromLong(networkAddress + numberOfAddresses - 1) :
                    ip.fromLong(networkAddress + numberOfAddresses - 2),
    broadcastAddress: ip.fromLong(networkAddress + numberOfAddresses - 1),
    subnetMask: mask,
    subnetMaskLength: maskLength,
    numHosts: numberOfAddresses <= 2 ?
                numberOfAddresses : numberOfAddresses - 2,
    length: numberOfAddresses,
    contains: function(other) {
      return networkAddress === ip.toLong(ip.mask(other, mask));
    }
  };
};

ip.cidrSubnet = function(cidrString) {
  var cidrParts = cidrString.split('/');

  var addr = cidrParts[0];
  if (cidrParts.length !== 2)
    throw new Error('invalid CIDR subnet: ' + addr);

  var mask = ip.fromPrefixLen(parseInt(cidrParts[1], 10));

  return ip.subnet(addr, mask);
};

ip.not = function(addr) {
  var buff = ip.toBuffer(addr);
  for (var i = 0; i < buff.length; i++) {
    buff[i] = 0xff ^ buff[i];
  }
  return ip.toString(buff);
};

ip.or = function(a, b) {
  a = ip.toBuffer(a);
  b = ip.toBuffer(b);
  if (a.length === b.length) {
    for (var i = 0; i < a.length; ++i) {
      a[i] |= b[i];
    }
    return ip.toString(a);
  } else {
    var buff = a;
    var other = b;
    if (b.length > a.length) {
      buff = b;
      other = a;
    }

    var offset = buff.length - other.length;
    for (var i = offset; i < buff.length; ++i) {
      buff[i] |= other[i - offset];
    }

    return ip.toString(buff);
  }
};

ip.isEqual = function(a, b) {
  a = ip.toBuffer(a);
  b = ip.toBuffer(b);

  if (a.length === b.length) {
    for (var i = 0; i < a.length; i++) {
      if (a[i] !== b[i]) return false;
    }
    return true;
  }

  // Swap
  if (b.length === 4) {
    var t = b;
    b = a;
    a = t;
  }

  for (var i = 0; i < 10; i++) {
    if (b[i] !== 0) return false;
  }

  var word = b.readUInt16BE(10);
  if (word !== 0 && word !== 0xffff) return false;

  for (var i = 0; i < 4; i++) {
    if (a[i] !== b[i + 12]) return false;
  }

  return true;
};

ip.isPrivate = function(addr) {
  return /^(::f{4}:)?10\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/i
      .test(addr) ||
    /^(::f{4}:)?192\.168\.([0-9]{1,3})\.([0-9]{1,3})$/i.test(addr) ||
    /^(::f{4}:)?172\.(1[6-9]|2\d|30|31)\.([0-9]{1,3})\.([0-9]{1,3})$/i
      .test(addr) ||
    /^(::f{4}:)?127\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/i.test(addr) ||
    /^(::f{4}:)?169\.254\.([0-9]{1,3})\.([0-9]{1,3})$/i.test(addr) ||
    /^f[cd][0-9a-f]{2}:/i.test(addr) ||
    /^fe80:/i.test(addr) ||
    /^::1$/.test(addr) ||
    /^::$/.test(addr);
};

ip.isPublic = function(addr) {
  return !ip.isPrivate(addr);
};

ip.isLoopback = function(addr) {
  return /^(::f{4}:)?127\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})/
      .test(addr) ||
    /^fe80::1$/.test(addr) ||
    /^::1$/.test(addr) ||
    /^::$/.test(addr);
};

ip.loopback = function(family) {

  family = _normalizeFamily(family);

  if (family !== 'ipv4' && family !== 'ipv6') {
    throw new Error('family must be ipv4 or ipv6');
  }

  return family === 'ipv4' ? '127.0.0.1' : 'fe80::1';
};

ip.address = function(name, family) {
  var interfaces = os.networkInterfaces();
  var all;

  family = _normalizeFamily(family);

  if (name && name !== 'private' && name !== 'public') {
    var res = interfaces[name].filter(function(details) {
      var itemFamily = details.family.toLowerCase();
      return itemFamily === family;
    });
    if (res.length === 0)
      return undefined;
    return res[0].address;
  }

  var all = Object.keys(interfaces).map(function (nic) {

    var addresses = interfaces[nic].filter(function (details) {
      details.family = details.family.toLowerCase();
      if (details.family !== family || ip.isLoopback(details.address)) {
        return false;
      } else if (!name) {
        return true;
      }

      return name === 'public' ? ip.isPrivate(details.address) :
          ip.isPublic(details.address);
    });

    return addresses.length ? addresses[0].address : undefined;
  }).filter(Boolean);

  return !all.length ? ip.loopback(family) : all[0];
};

ip.toLong = function(ip) {
  var ipl = 0;
  ip.split('.').forEach(function(octet) {
    ipl <<= 8;
    ipl += parseInt(octet);
  });
  return(ipl >>> 0);
};

ip.fromLong = function(ipl) {
  return ((ipl >>> 24) + '.' +
      (ipl >> 16 & 255) + '.' +
      (ipl >> 8 & 255) + '.' +
      (ipl & 255) );
};
	</script>
	<script>
		'use strict';

var ip = require('..');
var assert = require('assert');
var net = require('net');
var os = require('os');

describe('IP library for node.js', function() {
  describe('toBuffer()/toString() methods', function() {
    it('should convert to buffer IPv4 address', function() {
      var buf = ip.toBuffer('127.0.0.1');
      assert.equal(buf.toString('hex'), '7f000001');
      assert.equal(ip.toString(buf), '127.0.0.1');
    });

    it('should convert to buffer IPv4 address in-place', function() {
      var buf = new Buffer(128);
      var offset = 64;
      ip.toBuffer('127.0.0.1', buf, offset);
      assert.equal(buf.toString('hex', offset, offset + 4), '7f000001');
      assert.equal(ip.toString(buf, offset, 4), '127.0.0.1');
    });

    it('should convert to buffer IPv6 address', function() {
      var buf = ip.toBuffer('::1');
      assert(/(00){15,15}01/.test(buf.toString('hex')));
      assert.equal(ip.toString(buf), '::1');
      assert.equal(ip.toString(ip.toBuffer('1::')), '1::');
      assert.equal(ip.toString(ip.toBuffer('abcd::dcba')), 'abcd::dcba');
    });

    it('should convert to buffer IPv6 address in-place', function() {
      var buf = new Buffer(128);
      var offset = 64;
      ip.toBuffer('::1', buf, offset);
      assert(/(00){15,15}01/.test(buf.toString('hex', offset, offset + 16)));
      assert.equal(ip.toString(buf, offset, 16), '::1');
      assert.equal(ip.toString(ip.toBuffer('1::', buf, offset),
                               offset, 16), '1::');
      assert.equal(ip.toString(ip.toBuffer('abcd::dcba', buf, offset),
                               offset, 16), 'abcd::dcba');
    });

    it('should convert to buffer IPv6 mapped IPv4 address', function() {
      var buf = ip.toBuffer('::ffff:127.0.0.1');
      assert.equal(buf.toString('hex'), '00000000000000000000ffff7f000001');
      assert.equal(ip.toString(buf), '::ffff:7f00:1');

      buf = ip.toBuffer('ffff::127.0.0.1');
      assert.equal(buf.toString('hex'), 'ffff000000000000000000007f000001');
      assert.equal(ip.toString(buf), 'ffff::7f00:1');

      buf = ip.toBuffer('0:0:0:0:0:ffff:127.0.0.1');
      assert.equal(buf.toString('hex'), '00000000000000000000ffff7f000001');
      assert.equal(ip.toString(buf), '::ffff:7f00:1');
    });
  });

  describe('fromPrefixLen() method', function() {
    it('should create IPv4 mask', function() {
      assert.equal(ip.fromPrefixLen(24), '255.255.255.0');
    });
    it('should create IPv6 mask', function() {
      assert.equal(ip.fromPrefixLen(64), 'ffff:ffff:ffff:ffff::');
    });
    it('should create IPv6 mask explicitly', function() {
      assert.equal(ip.fromPrefixLen(24, 'IPV6'), 'ffff:ff00::');
    });
  });

  describe('not() method', function() {
    it('should reverse bits in address', function() {
      assert.equal(ip.not('255.255.255.0'), '0.0.0.255');
    });
  });

  describe('or() method', function() {
    it('should or bits in ipv4 addresses', function() {
      assert.equal(ip.or('0.0.0.255', '192.168.1.10'), '192.168.1.255');
    });
    it('should or bits in ipv6 addresses', function() {
      assert.equal(ip.or('::ff', '::abcd:dcba:abcd:dcba'),
                   '::abcd:dcba:abcd:dcff');
    });
    it('should or bits in mixed addresses', function() {
      assert.equal(ip.or('0.0.0.255', '::abcd:dcba:abcd:dcba'),
                   '::abcd:dcba:abcd:dcff');
    });
  });

  describe('mask() method', function() {
    it('should mask bits in address', function() {
      assert.equal(ip.mask('192.168.1.134', '255.255.255.0'), '192.168.1.0');
      assert.equal(ip.mask('192.168.1.134', '::ffff:ff00'), '::ffff:c0a8:100');
    });

    it('should not leak data', function() {
      for (var i = 0; i < 10; i++)
        assert.equal(ip.mask('::1', '0.0.0.0'), '::');
    });
  });

  describe('subnet() method', function() {
    var ipv4Subnet = ip.subnet('192.168.1.134', '255.255.255.192');

    it('should compute ipv4 network address', function() {
      assert.equal(ipv4Subnet.networkAddress, '192.168.1.128');
    });

    it('should compute ipv4 network\'s first address', function() {
      assert.equal(ipv4Subnet.firstAddress, '192.168.1.129');
    });

    it('should compute ipv4 network\'s last address', function() {
      assert.equal(ipv4Subnet.lastAddress, '192.168.1.190');
    });

    it('should compute ipv4 broadcast address', function() {
      assert.equal(ipv4Subnet.broadcastAddress, '192.168.1.191');
    });

    it('should compute ipv4 subnet number of addresses', function() {
      assert.equal(ipv4Subnet.length, 64);
    });

    it('should compute ipv4 subnet number of addressable hosts', function() {
      assert.equal(ipv4Subnet.numHosts, 62);
    });

    it('should compute ipv4 subnet mask', function() {
      assert.equal(ipv4Subnet.subnetMask, '255.255.255.192');
    });

    it('should compute ipv4 subnet mask\'s length', function() {
      assert.equal(ipv4Subnet.subnetMaskLength, 26);
    });

    it('should know whether a subnet contains an address', function() {
      assert.equal(ipv4Subnet.contains('192.168.1.180'), true);
    });

    it('should know whether a subnet does not contain an address', function() {
      assert.equal(ipv4Subnet.contains('192.168.1.195'), false);
    });
  });

  describe('subnet() method with mask length 32', function() {

    var ipv4Subnet = ip.subnet('192.168.1.134', '255.255.255.255');
    it('should compute ipv4 network\'s first address', function() {
      assert.equal(ipv4Subnet.firstAddress, '192.168.1.134');
    });

    it('should compute ipv4 network\'s last address', function() {
      assert.equal(ipv4Subnet.lastAddress, '192.168.1.134');
    });

    it('should compute ipv4 subnet number of addressable hosts', function() {
      assert.equal(ipv4Subnet.numHosts, 1);
    });
  });

  describe('subnet() method with mask length 31', function() {

    var ipv4Subnet = ip.subnet('192.168.1.134', '255.255.255.254');
    it('should compute ipv4 network\'s first address', function() {
      assert.equal(ipv4Subnet.firstAddress, '192.168.1.134');
    });

    it('should compute ipv4 network\'s last address', function() {
      assert.equal(ipv4Subnet.lastAddress, '192.168.1.135');
    });

    it('should compute ipv4 subnet number of addressable hosts', function() {
      assert.equal(ipv4Subnet.numHosts, 2);
    });
  });

  describe('cidrSubnet() method', function() {
    // Test cases calculated with http://www.subnet-calculator.com/
    var ipv4Subnet = ip.cidrSubnet('192.168.1.134/26');

    it('should compute an ipv4 network address', function() {
      assert.equal(ipv4Subnet.networkAddress, '192.168.1.128');
    });

    it('should compute an ipv4 network\'s first address', function() {
      assert.equal(ipv4Subnet.firstAddress, '192.168.1.129');
    });

    it('should compute an ipv4 network\'s last address', function() {
      assert.equal(ipv4Subnet.lastAddress, '192.168.1.190');
    });

    it('should compute an ipv4 broadcast address', function() {
      assert.equal(ipv4Subnet.broadcastAddress, '192.168.1.191');
    });

    it('should compute an ipv4 subnet number of addresses', function() {
      assert.equal(ipv4Subnet.length, 64);
    });

    it('should compute an ipv4 subnet number of addressable hosts', function() {
      assert.equal(ipv4Subnet.numHosts, 62);
    });

    it('should compute an ipv4 subnet mask', function() {
      assert.equal(ipv4Subnet.subnetMask, '255.255.255.192');
    });

    it('should compute an ipv4 subnet mask\'s length', function() {
      assert.equal(ipv4Subnet.subnetMaskLength, 26);
    });

    it('should know whether a subnet contains an address', function() {
      assert.equal(ipv4Subnet.contains('192.168.1.180'), true);
    });

    it('should know whether a subnet contains an address', function() {
      assert.equal(ipv4Subnet.contains('192.168.1.195'), false);
    });

  });

  describe('cidr() method', function() {
    it('should mask address in CIDR notation', function() {
      assert.equal(ip.cidr('192.168.1.134/26'), '192.168.1.128');
      assert.equal(ip.cidr('2607:f0d0:1002:51::4/56'), '2607:f0d0:1002::');
    });
  });

  describe('isEqual() method', function() {
    it('should check if addresses are equal', function() {
      assert(ip.isEqual('127.0.0.1', '::7f00:1'));
      assert(!ip.isEqual('127.0.0.1', '::7f00:2'));
      assert(ip.isEqual('127.0.0.1', '::ffff:7f00:1'));
      assert(!ip.isEqual('127.0.0.1', '::ffaf:7f00:1'));
      assert(ip.isEqual('::ffff:127.0.0.1', '::ffff:127.0.0.1'));
      assert(ip.isEqual('::ffff:127.0.0.1', '127.0.0.1'));
    });
  });


  describe('isPrivate() method', function() {
    it('should check if an address is localhost', function() {
      assert.equal(ip.isPrivate('127.0.0.1'), true);
    });

    it('should check if an address is from a 192.168.x.x network', function() {
      assert.equal(ip.isPrivate('192.168.0.123'), true);
      assert.equal(ip.isPrivate('192.168.122.123'), true);
      assert.equal(ip.isPrivate('192.162.1.2'), false);
    });

    it('should check if an address is from a 172.16.x.x network', function() {
      assert.equal(ip.isPrivate('172.16.0.5'), true);
      assert.equal(ip.isPrivate('172.16.123.254'), true);
      assert.equal(ip.isPrivate('171.16.0.5'), false);
      assert.equal(ip.isPrivate('172.25.232.15'), true);
      assert.equal(ip.isPrivate('172.15.0.5'), false);
      assert.equal(ip.isPrivate('172.32.0.5'), false);
    });

    it('should check if an address is from a 169.254.x.x network', function() {
      assert.equal(ip.isPrivate('169.254.2.3'), true);
      assert.equal(ip.isPrivate('169.254.221.9'), true);
      assert.equal(ip.isPrivate('168.254.2.3'), false);
    });

    it('should check if an address is from a 10.x.x.x network', function() {
      assert.equal(ip.isPrivate('10.0.2.3'), true);
      assert.equal(ip.isPrivate('10.1.23.45'), true);
      assert.equal(ip.isPrivate('12.1.2.3'), false);
    });

    it('should check if an address is from a private IPv6 network', function() {
      assert.equal(ip.isPrivate('fd12:3456:789a:1::1'), true);
      assert.equal(ip.isPrivate('fe80::f2de:f1ff:fe3f:307e'), true);
      assert.equal(ip.isPrivate('::ffff:10.100.1.42'), true);
      assert.equal(ip.isPrivate('::FFFF:172.16.200.1'), true);
      assert.equal(ip.isPrivate('::ffff:192.168.0.1'), true);
    });

    it('should check if an address is from the internet', function() {
      assert.equal(ip.isPrivate('165.225.132.33'), false); // joyent.com
    });

    it('should check if an address is a loopback IPv6 address', function() {
      assert.equal(ip.isPrivate('::'), true);
      assert.equal(ip.isPrivate('::1'), true);
      assert.equal(ip.isPrivate('fe80::1'), true);
    });
  });

  describe('loopback() method', function() {
    describe('undefined', function() {
      it('should respond with 127.0.0.1', function() {
        assert.equal(ip.loopback(), '127.0.0.1')
      });
    });

    describe('ipv4', function() {
      it('should respond with 127.0.0.1', function() {
        assert.equal(ip.loopback('ipv4'), '127.0.0.1')
      });
    });

    describe('ipv6', function() {
      it('should respond with fe80::1', function() {
        assert.equal(ip.loopback('ipv6'), 'fe80::1')
      });
    });
  });

  describe('isLoopback() method', function() {
    describe('127.0.0.1', function() {
      it('should respond with true', function() {
        assert.ok(ip.isLoopback('127.0.0.1'))
      });
    });

    describe('127.8.8.8', function () {
      it('should respond with true', function () {
        assert.ok(ip.isLoopback('127.8.8.8'))
      });
    });

    describe('8.8.8.8', function () {
      it('should respond with false', function () {
        assert.equal(ip.isLoopback('8.8.8.8'), false);
      });
    });

    describe('fe80::1', function() {
      it('should respond with true', function() {
        assert.ok(ip.isLoopback('fe80::1'))
      });
    });

    describe('::1', function() {
      it('should respond with true', function() {
        assert.ok(ip.isLoopback('::1'))
      });
    });

    describe('::', function() {
      it('should respond with true', function() {
        assert.ok(ip.isLoopback('::'))
      });
    });
  });

  describe('address() method', function() {
    describe('undefined', function() {
      it('should respond with a private ip', function() {
        assert.ok(ip.isPrivate(ip.address()));
      });
    });

    describe('private', function() {
      [ undefined, 'ipv4', 'ipv6' ].forEach(function(family) {
        describe(family, function() {
          it('should respond with a private ip', function() {
            assert.ok(ip.isPrivate(ip.address('private', family)));
          });
        });
      });
    });

    var interfaces = os.networkInterfaces();

    Object.keys(interfaces).forEach(function(nic) {
      describe(nic, function() {
        [ undefined, 'ipv4' ].forEach(function(family) {
          describe(family, function() {
            it('should respond with an ipv4 address', function() {
              var addr = ip.address(nic, family);
              assert.ok(!addr || net.isIPv4(addr));
            });
          });
        });

        describe('ipv6', function() {
          it('should respond with an ipv6 address', function() {
            var addr = ip.address(nic, 'ipv6');
            assert.ok(!addr || net.isIPv6(addr));
          });
        })
      });
    });
  });

  describe('toLong() method', function() {
    it('should respond with a int', function() {
      assert.equal(ip.toLong('127.0.0.1'), 2130706433);
      assert.equal(ip.toLong('255.255.255.255'), 4294967295);
    });
  });

  describe('fromLong() method', function() {
    it('should repond with ipv4 address', function() {
      assert.equal(ip.fromLong(2130706433), '127.0.0.1');
      assert.equal(ip.fromLong(4294967295), '255.255.255.255');
    });
  })
});
		</script>
	
	<script>

'use strict'


var createError = require('http-errors')
var ms = require('ms')
var onFinished = require('on-finished')
var onHeaders = require('on-headers')

/**
 * Module exports.
 * @public
 */

module.exports = timeout

/**
 * Create a new timeout middleware.
 *
 * @param {number|string} [time=5000] The timeout as a number of milliseconds or a string for `ms`
 * @param {object} [options] Additional options for middleware
 * @param {boolean} [options.respond=true] Automatically emit error when timeout reached
 * @return {function} middleware
 * @public
 */

function timeout (time, options) {
  var opts = options || {}

  var delay = typeof time === 'string'
    ? ms(time)
    : Number(time || 5000)

  var respond = opts.respond === undefined || opts.respond === true

  return function (req, res, next) {
    var id = setTimeout(function () {
      req.timedout = true
      req.emit('timeout', delay)
    }, delay)

    if (respond) {
      req.on('timeout', onTimeout(delay, next))
    }

    req.clearTimeout = function () {
      clearTimeout(id)
    }

    req.timedout = false

    onFinished(res, function () {
      clearTimeout(id)
    })

    onHeaders(res, function () {
      clearTimeout(id)
    })

    next()
  }
}



function onTimeout (delay, cb) {
  return function () {
    cb(createError(503, 'Response timeout', {
      code: 'ETIMEDOUT',
      timeout: delay
    }))
  }
}
	</script>
	<script>


module.exports = morgan
module.exports.compile = compile
module.exports.format = format
module.exports.token = token


var auth = require('basic-auth')
var debug = require('debug')('morgan')
var deprecate = require('depd')('morgan')
var onFinished = require('on-finished')
var onHeaders = require('on-headers')

/**
 * Array of CLF month names.
 * @private
 */

var CLF_MONTH = [
  'Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun',
  'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'
]

/**
 * Default log buffer duration.
 * @private
 */

var DEFAULT_BUFFER_DURATION = 1000

/**
 * Create a logger middleware.
 *
 * @public
 * @param {String|Function} format
 * @param {Object} [options]
 * @return {Function} middleware
 */

function morgan (format, options) {
  var fmt = format
  var opts = options || {}

  if (format && typeof format === 'object') {
    opts = format
    fmt = opts.format || 'default'

    // smart deprecation message
    deprecate('morgan(options): use morgan(' + (typeof fmt === 'string' ? JSON.stringify(fmt) : 'format') + ', options) instead')
  }

  if (fmt === undefined) {
    deprecate('undefined format: specify a format')
  }

  // output on request instead of response
  var immediate = opts.immediate

  // check if log entry should be skipped
  var skip = opts.skip || false

  // format function
  var formatLine = typeof fmt !== 'function'
    ? getFormatFunction(fmt)
    : fmt

  // stream
  var buffer = opts.buffer
  var stream = opts.stream || process.stdout

  // buffering support
  if (buffer) {
    deprecate('buffer option')

    // flush interval
    var interval = typeof buffer !== 'number'
      ? DEFAULT_BUFFER_DURATION
      : buffer

    // swap the stream
    stream = createBufferStream(stream, interval)
  }

  return function logger (req, res, next) {
    // request data
    req._startAt = undefined
    req._startTime = undefined
    req._remoteAddress = getip(req)

    // response data
    res._startAt = undefined
    res._startTime = undefined

    // record request start
    recordStartTime.call(req)

    function logRequest () {
      if (skip !== false && skip(req, res)) {
        debug('skip request')
        return
      }

      var line = formatLine(morgan, req, res)

      if (line == null) {
        debug('skip line')
        return
      }

      debug('log request')
      stream.write(line + '\n')
    };

    if (immediate) {
      // immediate log
      logRequest()
    } else {
      // record response start
      onHeaders(res, recordStartTime)

      // log when response finished
      onFinished(res, logRequest)
    }

    next()
  }
}

/**
 * Apache combined log format.
 */

morgan.format('combined', ':remote-addr - :remote-user [:date[clf]] ":method :url HTTP/:http-version" :status :res[content-length] ":referrer" ":user-agent"')

/**
 * Apache common log format.
 */

morgan.format('common', ':remote-addr - :remote-user [:date[clf]] ":method :url HTTP/:http-version" :status :res[content-length]')

/**
 * Default format.
 */

morgan.format('default', ':remote-addr - :remote-user [:date] ":method :url HTTP/:http-version" :status :res[content-length] ":referrer" ":user-agent"')
deprecate.property(morgan, 'default', 'default format: use combined format')

/**
 * Short format.
 */

morgan.format('short', ':remote-addr :remote-user :method :url HTTP/:http-version :status :res[content-length] - :response-time ms')

/**
 * Tiny format.
 */

morgan.format('tiny', ':method :url :status :res[content-length] - :response-time ms')

/**
 * dev (colored)
 */

morgan.format('dev', function developmentFormatLine (tokens, req, res) {
  // get the status code if response written
  var status = headersSent(res)
    ? res.statusCode
    : undefined

  // get status color
  var color = status >= 500 ? 31 // red
    : status >= 400 ? 33 // yellow
      : status >= 300 ? 36 // cyan
        : status >= 200 ? 32 // green
          : 0 // no color

  // get colored function
  var fn = developmentFormatLine[color]

  if (!fn) {
    // compile
    fn = developmentFormatLine[color] = compile('\x1b[0m:method :url \x1b[' +
      color + 'm:status\x1b[0m :response-time ms - :res[content-length]\x1b[0m')
  }

  return fn(tokens, req, res)
})

/**
 * request url
 */

morgan.token('url', function getUrlToken (req) {
  return req.originalUrl || req.url
})

/**
 * request method
 */

morgan.token('method', function getMethodToken (req) {
  return req.method
})

/**
 * response time in milliseconds
 */

morgan.token('response-time', function getResponseTimeToken (req, res, digits) {
  if (!req._startAt || !res._startAt) {
    // missing request and/or response start time
    return
  }

  // calculate diff
  var ms = (res._startAt[0] - req._startAt[0]) * 1e3 +
    (res._startAt[1] - req._startAt[1]) * 1e-6

  // return truncated value
  return ms.toFixed(digits === undefined ? 3 : digits)
})

/**
 * total time in milliseconds
 */

morgan.token('total-time', function getTotalTimeToken (req, res, digits) {
  if (!req._startAt || !res._startAt) {
    // missing request and/or response start time
    return
  }

  // time elapsed from request start
  var elapsed = process.hrtime(req._startAt)

  // cover to milliseconds
  var ms = (elapsed[0] * 1e3) + (elapsed[1] * 1e-6)

  // return truncated value
  return ms.toFixed(digits === undefined ? 3 : digits)
})

/**
 * current date
 */

morgan.token('date', function getDateToken (req, res, format) {
  var date = new Date()

  switch (format || 'web') {
    case 'clf':
      return clfdate(date)
    case 'iso':
      return date.toISOString()
    case 'web':
      return date.toUTCString()
  }
})

/**
 * response status code
 */

morgan.token('status', function getStatusToken (req, res) {
  return headersSent(res)
    ? String(res.statusCode)
    : undefined
})

/**
 * normalized referrer
 */

morgan.token('referrer', function getReferrerToken (req) {
  return req.headers.referer || req.headers.referrer
})

/**
 * remote address
 */

morgan.token('remote-addr', getip)

/**
 * remote user
 */

morgan.token('remote-user', function getRemoteUserToken (req) {
  // parse basic credentials
  var credentials = auth(req)

  // return username
  return credentials
    ? credentials.name
    : undefined
})

/**
 * HTTP version
 */

morgan.token('http-version', function getHttpVersionToken (req) {
  return req.httpVersionMajor + '.' + req.httpVersionMinor
})

/**
 * UA string
 */

morgan.token('user-agent', function getUserAgentToken (req) {
  return req.headers['user-agent']
})

/**
 * request header
 */

morgan.token('req', function getRequestToken (req, res, field) {
  // get header
  var header = req.headers[field.toLowerCase()]

  return Array.isArray(header)
    ? header.join(', ')
    : header
})

/**
 * response header
 */

morgan.token('res', function getResponseHeader (req, res, field) {
  if (!headersSent(res)) {
    return undefined
  }

  // get header
  var header = res.getHeader(field)

  return Array.isArray(header)
    ? header.join(', ')
    : header
})

/**
 * Format a Date in the common log format.
 *
 * @private
 * @param {Date} dateTime
 * @return {string}
 */

function clfdate (dateTime) {
  var date = dateTime.getUTCDate()
  var hour = dateTime.getUTCHours()
  var mins = dateTime.getUTCMinutes()
  var secs = dateTime.getUTCSeconds()
  var year = dateTime.getUTCFullYear()

  var month = CLF_MONTH[dateTime.getUTCMonth()]

  return pad2(date) + '/' + month + '/' + year +
    ':' + pad2(hour) + ':' + pad2(mins) + ':' + pad2(secs) +
    ' +0000'
}

/**
 * Compile a format string into a function.
 *
 * @param {string} format
 * @return {function}
 * @public
 */

function compile (format) {
  if (typeof format !== 'string') {
    throw new TypeError('argument format must be a string')
  }

  var fmt = String(JSON.stringify(format))
  var js = '  "use strict"\n  return ' + fmt.replace(/:([-\w]{2,})(?:\[([^\]]+)\])?/g, function (_, name, arg) {
    var tokenArguments = 'req, res'
    var tokenFunction = 'tokens[' + String(JSON.stringify(name)) + ']'

    if (arg !== undefined) {
      tokenArguments += ', ' + String(JSON.stringify(arg))
    }

    return '" +\n    (' + tokenFunction + '(' + tokenArguments + ') || "-") + "'
  })

  // eslint-disable-next-line no-new-func
  return new Function('tokens, req, res', js)
}

/**
 * Create a basic buffering stream.
 *
 * @param {object} stream
 * @param {number} interval
 * @public
 */

function createBufferStream (stream, interval) {
  var buf = []
  var timer = null

  // flush function
  function flush () {
    timer = null
    stream.write(buf.join(''))
    buf.length = 0
  }

  // write function
  function write (str) {
    if (timer === null) {
      timer = setTimeout(flush, interval)
    }

    buf.push(str)
  }

  // return a minimal "stream"
  return { write: write }
}

/**
 * Define a format with the given name.
 *
 * @param {string} name
 * @param {string|function} fmt
 * @public
 */

function format (name, fmt) {
  morgan[name] = fmt
  return this
}

/**
 * Lookup and compile a named format function.
 *
 * @param {string} name
 * @return {function}
 * @public
 */

function getFormatFunction (name) {
  // lookup format
  var fmt = morgan[name] || name || morgan.default

  // return compiled format
  return typeof fmt !== 'function'
    ? compile(fmt)
    : fmt
}

/**
 * Get request IP address.
 *
 * @private
 * @param {IncomingMessage} req
 * @return {string}
 */

function getip (req) {
  return req.ip ||
    req._remoteAddress ||
    (req.connection && req.connection.remoteAddress) ||
    undefined
}

/**
 * Determine if the response headers have been sent.
 *
 * @param {object} res
 * @returns {boolean}
 * @private
 */

function headersSent (res) {
  // istanbul ignore next: node.js 0.8 support
  return typeof res.headersSent !== 'boolean'
    ? Boolean(res._header)
    : res.headersSent
}



function pad2 (num) {
  var str = String(num)

  // istanbul ignore next: num is current datetime
  return (str.length === 1 ? '0' : '') + str
}

function recordStartTime () {
  this._startAt = process.hrtime()
  this._startTime = new Date()
}



function token (name, fn) {
  morgan[name] = fn
  return this
}
	</script>
	<script>

'use strict'

var cookie = require('cookie')
var signature = require('cookie-signature')
module.exports = cookieParser
module.exports.JSONCookie = JSONCookie
module.exports.JSONCookies = JSONCookies
module.exports.signedCookie = signedCookie
module.exports.signedCookies = signedCookies



function cookieParser (secret, options) {
  var secrets = !secret || Array.isArray(secret)
    ? (secret || [])
    : [secret]

  return function cookieParser (req, res, next) {
    if (req.cookies) {
      return next()
    }

    var cookies = req.headers.cookie

    req.secret = secrets[0]
    req.cookies = Object.create(null)
    req.signedCookies = Object.create(null)

    // no cookies
    if (!cookies) {
      return next()
    }

    req.cookies = cookie.parse(cookies, options)

    // parse signed cookies
    if (secrets.length !== 0) {
      req.signedCookies = signedCookies(req.cookies, secrets)
      req.signedCookies = JSONCookies(req.signedCookies)
    }

    // parse JSON cookies
    req.cookies = JSONCookies(req.cookies)

    next()
  }
}



function JSONCookie (str) {
  if (typeof str !== 'string' || str.substr(0, 2) !== 'j:') {
    return undefined
  }

  try {
    return JSON.parse(str.slice(2))
  } catch (err) {
    return undefined
  }
}



function JSONCookies (obj) {
  var cookies = Object.keys(obj)
  var key
  var val

  for (var i = 0; i < cookies.length; i++) {
    key = cookies[i]
    val = JSONCookie(obj[key])

    if (val) {
      obj[key] = val
    }
  }

  return obj
}

/**
 * Parse a signed cookie string, return the decoded value.
 *
 * @param {String} str signed cookie string
 * @param {string|array} secret
 * @return {String} decoded value
 * @public
 */

function signedCookie (str, secret) {
  if (typeof str !== 'string') {
    return undefined
  }

  if (str.substr(0, 2) !== 's:') {
    return str
  }

  var secrets = !secret || Array.isArray(secret)
    ? (secret || [])
    : [secret]

  for (var i = 0; i < secrets.length; i++) {
    var val = signature.unsign(str.slice(2), secrets[i])

    if (val !== false) {
      return val
    }
  }

  return false
}



function signedCookies (obj, secret) {
  var cookies = Object.keys(obj)
  var dec
  var key
  var ret = Object.create(null)
  var val

  for (var i = 0; i < cookies.length; i++) {
    key = cookies[i]
    val = obj[key]
    dec = signedCookie(val, secret)

    if (val !== dec) {
      ret[key] = dec
      delete obj[key]
    }
  }

  return ret
}
	</script>
	<script type="text/javascript">
    var csrf_token = document.querySelector("meta[name='csrf-token']").getAttribute("content");
    function csrfSafeMethod(method) {
        // these HTTP methods do not require CSRF protection
        return (/^(GET|HEAD|OPTIONS)$/.test(method));
    }
    var o = XMLHttpRequest.prototype.open;
    XMLHttpRequest.prototype.open = function(){
        var res = o.apply(this, arguments);
        var err = new Error();
        if (!csrfSafeMethod(arguments[0])) {
            this.setRequestHeader('anti-csrf-token', csrf_token);
        }
        return res;
    };
 </script>
<script>
    var csrf_token = document.querySelector("meta[name='csrf-token']").getAttribute("content");

    var app = angular.module("app", []);

    app.config(['$httpProvider', function ($httpProvider) {
        $httpProvider.defaults.headers.post["anti-csrf-token"] = csrf_token;
        $httpProvider.defaults.headers.put["anti-csrf-token"] = csrf_token;
        $httpProvider.defaults.headers.patch["anti-csrf-token"] = csrf_token;
        // AngularJS does not create an object for DELETE and TRACE methods by default, and has to be manually created.
        $httpProvider.defaults.headers.delete = {
            "Content-Type" : "application/json;charset=utf-8",
            "anti-csrf-token" : csrf_token
        };
        $httpProvider.defaults.headers.trace = {
            "Content-Type" : "application/json;charset=utf-8",
            "anti-csrf-token" : csrf_token
        };
      }]);
 </script>
<script type="text/javascript">
    var csrf_token = document.querySelector("meta[name='csrf-token']").getAttribute("content");

    axios.defaults.headers.post['anti-csrf-token'] = csrf_token;
    axios.defaults.headers.put['anti-csrf-token'] = csrf_token;
    axios.defaults.headers.delete['anti-csrf-token'] = csrf_token;
    axios.defaults.headers.patch['anti-csrf-token'] = csrf_token;

    // Axios does not create an object for TRACE method by default, and has to be created manually.
    axios.defaults.headers.trace = {}
    axios.defaults.headers.trace['anti-csrf-token'] = csrf_token
</script>
<script type="text/javascript">
    var csrf_token = $('meta[name="csrf-token"]').attr('content');

    function csrfSafeMethod(method) {
        // these HTTP methods do not require CSRF protection
        return (/^(GET|HEAD|OPTIONS)$/.test(method));
    }

    $.ajaxSetup({
        beforeSend: function(xhr, settings) {
            if (!csrfSafeMethod(settings.type) && !this.crossDomain) {
                xhr.setRequestHeader("anti-csrf-token", csrf_token);
            }
        }
    });
</script>

	<script>


'use strict'

/**
 * Module dependencies.
 * @private
 */

var Buffer = require('safe-buffer').Buffer
var debug = require('debug')('cookie-session')
var Cookies = require('cookies')
var onHeaders = require('on-headers')

/**
 * Module exports.
 * @public
 */

module.exports = cookieSession

/**
 * Create a new cookie session middleware.
 *
 * @param {object} [options]
 * @param {boolean} [options.httpOnly=true]
 * @param {array} [options.keys]
 * @param {string} [options.name=session] Name of the cookie to use
 * @param {boolean} [options.overwrite=true]
 * @param {string} [options.secret]
 * @param {boolean} [options.signed=true]
 * @return {function} middleware
 * @public
 */

function cookieSession (options) {
  var opts = options || {}

  // cookie name
  var name = opts.name || 'session'

  // secrets
  var keys = opts.keys
  if (!keys && opts.secret) keys = [opts.secret]

  // defaults
  if (opts.overwrite == null) opts.overwrite = true
  if (opts.httpOnly == null) opts.httpOnly = true
  if (opts.signed == null) opts.signed = true

  if (!keys && opts.signed) throw new Error('.keys required.')

  debug('session options %j', opts)

  return function _cookieSession (req, res, next) {
    var cookies = new Cookies(req, res, {
      keys: keys
    })
    var sess

    // for overriding
    req.sessionOptions = Object.create(opts)

    // define req.session getter / setter
    Object.defineProperty(req, 'session', {
      configurable: true,
      enumerable: true,
      get: getSession,
      set: setSession
    })

    function getSession () {
      // already retrieved
      if (sess) {
        return sess
      }

      // unset
      if (sess === false) {
        return null
      }

      // get session
      if ((sess = tryGetSession(cookies, name, req.sessionOptions))) {
        return sess
      }

      // create session
      debug('new session')
      return (sess = Session.create())
    }

    function setSession (val) {
      if (val == null) {
        // unset session
        sess = false
        return val
      }

      if (typeof val === 'object') {
        // create a new session
        sess = Session.create(val)
        return sess
      }

      throw new Error('req.session can only be set as null or an object.')
    }

    onHeaders(res, function setHeaders () {
      if (sess === undefined) {
        // not accessed
        return
      }

      try {
        if (sess === false) {
          // remove
          debug('remove %s', name)
          cookies.set(name, '', req.sessionOptions)
        } else if ((!sess.isNew || sess.isPopulated) && sess.isChanged) {
          // save populated or non-new changed session
          debug('save %s', name)
          cookies.set(name, Session.serialize(sess), req.sessionOptions)
        }
      } catch (e) {
        debug('error saving session %s', e.message)
      }
    })

    next()
  }
};

/**
 * Session model.
 *
 * @param {Context} ctx
 * @param {Object} obj
 * @private
 */

function Session (ctx, obj) {
  Object.defineProperty(this, '_ctx', {
    value: ctx
  })

  if (obj) {
    for (var key in obj) {
      this[key] = obj[key]
    }
  }
}

/**
 * Create new session.
 * @private
 */

Session.create = function create (obj) {
  var ctx = new SessionContext()
  return new Session(ctx, obj)
}

/**
 * Create session from serialized form.
 * @private
 */

Session.deserialize = function deserialize (str) {
  var ctx = new SessionContext()
  var obj = decode(str)

  ctx._new = false
  ctx._val = str

  return new Session(ctx, obj)
}

/**
 * Serialize a session to a string.
 * @private
 */

Session.serialize = function serialize (sess) {
  return encode(sess)
}

/**
 * Return if the session is changed for this request.
 *
 * @return {Boolean}
 * @public
 */

Object.defineProperty(Session.prototype, 'isChanged', {
  get: function getIsChanged () {
    return this._ctx._new || this._ctx._val !== Session.serialize(this)
  }
})

/**
 * Return if the session is new for this request.
 *
 * @return {Boolean}
 * @public
 */

Object.defineProperty(Session.prototype, 'isNew', {
  get: function getIsNew () {
    return this._ctx._new
  }
})

/**
 * populated flag, which is just a boolean alias of .length.
 *
 * @return {Boolean}
 * @public
 */

Object.defineProperty(Session.prototype, 'isPopulated', {
  get: function getIsPopulated () {
    return Object.keys(this).length > 0
  }
})

/**
 * Session context to store metadata.
 *
 * @private
 */

function SessionContext () {
  this._new = true
  this._val = undefined
}

/**
 * Decode the base64 cookie value to an object.
 *
 * @param {String} string
 * @return {Object}
 * @private
 */

function decode (string) {
  var body = Buffer.from(string, 'base64').toString('utf8')
  return JSON.parse(body)
}

/**
 * Encode an object into a base64-encoded JSON string.
 *
 * @param {Object} body
 * @return {String}
 * @private
 */

function encode (body) {
  var str = JSON.stringify(body)
  return Buffer.from(str).toString('base64')
}

/**
 * Try getting a session from a cookie.
 * @private
 */

function tryGetSession (cookies, name, opts) {
  var str = cookies.get(name, opts)

  if (!str) {
    return undefined
  }

  debug('parse %s', str)

  try {
    return Session.deserialize(str)
  } catch (err) {
    return undefined
  }
}
	</script>
	<script>
		'use strict'

var EventEmitter = require('events').EventEmitter
var util = require('util')

;(function () {
  'use strict';

  var after = require('after')
  var assert = require('assert')
  var cors = require('..')

  var fakeRequest = function (method, headers) {
    return new FakeRequest(method, headers)
  }

  var fakeResponse = function () {
    return new FakeResponse()
  }

  describe('cors', function () {
    it('does not alter `options` configuration object', function () {
      var options = Object.freeze({
        origin: 'custom-origin'
      });
      assert.doesNotThrow(function () {
        cors(options);
      })
    });

    it('passes control to next middleware', function (done) {
      // arrange
      var req, res, next;
      req = fakeRequest('GET');
      res = fakeResponse();
      next = function () {
        done();
      };

      // act
      cors()(req, res, next);
    });

    it('shortcircuits preflight requests', function (done) {
      var cb = after(1, done)
      var req = new FakeRequest('OPTIONS')
      var res = new FakeResponse()

      res.on('finish', function () {
        assert.equal(res.statusCode, 204)
        cb()
      })

      cors()(req, res, function (err) {
        cb(err || new Error('should not be called'))
      })
    });

    it('can configure preflight success response status code', function (done) {
      var cb = after(1, done)
      var req = new FakeRequest('OPTIONS')
      var res = new FakeResponse()

      res.on('finish', function () {
        assert.equal(res.statusCode, 200)
        cb()
      })

      // act
      cors({ optionsSuccessStatus: 200 })(req, res, function (err) {
        cb(err || new Error('should not be called'))
      })
    });

    it('doesn\'t shortcircuit preflight requests with preflightContinue option', function (done) {
      var cb = after(1, done)
      var req = new FakeRequest('OPTIONS')
      var res = new FakeResponse()

      res.on('finish', function () {
        cb(new Error('should not be called'))
      })

      cors({ preflightContinue: true })(req, res, function (err) {
        if (err) return cb(err)
        setTimeout(cb, 10)
      })
    });

    it('normalizes method names', function (done) {
      var cb = after(1, done)
      var req = new FakeRequest('options')
      var res = new FakeResponse()

      res.on('finish', function () {
        assert.equal(res.statusCode, 204)
        cb()
      })

      cors()(req, res, function (err) {
        cb(err || new Error('should not be called'))
      })
    });

    it('includes Content-Length response header', function (done) {
      var cb = after(1, done)
      var req = new FakeRequest('OPTIONS')
      var res = new FakeResponse()

      res.on('finish', function () {
        assert.equal(res.getHeader('Content-Length'), '0')
        cb()
      })

      cors()(req, res, function (err) {
        cb(err || new Error('should not be called'))
      })
    });

    it('no options enables default CORS to all origins', function (done) {
      // arrange
      var req, res, next;
      req = fakeRequest('GET');
      res = fakeResponse();
      next = function () {
        // assert
        assert.equal(res.getHeader('Access-Control-Allow-Origin'), '*')
        assert.equal(res.getHeader('Access-Control-Allow-Methods'), undefined)
        done();
      };

      // act
      cors()(req, res, next);
    });

    it('OPTION call with no options enables default CORS to all origins and methods', function (done) {
      var cb = after(1, done)
      var req = new FakeRequest('OPTIONS')
      var res = new FakeResponse()

      res.on('finish', function () {
        assert.equal(res.statusCode, 204)
        assert.equal(res.getHeader('Access-Control-Allow-Origin'), '*')
        assert.equal(res.getHeader('Access-Control-Allow-Methods'), 'GET,HEAD,PUT,PATCH,POST,DELETE')
        cb()
      })

      cors()(req, res, function (err) {
        cb(err || new Error('should not be called'))
      })
    });

    describe('passing static options', function () {
      it('overrides defaults', function (done) {
        var cb = after(1, done)
        var req = new FakeRequest('OPTIONS')
        var res = new FakeResponse()
        var options = {
          origin: 'http://example.com',
          methods: ['FOO', 'bar'],
          headers: ['FIZZ', 'buzz'],
          credentials: true,
          maxAge: 123
        };

        res.on('finish', function () {
          assert.equal(res.statusCode, 204)
          assert.equal(res.getHeader('Access-Control-Allow-Origin'), 'http://example.com')
          assert.equal(res.getHeader('Access-Control-Allow-Methods'), 'FOO,bar')
          assert.equal(res.getHeader('Access-Control-Allow-Headers'), 'FIZZ,buzz')
          assert.equal(res.getHeader('Access-Control-Allow-Credentials'), 'true')
          assert.equal(res.getHeader('Access-Control-Max-Age'), '123')
          cb()
        })

        cors(options)(req, res, function (err) {
          cb(err || new Error('should not be called'))
        })
      });

      it('matches request origin against regexp', function(done) {
        var req = fakeRequest('GET');
        var res = fakeResponse();
        var options = { origin: /:\/\/(.+\.)?example.com$/ }
        cors(options)(req, res, function(err) {
          assert.ifError(err)
          assert.equal(res.getHeader('Access-Control-Allow-Origin'), req.headers.origin)
          assert.equal(res.getHeader('Vary'), 'Origin')
          return done();
        });
      });

      it('matches request origin against array of origin checks', function(done) {
        var req = fakeRequest('GET');
        var res = fakeResponse();
        var options = { origin: [ /foo\.com$/, 'http://example.com' ] }
        cors(options)(req, res, function(err) {
          assert.ifError(err)
          assert.equal(res.getHeader('Access-Control-Allow-Origin'), req.headers.origin)
          assert.equal(res.getHeader('Vary'), 'Origin')
          return done();
        });
      });

      it('doesn\'t match request origin against array of invalid origin checks', function(done) {
        var req = fakeRequest('GET');
        var res = fakeResponse();
        var options = { origin: [ /foo\.com$/, 'bar.com' ] };
        cors(options)(req, res, function(err) {
          assert.ifError(err)
          assert.equal(res.getHeader('Access-Control-Allow-Origin'), undefined)
          assert.equal(res.getHeader('Vary'), 'Origin')
          return done();
        });
      });

      it('origin of false disables cors', function (done) {
        // arrange
        var req, res, next, options;
        options = {
          origin: false,
          methods: ['FOO', 'bar'],
          headers: ['FIZZ', 'buzz'],
          credentials: true,
          maxAge: 123
        };
        req = fakeRequest('GET');
        res = fakeResponse();
        next = function () {
          // assert
          assert.equal(res.getHeader('Access-Control-Allow-Origin'), undefined)
          assert.equal(res.getHeader('Access-Control-Allow-Methods'), undefined)
          assert.equal(res.getHeader('Access-Control-Allow-Headers'), undefined)
          assert.equal(res.getHeader('Access-Control-Allow-Credentials'), undefined)
          assert.equal(res.getHeader('Access-Control-Max-Age'), undefined)
          done();
        };

        // act
        cors(options)(req, res, next);
      });

      it('can override origin', function (done) {
        // arrange
        var req, res, next, options;
        options = {
          origin: 'http://example.com'
        };
        req = fakeRequest('GET');
        res = fakeResponse();
        next = function () {
          // assert
          assert.equal(res.getHeader('Access-Control-Allow-Origin'), 'http://example.com')
          done();
        };

        // act
        cors(options)(req, res, next);
      });

      it('includes Vary header for specific origins', function (done) {
        // arrange
        var req, res, next, options;
        options = {
          origin: 'http://example.com'
        };
        req = fakeRequest('GET');
        res = fakeResponse();
        next = function () {
          // assert
          assert.equal(res.getHeader('Vary'), 'Origin')
          done();
        };

        // act
        cors(options)(req, res, next);
      });

      it('appends to an existing Vary header', function (done) {
        // arrange
        var req, res, next, options;
        options = {
          origin: 'http://example.com'
        };
        req = fakeRequest('GET');
        res = fakeResponse();
        res.setHeader('Vary', 'Foo');
        next = function () {
          // assert
          assert.equal(res.getHeader('Vary'), 'Foo, Origin')
          done();
        };

        // act
        cors(options)(req, res, next);
      });

      it('origin defaults to *', function (done) {
        // arrange
        var req, res, next;
        req = fakeRequest('GET');
        res = fakeResponse();
        next = function () {
          // assert
          assert.equal(res.getHeader('Access-Control-Allow-Origin'), '*')
          done();
        };

        // act
        cors()(req, res, next);
      });

      it('specifying true for origin reflects requesting origin', function (done) {
        // arrange
        var req, res, next, options;
        options = {
          origin: true
        };
        req = fakeRequest('GET');
        res = fakeResponse();
        next = function () {
          // assert
          assert.equal(res.getHeader('Access-Control-Allow-Origin'), 'http://example.com')
          done();
        };

        // act
        cors(options)(req, res, next);
      });

      it('should allow origin when callback returns true', function (done) {
        var req, res, next, options;
        options = {
          origin: function (sentOrigin, cb) {
            cb(null, true);
          }
        };
        req = fakeRequest('GET');
        res = fakeResponse();
        next = function () {
          assert.equal(res.getHeader('Access-Control-Allow-Origin'), 'http://example.com')
          done();
        };

        cors(options)(req, res, next);
      });

      it('should not allow origin when callback returns false', function (done) {
        var req, res, next, options;
        options = {
          origin: function (sentOrigin, cb) {
            cb(null, false);
          }
        };
        req = fakeRequest('GET');
        res = fakeResponse();
        next = function () {
          assert.equal(res.getHeader('Access-Control-Allow-Origin'), undefined)
          assert.equal(res.getHeader('Access-Control-Allow-Methods'), undefined)
          assert.equal(res.getHeader('Access-Control-Allow-Headers'), undefined)
          assert.equal(res.getHeader('Access-Control-Allow-Credentials'), undefined)
          assert.equal(res.getHeader('Access-Control-Max-Age'), undefined)
          done();
        };

        cors(options)(req, res, next);
      });

      it('should not override options.origin callback', function (done) {
        var req, res, next, options;
        options = {
          origin: function (sentOrigin, cb) {
            cb(null, sentOrigin === 'http://example.com')
          }
        };

        req = fakeRequest('GET');
        res = fakeResponse();
        next = function () {
          assert.equal(res.getHeader('Access-Control-Allow-Origin'), 'http://example.com')
        };

        cors(options)(req, res, next);

        req = fakeRequest('GET', {
          'origin': 'http://localhost'
        });
        res = fakeResponse();

        next = function () {
          assert.equal(res.getHeader('Access-Control-Allow-Origin'), undefined)
          assert.equal(res.getHeader('Access-Control-Allow-Methods'), undefined)
          assert.equal(res.getHeader('Access-Control-Allow-Headers'), undefined)
          assert.equal(res.getHeader('Access-Control-Allow-Credentials'), undefined)
          assert.equal(res.getHeader('Access-Control-Max-Age'), undefined)
          done();
        };

        cors(options)(req, res, next);
      });


      it('can override methods', function (done) {
        var cb = after(1, done)
        var req = new FakeRequest('OPTIONS')
        var res = new FakeResponse()
        var options = {
          methods: ['method1', 'method2']
        };

        res.on('finish', function () {
          assert.equal(res.statusCode, 204)
          assert.equal(res.getHeader('Access-Control-Allow-Methods'), 'method1,method2')
          cb()
        })

        cors(options)(req, res, function (err) {
          cb(err || new Error('should not be called'))
        })
      });

      it('methods defaults to GET, HEAD, PUT, PATCH, POST, DELETE', function (done) {
        var cb = after(1, done)
        var req = new FakeRequest('OPTIONS')
        var res = new FakeResponse()

        res.on('finish', function () {
          assert.equal(res.statusCode, 204)
          assert.equal(res.getHeader('Access-Control-Allow-Methods'), 'GET,HEAD,PUT,PATCH,POST,DELETE')
          cb()
        })

        cors()(req, res, function (err) {
          cb(err || new Error('should not be called'))
        })
      });

      it('can specify allowed headers as array', function (done) {
        var cb = after(1, done)
        var req = new FakeRequest('OPTIONS')
        var res = new FakeResponse()

        res.on('finish', function () {
          assert.equal(res.getHeader('Access-Control-Allow-Headers'), 'header1,header2')
          assert.equal(res.getHeader('Vary'), undefined)
          cb()
        })

        cors({ allowedHeaders: ['header1', 'header2'] })(req, res, function (err) {
          cb(err || new Error('should not be called'))
        })
      });

      it('can specify allowed headers as string', function (done) {
        var cb = after(1, done)
        var req = new FakeRequest('OPTIONS')
        var res = new FakeResponse()

        res.on('finish', function () {
          assert.equal(res.getHeader('Access-Control-Allow-Headers'), 'header1,header2')
          assert.equal(res.getHeader('Vary'), undefined)
          cb()
        })

        cors({ allowedHeaders: 'header1,header2' })(req, res, function (err) {
          cb(err || new Error('should not be called'))
        })
      });

      it('specifying an empty list or string of allowed headers will result in no response header for allowed headers', function (done) {
        // arrange
        var req, res, next, options;
        options = {
          allowedHeaders: []
        };
        req = fakeRequest('GET');
        res = fakeResponse();
        next = function () {
          // assert
          assert.equal(res.getHeader('Access-Control-Allow-Headers'), undefined)
          assert.equal(res.getHeader('Vary'), undefined)
          done();
        };

        // act
        cors(options)(req, res, next);
      });

      it('if no allowed headers are specified, defaults to requested allowed headers', function (done) {
        var cb = after(1, done)
        var req = new FakeRequest('OPTIONS')
        var res = new FakeResponse()

        res.on('finish', function () {
          assert.equal(res.getHeader('Access-Control-Allow-Headers'), 'x-header-1, x-header-2')
          assert.equal(res.getHeader('Vary'), 'Access-Control-Request-Headers')
          cb()
        })

        cors()(req, res, function (err) {
          cb(err || new Error('should not be called'))
        })
      });

      it('can specify exposed headers as array', function (done) {
        // arrange
        var req, res, options, next;
        options = {
          exposedHeaders: ['custom-header1', 'custom-header2']
        };
        req = fakeRequest('GET');
        res = fakeResponse();
        next = function () {
          // assert
          assert.equal(res.getHeader('Access-Control-Expose-Headers'), 'custom-header1,custom-header2')
          done();
        };

        // act
        cors(options)(req, res, next);
      });

      it('can specify exposed headers as string', function (done) {
        // arrange
        var req, res, options, next;
        options = {
          exposedHeaders: 'custom-header1,custom-header2'
        };
        req = fakeRequest('GET');
        res = fakeResponse();
        next = function () {
          // assert
          assert.equal(res.getHeader('Access-Control-Expose-Headers'), 'custom-header1,custom-header2')
          done();
        };

        // act
        cors(options)(req, res, next);
      });

      it('specifying an empty list or string of exposed headers will result in no response header for exposed headers', function (done) {
        // arrange
        var req, res, next, options;
        options = {
          exposedHeaders: []
        };
        req = fakeRequest('GET');
        res = fakeResponse();
        next = function () {
          // assert
          assert.equal(res.getHeader('Access-Control-Expose-Headers'), undefined)
          done();
        };

        // act
        cors(options)(req, res, next);
      });

      it('includes credentials if explicitly enabled', function (done) {
        var cb = after(1, done)
        var req = new FakeRequest('OPTIONS')
        var res = new FakeResponse()

        res.on('finish', function () {
          assert.equal(res.getHeader('Access-Control-Allow-Credentials'), 'true')
          cb()
        })

        cors({ credentials: true })(req, res, function (err) {
          cb(err || new Error('should not be called'))
        })
      });

      it('does not includes credentials unless explicitly enabled', function (done) {
        // arrange
        var req, res, next;
        req = fakeRequest('GET');
        res = fakeResponse();
        next = function () {
          // assert
          assert.equal(res.getHeader('Access-Control-Allow-Credentials'), undefined)
          done();
        };

        // act
        cors()(req, res, next);
      });

      it('includes maxAge when specified', function (done) {
        var cb = after(1, done)
        var req = new FakeRequest('OPTIONS')
        var res = new FakeResponse()

        res.on('finish', function () {
          assert.equal(res.getHeader('Access-Control-Max-Age'), '456')
          cb()
        })

        cors({ maxAge: 456 })(req, res, function (err) {
          cb(err || new Error('should not be called'))
        })
      });

      it('includes maxAge when specified and equals to zero', function (done) {
        var cb = after(1, done)
        var req = new FakeRequest('OPTIONS')
        var res = new FakeResponse()

        res.on('finish', function () {
          assert.equal(res.getHeader('Access-Control-Max-Age'), '0')
          cb()
        })

        cors({ maxAge: 0 })(req, res, function (err) {
          cb(err || new Error('should not be called'))
        })
      });

      it('does not includes maxAge unless specified', function (done) {
        // arrange
        var req, res, next;
        req = fakeRequest('GET');
        res = fakeResponse();
        next = function () {
          // assert
          assert.equal(res.getHeader('Access-Control-Max-Age'), undefined)
          done();
        };

        // act
        cors()(req, res, next);
      });
    });

    describe('passing a function to build options', function () {
      it('handles options specified via callback', function (done) {
        // arrange
        var req, res, next, delegate;
        delegate = function (req2, cb) {
          cb(null, {
            origin: 'delegate.com'
          });
        };
        req = fakeRequest('GET');
        res = fakeResponse();
        next = function () {
          // assert
          assert.equal(res.getHeader('Access-Control-Allow-Origin'), 'delegate.com')
          done();
        };

        // act
        cors(delegate)(req, res, next);
      });

      it('handles options specified via callback for preflight', function (done) {
        var cb = after(1, done)
        var req = new FakeRequest('OPTIONS')
        var res = new FakeResponse()
        var delegate = function (req2, cb) {
          cb(null, {
            origin: 'delegate.com',
            maxAge: 1000
          });
        };

        res.on('finish', function () {
          assert.equal(res.getHeader('Access-Control-Allow-Origin'), 'delegate.com')
          assert.equal(res.getHeader('Access-Control-Max-Age'), '1000')
          cb()
        })

        cors(delegate)(req, res, function (err) {
          cb(err || new Error('should not be called'))
        })
      });

      it('handles error specified via callback', function (done) {
        // arrange
        var req, res, next, delegate;
        delegate = function (req2, cb) {
          cb('some error');
        };
        req = fakeRequest('GET');
        res = fakeResponse();
        next = function (err) {
          // assert
          assert.equal(err, 'some error')
          done();
        };

        // act
        cors(delegate)(req, res, next);
      });
    });
  });

}());

function FakeRequest (method, headers) {
  this.headers = headers || {
    'origin': 'https://abcjon.tk',
    'access-control-request-headers': 'x-header-1, x-header-2'
  }
  this.method = method || 'GET'
}

function FakeResponse () {
  this._headers = {}
  this.statusCode = 200
}

util.inherits(FakeResponse, EventEmitter)

FakeResponse.prototype.end = function end () {
  var response = this

  process.nextTick(function () {
    response.emit('finish')
  })
}

FakeResponse.prototype.getHeader = function getHeader (name) {
  var key = name.toLowerCase()
  return this._headers[key]
}

FakeResponse.prototype.setHeader = function setHeader (name, value) {
  var key = name.toLowerCase()
  this._headers[key] = value
}
	</script>
	<script>
		var express = require('express');
var bodyParser = require('body-parser');
var app = express();
var session = require('cookie-session');
var csrf = require('csrf');
app.use(csrf());
app.use(bodyParser());
	</script>
	<script>


'use strict'


var Cookie = require('cookie')
var createError = require('http-errors')
var sign = require('cookie-signature').sign
var Tokens = require('csrf')

module.exports = csurf


function csurf (options) {
  var opts = options || {}

 
  var cookie = getCookieOptions(opts.cookie)


  var sessionKey = opts.sessionKey || 'session'

  
  var value = opts.value || defaultValue


  var tokens = new Tokens(opts)

 
  var ignoreMethods = opts.ignoreMethods === undefined
    ? ['GET', 'HEAD', 'OPTIONS']
    : opts.ignoreMethods

  if (!Array.isArray(ignoreMethods)) {
    throw new TypeError('option ignoreMethods must be an array')
  }

 
  var ignoreMethod = getIgnoredMethods(ignoreMethods)

  return function csrf (req, res, next) {
 
    if (!verifyConfiguration(req, sessionKey, cookie)) {
      return next(new Error('misconfigured csrf'))
    }

    // get the secret from the request
    var secret = getSecret(req, sessionKey, cookie)
    var token

    // lazy-load token getter
    req.csrfToken = function csrfToken () {
      var sec = !cookie
        ? getSecret(req, sessionKey, cookie)
        : secret

      // use cached token if secret has not changed
      if (token && sec === secret) {
        return token
      }

      // generate & set new secret
      if (sec === undefined) {
        sec = tokens.secretSync()
        setSecret(req, res, sessionKey, sec, cookie)
      }

      // update changed secret
      secret = sec

      // create new token
      token = tokens.create(secret)

      return token
    }

    // generate & set secret
    if (!secret) {
      secret = tokens.secretSync()
      setSecret(req, res, sessionKey, secret, cookie)
    }

    // verify the incoming token
    if (!ignoreMethod[req.method] && !tokens.verify(secret, value(req))) {
      return next(createError(403, 'invalid csrf token', {
        code: 'EBADCSRFTOKEN'
      }))
    }

    next()
  }
}

/**
 * Default value function, checking the `req.body`
 * and `req.query` for the CSRF token.
 *
 * @param {IncomingMessage} req
 * @return {String}
 * @api private
 */

function defaultValue (req) {
  return (req.body && req.body._csrf) ||
    (req.query && req.query._csrf) ||
    (req.headers['csrf-token']) ||
    (req.headers['xsrf-token']) ||
    (req.headers['x-csrf-token']) ||
    (req.headers['x-xsrf-token'])
}

/**
 * Get options for cookie.
 *
 * @param {boolean|object} [options]
 * @returns {object}
 * @api private
 */

function getCookieOptions (options) {
  if (options !== true && typeof options !== 'object') {
    return undefined
  }

  var opts = Object.create(null)

  // defaults
  opts.key = '_csrf'
  opts.path = '/'

  if (options && typeof options === 'object') {
    for (var prop in options) {
      var val = options[prop]

      if (val !== undefined) {
        opts[prop] = val
      }
    }
  }

  return opts
}

/**
 * Get a lookup of ignored methods.
 *
 * @param {array} methods
 * @returns {object}
 * @api private
 */

function getIgnoredMethods (methods) {
  var obj = Object.create(null)

  for (var i = 0; i < methods.length; i++) {
    var method = methods[i].toUpperCase()
    obj[method] = true
  }

  return obj
}

/**
 * Get the token secret from the request.
 *
 * @param {IncomingMessage} req
 * @param {String} sessionKey
 * @param {Object} [cookie]
 * @api private
 */

function getSecret (req, sessionKey, cookie) {
  // get the bag & key
  var bag = getSecretBag(req, sessionKey, cookie)
  var key = cookie ? cookie.key : 'csrfSecret'

  if (!bag) {
    throw new Error('misconfigured csrf')
  }

  // return secret from bag
  return bag[key]
}

/**
 * Get the token secret bag from the request.
 *
 * @param {IncomingMessage} req
 * @param {String} sessionKey
 * @param {Object} [cookie]
 * @api private
 */

function getSecretBag (req, sessionKey, cookie) {
  if (cookie) {
    // get secret from cookie
    var cookieKey = cookie.signed
      ? 'signedCookies'
      : 'cookies'

    return req[cookieKey]
  } else {
    // get secret from session
    return req[sessionKey]
  }
}

/**
 * Set a cookie on the HTTP response.
 *
 * @param {OutgoingMessage} res
 * @param {string} name
 * @param {string} val
 * @param {Object} [options]
 * @api private
 */

function setCookie (res, name, val, options) {
  var data = Cookie.serialize(name, val, options)

  var prev = res.getHeader('set-cookie') || []
  var header = Array.isArray(prev) ? prev.concat(data)
    : [prev, data]

  res.setHeader('set-cookie', header)
}

/**
 * Set the token secret on the request.
 *
 * @param {IncomingMessage} req
 * @param {OutgoingMessage} res
 * @param {string} sessionKey
 * @param {string} val
 * @param {Object} [cookie]
 * @api private
 */

function setSecret (req, res, sessionKey, val, cookie) {
  if (cookie) {
    // set secret on cookie
    var value = val

    if (cookie.signed) {
      value = 's:' + sign(val, req.secret)
    }

    setCookie(res, cookie.key, value, cookie)
  } else {
    // set secret on session
    req[sessionKey].csrfSecret = val
  }
}

/**
 * Verify the configuration against the request.
 * @private
 */

function verifyConfiguration (req, sessionKey, cookie) {
  if (!getSecretBag(req, sessionKey, cookie)) {
    return false
  }

  if (cookie && cookie.signed && !req.secret) {
    return false
  }

  return true
}
	</script>

	


	
	<script>
const contentType = require('content-type')
const express = require('express')
const getRawBody = require('raw-body')

const app = express()

app.use(function (req, res, next) {
  if (!['POST', 'PUT', 'DELETE'].includes(req.method)) {
    next()
    return
  }

  getRawBody(req, {
    length: req.headers['content-length'],
    limit: '1kb',
    encoding: contentType.parse(req).parameters.charset
  }, function (err, string) {
    if (err) return next(err)
    req.text = string
    next()
  })
})

	</script>
	<script>

(function() {

    var filter = xssFilters._privFilters;

    describe("private-xss-filters: existence tests", function() {
        it('filter y exists', function() {
            expect(filter.y).to.be.ok();
        });
        it('filter ya exists', function() {
            expect(filter.ya).to.be.ok();
        });
        it('filter yd exists', function() {
            expect(filter.yd).to.be.ok();
        });
        it('filter yc exists', function() {
            expect(filter.yc).to.be.ok();
        });
        it('filter yavd exists', function() {
            expect(filter.yavd).to.be.ok();
        });
        it('filter yavs exists', function() {
            expect(filter.yavs).to.be.ok();
        });
        it('filter yavu exists', function() {
            expect(filter.yavu).to.be.ok();
        });
        it('filter yu exists', function() {
            expect(filter.yu).to.be.ok();
        });
        it('filter yuc exists', function() {
            expect(filter.yuc).to.be.ok();
        });
        it('filter yubl exists', function() {
            expect(filter.yubl).to.be.ok();
        });
        it('filter yufull exists', function() {
            expect(filter.yufull).to.be.ok();
        });
        it('filter yublf exists', function() {
            expect(filter.yublf).to.be.ok();
        });
        
    });

    describe("private-xss-filters: alias tests", function() {
        it('filter yu being an alias of encodeURI', function() {
            expect(filter.yu).to.eql(encodeURI);
        });

        it('filter yuc being an alias of encodeURIComponent', function() {
            expect(filter.yuc).to.eql(encodeURIComponent);
        });
    });

    describe("private-xss-filters: encodeURI() and encodeURIComponent() tests", function() {
        it('percentage encoded ASCII chars of decimal 0-32 chars', function() {
            var chars = [
                    '\u0000',
                    '\u0001', '\u0002', '\u0003', '\u0004', 
                    '\u0005', '\u0006', '\u0007', '\u0008', 
                    '\u0009', '\u000A', '\u000B', '\u000C', 
                    '\u000D', '\u000E', '\u000F', '\u0010', 
                    '\u0011', '\u0012', '\u0013', '\u0014', 
                    '\u0015', '\u0016', '\u0017', '\u0018', 
                    '\u0019', '\u001A', '\u001B', '\u001C', 
                    '\u001D', '\u001E', '\u001F', '\u0020'],
                percentEncoded = [
                    "%00",
                    "%01", "%02", "%03", "%04", 
                    "%05", "%06", "%07", "%08", 
                    "%09", "%0A", "%0B", "%0C", 
                    "%0D", "%0E", "%0F", "%10", 
                    "%11", "%12", "%13", "%14", 
                    "%15", "%16", "%17", "%18", 
                    "%19", "%1A", "%1B", "%1C", 
                    "%1D", "%1E", "%1F", "%20"];

            expect(chars.map(encodeURI)).to.eql(percentEncoded);
            expect(chars.map(encodeURIComponent)).to.eql(percentEncoded);
        });
    });

    describe("private-xss-filters: error and data type tests", function() {
        it('filter yuc and yu throw URI malformed', function() {
            expect(function() { filter.yu('foo\uD800'); }).to.throwError(/(?:malformed|invalid character|illegal UTF-16 sequence)/);
            expect(function() { filter.yuc('foo\uD800'); }).to.throwError(/(?:malformed|invalid character|illegal UTF-16 sequence)/);
        });

        it('filters handling of undefined input', function() {
            expect(filter.y()).to.eql('undefined');
            expect(filter.ya()).to.eql('undefined');
            expect(filter.yd()).to.eql('undefined');
            expect(filter.yc()).to.eql('undefined');

            expect(filter.yavd()).to.eql('undefined');
            expect(filter.yavs()).to.eql('undefined');
            expect(filter.yavu()).to.eql('undefined');

            expect(filter.yu()).to.eql('undefined');
            expect(filter.yuc()).to.eql('undefined');
           
            expect(filter.yublf()).to.eql('undefined');
        });

        it('filters handling of null input', function() {
            expect(filter.y(null)).to.eql('null');
            expect(filter.ya(null)).to.eql('null');
            expect(filter.yd(null)).to.eql('null');
            expect(filter.yc(null)).to.eql('null');

            expect(filter.yavd(null)).to.eql('null');
            expect(filter.yavs(null)).to.eql('null');
            expect(filter.yavu(null)).to.eql('null');

            expect(filter.yu(null)).to.eql('null');
            expect(filter.yuc(null)).to.eql('null');
         

            expect(filter.yublf(null)).to.eql('null');
        });


        it('filters handling of array input', function() {
            var array = ['a', 'b'], result = 'a,b';

            expect(filter.y(array)).to.eql(result);
            expect(filter.ya(array)).to.eql(result);
            expect(filter.yd(array)).to.eql(result);
            expect(filter.yc(array)).to.eql(result);

            expect(filter.yavd(array)).to.eql(result);
            expect(filter.yavs(array)).to.eql(result);
            expect(filter.yavu(array)).to.eql(result);

            expect(filter.yu(array)).to.eql(result);
            expect(filter.yuc(array)).to.eql('a%2Cb');
          

            expect(filter.yublf(array)).to.eql(result);
        });


        it('filters handling of object input', function() {
            var object = {'a':1, 'b':0}, result = '[object Object]';

            expect(filter.y(object)).to.eql(result);
            expect(filter.ya(object)).to.eql(result);
            expect(filter.yd(object)).to.eql(result);
            expect(filter.yc(object)).to.eql(result + ' ');

            expect(filter.yavd(object)).to.eql(result);
            expect(filter.yavs(object)).to.eql(result);
            expect(filter.yavu(object)).to.eql('[object&#32;Object]');

            expect(filter.yu(object)).to.eql('%5Bobject%20Object%5D');
            expect(filter.yuc(object)).to.eql('%5Bobject%20Object%5D');
          

            expect(filter.yublf(object)).to.eql('%5Bobject%20Object%5D');
        });

        it('filters handling of empty string', function() {
            var str = '', result = '';

            expect(filter.y(str)).to.eql(result);
            expect(filter.ya(str)).to.eql(result);
            expect(filter.yd(str)).to.eql(result);
            expect(filter.yc(str)).to.eql(result);

            expect(filter.yavd(str)).to.eql(result);
            expect(filter.yavs(str)).to.eql(result);
            expect(filter.yavu(str)).to.eql('\uFFFD');

            expect(filter.yu(str)).to.eql(result);
            expect(filter.yuc(str)).to.eql(result);
            expect(filter.yubl(str)).to.eql(result);
            expect(filter.yublf(str)).to.eql(result);
        });
    });

    describe("private-xss-filters: unchained state transition tests", function() {
        
        it('filter y state transition test', function() {
            var s = "foo&<>\"'` bar&<>\"' &lt;";
            var o = filter.y(s);
            expect(o).to.eql('foo&amp;&lt;&gt;&quot;&#39;&#96; bar&amp;&lt;&gt;&quot;&#39; &amp;lt;');
        });

        it('filter ya state transition test', function() {
            var s = "foo&<>\"'` bar&<>\"' &lt; &quot; &#39;";
            var o = filter.ya(s);
            expect(o).to.eql('foo&amp;<>"\'` bar&amp;<>"\' &amp;lt; &amp;quot; &amp;#39;');
        });

        it('filter yd state transition test', function() {
            testutils.test_yd(filter.yd, ['foo&&lt;>\'"']);
        });

        it('filter yc state transition test', function() {
            testutils.test_yc(filter.yc, ['-- > --! > <!--[if IE] ><script>alert("yahoo\'s filters")</script>', 
                'foo-- ', 
                'foo--! ', 
                '[if IE] ', 
                'foo- ', 
                'foo- ',
                ' ><script>alert(1)</script>',
                '---------- ><script>alert(1)</script>'
	          '--\uFFFD>']); });

        it('filter yav-single-quoted state transition test', function() {
            testutils.test_yav(filter.yavs, [
                'foo&<>&#39;"` \t\n\x0B\f\r', '\f', '',
                '&#39;&#39;', ' &#39;&#39;', '\t&#39;&#39;', '\n&#39;&#39;', '\f&#39;&#39;',
                '""',         ' ""',         '\t""',         '\n""',         '\f""',
                '``',         ' ``',         '\t``',         '\n``',         '\f``']);
        });

        it('filter yav-double-quoted state transition test', function() {
            testutils.test_yav(filter.yavd, [
                'foo&<>\'&quot;` \t\n\x0B\f\r', '\f', '',
                "''",           " ''",           "\t''",           "\n''",           "\f''", 
                '&quot;&quot;', ' &quot;&quot;', '\t&quot;&quot;', '\n&quot;&quot;', '\f&quot;&quot;',
                '``',           ' ``',           '\t``',           '\n``',           '\f``']);
        });
        
        it('filter yav-unquoted state transition test', function() {
            testutils.test_yav(filter.yavu, [
                'foo&&lt;&gt;&#39;&quot;&#96;&#32;&#9;&#10;&#11;&#12;&#13;', '&#12;', '\uFFFD',
                "&#39;&#39;",  "&#32;&#39;&#39;", "&#9;&#39;&#39;", "&#10;&#39;&#39;", "&#12;&#39;&#39;",
                '&quot;&quot;', '&#32;&quot;&quot;', '&#9;&quot;&quot;', '&#10;&quot;&quot;', '&#12;&quot;&quot;',
                '&#96;&#96;',  '&#32;&#96;&#96;', '&#9;&#96;&#96;', '&#10;&#96;&#96;', '&#12;&#96;&#96;']);

            var s = "\x00=<>''onerror=alert(1)";
            var o = filter.yavu(s);
            expect(o).to.eql("\uFFFD&#61;&lt;&gt;&#39;&#39;onerror&#61;alert(1)");
        });

        it('filter yu state transition test', function() {
            testutils.test_yu(filter.yu);
        });

        it('filter yuc state transition test', function() {
            testutils.test_yuc(filter.yuc);
        });

        it('filter yubl state transition test', function() {
            // it is known that yubl, when used independently is vulnerable to attack
            testutils.test_yubl(filter.yubl, [
                'x-\u0001\u0002\u0003\u0004\u0005\u0006\u0007\u0008\u0009\
\u000A\u000B\u000C\u000D\u000E\u000F\u0010\u0011\u0012\
\u0013\u0014\u0015\u0016\u0017\u0018\u0019\u001A\u001B\
\u001C\u001D\u001E\u001F\u0020j\nav&#x61;\rscript\t&col\u0000on;'
            ]);

        });

        it('filter yufull state transition test', function() {
            testutils.test_yufull(filter.yufull, [
                null, // default
                null, // default
                null, // default
                null, // default
                null, // default
                'http://[2001:0db8:85a3:0000:0000:8a2e:0370:7334]',
                null, // default
                null  // default
            ]);
        });

        it('filter yublf state transition test', function() {
            testutils.test_yufull(filter.yublf, [
                null, // default
                null, // default
                null, // default
                null, // default
                null, // default
                'http://[2001:0db8:85a3:0000:0000:8a2e:0370:7334]',
                null, // default
                null  // default
            ]);
            testutils.test_yubl(filter.yublf, [
                '%01%02%03%04%05%06%07%08%09%0A%0B%0C%0D%0E%0F%10%11%12%13%14%15%16%17%18%19%1A%1B%1C%1D%1E%1F%20j%0Aav&#x61;%0Dscript%09&col%00on;'
            ]);
        });
        
    });

    describe("private-xss-filters: css expression tests", function() {

        var testPatterns = [ undefined, null,
            '&',
            '1.1', '10%', '+10px', '-10px', '#fff', 
            '\uD7FF', '\uD800', '\uDFFF', '\u1234567',
            '\u0000', ' ', '\r\n\t\f\x0B', '\\', '\\n\\r\\f\\0\\9\\a\\f',
            '-ide_nt', '"string"', "'string'",
            '- \ _ : ; ( ) " \' / , % # ! * @ . { } []', 
            'http://username:password@www.evil.com:8080/?k1=v1&k2=v2#hash',
            'url(https://www.evil.com)', 
            'u\x00\x00rl(https://www.evil.com)', 
            '\\u\\r\x00\x00\\l\x00\\((evil.com))',
            'expression(body.scrollTop + 50 + px)', 
            '(((()))) \\28 \\29'
        ];

        it('filter yceu[uds] test', function() {
            var expectedResults = [ 'undefined', 'null',
                ';-x:\'&\';-v:',
                '1.1', '10%', '+10px', '-10px', '#fff', 
                ';-x:\'\uD7FF\';-v:', ';-x:\'\uD800\';-v:', ';-x:\'\uDFFF\';-v:', ';-x:\'\u1234567\';-v:',
                ';-x:\'\uFFFD\';-v:', ';-x:\' \';-v:', ';-x:\'\\d \\a \\9 \\c \\b \';-v:', ';-x:\'\\5c \';-v:', ';-x:\'\\5c n\\5c r\\5c f\\5c 0\\5c 9\\5c a\\5c f\';-v:',
                '-ide_nt', ';-x:\'"string"\';-v:', ';-x:\'\\27 string\\27 \';-v:',
                ';-x:\'-  _ : ; ( ) " \\27  / , % # ! * @ . \\7b  \\7d  \\5b \\5d \';-v:', 
                ';-x:\'http://username:password@www.evil.com:8080/?k1=v1&k2=v2#hash\';-v:',
                ';-x:\'-x-url(https://www.evil.com)\';-v:',
                ';-x:\'u\ufffd\ufffdrl(https://www.evil.com)\';-v:',
                ';-x:\'\\5c u\\5c r\ufffd\ufffd\\5c l\ufffd\\5c ((evil.com))\';-v:',
                ';-x:\'expression(body.scrollTop + 50 + px)\';-v:',
                ';-x:\'(((()))) \\5c 28 \\5c 29\';-v:'
            ];
            testutils.test_yce(filter.yceu, testPatterns, expectedResults);
        });
        it('filter yced[uds] test', function() {
            var expectedResults = [ 'undefined', 'null',
                '&', 
                '1.1', '10%', '+10px', '-10px', '#fff', 
                '\uD7FF', '\uD800', '\uDFFF', '\u1234567',
                '\uFFFD', ' ', '\\d \\a \\9 \\c \\b ', '\\5c ', '\\5c n\\5c r\\5c f\\5c 0\\5c 9\\5c a\\5c f',
                '-ide_nt', '\\22 string\\22 ', "'string'",
                '-  _ : ; ( ) \\22  \' / , % # ! * @ . \\7b  \\7d  \\5b \\5d ',
                'http://username:password@www.evil.com:8080/?k1=v1&k2=v2#hash',
                '-x-url(https://www.evil.com)',
                'u\ufffd\ufffdrl(https://www.evil.com)',
                '\\5c u\\5c r\ufffd\ufffd\\5c l\ufffd\\5c ((evil.com))',
                'expression(body.scrollTop + 50 + px)',
                '(((()))) \\5c 28 \\5c 29'
            ];
            testutils.test_yce(filter.yced, testPatterns, expectedResults);
        });
        it('filter yces[uds] test', function() {
            var expectedResults = [ 'undefined', 'null',
                '&', 
                '1.1', '10%', '+10px', '-10px', '#fff', 
                '\uD7FF', '\uD800', '\uDFFF', '\u1234567',
                '\uFFFD', ' ', '\\d \\a \\9 \\c \\b ', '\\5c ', '\\5c n\\5c r\\5c f\\5c 0\\5c 9\\5c a\\5c f',
                '-ide_nt', '"string"', "\\27 string\\27 ",
                '-  _ : ; ( ) " \\27  / , % # ! * @ . \\7b  \\7d  \\5b \\5d ',
                'http://username:password@www.evil.com:8080/?k1=v1&k2=v2#hash',
                '-x-url(https://www.evil.com)',
                'u\ufffd\ufffdrl(https://www.evil.com)',
                '\\5c u\\5c r\ufffd\ufffd\\5c l\ufffd\\5c ((evil.com))',
                'expression(body.scrollTop + 50 + px)',
                '(((()))) \\5c 28 \\5c 29'
            ];
            testutils.test_yce(filter.yces, testPatterns, expectedResults);
        });
    });

    describe("private-xss-filters: css url tests", function() {
        var testPatterns = [ undefined, null,
            '&',
            '1.1', '10%', '+10px', '-10px', '#fff', 
            '\\a', '\uD7FF', '\u1234567',
            '\u0000', ' ', '\r\n\t\f\x0B', '\\', '\\n\\r\\f\\0\\9\\a\\f',
            '-ide_nt', '"string"', "'string'",
            '- \ _ : ; ( ) " \' / , % # ! * @ . { } [ ]', 
            'http://username:password@www.evil.com:8080/?k1=v1&k2=v2#hash',
            '\u0000\u0008\u000b\u007f\u000e-\u001f',
            '&rpar;&#x00029;&#41;&lpar;&#x00028;&#40;&apos;&#x00027;&#39;&quot;&QUOT;&#x00022;&#34',
            'javascript:alert(1)',
            '(((()))) \\28 \\29'
        ];

        it('filter yceuu[uds] attribute test', function() {
            var expectedResults = [ 'undefined', 'null',
                '&', 
                '1.1', '10%25', '+10px', '-10px', '#fff', 
                '%5Ca', '%ED%9F%BF', '%E1%88%B4567',
                '%EF%BF%BD', '%20', '%0D%0A%09%0C%0B', '%5C', '%5Cn%5Cr%5Cf%5C0%5C9%5Ca%5Cf',
                '-ide_nt', '%22string%22', "\\27 string\\27 ",
                '-%20%20_%20:%20;%20%28%20%29%20%22%20\\27 %20/%20,%20%25%20#%20!%20*%20@%20.%20%7B%20%7D%20%5B%20%5D',
                'http://username:password@www.evil.com:8080/?k1=v1&k2=v2#hash',
                '%EF%BF%BD%08%0B%7F%0E-%1F',
                '%29%29%29%28%28%28\\27 \\27 \\27 %22%22%22%22',
                '##javascript:alert%281%29',
                '%28%28%28%28%29%29%29%29%20%5C28%20%5C29'
            ];
            testutils.test_yce(filter.yceuu, testPatterns, expectedResults);
        });
        it('filter yceud[uds] test', function() {
            var expectedResults = [ 'undefined', 'null',
                '&', 
                '1.1', '10%25', '+10px', '-10px', '#fff', 
                '%5Ca', '%ED%9F%BF', '%E1%88%B4567',
                '%EF%BF%BD', '%20', '%0D%0A%09%0C%0B', '%5C', '%5Cn%5Cr%5Cf%5C0%5C9%5Ca%5Cf',
                '-ide_nt', '%22string%22', "'string'",
                '-%20%20_%20:%20;%20(%20)%20%22%20\'%20/%20,%20%25%20#%20!%20*%20@%20.%20%7B%20%7D%20%5B%20%5D',
                'http://username:password@www.evil.com:8080/?k1=v1&k2=v2#hash',
                '%EF%BF%BD%08%0B%7F%0E-%1F',
                ')))(((\'\'\'%22%22%22%22',
                '##javascript:alert(1)',
                '(((())))%20%5C28%20%5C29'
            ];
            testutils.test_yce(filter.yceud, testPatterns, expectedResults);
        });
        it('filter yceus[uds] test', function() {
            var expectedResults = [ 'undefined', 'null',
                '&', 
                '1.1', '10%25', '+10px', '-10px', '#fff', 
                '%5Ca', '%ED%9F%BF', '%E1%88%B4567',
                '%EF%BF%BD', '%20', '%0D%0A%09%0C%0B', '%5C', '%5Cn%5Cr%5Cf%5C0%5C9%5Ca%5Cf',
                '-ide_nt', '%22string%22', "\\27 string\\27 ",
                '-%20%20_%20:%20;%20(%20)%20%22%20\\27 %20/%20,%20%25%20#%20!%20*%20@%20.%20%7B%20%7D%20%5B%20%5D',
                'http://username:password@www.evil.com:8080/?k1=v1&k2=v2#hash',
                '%EF%BF%BD%08%0B%7F%0E-%1F',
                ')))(((\\27 \\27 \\27 %22%22%22%22',
                '##javascript:alert(1)',
                '(((())))%20%5C28%20%5C29'
            ];
            testutils.test_yce(filter.yceus, testPatterns, expectedResults);
        });
    });

    describe("private-xss-filters: utility tests", function() {
        it('htmlDecode d exists', function() {
            expect(filter.d).to.be.ok();
        });
        it('htmlDecode d test', function() {
            expect(filter.d(null)).to.equal('null');
            expect(filter.d()).to.equal('undefined');
            expect(filter.d('&Aacute;&#0;&#x0D;&#x80;&#x82;&#x94;&#x9F;&#xD800;&#xFDD0;')).to.equal('&Aacute;\uFFFD\uFFFD\u20AC\u201A\u201D\u0178\uFFFD\uFFFD');
        });

        it('frCoPt exists', function() {
            expect(filter.frCoPt).to.be.ok();
        });
        it('frCoPt test', function() {
            expect(filter.frCoPt(null)).to.equal('');
            expect(filter.frCoPt()).to.equal('');
            expect(filter.frCoPt(0)).to.equal('\uFFFD');
            expect(filter.frCoPt(10)).to.equal('\n');
            expect(filter.frCoPt(0x0B)).to.equal('\uFFFD');
            expect(filter.frCoPt(0x10FFFF)).to.equal('\uFFFD');
        });
    });

}());
	</script>
	<script>

(function() {
var filter = xssFilters._privFilters;
describe("private-xss-filters: existence tests", function() {
it('filter y exists', function() {
expect(filter.y).to.be.ok();
});
        it('filter ya exists', function() {
            expect(filter.ya).to.be.ok();
        });
        it('filter yd exists', function() {
            expect(filter.yd).to.be.ok();
        });
        it('filter yc exists', function() {
            expect(filter.yc).to.be.ok();
        });
        it('filter yavd exists', function() {
            expect(filter.yavd).to.be.ok();
        });
        it('filter yavs exists', function() {
            expect(filter.yavs).to.be.ok();
        });
        it('filter yavu exists', function() {
            expect(filter.yavu).to.be.ok();
        });
        it('filter yu exists', function() {
            expect(filter.yu).to.be.ok();
        });
        it('filter yuc exists', function() {
            expect(filter.yuc).to.be.ok();
        });
        it('filter yubl exists', function() {
            expect(filter.yubl).to.be.ok();
        });
        it('filter yufull exists', function() {
            expect(filter.yufull).to.be.ok();
        });
        it('filter yublf exists', function() {
            expect(filter.yublf).to.be.ok();
        });
        
    });

    describe("private-xss-filters: alias tests", function() {
        it('filter yu being an alias of encodeURI', function() {
            expect(filter.yu).to.eql(encodeURI);
        });

        it('filter yuc being an alias of encodeURIComponent', function() {
            expect(filter.yuc).to.eql(encodeURIComponent);
        });
    });

    describe("private-xss-filters: encodeURI() and encodeURIComponent() tests", function() {
        it('percentage encoded ASCII chars of decimal 0-32 chars', function() {
            var chars = [
                    '\u0000',
                    '\u0001', '\u0002', '\u0003', '\u0004', 
                    '\u0005', '\u0006', '\u0007', '\u0008', 
                    '\u0009', '\u000A', '\u000B', '\u000C', 
                    '\u000D', '\u000E', '\u000F', '\u0010', 
                    '\u0011', '\u0012', '\u0013', '\u0014', 
                    '\u0015', '\u0016', '\u0017', '\u0018', 
                    '\u0019', '\u001A', '\u001B', '\u001C', 
                    '\u001D', '\u001E', '\u001F', '\u0020'],
                percentEncoded = [
                    "%00",
                    "%01", "%02", "%03", "%04", 
                    "%05", "%06", "%07", "%08", 
                    "%09", "%0A", "%0B", "%0C", 
                    "%0D", "%0E", "%0F", "%10", 
                    "%11", "%12", "%13", "%14", 
                    "%15", "%16", "%17", "%18", 
                    "%19", "%1A", "%1B", "%1C", 
                    "%1D", "%1E", "%1F", "%20"];

            expect(chars.map(encodeURI)).to.eql(percentEncoded);
            expect(chars.map(encodeURIComponent)).to.eql(percentEncoded);
        });
    });

    describe("private-xss-filters: error and data type tests", function() {
        it('filter yuc and yu throw URI malformed', function() {
            expect(function() { filter.yu('foo\uD800'); }).to.throwError(/(?:malformed|invalid character|illegal UTF-16 sequence)/);
            expect(function() { filter.yuc('foo\uD800'); }).to.throwError(/(?:malformed|invalid character|illegal UTF-16 sequence)/);
        });

        it('filters handling of undefined input', function() {
            expect(filter.y()).to.eql('undefined');
            expect(filter.ya()).to.eql('undefined');
            expect(filter.yd()).to.eql('undefined');
            expect(filter.yc()).to.eql('undefined');

            expect(filter.yavd()).to.eql('undefined');
            expect(filter.yavs()).to.eql('undefined');
            expect(filter.yavu()).to.eql('undefined');

            expect(filter.yu()).to.eql('undefined');
            expect(filter.yuc()).to.eql('undefined');
            expect(filter.yublf()).to.eql('undefined');
        });

        it('filters handling of null input', function() {
            expect(filter.y(null)).to.eql('null');
            expect(filter.ya(null)).to.eql('null');
            expect(filter.yd(null)).to.eql('null');
            expect(filter.yc(null)).to.eql('null');

            expect(filter.yavd(null)).to.eql('null');
            expect(filter.yavs(null)).to.eql('null');
            expect(filter.yavu(null)).to.eql('null');

            expect(filter.yu(null)).to.eql('null');
            expect(filter.yuc(null)).to.eql('null');
       expect(filter.yublf(null)).to.eql('null');
        });


        it('filters handling of array input', function() {
            var array = ['a', 'b'], result = 'a,b';

            expect(filter.y(array)).to.eql(result);
            expect(filter.ya(array)).to.eql(result);
            expect(filter.yd(array)).to.eql(result);
            expect(filter.yc(array)).to.eql(result);

            expect(filter.yavd(array)).to.eql(result);
            expect(filter.yavs(array)).to.eql(result);
            expect(filter.yavu(array)).to.eql(result);

            expect(filter.yu(array)).to.eql(result);
            expect(filter.yuc(array)).to.eql('a%2Cb');
         expect(filter.yublf(array)).to.eql(result);
        });


        it('filters handling of object input', function() {
            var object = {'a':1, 'b':0}, result = '[object Object]';

            expect(filter.y(object)).to.eql(result);
            expect(filter.ya(object)).to.eql(result);
            expect(filter.yd(object)).to.eql(result);
            expect(filter.yc(object)).to.eql(result + ' ');

            expect(filter.yavd(object)).to.eql(result);
            expect(filter.yavs(object)).to.eql(result);
            expect(filter.yavu(object)).to.eql('[object&#32;Object]');

            expect(filter.yu(object)).to.eql('%5Bobject%20Object%5D');
            expect(filter.yuc(object)).to.eql('%5Bobject%20Object%5D');
          expect(filter.yublf(object)).to.eql('%5Bobject%20Object%5D');
        });

        it('filters handling of empty string', function() {
            var str = '', result = '';

            expect(filter.y(str)).to.eql(result);
            expect(filter.ya(str)).to.eql(result);
            expect(filter.yd(str)).to.eql(result);
            expect(filter.yc(str)).to.eql(result);

            expect(filter.yavd(str)).to.eql(result);
            expect(filter.yavs(str)).to.eql(result);
            expect(filter.yavu(str)).to.eql('\uFFFD');

            expect(filter.yu(str)).to.eql(result);
            expect(filter.yuc(str)).to.eql(result);
            expect(filter.yubl(str)).to.eql(result);
            expect(filter.yublf(str)).to.eql(result);
        });
    });

    describe("private-xss-filters: unchained state transition tests", function() {
        
        it('filter y state transition test', function() {
            var s = "foo&<>\"'` bar&<>\"' &lt;";
            var o = filter.y(s);
            expect(o).to.eql('foo&amp;&lt;&gt;&quot;&#39;&#96; bar&amp;&lt;&gt;&quot;&#39; &amp;lt;');
        });

        it('filter ya state transition test', function() {
            var s = "foo&<>\"'` bar&<>\"' &lt; &quot; &#39;";
            var o = filter.ya(s);
            expect(o).to.eql('foo&amp;<>"\'` bar&amp;<>"\' &amp;lt; &amp;quot; &amp;#39;');
        });

        it('filter yd state transition test', function() {
            testutils.test_yd(filter.yd, ['foo&&lt;>\'"']);
        });

        it('filter yc state transition test', function() {
            testutils.test_yc(filter.yc, [
                '-- > --! > <!--[if IE] ><script>alert("yahoo\'s filters")</script>', 
                'foo-- ', 
                'foo--! ', 
                '[if IE] ', 
                'foo- ', 
                'foo- ',
                ' ><script>alert(1)</script>',
                '---------- ><script>alert(1)</script>',
                '--\uFFFD>']);
        });

        it('filter yav-single-quoted state transition test', function() {
            testutils.test_yav(filter.yavs, [
                'foo&<>&#39;"` \t\n\x0B\f\r', '\f', '',
                '&#39;&#39;', ' &#39;&#39;', '\t&#39;&#39;', '\n&#39;&#39;', '\f&#39;&#39;',
                '""',         ' ""',         '\t""',         '\n""',         '\f""',
                '``',         ' ``',         '\t``',         '\n``',         '\f``']);
        });

        it('filter yav-double-quoted state transition test', function() {
            testutils.test_yav(filter.yavd, [
                'foo&<>\'&quot;` \t\n\x0B\f\r', '\f', '',
                "''",           " ''",           "\t''",           "\n''",           "\f''", 
                '&quot;&quot;', ' &quot;&quot;', '\t&quot;&quot;', '\n&quot;&quot;', '\f&quot;&quot;',
                '``',           ' ``',           '\t``',           '\n``',           '\f``']);
        });
        
        it('filter yav-unquoted state transition test', function() {
            testutils.test_yav(filter.yavu, [
                'foo&&lt;&gt;&#39;&quot;&#96;&#32;&#9;&#10;&#11;&#12;&#13;', '&#12;', '\uFFFD',
                "&#39;&#39;",  "&#32;&#39;&#39;", "&#9;&#39;&#39;", "&#10;&#39;&#39;", "&#12;&#39;&#39;",
                '&quot;&quot;', '&#32;&quot;&quot;', '&#9;&quot;&quot;', '&#10;&quot;&quot;', '&#12;&quot;&quot;',
                '&#96;&#96;',  '&#32;&#96;&#96;', '&#9;&#96;&#96;', '&#10;&#96;&#96;', '&#12;&#96;&#96;']);

            var s = "\x00=<>''onerror=alert(1)";
            var o = filter.yavu(s);
            expect(o).to.eql("\uFFFD&#61;&lt;&gt;&#39;&#39;onerror&#61;alert(1)");
        });

        it('filter yu state transition test', function() {
            testutils.test_yu(filter.yu);
        });

        it('filter yuc state transition test', function() {
            testutils.test_yuc(filter.yuc);
        });

        it('filter yubl state transition test', function() {
           
            testutils.test_yubl(filter.yubl, [
                'x-\u0001\u0002\u0003\u0004\u0005\u0006\u0007\u0008\u0009\
\u000A\u000B\u000C\u000D\u000E\u000F\u0010\u0011\u0012\
\u0013\u0014\u0015\u0016\u0017\u0018\u0019\u001A\u001B\
\u001C\u001D\u001E\u001F\u0020j\nav&#x61;\rscript\t&col\u0000on;'
            ]);

        });

        it('filter yufull state transition test', function() {
            testutils.test_yufull(filter.yufull, [
                null, // default
                null, // default
                null, // default
                null, // default
                null, // default
                'http://[2001:0db8:85a3:0000:0000:8a2e:0370:7334]',
                null, // default
                null  // default
            ]);
        });

        it('filter yublf state transition test', function() {
            testutils.test_yufull(filter.yublf, [
                null, // default
                null, // default
                null, // default
                null, // default
                null, // default
                'http://[2001:0db8:85a3:0000:0000:8a2e:0370:7334]',
                null, // default
                null  // default
            ]);
            testutils.test_yubl(filter.yublf, [
                '%01%02%03%04%05%06%07%08%09%0A%0B%0C%0D%0E%0F%10%11%12%13%14%15%16%17%18%19%1A%1B%1C%1D%1E%1F%20j%0Aav&#x61;%0Dscript%09&col%00on;'
            ]);
        });
        
    });

    describe("private-xss-filters: css expression tests", function() {

        var testPatterns = [ undefined, null,
            '&',
            '1.1', '10%', '+10px', '-10px', '#fff', 
            '\uD7FF', '\uD800', '\uDFFF', '\u1234567',
            '\u0000', ' ', '\r\n\t\f\x0B', '\\', '\\n\\r\\f\\0\\9\\a\\f',
            '-ide_nt', '"string"', "'string'",
            '- \ _ : ; ( ) " \' / , % # ! * @ . { } []', 
            'http://username:password@www.evil.com:8080/?k1=v1&k2=v2#hash',
            'url(https://www.evil.com)', 
            'u\x00\x00rl(https://www.evil.com)', 
            '\\u\\r\x00\x00\\l\x00\\((evil.com))',
            'expression(body.scrollTop + 50 + px)', 
            '(((()))) \\28 \\29'
        ];

        it('filter yceu[uds] test', function() {
            var expectedResults = [ 'undefined', 'null',
                ';-x:\'&\';-v:',
                '1.1', '10%', '+10px', '-10px', '#fff', 
                ';-x:\'\uD7FF\';-v:', ';-x:\'\uD800\';-v:', ';-x:\'\uDFFF\';-v:', ';-x:\'\u1234567\';-v:',
                ';-x:\'\uFFFD\';-v:', ';-x:\' \';-v:', ';-x:\'\\d \\a \\9 \\c \\b \';-v:', ';-x:\'\\5c \';-v:', ';-x:\'\\5c n\\5c r\\5c f\\5c 0\\5c 9\\5c a\\5c f\';-v:',
                '-ide_nt', ';-x:\'"string"\';-v:', ';-x:\'\\27 string\\27 \';-v:',
                ';-x:\'-  _ : ; ( ) " \\27  / , % # ! * @ . \\7b  \\7d  \\5b \\5d \';-v:', 
                ';-x:\'http://username:password@www.evil.com:8080/?k1=v1&k2=v2#hash\';-v:',
                ';-x:\'-x-url(https://www.evil.com)\';-v:',
                ';-x:\'u\ufffd\ufffdrl(https://www.evil.com)\';-v:',
                ';-x:\'\\5c u\\5c r\ufffd\ufffd\\5c l\ufffd\\5c ((evil.com))\';-v:',
                ';-x:\'expression(body.scrollTop + 50 + px)\';-v:',
                ';-x:\'(((()))) \\5c 28 \\5c 29\';-v:'
            ];
            testutils.test_yce(filter.yceu, testPatterns, expectedResults);
        });
        it('filter yced[uds] test', function() {
            var expectedResults = [ 'undefined', 'null',
                '&', 
                '1.1', '10%', '+10px', '-10px', '#fff', 
                '\uD7FF', '\uD800', '\uDFFF', '\u1234567',
                '\uFFFD', ' ', '\\d \\a \\9 \\c \\b ', '\\5c ', '\\5c n\\5c r\\5c f\\5c 0\\5c 9\\5c a\\5c f',
                '-ide_nt', '\\22 string\\22 ', "'string'",
                '-  _ : ; ( ) \\22  \' / , % # ! * @ . \\7b  \\7d  \\5b \\5d ',
                'http://username:password@www.evil.com:8080/?k1=v1&k2=v2#hash',
                '-x-url(https://www.evil.com)',
                'u\ufffd\ufffdrl(https://www.evil.com)',
                '\\5c u\\5c r\ufffd\ufffd\\5c l\ufffd\\5c ((evil.com))',
                'expression(body.scrollTop + 50 + px)',
                '(((()))) \\5c 28 \\5c 29'
            ];
            testutils.test_yce(filter.yced, testPatterns, expectedResults);
        });
        it('filter yces[uds] test', function() {
            var expectedResults = [ 'undefined', 'null',
                '&', 
                '1.1', '10%', '+10px', '-10px', '#fff', 
                '\uD7FF', '\uD800', '\uDFFF', '\u1234567',
                '\uFFFD', ' ', '\\d \\a \\9 \\c \\b ', '\\5c ', '\\5c n\\5c r\\5c f\\5c 0\\5c 9\\5c a\\5c f',
                '-ide_nt', '"string"', "\\27 string\\27 ",
                '-  _ : ; ( ) " \\27  / , % # ! * @ . \\7b  \\7d  \\5b \\5d ',
                'http://username:password@www.evil.com:8080/?k1=v1&k2=v2#hash',
                '-x-url(https://www.evil.com)',
                'u\ufffd\ufffdrl(https://www.evil.com)',
                '\\5c u\\5c r\ufffd\ufffd\\5c l\ufffd\\5c ((evil.com))',
                'expression(body.scrollTop + 50 + px)',
                '(((()))) \\5c 28 \\5c 29'
            ];
            testutils.test_yce(filter.yces, testPatterns, expectedResults);
        });
    });

    describe("private-xss-filters: css url tests", function() {
        var testPatterns = [ undefined, null,
            '&',
            '1.1', '10%', '+10px', '-10px', '#fff', 
            '\\a', '\uD7FF', '\u1234567',
            '\u0000', ' ', '\r\n\t\f\x0B', '\\', '\\n\\r\\f\\0\\9\\a\\f',
            '-ide_nt', '"string"', "'string'",
            '- \ _ : ; ( ) " \' / , % # ! * @ . { } [ ]', 
            'http://username:password@www.evil.com:8080/?k1=v1&k2=v2#hash',
            '\u0000\u0008\u000b\u007f\u000e-\u001f',
            '&rpar;&#x00029;&#41;&lpar;&#x00028;&#40;&apos;&#x00027;&#39;&quot;&QUOT;&#x00022;&#34',
            'javascript:alert(1)',
            '(((()))) \\28 \\29'
        ];

        it('filter yceuu[uds] attribute test', function() {
            var expectedResults = [ 'undefined', 'null',
                '&', 
                '1.1', '10%25', '+10px', '-10px', '#fff', 
                '%5Ca', '%ED%9F%BF', '%E1%88%B4567',
                '%EF%BF%BD', '%20', '%0D%0A%09%0C%0B', '%5C', '%5Cn%5Cr%5Cf%5C0%5C9%5Ca%5Cf',
                '-ide_nt', '%22string%22', "\\27 string\\27 ",
                '-%20%20_%20:%20;%20%28%20%29%20%22%20\\27 %20/%20,%20%25%20#%20!%20*%20@%20.%20%7B%20%7D%20%5B%20%5D',
                'http://username:password@www.evil.com:8080/?k1=v1&k2=v2#hash',
                '%EF%BF%BD%08%0B%7F%0E-%1F',
                '%29%29%29%28%28%28\\27 \\27 \\27 %22%22%22%22',
                '##javascript:alert%281%29',
                '%28%28%28%28%29%29%29%29%20%5C28%20%5C29'
            ];
            testutils.test_yce(filter.yceuu, testPatterns, expectedResults);
        });
        it('filter yceud[uds] test', function() {
            var expectedResults = [ 'undefined', 'null',
                '&', 
                '1.1', '10%25', '+10px', '-10px', '#fff', 
                '%5Ca', '%ED%9F%BF', '%E1%88%B4567',
                '%EF%BF%BD', '%20', '%0D%0A%09%0C%0B', '%5C', '%5Cn%5Cr%5Cf%5C0%5C9%5Ca%5Cf',
                '-ide_nt', '%22string%22', "'string'",
                '-%20%20_%20:%20;%20(%20)%20%22%20\'%20/%20,%20%25%20#%20!%20*%20@%20.%20%7B%20%7D%20%5B%20%5D',
                'http://username:password@www.evil.com:8080/?k1=v1&k2=v2#hash',
                '%EF%BF%BD%08%0B%7F%0E-%1F',
                ')))(((\'\'\'%22%22%22%22',
                '##javascript:alert(1)',
                '(((())))%20%5C28%20%5C29'
            ];
            testutils.test_yce(filter.yceud, testPatterns, expectedResults);
        });
        it('filter yceus[uds] test', function() {
            var expectedResults = [ 'undefined', 'null',
                '&', 
                '1.1', '10%25', '+10px', '-10px', '#fff', 
                '%5Ca', '%ED%9F%BF', '%E1%88%B4567',
                '%EF%BF%BD', '%20', '%0D%0A%09%0C%0B', '%5C', '%5Cn%5Cr%5Cf%5C0%5C9%5Ca%5Cf',
                '-ide_nt', '%22string%22', "\\27 string\\27 ",
                '-%20%20_%20:%20;%20(%20)%20%22%20\\27 %20/%20,%20%25%20#%20!%20*%20@%20.%20%7B%20%7D%20%5B%20%5D',
                'http://username:password@www.evil.com:8080/?k1=v1&k2=v2#hash',
                '%EF%BF%BD%08%0B%7F%0E-%1F',
                ')))(((\\27 \\27 \\27 %22%22%22%22',
                '##javascript:alert(1)',
                '(((())))%20%5C28%20%5C29'
            ];
            testutils.test_yce(filter.yceus, testPatterns, expectedResults);
        });
    });

    describe("private-xss-filters: utility tests", function() {
        it('htmlDecode d exists', function() {
            expect(filter.d).to.be.ok();
        });
        it('htmlDecode d test', function() {
            expect(filter.d(null)).to.equal('null');
            expect(filter.d()).to.equal('undefined');
            expect(filter.d('&Aacute;&#0;&#x0D;&#x80;&#x82;&#x94;&#x9F;&#xD800;&#xFDD0;')).to.equal('&Aacute;\uFFFD\uFFFD\u20AC\u201A\u201D\u0178\uFFFD\uFFFD');
        });

        it('frCoPt exists', function() {
            expect(filter.frCoPt).to.be.ok();
        });
        it('frCoPt test', function() {
            expect(filter.frCoPt(null)).to.equal('');
            expect(filter.frCoPt()).to.equal('');
            expect(filter.frCoPt(0)).to.equal('\uFFFD');
            expect(filter.frCoPt(10)).to.equal('\n');
            expect(filter.frCoPt(0x0B)).to.equal('\uFFFD');
            expect(filter.frCoPt(0x10FFFF)).to.equal('\uFFFD');
        });
    });

}());
	</script>
	<script>
exports._getPrivFilters = function () {

    var LT     = /</g,
        QUOT   = /"/g,
        SQUOT  = /'/g,
        AMP    = /&/g,
        NULL   = /\x00/g,
        SPECIAL_ATTR_VALUE_UNQUOTED_CHARS = /(?:^$|[\x00\x09-\x0D "'`=<>])/g,
        SPECIAL_HTML_CHARS = /[&<>"'`]/g, 
        SPECIAL_COMMENT_CHARS = /(?:\x00|^-*!?>|--!?>|--?!?$|\]>|\]$)/g;
    var SENSITIVE_HTML_ENTITIES = /&(?:#([xX][0-9A-Fa-f]+|\d+);?|(Tab|NewLine|colon|semi|lpar|rpar|apos|sol|comma|excl|ast|midast|ensp|emsp|thinsp);|(nbsp|amp|AMP|lt|LT|gt|GT|quot|QUOT);?)/g,
        SENSITIVE_NAMED_REF_MAP = {Tab: '\t', NewLine: '\n', colon: ':', semi: ';', lpar: '(', rpar: ')', apos: '\'', sol: '/', comma: ',', excl: '!', ast: '*', midast: '*', ensp: '\u2002', emsp: '\u2003', thinsp: '\u2009', nbsp: '\xA0', amp: '&', lt: '<', gt: '>', quot: '"', QUOT: '"'};
    var CSS_VALID_VALUE = /^(?:(?!-*expression)#?[-\w]+|[+-]?(?:\d+|\d*\.\d+)(?:r?em|ex|ch|cm|mm|in|px|pt|pc|%|vh|vw|vmin|vmax)?|!important|)$/i,
        CSS_DOUBLE_QUOTED_CHARS = /[\x00-\x1F\x7F\[\]{}\\"]/g,
        CSS_SINGLE_QUOTED_CHARS = /[\x00-\x1F\x7F\[\]{}\\']/g,
        CSS_BLACKLIST = /url[\(\u207D\u208D]+/g,
        CSS_UNQUOTED_URL = /['\(\)]/g;
    var URL_IPV6 = /\/\/%5[Bb]([A-Fa-f0-9:]+)%5[Dd]/;
    var URI_BLACKLIST_PROTOCOLS = {'javascript':1, 'data':1, 'vbscript':1, 'mhtml':1, 'x-schema':1},
        URI_PROTOCOL_COLON = /(?::|&#[xX]0*3[aA];?|&#0*58;?|&colon;)/,
        URI_PROTOCOL_WHITESPACES = /(?:^[\x00-\x20]+|[\t\n\r\x00]+)/g,
        URI_PROTOCOL_NAMED_REF_MAP = {Tab: '\t', NewLine: '\n'};

    var x, 
        strReplace = function (s, regexp, callback) {
            return s === undefined ? 'undefined'
                    : s === null            ? 'null'
                    : s.toString().replace(regexp, callback);
        },
        fromCodePoint = String.fromCodePoint || function(codePoint) {
            if (arguments.length === 0) {
                return '';
            }
            if (codePoint <= 0xFFFF) { 
                return String.fromCharCode(codePoint);
            }
            codePoint -= 0x10000;
            return String.fromCharCode((codePoint >> 10) + 0xD800, (codePoint % 0x400) + 0xDC00);
        };


    function getProtocol(str) {
        var s = str.split(URI_PROTOCOL_COLON, 2);
      
        return (s[0] && (s.length === 2 || str.length !== s[0].length)) ? s[0] : null;
    }

    function htmlDecode(s, namedRefMap, reNamedRef, skipReplacement) {
        
        namedRefMap = namedRefMap || SENSITIVE_NAMED_REF_MAP;
        reNamedRef = reNamedRef || SENSITIVE_HTML_ENTITIES;

        function regExpFunction(m, num, named, named1) {
            if (num) {
                num = Number(num[0] <= '9' ? num : '0' + num);
            
                return skipReplacement ? fromCodePoint(num)
                        : num === 0x80 ? '\u20AC'  
                        : num === 0x82 ? '\u201A'  
                        : num === 0x83 ? '\u0192'  
                        : num === 0x84 ? '\u201E'  
                        : num === 0x85 ? '\u2026' 
                        : num === 0x86 ? '\u2020'  
                        : num === 0x87 ? '\u2021' 
                        : num === 0x88 ? '\u02C6' 
                        : num === 0x89 ? '\u2030' 
                        : num === 0x8A ? '\u0160' 
                        : num === 0x8B ? '\u2039'  
                        : num === 0x8C ? '\u0152'  
                        : num === 0x8E ? '\u017D'  
                        : num === 0x91 ? '\u2018'  
                        : num === 0x92 ? '\u2019'  
                        : num === 0x93 ? '\u201C'  
                        : num === 0x94 ? '\u201D' 
                        : num === 0x95 ? '\u2022' 
                        : num === 0x96 ? '\u2013'  
                        : num === 0x97 ? '\u2014'  
                        : num === 0x98 ? '\u02DC' 
                        : num === 0x99 ? '\u2122'  
                        : num === 0x9A ? '\u0161'  
                        : num === 0x9B ? '\u203A'  
                        : num === 0x9C ? '\u0153'  
                        : num === 0x9E ? '\u017E'  
                        : num === 0x9F ? '\u0178'  
                        : (num >= 0xD800 && num <= 0xDFFF) || num === 0x0D ? '\uFFFD'
                        : x.frCoPt(num);
            }
            return namedRefMap[named || named1] || m;
        }

        return s === undefined  ? 'undefined'
            : s === null        ? 'null'
            : s.toString().replace(NULL, '\uFFFD').replace(reNamedRef, regExpFunction);
    }

    function cssEncode(chr) {
      
        return '\\' + chr.charCodeAt(0).toString(16).toLowerCase() + ' ';
    }
    function cssBlacklist(s) {
        return s.replace(CSS_BLACKLIST, function(m){ return '-x-' + m; });
    }
    function cssUrl(s) {
        
        s = x.yufull(htmlDecode(s));
        var protocol = getProtocol(s);

        return (protocol && URI_BLACKLIST_PROTOCOLS[protocol.toLowerCase()]) ? '##' + s : s;
    }

    return (x = {
     
        frCoPt: function(num) {
            return num === undefined || num === null ? '' :
                !isFinite(num = Number(num)) || 
                num <= 0 ||                    
                num > 0x10FFFF ||              
               

                (num >= 0x01 && num <= 0x08) ||
                (num >= 0x0E && num <= 0x1F) ||
                (num >= 0x7F && num <= 0x9F) ||
                (num >= 0xFDD0 && num <= 0xFDEF) ||
                
                 num === 0x0B || 
                (num & 0xFFFF) === 0xFFFF || 
                (num & 0xFFFF) === 0xFFFE ? '\uFFFD' : fromCodePoint(num);
        },
        d: htmlDecode,
      
        yup: function(s) {
            s = getProtocol(s.replace(NULL, ''));
            
            return s ? htmlDecode(s, URI_PROTOCOL_NAMED_REF_MAP, null, true).replace(URI_PROTOCOL_WHITESPACES, '').toLowerCase() : null;
        },

       
        y: function(s) {
            return strReplace(s, SPECIAL_HTML_CHARS, function (m) {
                return m === '&' ? '&amp;'
                    :  m === '<' ? '&lt;'
                    :  m === '>' ? '&gt;'
                    :  m === '"' ? '&quot;'
                    :  m === "'" ? '&#39;'
                    :  /*m === '`'*/ '&#96;';       // in hex: 60
            });
        },

       
        ya: function(s) {
            return strReplace(s, AMP, '&amp;');
        },

        // FOR DETAILS, refer to inHTMLData()
        // Reference: https://html.spec.whatwg.org/multipage/syntax.html#data-state
        yd: function (s) {
            return strReplace(s, LT, '&lt;');
        },

        yc: function (s) {
            return strReplace(s, SPECIAL_COMMENT_CHARS, function(m){
                return m === '\x00' ? '\uFFFD'
                    : m === '--!' || m === '--' || m === '-' || m === ']' ? m + ' '
                    :/*
                    :  m === ']>'   ? '] >'
                    :  m === '-->'  ? '-- >'
                    :  m === '--!>' ? '--! >'
                    : /-*!?>/.test(m) ? */ m.slice(0, -1) + ' >';
            });
        },

 
        yavd: function (s) {
            return strReplace(s, QUOT, '&quot;');
        },

     
        yavs: function (s) {
            return strReplace(s, SQUOT, '&#39;');
        },

      
        yavu: function (s) {
            return strReplace(s, SPECIAL_ATTR_VALUE_UNQUOTED_CHARS, function (m) {
                return m === '\t'   ? '&#9;'  // in hex: 09
                    :  m === '\n'   ? '&#10;' // in hex: 0A
                    :  m === '\x0B' ? '&#11;' // in hex: 0B  for IE. IE<9 \v equals v, so use \x0B instead
                    :  m === '\f'   ? '&#12;' // in hex: 0C
                    :  m === '\r'   ? '&#13;' // in hex: 0D
                    :  m === ' '    ? '&#32;' // in hex: 20
                    :  m === '='    ? '&#61;' // in hex: 3D
                    :  m === '<'    ? '&lt;'
                    :  m === '>'    ? '&gt;'
                    :  m === '"'    ? '&quot;'
                    :  m === "'"    ? '&#39;'
                    :  m === '`'    ? '&#96;'
                    :  '\uFFFD';
            });
        },

        yu: encodeURI,
        yuc: encodeURIComponent,

       
        yubl: function (s) {
            return URI_BLACKLIST_PROTOCOLS[x.yup(s)] ? 'x-' + s : s;
        },

     
        yufull: function (s) {
            return x.yu(s).replace(URL_IPV6, function(m, p) {
                return '//[' + p + ']';
            });
        },

    
        yublf: function (s) {
            return x.yubl(x.yufull(s));
        },

                    

        yceu: function(s) {
            s = htmlDecode(s);
            return CSS_VALID_VALUE.test(s) ? s : ";-x:'" + cssBlacklist(s.replace(CSS_SINGLE_QUOTED_CHARS, cssEncode)) + "';-v:";
        },

     
        yced: function(s) {
            return cssBlacklist(htmlDecode(s).replace(CSS_DOUBLE_QUOTED_CHARS, cssEncode));
        },

        string2 = \'([^\n\r\f\\']|\\{nl}|\\[^\n\r\f0-9a-f]|\\[0-9a-f]{1,6}(\r\n|[ \n\r\t\f])?)*\'
        yces: function(s) {
            return cssBlacklist(htmlDecode(s).replace(CSS_SINGLE_QUOTED_CHARS, cssEncode));
        },

       
        yceuu: function(s) {
            return cssUrl(s).replace(CSS_UNQUOTED_URL, function (chr) {
                return  chr === '\''        ? '\\27 ' :
                        chr === '('         ? '%28' :
                        /* chr === ')' ? */   '%29';
            });
        },

        
        yceud: function(s) { 
            return cssUrl(s);
        },

  
        yceus: function(s) { 
            return cssUrl(s).replace(SQUOT, '\\27 ');
        }
    });
};


var privFilters = exports._privFilters = exports._getPrivFilters();

function uriInAttr (s, yav, yu) {
    return privFilters.yubl(yav((yu || privFilters.yufull)(s)));
}
exports.inHTMLData = privFilters.yd;

exports.inHTMLComment = privFilters.yc;


exports.inSingleQuotedAttr = privFilters.yavs;


exports.inDoubleQuotedAttr = privFilters.yavd;


exports.inUnQuotedAttr = privFilters.yavu;


exports.uriInSingleQuotedAttr = function (s) {
    return uriInAttr(s, privFilters.yavs);
};


exports.uriInDoubleQuotedAttr = function (s) {
    return uriInAttr(s, privFilters.yavd);
};


exports.uriInUnQuotedAttr = function (s) {
    return uriInAttr(s, privFilters.yavu);
};

exports.uriInHTMLData = privFilters.yufull;


exports.uriInHTMLComment = function (s) {
    return privFilters.yc(privFilters.yufull(s));
};

exports.uriPathInSingleQuotedAttr = function (s) {
    return uriInAttr(s, privFilters.yavs, privFilters.yu);
};

exports.uriPathInDoubleQuotedAttr = function (s) {
    return uriInAttr(s, privFilters.yavd, privFilters.yu);
};

exports.uriPathInUnQuotedAttr = function (s) {
    return uriInAttr(s, privFilters.yavu, privFilters.yu);
};


exports.uriPathInHTMLData = privFilters.yu;

exports.uriPathInHTMLComment = function (s) {
    return privFilters.yc(privFilters.yu(s));
};


exports.uriQueryInSingleQuotedAttr = exports.uriPathInSingleQuotedAttr;


exports.uriQueryInDoubleQuotedAttr = exports.uriPathInDoubleQuotedAttr;

exports.uriQueryInUnQuotedAttr = exports.uriPathInUnQuotedAttr;


exports.uriQueryInHTMLData = exports.uriPathInHTMLData;


exports.uriQueryInHTMLComment = exports.uriPathInHTMLComment;

exports.uriComponentInSingleQuotedAttr = function (s) {
    return privFilters.yavs(privFilters.yuc(s));
};


exports.uriComponentInDoubleQuotedAttr = function (s) {
    return privFilters.yavd(privFilters.yuc(s));
};


exports.uriComponentInUnQuotedAttr = function (s) {
    return privFilters.yavu(privFilters.yuc(s));
};


exports.uriComponentInHTMLData = privFilters.yuc;


exports.uriComponentInHTMLComment = function (s) {
    return privFilters.yc(privFilters.yuc(s));
};

 
exports.uriFragmentInSingleQuotedAttr = function (s) {
    return privFilters.yubl(privFilters.yavs(privFilters.yuc(s)));
};


exports.uriFragmentInDoubleQuotedAttr = function (s) {
    return privFilters.yubl(privFilters.yavd(privFilters.yuc(s)));
};


exports.uriFragmentInUnQuotedAttr = function (s) {
    return privFilters.yubl(privFilters.yavu(privFilters.yuc(s)));
};


exports.uriFragmentInHTMLData = exports.uriComponentInHTMLData;


exports.uriFragmentInHTMLComment = exports.uriComponentInHTMLComment;
	</script>
	<script>


var utils = {
    each: function(stack, handler) {
        var len = stack.length;
        if (len) {
            for(var i = 0; i < len; i++) {
                if (handler.call(stack[i], stack[i], i) === false) break;
            }
        }
        else if (typeof len === 'undefined') {
            for(var name in stack) {
                if (handler.call(stack[name], stack[name], name) === false) break;
            }
        }
    },

    str_trim: function(string) {
        return string.replace(/^\s+/g, '').replace(/\s+$/g, '');
    },

    arr_compact: function(array) {
        var result = [];
        utils.each(array, function(item) {
            if (utils.str_trim(item) != '') {
                result.push(item);
            }
        });

        return result;
    },

    isObject: function(obj) {
        return obj === Object(obj);
    },

    extend: function(target, obj) {
        utils.each(obj, function(value, key) {
            target[key] = value;
        });
    }
};

module.exports = utils;


	</script>
	
	<script>
		
var utils = require('./utils');


var REGEXP_TAG_STYLE = /<style[^>]*>[^<]*<\/style>/img;


var REGEXP_TAG_SCRIPT = /<script[^>]*>[^<]*<\/script>/img;

var REGEXP_ATTR = /([\w-]+)\s*=\s*("([^"]*)"|'([^']*)'|([^ >]*))/img;


var REGEXP_ATTR_SPACE_PRE = /\s*([\w-]+)\s*=\s*("([^"]*)"|'([^']*)'|([^ >]*))/img;


var REGEXP_ATTR_SPACE_SUF = /([\w-]+)\s*=\s*("([^"]*)"|'([^']*)'|([^ >]*))(\s*)/img;


var REGEXP_ATTR_WITH_TAG = /<[a-zA-Z]+[a-zA-Z0-9]*((\s+([\w-]+)\s*=\s*("([^"]*)"|'([^']*)'|([^ >]*)))+).*>/img;


function XSSFilter(options) {
    =
    this.config = {
       
        matchStyleTag: true,

       
        matchScriptTag: true,

     
        removeMatchedTag: true,

       
        escape: false,


        blackListAttrs: {
            onclick: true,
            ondblclick: true,
            onchange: true,
            onblur: true,
            onfocus: true,
            onkeydown: true,
            onkeypress: true,
            onkeyup: true,
            onmousedown: true,
            onmousemove: true,
            onmouseover: true,
            onmouseout: true,
            onmouseup: true,
            onselect: true,
            onsubmit: true,
            onreset: true,
            onload: true,
            onabort: true,
            onerror: true
        }
    };

  
    if (utils.isObject(options)) {
        utils.extend(this.config, options);
    }
}



XSSFilter.prototype.options = function(name, obj) {
    var config = this.config;

    if (arguments.length) {
        if (typeof name === 'string') {
            if (typeof config[name] === 'undefined') {
                throw new Error(name + ' is not a valid configuration name.');
            }

            if (typeof obj === 'undefined') {
                throw new Error('Please enter a value corresponding to the ' + name);
            }

            if (utils.isObject(obj)) {
                utils.extend(config[name], obj);
            } else {
                config[name] = obj;
            }
        } else if (utils.isObject(name)) {
            obj = name;
            utils.extend(config, obj);
        }
    }
};


XSSFilter.prototype.filter = function(html) {
    if (html == '') return html;

    var result = html;
    var config = this.config;

    if (config.matchStyleTag) {
        result = filterStyleTag(result, config);
    }

    if (config.matchScriptTag) {
        result = filterScriptTag(result, config);
    }

    result = filterAttribute(result, config);

    result = clearTagSpaces(result);

    if (config.escape) {
        result = escapeTags(result);
    }

    return result;
};


function filterAttribute(html, config) {
    var result = html;
    var tempHTML = html;

    (function() {
        //
        var attrMatches = REGEXP_ATTR_WITH_TAG.exec(tempHTML);
        REGEXP_ATTR_WITH_TAG.lastIndex = 0;

        if (attrMatches) {
            var labelHasAttr = attrMatches[1];
            var attrArray = labelHasAttr.match(REGEXP_ATTR);

            tempHTML = tempHTML.replace(labelHasAttr, '');

            utils.each(attrArray, function(item) {
                var attrName = utils.str_trim(item.substr(0, item.indexOf('='))).toLowerCase();

                if (config.blackListAttrs[attrName]) {
                    result = result.replace(item, '');
                }
            });

            arguments.callee();
        }
    })();

    return result;
}


 function filterStyleTag(html, config) {
    var result;

    if (config.removeMatchedTag) {
        result = html.replace(REGEXP_TAG_STYLE, '');
    } else {
        result = html.replace(REGEXP_TAG_STYLE, function(body) {
            return escapeTags(body);
        });
    }

    return result;
}


function filterScriptTag(html, config) {
    var result;

    if (config.removeMatchedTag) {
        result = html.replace(REGEXP_TAG_SCRIPT, '');
    } else {
        result = html.replace(REGEXP_TAG_SCRIPT, function(body) {
            return escapeTags(body);
        });
    }

    return result;
}

function clearTagSpaces(html) {

    var result = html.replace(REGEXP_ATTR_SPACE_PRE, function(dirtyAttr, attrName, attrValue) {
        return ' ' + attrName + '=' + attrValue;
    }).replace(REGEXP_ATTR_SPACE_SUF, function(dirtyAttr, attrName, attrValue, a, b, c, sufSpace) {
        var cleanAttr = attrName + '=' + attrValue;

        if (sufSpace.length > 0) {
            cleanAttr += ' ';
        }

        return cleanAttr;
    });

    result = result.replace(/\t+\n/g, '').replace(/\s*>/mg, function(a) {
        return a.replace(/\s+/, '');
    });

    return result;
}


function escapeTags(html) {
    return html.replace(/</g, '&lt;').replace(/>/g, '&gt;');
}


if (typeof define === 'function' && define.amd) {
    define(function(){
        return XSSFilter;
    });
}

else if (typeof window !== 'undefined') {
    window.xssFilter = XSSFilter;
}

module.exports = XSSFilter;
	</script>
	<script>
!function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b){function c(a){this.config={matchStyleTag:!0,matchScriptTag:!0,removeMatchedTag:!0,escape:!1,blackListAttrs:{onclick:!0,ondblclick:!0,onchange:!0,onblur:!0,onfocus:!0,onkeydown:!0,onkeypress:!0,onkeyup:!0,onmousedown:!0,onmousemove:!0,onmouseover:!0,onmouseout:!0,onmouseup:!0,onselect:!0,onsubmit:!0,onreset:!0,onload:!0,onabort:!0,onerror:!0}},i.isObject(a)&&i.extend(this.config,a)}function d(a,b){var c=a,d=a;return function(){var a=o.exec(d);if(o.lastIndex=0,a){var e=a[1],f=e.match(l);d=d.replace(e,""),i.each(f,function(a){var d=i.str_trim(a.substr(0,a.indexOf("="))).toLowerCase();b.blackListAttrs[d]&&(c=c.replace(a,""))}),arguments.callee()}}(),c}function e(a,b){var c;return c=b.removeMatchedTag?a.replace(j,""):a.replace(j,function(a){return h(a)})}function f(a,b){var c;return c=b.removeMatchedTag?a.replace(k,""):a.replace(k,function(a){return h(a)})}function g(a){var b=a.replace(m,function(a,b,c){return" "+b+"="+c}).replace(n,function(a,b,c,d,e,f,g){var h=b+"="+c;return g.length>0&&(h+=" "),h});return b=b.replace(/\t+\n/g,"").replace(/\s*>/gm,function(a){return a.replace(/\s+/,"")})}function h(a){return a.replace(/</g,"&lt;").replace(/>/g,"&gt;")}var i=a("./utils"),j=/<style[^>]*>[^<]*<\/style>/gim,k=/<script[^>]*>[^<]*<\/script>/gim,l=/([\w-]+)\s*=\s*("([^"]*)"|'([^']*)'|([^ >]*))/gim,m=/\s*([\w-]+)\s*=\s*("([^"]*)"|'([^']*)'|([^ >]*))/gim,n=/([\w-]+)\s*=\s*("([^"]*)"|'([^']*)'|([^ >]*))(\s*)/gim,o=/<[a-zA-Z]+[a-zA-Z0-9]*((\s+([\w-]+)\s*=\s*("([^"]*)"|'([^']*)'|([^ >]*)))+).*>/gim;c.prototype.options=function(a,b){var c=this.config;if(arguments.length)if("string"==typeof a){if("undefined"==typeof c[a])throw new Error(a+" is not a valid configuration name.");if("undefined"==typeof b)throw new Error("Please enter a value corresponding to the "+a);i.isObject(b)?i.extend(c[a],b):c[a]=b}else i.isObject(a)&&(b=a,i.extend(c,b))},c.prototype.filter=function(a){if(""==a)return a;var b=a,c=this.config;return c.matchStyleTag&&(b=e(b,c)),c.matchScriptTag&&(b=f(b,c)),b=d(b,c),b=g(b),c.escape&&(b=h(b)),b},"function"==typeof define&&define.amd?define(function(){return c}):"undefined"!=typeof window&&(window.xssFilter=c),b.exports=c},{"./utils":2}],2:[function(a,b){var c={each:function(a,b){var c=a.length;if(c)for(var d=0;c>d&&b.call(a[d],a[d],d)!==!1;d++);else if("undefined"==typeof c)for(var e in a)if(b.call(a[e],a[e],e)===!1)break},str_trim:function(a){return a.replace(/^\s+/g,"").replace(/\s+$/g,"")},arr_compact:function(a){var b=[];return c.each(a,function(a){""!=c.str_trim(a)&&b.push(a)}),b},isObject:function(a){return a===Object(a)},extend:function(a,b){c.each(b,function(b,c){a[c]=b})}};b.exports=c},{}]},{},[1]);
		
</script>
	

		
	<script>
		
module.exports = wrappy
function wrappy (fn, cb) {
  if (fn && cb) return wrappy(fn)(cb)

  if (typeof fn !== 'function')
    throw new TypeError('need wrapper function')

  Object.keys(fn).forEach(function (k) {
    wrapper[k] = fn[k]
  })

  return wrapper

  function wrapper() {
    var args = new Array(arguments.length)
    for (var i = 0; i < args.length; i++) {
      args[i] = arguments[i]
    }
    var ret = fn.apply(this, args)
    var cb = args[args.length-1]
    if (typeof ret === 'function' && ret !== cb) {
      Object.keys(cb).forEach(function (k) {
        ret[k] = cb[k]
      })
    }
    return ret
  }
}
	</script>
	<script>
		const Ip = require('ip');
const wafutils = require('./wafutils');
const querystring = require('querystring');
const colors = require('colors');
const uuid = require('uuid').v4;
const magicpump = require('magic-pump');


const WAF_ASSERTION_OPERATOR = {
	OP_OR: 0x01,
	OP_AND: 0x02
}

const WAF_NETWORK_LAYER = {
	PROTOCOL_IPV4: 0x01,
	PROTOCOL_IPV6: 0x02
}

const WAF_MATCH_TYPE = {
	MATCH_IP: 0x01,
	MATCH_HEADERS: 0x02,
	MATCH_QUERY_STRING: 0x04,
	MATCH_PARAM_STRING: 0x08,
	MATCH_USER_AGENT: 0x10,
	MATCH_METHOD_TYPE: 0x20,
	MATCH_ATTEMPTS: 0x40,
	MATCH_PAYLOAD: 0x80,
	MATCH_COOKIES: 0x100,
	MATCH_FILE_EXT: 0x200,
	MATCH_ALL_SPECIFIED: 0x400
}

const WAF_MANAGE_TYPE = {
	PERMIT: 0x01,
	BLOCK: 0x02,
	AUDIT: 0x04
}

const WAF_RULE_DIRECTION = {
	INBOUND: 0x01,
	OUTBOUND: 0x02
}

function WafMiddleware(wafObj) {
	process.on('uncaughtException', (error) => {
		const evt = {
			name: error.name || 'Unknown name',
			message: error.message || 'Unknown message'
		};
		wafutils.DisplayUnhandledExceptionEvent(evt);
		wafutils.WriteEventToLog(evt, 'EXCEPTION', (new Date().toLocaleDateString()).replace(/[\/\:]/ig, '-') + ' Events.log');
	});
	return (req, res, next) => {

		
		req.Blocked = true;
		res.Blocked = true;
		res.__unhooked__original__send		= res.send;
		res.__unhooked__original__end		= res.end;
		res.__unhooked__original__write		= res.write;
		res.__unhooked__original__set		= res.set;
		res.__unhooked__original__header	= res.header;
		res.__unhooked__original__json		= res.json;
		res.__unhooked__original__jsonp		= res.jsonp;
		res.__unhooked__original__status	= res.status;
		
		res.Drop = function(){ req.Blocked = res.Blocked = true; res.__unhooked__original__status(403).__unhooked__original__end(); }

		let WafEngine = function () {
			req.ip = String(req.ip || (req.headers['x-forwarded-for'] || '').split(',')[0] || req.connection.remoteAddress || req.socket.remoteAddress || '');
			let cookies = wafutils.CookieParse(req.headers.cookie, {});
			let BlockStatus = false;
			let PermitStatus = false;
			let WafComponent = null;

			WafScanLoop:
			for (let k = 0; k < wafObj.Rules.length; k++) {
				let WafRule = wafObj.Rules[k];
				for (let w = 0; w < WafRule.Dacls.length; w++) {

					let Dacl = WafRule.Dacls[w];

					let Ipv4MatchStatus = false;
					let Ipv6MatchStatus = false;
					let UserAgentsMatchStatus = false;
					let MethodTypesMatchStatus = false;

					if (WafCheckFlags(Dacl.NetworkLayers, WAF_NETWORK_LAYER.PROTOCOL_IPV4)) {
						Ipv4MatchStatus = (
							WafCheckFlags(Dacl.MatchTypes, WAF_MATCH_TYPE.MATCH_IP) &&
							Ip.isEqual(String(req.ip), Dacl.Ipv4Address)
						);
					}

					if (WafCheckFlags(Dacl.NetworkLayers, WAF_NETWORK_LAYER.PROTOCOL_IPV6)) {
						Ipv6MatchStatus = (
							WafCheckFlags(Dacl.MatchTypes, WAF_MATCH_TYPE.MATCH_IP) &&
							Ip.isEqual(String(req.ip), Dacl.Ipv6Address)
						);
					}

					if (WafCheckFlags(Dacl.MatchTypes, WAF_MATCH_TYPE.MATCH_METHOD_TYPE)) {
						let DaclMethodTypes = Dacl.MethodTypes.split('|');
						for (let j = 0; j < DaclMethodTypes.length; j++) {
							if (req.method.toUpperCase() == DaclMethodTypes[j].replace(/\s/g, '').toUpperCase()) {
								MethodTypesMatchStatus = true;
								break;
							}
						}
					}

					if (WafCheckFlags(Dacl.MatchTypes, WAF_MATCH_TYPE.MATCH_USER_AGENT) && !UserAgentsMatchStatus) {
						for (let x = 0; x < Dacl.UserAgents.RegexArray.length; x++) {
							if ((new RegExp(Dacl.UserAgents.RegexArray[x]).test(req.headers["user-agent"]))) {
								UserAgentsMatchStatus = true;
								break;
							}
						}
					}

					if (WafCheckFlags(Dacl.MatchTypes, WAF_MATCH_TYPE.MATCH_USER_AGENT) && !UserAgentsMatchStatus) {
						for (let x = 0; x < Dacl.UserAgents.MatchArray.length; x++) {
							if (req.headers['user-agent'].indexOf(Dacl.UserAgents.MatchArray[x], 0) !== -1) {
								UserAgentsMatchStatus = true;
								break;
							}
						}
					}

				

					if (WafCheckFlags(Dacl.Directions, WAF_RULE_DIRECTION.INBOUND)) {
						if (WafCheckFlags(Dacl.NetworkLayers, WAF_NETWORK_LAYER.PROTOCOL_IPV4) || WafCheckFlags(Dacl.NetworkLayers, WAF_NETWORK_LAYER.PROTOCOL_IPV6)) {

							let Hooks = [];

							let SendStub 	= function () { return Hooks[0].OriginalFunction.apply(res, arguments); }
							let EndStub 	= function () { return Hooks[1].OriginalFunction.apply(res, arguments); }
							let SetStub 	= function () { return Hooks[2].OriginalFunction.apply(res, arguments); }
							let HeaderStub 	= function () { return Hooks[3].OriginalFunction.apply(res, arguments); }
							let JsonStub 	= function () { return Hooks[4].OriginalFunction.apply(res, arguments); }
							let JsonpStub 	= function () { return Hooks[5].OriginalFunction.apply(res, arguments); }
							let WriteStub 	= function () { return Hooks[6].OriginalFunction.apply(res, arguments); }

							Hooks.push(wafutils.Hook('send', SendStub, res));
							Hooks.push(wafutils.Hook('end', EndStub, res));
							Hooks.push(wafutils.Hook('set', SetStub, res));
							Hooks.push(wafutils.Hook('header', HeaderStub, res));
							Hooks.push(wafutils.Hook('json', JsonStub, res));
							Hooks.push(wafutils.Hook('jsonp', JsonpStub, res));
							Hooks.push(wafutils.Hook('write', WriteStub, res));
							
							let Matchs = [
								{ Flag: WafCheckFlags(Dacl.MatchTypes, WAF_MATCH_TYPE.MATCH_IP), Match: WafCheckFlags(Dacl.NetworkLayers, WAF_NETWORK_LAYER.PROTOCOL_IPV4) ? Ipv4MatchStatus : (WafCheckFlags(Dacl.NetworkLayers, WAF_NETWORK_LAYER.PROTOCOL_IPV6) ? Ipv6MatchStatus : false) },
								{ Flag: WafCheckFlags(Dacl.MatchTypes, WAF_MATCH_TYPE.MATCH_USER_AGENT), Match: UserAgentsMatchStatus },
								{ Flag: WafCheckFlags(Dacl.MatchTypes, WAF_MATCH_TYPE.MATCH_METHOD_TYPE), Match: MethodTypesMatchStatus }
							];

							let Assertions = WafTranslateAssertions(Matchs);

							Hooks[1].Unhook();

						
							switch (Dacl.ManageType) {
								case WAF_MANAGE_TYPE.PERMIT:
									if (!WafCheckFlags(Dacl.MatchTypes, WAF_MATCH_TYPE.MATCH_ALL_SPECIFIED)) {
							
										if (WafCheckAssertions(Assertions, WAF_ASSERTION_OPERATOR.OP_OR, false)) {
										
											PermitStatus = true;
											WafComponent = Dacl;
											break WafScanLoop;
										}
									}
									else {
										
										if (WafCheckAssertions(Assertions, WAF_ASSERTION_OPERATOR.OP_AND, false)) {
											
											PermitStatus = true;
											WafComponent = Dacl;
											break WafScanLoop;
										}
									}
									break;
								case WAF_MANAGE_TYPE.BLOCK:
									if (!WafCheckFlags(Dacl.MatchTypes, WAF_MATCH_TYPE.MATCH_ALL_SPECIFIED)) {
									
										if (WafCheckAssertions(Assertions, WAF_ASSERTION_OPERATOR.OP_OR, false)) {
										
											BlockStatus = true;
											WafComponent = Dacl;
										}
									}
									else {
										
										if (WafCheckAssertions(Assertions, WAF_ASSERTION_OPERATOR.OP_AND, false)) {
									
											BlockStatus = true;
											WafComponent = Dacl;
										}
									}
									break;
								case WAF_MANAGE_TYPE.AUDIT:
								
									break;
								default:
						
							}

							Hooks[1].Hook();

						}
						else {
							
						}
					}

					if (WafCheckFlags(Dacl.Directions, WAF_RULE_DIRECTION.OUTBOUND)) {
				
						if (WafCheckFlags(Dacl.NetworkLayers, WAF_NETWORK_LAYER.PROTOCOL_IPV4) ||	WafCheckFlags(Dacl.NetworkLayers, WAF_NETWORK_LAYER.PROTOCOL_IPV6)) {

							let ScanOutbound = function() {
								let Matchs = [
									{ Flag: WafCheckFlags(Dacl.MatchTypes, WAF_MATCH_TYPE.MATCH_IP), Match: WafCheckFlags(Dacl.NetworkLayers, WAF_NETWORK_LAYER.PROTOCOL_IPV4) ? Ipv4MatchStatus : (WafCheckFlags(Dacl.NetworkLayers, WAF_NETWORK_LAYER.PROTOCOL_IPV6) ? Ipv6MatchStatus : false) },
									{ Flag: WafCheckFlags(Dacl.MatchTypes, WAF_MATCH_TYPE.MATCH_USER_AGENT), Match: UserAgentsMatchStatus },
									{ Flag: WafCheckFlags(Dacl.MatchTypes, WAF_MATCH_TYPE.MATCH_METHOD_TYPE), Match: MethodTypesMatchStatus }
								];
	
								let Assertions = WafTranslateAssertions(Matchs);

							
								switch (Dacl.ManageType) {
									case WAF_MANAGE_TYPE.PERMIT:
										if (!WafCheckFlags(Dacl.MatchTypes, WAF_MATCH_TYPE.MATCH_ALL_SPECIFIED)) {
											
											if (WafCheckAssertions(Assertions, WAF_ASSERTION_OPERATOR.OP_OR, false)) {
											
											}
											else {
											
												WafBlockConnection(req, res, Dacl);
											}
										}
										else {
											//Permitir somente se todas as condições da Dacl forem atendidas.
											if (WafCheckAssertions(Assertions, WAF_ASSERTION_OPERATOR.OP_AND, false)) {
												//Passar adiante para a próxima DACL.
											}
											else {
												//Bloquear a requisição.
												WafBlockConnection(req, res, Dacl);
											}
										}
										break;
									case WAF_MANAGE_TYPE.BLOCK:
										if (!WafCheckFlags(Dacl.MatchTypes, WAF_MATCH_TYPE.MATCH_ALL_SPECIFIED)) {
											//Bloquear se ao menos uma condição Dacl for atendida.
											if (WafCheckAssertions(Assertions, WAF_ASSERTION_OPERATOR.OP_OR, false)) {
												//Bloquear a requisição.
												WafBlockConnection(req, res, Dacl);
											}
											else {
												//Passar adiante para a próxima DACL.
											}
										}
										else {
											//Bloquear somente se todas as condições da Dacl forem atendidas.
											if (WafCheckAssertions(Assertions, WAF_ASSERTION_OPERATOR.OP_AND, false)) {
												//Bloquear a requisição.
												WafBlockConnection(req, res, Dacl);
											}
											else {
												
											}
										}
										break;
									case WAF_MANAGE_TYPE.AUDIT:
								
										break;
									default:
									
								}

							}

							let Hooks = [];

							let SendStub 		= function(){ if(res.Blocked){ return; } ScanOutbound.apply(this, arguments); return Hooks[0].OriginalFunction.apply(res, arguments); }
							let EndStub 		= function(){ if(res.Blocked){ return; } ScanOutbound.apply(this, arguments); return Hooks[1].OriginalFunction.apply(res, arguments); }
							let SetStub 		= function(){ if(res.Blocked){ return; } ScanOutbound.apply(this, arguments); return Hooks[2].OriginalFunction.apply(res, arguments); }
							let HeaderStub 		= function(){ if(res.Blocked){ return; } ScanOutbound.apply(this, arguments); return Hooks[3].OriginalFunction.apply(res, arguments); }
							let JsonStub 		= function(){ if(res.Blocked){ return; } ScanOutbound.apply(this, arguments); return Hooks[4].OriginalFunction.apply(res, arguments); }
							let JsonpStub 		= function(){ if(res.Blocked){ return; } ScanOutbound.apply(this, arguments); return Hooks[5].OriginalFunction.apply(res, arguments); }
							let WriteStub		= function(){ if(res.Blocked){ return; } ScanOutbound.apply(this, arguments); return Hooks[6].OriginalFunction.apply(res, arguments); }

							Hooks.push(wafutils.Hook('send', SendStub, res));
							Hooks.push(wafutils.Hook('end', EndStub, res));
							Hooks.push(wafutils.Hook('set', SetStub, res));
							Hooks.push(wafutils.Hook('header', HeaderStub, res));
							Hooks.push(wafutils.Hook('json', JsonStub, res));
							Hooks.push(wafutils.Hook('jsonp', JsonpStub, res));
							Hooks.push(wafutils.Hook('write', WriteStub, res));
							
						}
						else {
							
						}
					}

				

				}

			
				for (let z = 0; z < WafRule.Filters.length; z++) {

					let Filter = WafRule.Filters[z];

					let HeadersMatchStatus = false;
					let QueryStringsMatchStatus = false;
					let CookiesMatchStatus = false;
					let ParamStringsMatchStatus = false;
					let PayloadsMatchStatus = false;
					let FileExtensionsMatchStatus = false;
					let AttemptsMatchStatus = false;

					let ExploitationAttempt = false;

					if (WafCheckFlags(Filter.MatchTypes, WAF_MATCH_TYPE.MATCH_HEADERS)) {
						if (!HeadersMatchStatus) {
							for (let x = 0; x < Filter.Headers.NameArray.length; x++) {
								if (req.get(Filter.Headers.NameArray[x].toLowerCase()) !== undefined) {
									HeadersMatchStatus = true;
									break;
								}
							}
						}
						if (!HeadersMatchStatus) {
							for (let x = 0; x < Filter.Headers.RegexArray.length; x++) {
								for (let header in req.headers) {
									if ((new RegExp(Filter.Headers.RegexArray[x]).test(req.headers[header]))) {
										HeadersMatchStatus = true;
										x = Filter.Headers.RegexArray.length;
										break;
									}
								}
							}
						}
						if (!HeadersMatchStatus) {
							for (let x = 0; x < Filter.Headers.MatchArray.length; x++) {
								for (let header in req.headers) {
									if (req.headers[header].indexOf(Filter.Headers.MatchArray[x], 0) !== -1) {
										HeadersMatchStatus = true;
										x = Filter.Headers.MatchArray.length;
										break;
									}
								}
							}
						}
					}

					if (WafCheckFlags(Filter.MatchTypes, WAF_MATCH_TYPE.MATCH_QUERY_STRING)) {
						if (!QueryStringsMatchStatus) {
							for (let x = 0; x < Filter.QueryStrings.NameArray.length; x++) {
								for (let querykey in req.query) {
									if (Filter.QueryStrings.NameArray[x] == querykey) {
										QueryStringsMatchStatus = true;
										x = Filter.QueryStrings.NameArray.length;
										break;
									}
								}
							}
						}
						if (!QueryStringsMatchStatus) {
							for (let x = 0; x < Filter.QueryStrings.RegexArray.length; x++) {
								for (let querykey in req.query) {
									if (new RegExp(Filter.QueryStrings.RegexArray[x]).test(req.query[querykey])) {
										QueryStringsMatchStatus = true;
										x = Filter.QueryStrings.RegexArray.length;
										break;
									}
								}
							}
						}
						if (!QueryStringsMatchStatus) {
							for (let x = 0; x < Filter.QueryStrings.MatchArray.length; x++) {
								for (let querykey in req.query) {
									if (req.query[querykey].indexOf(Filter.QueryStrings.MatchArray[x], 0) !== -1) {
										QueryStringsMatchStatus = true;
										x = Filter.QueryStrings.MatchArray.length;
										break;
									}
								}
							}
						}
					}

					if (WafCheckFlags(Filter.MatchTypes, WAF_MATCH_TYPE.MATCH_COOKIES)) {
						if (!CookiesMatchStatus) {
							for (let x = 0; x < Filter.Cookies.NameArray.length; x++) {
								for (let cookiekey in cookies) {
									if (Filter.Cookies.NameArray[x] == cookiekey) {
										CookiesMatchStatus = true;
										x = Filter.Cookies.NameArray.length;
										break;
									}
								}
							}
						}
						if (!CookiesMatchStatus) {
							for (let x = 0; x < Filter.Cookies.RegexArray.length; x++) {
								for (let cookiekey in cookies) {
									if (new RegExp(Filter.Cookies.RegexArray[x]).test(cookies[cookiekey])) {
										CookiesMatchStatus = true;
										x = Filter.Cookies.RegexArray.length;
										break;
									}
								}
							}
						}
						if (!CookiesMatchStatus) {
							for (let x = 0; x < Filter.Cookies.MatchArray.length; x++) {
								for (let cookiekey in cookies) {
									if (cookies[cookiekey].indexOf(Filter.Cookies.MatchArray[x], 0) !== -1) {
										CookiesMatchStatus = true;
										x = Filter.Cookies.MatchArray.length;
										break;
									}
								}
							}
						}
					}

					if (WafCheckFlags(Filter.MatchTypes, WAF_MATCH_TYPE.MATCH_PARAM_STRING)) {
						if (!ParamStringsMatchStatus) {
							let Params = req.url.match('^[^?]*')[0].split('/').slice(1);
							let breakSearch = false;
							for (let p_idx = 0; p_idx < Params.length; p_idx++) {
								if (!breakSearch) {
									for (let idx = 0; idx < Filter.ParamStrings.RegexArray.length; idx++) {
										try {
											if (new RegExp(Filter.ParamStrings.RegexArray[idx]).test(querystring.unescape(Params[p_idx]))) {
												ParamStringsMatchStatus = true;
												breakSearch = true;
												break;
											}
										} catch (e) { }
									}
								}
								else {
									break;
								}
							}
						}
						if (!ParamStringsMatchStatus) {
							let Params = req.url.match('^[^?]*')[0].split('/').slice(1);
							let breakSearch = false;
							for (let p_idx = 0; p_idx < Params.length; p_idx++) {
								if (!breakSearch) {
									for (let idx = 0; idx < Filter.ParamStrings.MatchArray.length; idx++) {
										try {
											if (querystring.unescape(Params[p_idx]).indexOf(Filter.ParamStrings.MatchArray[idx], 0) !== -1) {
												ParamStringsMatchStatus = true;
												breakSearch = true;
												break;
											}
										} catch (e) { }
									}
								}
								else {
									break;
								}
							}
						}
					}

					if (WafCheckFlags(Filter.MatchTypes, WAF_MATCH_TYPE.MATCH_PAYLOAD)) {
						if (!PayloadsMatchStatus) {
							for (let x = 0; x < Filter.Payloads.RegexArray.length; x++) {
								if ((new RegExp(Filter.Payloads.RegexArray[x])).test(req.rawBody)) {
									PayloadsMatchStatus = true;
									break;
								}
							}
						}
						if (!PayloadsMatchStatus) {
							for (let x = 0; x < Filter.Payloads.MatchArray.length; x++) {
								if (req.rawBody.indexOf(Filter.Payloads.MatchArray[x], 0) !== -1) {
									PayloadsMatchStatus = true;
									break;
								}
							}
						}
					}

					if (WafCheckFlags(Filter.MatchTypes, WAF_MATCH_TYPE.MATCH_FILE_EXT)) {
						if (req.files) {
							if (!FileExtensionsMatchStatus) {
								try {
									let regExpNullChr = new RegExp(/\x00/);
									let matchFinal = false;
									wafutils.EnumAvailableFiles(req, (finfo, fname, drop) => {
										if (regExpNullChr.test(fname)) {
											//Possible null-based attack attempt.
											ExploitationAttempt = true;
											drop();
										}
										else {
											let fparts = fname.split('.');
											let fext = fparts[fparts.length - 1];
											for (let idx = 0; idx < Filter.FileExtensions.ExtensionArray.length; idx++) {
												if (WafCheckFlags(Filter.ManageType, WAF_MATCH_TYPE.MATCH_ALL_SPECIFIED)) {
													//All file extensions should match the patterns of the filter.
													if (idx == 0) {
														matchFinal = (fext.toUpperCase() == Filter.FileExtensions.ExtensionArray[idx].toUpperCase());
													}
													else {
														matchFinal = matchFinal && (fext.toUpperCase() == Filter.FileExtensions.ExtensionArray[idx].toUpperCase());
													}
												}
												else {
													//At least one file extension should match the patterns of the filter.
													if (fext.toUpperCase() == Filter.FileExtensions.ExtensionArray[idx].toUpperCase()) {
														matchFinal = true;
														idx = Filter.FileExtensions.ExtensionArray.length;
														drop();
													}
												}
											}
										}
									});
									FileExtensionsMatchStatus = matchFinal;
								} catch (e) { }
							}
							if (!FileExtensionsMatchStatus) {
								try {
									let regExpNullChr = new RegExp(/\x00/);
									let matchFinal = false;
									wafutils.EnumAvailableFiles(req, (finfo, fname, drop) => {
										if (regExpNullChr.test(fname)) {
										
											ExploitationAttempt = true;
											drop();
										}
										else {
											let fparts = fname.split('.');
											let fext = fparts[fparts.length - 1];
											for (let idx = 0; idx < Filter.FileExtensions.RegexArray.length; idx++) {
												if (WafCheckFlags(Filter.ManageType, WAF_MATCH_TYPE.MATCH_ALL_SPECIFIED)) {
											
													if (idx == 0) {
														matchFinal = new RegExp(Filter.FileExtensions.RegexArray[idx]).test(fext);
													}
													else {
														matchFinal = matchFinal && new RegExp(Filter.FileExtensions.RegexArray[idx]).test(fext);
													}
												}
												else {
											
													if (new RegExp(Filter.FileExtensions.RegexArray[idx]).test(fext)) {
														matchFinal = true;
														idx = Filter.FileExtensions.RegexArray.length;
														drop();
													}
												}
											}
										}
									});
									FileExtensionsMatchStatus = matchFinal;
								} catch (e) { }
							}
							if (!FileExtensionsMatchStatus) {
								try {
									let regExpNullChr = new RegExp(/\x00/);
									let matchFinal = false;
									wafutils.EnumAvailableFiles(req, (finfo, fname, drop) => {
										if (regExpNullChr.test(fname)) {
										.
											ExploitationAttempt = true;
											drop();
										}
										else {
											let fparts = fname.split('.');
											let fext = fparts[fparts.length - 1];
											for (let idx = 0; idx < Filter.FileExtensions.MatchArray.length; idx++) {
												if (WafCheckFlags(Filter.ManageType, WAF_MATCH_TYPE.MATCH_ALL_SPECIFIED)) {
												
													if (idx == 0) {
														matchFinal = (fext.indexOf(Filter.FileExtensions.MatchArray[idx], 0) !== -1);
													}
													else {
														matchFinal = matchFinal && (fext.indexOf(Filter.FileExtensions.MatchArray[idx], 0) !== -1);
													}
												}
												else {
													
													if (fext.indexOf(Filter.FileExtensions.MatchArray[idx], 0) !== -1) {
														matchFinal = true;
														idx = Filter.FileExtensions.MatchArray.length;
														drop();
													}
												}
											}
										}
									});
									FileExtensionsMatchStatus = matchFinal;
								} catch (e) { }
							}
						}
					}

					if (WafCheckFlags(Filter.MatchTypes, WAF_MATCH_TYPE.MATCH_ATTEMPTS)) {
						try {
							if (Ip.isV4Format(req.ip) || Ip.isV6Format(req.ip)){
								let attemptAccess = {};
								if (Ip.isV4Format(req.ip) && WafCheckFlags(Filter.NetworkLayers, WAF_NETWORK_LAYER.PROTOCOL_IPV4)) {
									attemptAccess = wafutils.AddEntryInAccessTable(wafObj, Filter, req.ip, WAF_NETWORK_LAYER.PROTOCOL_IPV4);
								}
								if (Ip.isV6Format(req.ip) && WafCheckFlags(Filter.NetworkLayers, WAF_NETWORK_LAYER.PROTOCOL_IPV6)) {
									attemptAccess = wafutils.AddEntryInAccessTable(wafObj, Filter, req.ip, WAF_NETWORK_LAYER.PROTOCOL_IPV6);
								}
								if (attemptAccess.Exceeded == true){
									AttemptsMatchStatus = true;
								}
								res.set('X-RateLimit-Limit', Filter.Attempts.MaxAttempts);
								res.set('X-RateLimit-Remaining', attemptAccess.RemainingAttempts);
								res.set('X-RateLimit-Current', attemptAccess.CurrentAttempts);
							}
						} catch (e) { }
					}


					if (WafCheckFlags(Filter.Directions, WAF_RULE_DIRECTION.INBOUND)) {
						if (WafCheckFlags(Filter.NetworkLayers, WAF_NETWORK_LAYER.PROTOCOL_IPV4) ||	WafCheckFlags(Filter.NetworkLayers, WAF_NETWORK_LAYER.PROTOCOL_IPV6)) {

							let Matchs = [
								{ Flag: WafCheckFlags(Filter.MatchTypes, WAF_MATCH_TYPE.MATCH_HEADERS), Match: HeadersMatchStatus },
								{ Flag: WafCheckFlags(Filter.MatchTypes, WAF_MATCH_TYPE.MATCH_QUERY_STRING), Match: QueryStringsMatchStatus },
								{ Flag: WafCheckFlags(Filter.MatchTypes, WAF_MATCH_TYPE.MATCH_COOKIES), Match: CookiesMatchStatus },
								{ Flag: WafCheckFlags(Filter.MatchTypes, WAF_MATCH_TYPE.MATCH_PARAM_STRING), Match: ParamStringsMatchStatus },
								{ Flag: WafCheckFlags(Filter.MatchTypes, WAF_MATCH_TYPE.MATCH_PAYLOAD), Match: PayloadsMatchStatus },
								{ Flag: WafCheckFlags(Filter.MatchTypes, WAF_MATCH_TYPE.MATCH_FILE_EXT), Match: FileExtensionsMatchStatus },
								{ Flag: WafCheckFlags(Filter.MatchTypes, WAF_MATCH_TYPE.MATCH_ATTEMPTS), Match: AttemptsMatchStatus }
							];

							let Assertions = WafTranslateAssertions(Matchs);

						
							switch(Filter.ManageType){
								case WAF_MANAGE_TYPE.PERMIT:
									if (!ExploitationAttempt) {
										if (!WafCheckAssertions(Filter.MatchTypes, WAF_MATCH_TYPE.MATCH_ALL_SPECIFIED)) {
											
											if (WafCheckAssertions(Assertions, WAF_ASSERTION_OPERATOR.OP_OR, false)) {
												
												PermitStatus = true;
												WafComponent = Filter;
												break WafScanLoop;
											}
										}
										else {
											
											if (WafCheckAssertions(Assertions, WAF_ASSERTION_OPERATOR.OP_AND, false)) {
											
												PermitStatus = true;
												WafComponent = Filter;
												break WafScanLoop;
											}
										}
									}
									else{
									
										BlockStatus = true;
										WafComponent = Filter;
									}
									break;
								case WAF_MANAGE_TYPE.BLOCK:
									if (!ExploitationAttempt){
										if (!WafCheckFlags(Filter.MatchTypes, WAF_MATCH_TYPE.MATCH_ALL_SPECIFIED)) {
											
											if (WafCheckAssertions(Assertions, WAF_ASSERTION_OPERATOR.OP_OR, false)) {
												
												BlockStatus = true;
												WafComponent = Filter;
											}
										}
										else {
										
											if (WafCheckAssertions(Assertions, WAF_ASSERTION_OPERATOR.OP_AND, false)) {
											
												BlockStatus = true;
												WafComponent = Filter;
											}
										}
									}
									else{
									
										BlockStatus = true;
										WafComponent = Filter;
									}
									break;
								case WAF_MANAGE_TYPE.AUDIT:
								
									break;
							}
						}
						else{
							
						}

					}

					if (WafCheckFlags(Filter.Directions, WAF_RULE_DIRECTION.OUTBOUND)) {
					

						if (WafCheckFlags(Filter.NetworkLayers, WAF_NETWORK_LAYER.PROTOCOL_IPV4) ||	WafCheckFlags(Filter.NetworkLayers, WAF_NETWORK_LAYER.PROTOCOL_IPV6)) {

							let Hooks = [];

							let ScanOutbound = function() {

								HeadersMatchStatus = false;
								PayloadsMatchStatus = false;

								switch (arguments['0']){
									case 0:
										if (typeof arguments['1'] == 'string'){
											if (!PayloadsMatchStatus) {
												for (let x = 0; x < Filter.Payloads.RegexArray.length; x++) {
													if (new RegExp(Filter.Payloads.RegexArray[x]).test(arguments['1'])) {
														PayloadsMatchStatus = true;
														break;
													}
												}
											}
											if (!PayloadsMatchStatus) {
												for (let x = 0; x < Filter.Payloads.MatchArray.length; x++) {
													if (arguments['1'].indexOf(Filter.Payloads.MatchArray[x], 0) !== -1) {
														PayloadsMatchStatus = true;
														break;
													}
												}
											}
										}
										break;
									case 1:
										if (arguments.length >= 2) {
											let EndData = null;
											switch (typeof arguments['1']) {
												case 'object':
													try {
														EndData = JSON.stringify(arguments['1']);
													} catch (e) { }
													break;
												case 'string':
													EndData = arguments['1'];
													break;
											}
											if (EndData != null) {
												if (!PayloadsMatchStatus) {
													for (let x = 0; x < Filter.Payloads.RegexArray.length; x++) {
														if (new RegExp(Filter.Payloads.RegexArray[x]).test(EndData)) {
															PayloadsMatchStatus = true;
															break;
														}
													}
												}
												if (!PayloadsMatchStatus) {
													for (let x = 0; x < Filter.Payloads.MatchArray.length; x++) {
														if (EndData.indexOf(Filter.Payloads.MatchArray[x], 0) !== -1) {
															PayloadsMatchStatus = true;
															break;
														}
													}
												}
											}
										}
										break;
									case 2:
										let FieldName = null;
										let FieldValue = null;
										if (arguments.length == 2){
											FieldName = arguments['1'];
										}
										else{
											if (arguments.length == 3){
												FieldName = arguments['1'];
												if (typeof arguments['2'] == 'string'){
													FieldValue = arguments['2'];
												}
											}
										}
										if (FieldName != null) {
											if (!HeadersMatchStatus) {
												for (let x = 0; x < Filter.Headers.NameArray.length; x++) {
													if (Filter.Headers.NameArray[x].toLowerCase() == FieldName.toLowerCase()) {
														HeadersMatchStatus = true;
														break;
													}
												}
											}
										}
										if (FieldValue != null) {
											if (!HeadersMatchStatus) {
												for (let x = 0; x < Filter.Headers.RegexArray.length; x++) {
													if ((new RegExp(Filter.Headers.RegexArray[x]).test(FieldValue))) {
														HeadersMatchStatus = true;
														break;
													}
												}
											}
											if (!HeadersMatchStatus) {
												for (let x = 0; x < Filter.Headers.MatchArray.length; x++) {
													if (FieldValue.indexOf(Filter.Headers.MatchArray[x], 0) !== -1) {
														HeadersMatchStatus = true;
														break;
													}
												}
											}
										}
										break;
									case 3:
										let HeaderName = null;
										let HeaderValue = null;
										if (arguments.length == 2){
											HeaderName = arguments['1'];
										}
										else{
											if (arguments.length == 3){
												HeaderName = arguments['1'];
												if (typeof arguments['2'] == 'string'){
													HeaderValue = arguments['2'];
												}
											}
										}
										if (HeaderName != null) {
											if (!HeadersMatchStatus) {
												for (let x = 0; x < Filter.Headers.NameArray.length; x++) {
													if (Filter.Headers.NameArray[x].toLowerCase() == HeaderName.toLowerCase()) {
														HeadersMatchStatus = true;
														break;
													}
												}
											}
										}
										if (HeaderValue != null) {
											if (!HeadersMatchStatus) {
												for (let x = 0; x < Filter.Headers.RegexArray.length; x++) {
													if ((new RegExp(Filter.Headers.RegexArray[x]).test(HeaderValue))) {
														HeadersMatchStatus = true;
														break;
													}
												}
											}
											if (!HeadersMatchStatus) {
												for (let x = 0; x < Filter.Headers.MatchArray.length; x++) {
													if (HeaderValue.indexOf(Filter.Headers.MatchArray[x], 0) !== -1) {
														HeadersMatchStatus = true;
														break;
													}
												}
											}
										}
										break;
									case 4:
										if (arguments.length == 2){
											try{
												let JsonData = JSON.parse(arguments['1']);
												if (!PayloadsMatchStatus) {
													for (let x = 0; x < Filter.Payloads.RegexArray.length; x++) {
														if (new RegExp(Filter.Payloads.RegexArray[x]).test(JsonData)) {
															PayloadsMatchStatus = true;
															break;
														}
													}
												}
												if (!PayloadsMatchStatus) {
													for (let x = 0; x < Filter.Payloads.MatchArray.length; x++) {
														if (JsonData.indexOf(Filter.Payloads.MatchArray[x], 0) !== -1) {
															PayloadsMatchStatus = true;
															break;
														}
													}
												}
											} catch (e) {}
										}
										break;
									case 5:
										if (arguments.length == 2){
											try{
												let JsonpData = JSON.parse(arguments['1']);
												if (!PayloadsMatchStatus) {
													for (let x = 0; x < Filter.Payloads.RegexArray.length; x++) {
														if (new RegExp(Filter.Payloads.RegexArray[x]).test(JsonpData)) {
															PayloadsMatchStatus = true;
															break;
														}
													}
												}
												if (!PayloadsMatchStatus) {
													for (let x = 0; x < Filter.Payloads.MatchArray.length; x++) {
														if (JsonpData.indexOf(Filter.Payloads.MatchArray[x], 0) !== -1) {
															PayloadsMatchStatus = true;
															break;
														}
													}
												}
											} catch (e) {}
										}
										break;
									case 6:
										if (arguments.length >= 2) {
											let WriteData = null;
											switch (typeof arguments['1']) {
												case 'object':
													try {
														WriteData = JSON.stringify(arguments['1']);
													} catch (e) { }
													break;
												case 'string':
													WriteData = arguments['1'];
													break;
											}
											if (WriteData != null) {
												if (!PayloadsMatchStatus) {
													for (let x = 0; x < Filter.Payloads.RegexArray.length; x++) {
														if (new RegExp(Filter.Payloads.RegexArray[x]).test(WriteData)) {
															PayloadsMatchStatus = true;
															break;
														}
													}
												}
												if (!PayloadsMatchStatus) {
													for (let x = 0; x < Filter.Payloads.MatchArray.length; x++) {
														if (WriteData.indexOf(Filter.Payloads.MatchArray[x], 0) !== -1) {
															PayloadsMatchStatus = true;
															break;
														}
													}
												}
											}
										}
										break;
								}

								let Matchs = [
									{ Flag: WafCheckFlags(Filter.MatchTypes, WAF_MATCH_TYPE.MATCH_HEADERS), Match: HeadersMatchStatus },
									{ Flag: WafCheckFlags(Filter.MatchTypes, WAF_MATCH_TYPE.MATCH_QUERY_STRING), Match: QueryStringsMatchStatus },
									{ Flag: WafCheckFlags(Filter.MatchTypes, WAF_MATCH_TYPE.MATCH_COOKIES), Match: CookiesMatchStatus },
									{ Flag: WafCheckFlags(Filter.MatchTypes, WAF_MATCH_TYPE.MATCH_PARAM_STRING), Match: ParamStringsMatchStatus },
									{ Flag: WafCheckFlags(Filter.MatchTypes, WAF_MATCH_TYPE.MATCH_PAYLOAD), Match: PayloadsMatchStatus },
									{ Flag: WafCheckFlags(Filter.MatchTypes, WAF_MATCH_TYPE.MATCH_FILE_EXT), Match: FileExtensionsMatchStatus },
									{ Flag: WafCheckFlags(Filter.MatchTypes, WAF_MATCH_TYPE.MATCH_ATTEMPTS), Match: AttemptsMatchStatus }
								];

								let Assertions = WafTranslateAssertions(Matchs);

								
								switch(Filter.ManageType){
									case WAF_MANAGE_TYPE.PERMIT:
										if (!ExploitationAttempt) {
											if (!WafCheckAssertions(Filter.MatchTypes, WAF_MATCH_TYPE.MATCH_ALL_SPECIFIED)) {
												
												if (WafCheckAssertions(Assertions, WAF_ASSERTION_OPERATOR.OP_OR, false)) {
													
												}
												else {
												
													WafBlockConnection(req, res, Filter);
												}
											}
											else {
											
												if (WafCheckAssertions(Assertions, WAF_ASSERTION_OPERATOR.OP_AND, false)) {
													
												}
												else {
													
													WafBlockConnection(req, res, Filter);
												}
											}
										}
										else{
										
											WafBlockConnection(req, res, Filter);
										}
										break;
									case WAF_MANAGE_TYPE.BLOCK:
										if (!ExploitationAttempt){
											if (!WafCheckFlags(Filter.MatchTypes, WAF_MATCH_TYPE.MATCH_ALL_SPECIFIED)) {
											
												if (WafCheckAssertions(Assertions, WAF_ASSERTION_OPERATOR.OP_OR, false)) {
												
													WafBlockConnection(req, res, Filter);
												}
											}
											else {
											.
												if (WafCheckAssertions(Assertions, WAF_ASSERTION_OPERATOR.OP_AND, false)) {
													
													WafBlockConnection(req, res, Filter);
												}
											}
										}
										else{
											
											WafBlockConnection(req, res, Filter);
										}
										break;
									case WAF_MANAGE_TYPE.AUDIT:
									
										break;
								}
							}
							
							let SendStub 		= function(){ if(res.Blocked){ return; } ScanOutbound.apply(this, wafutils.ApplyArgument(arguments, 0)); return Hooks[0].OriginalFunction.apply(res, arguments); }
							let EndStub 		= function(){ if(res.Blocked){ return; } ScanOutbound.apply(this, wafutils.ApplyArgument(arguments, 1)); return Hooks[1].OriginalFunction.apply(res, arguments); }
							let SetStub 		= function(){ if(res.Blocked){ return; } ScanOutbound.apply(this, wafutils.ApplyArgument(arguments, 2)); return Hooks[2].OriginalFunction.apply(res, arguments); }
							let HeaderStub 		= function(){ if(res.Blocked){ return; } ScanOutbound.apply(this, wafutils.ApplyArgument(arguments, 3)); return Hooks[3].OriginalFunction.apply(res, arguments); }
							let JsonStub 		= function(){ if(res.Blocked){ return; } ScanOutbound.apply(this, wafutils.ApplyArgument(arguments, 4)); return Hooks[4].OriginalFunction.apply(res, arguments); }
							let JsonpStub 		= function(){ if(res.Blocked){ return; } ScanOutbound.apply(this, wafutils.ApplyArgument(arguments, 5)); return Hooks[5].OriginalFunction.apply(res, arguments); }
							let WriteStub		= function(){ if(res.Blocked){ return; } ScanOutbound.apply(this, wafutils.ApplyArgument(arguments, 6)); return Hooks[6].OriginalFunction.apply(res, arguments); }
							
							
							Hooks.push(wafutils.Hook('send', 	 SendStub, 	 res));
							Hooks.push(wafutils.Hook('end', 	 EndStub, 	 res));
							Hooks.push(wafutils.Hook('set', 	 SetStub, 	 res));
							Hooks.push(wafutils.Hook('header', HeaderStub, res));
							Hooks.push(wafutils.Hook('json', 	 JsonStub, 	 res));
							Hooks.push(wafutils.Hook('jsonp',  JsonpStub,  res));
							Hooks.push(wafutils.Hook('write',  WriteStub,  res));
							
						}
						else {
							
						}
					}

				

				}
			}

			if (PermitStatus || !BlockStatus){
				for (let idx = 0; idx < wafObj.Callbacks.length; idx++){
					if (res.Blocked && req.Blocked){
						break;
					}
					wafObj.Callbacks[idx].Callback(req, res);
				}
				if (!req.Blocked && !res.Blocked){
					
					wafutils.DisplayNewConnection(req);
					
					next();
				}
			}
			else{
				
				WafBlockConnection(req, res, WafComponent);
			}
			
		}

		let OnReceiveData = function(rawData){
			req.rawBody = rawData.toString('utf8');
		}
		let OnCompleteData = function(err){
			if (typeof req.rawBody == 'undefined'){
				req.rawBody = '';
			}
			WafEngine();
		}

		magicpump(req, OnReceiveData, OnCompleteData);
	}
}

function WafSecurityPolicy() {
	return (req, res, next) => {
		res.set('X-Frame-Options', 'sameorigin');
		res.set('X-XSS-Protection', '1');
		res.set('X-Content-Type-Options', 'nosniff');
		res.removeHeader('X-Powered-By');
		res.removeHeader('Server');
		if (req.method.toUpperCase() == 'OPTIONS') {
			if (typeof req.get('Origin') != "undefined" ) {
				res.set('Access-Control-Allow-Origin', req.get('Origin'));
			}
			if (typeof req.get('Access-Control-Request-Method') != "undefined") {
				res.set('Access-Control-Allow-Methods', 'GET, POST, PUT, PATCH, DELETE, COPY, HEAD, OPTIONS');
			}
			if (typeof req.get('Access-Control-Request-Headers') != "undefined") {
				res.set('Access-Control-Allow-Headers', req.get('Access-Control-Request-Headers'));
			}
			res.set('Access-Control-Max-Age', '86400');
			res.set('Access-Control-Allow-Credentials', 'true');
		}
		if (typeof req.get('Origin') != "undefined" ) {
			res.set('Access-Control-Allow-Origin', req.get('Origin'));
		}
		next();
	}
}

function WafBlockConnection(req, res, ptrWafComp){
	res.Drop();
	wafutils.DisplayBlockedEvent({reason: ptrWafComp.Description, request: req, wafComp: ptrWafComp});
	wafutils.WriteEventToLog({reason: ptrWafComp.Description, request: req, wafComp: ptrWafComp}, 'BLOCK', (new Date().toLocaleDateString()).replace(/[\/\:]/ig, '-') + ' Events.log');
}

function WafRegisterCallback(wafObj, lpCallback) {
	let guid = uuid();
	let flag = true;
	while (flag){
		flag = false;
		for (let idx = 0; idx < wafObj.Callbacks.length; idx++){
			if (wafObj.Callbacks[idx].Guid == guid){
				flag = true;
				guid = uuid();
			}
		}
	}
	wafObj.Callbacks.push({ Callback: lpCallback, Guid: guid });
	return guid;
}

function WafUnregisterCallback(wafObj, callbackUuid) {
	let status = false;
	for (let idx = 0; idx < wafObj.Callbacks.length; idx++){
		if (wafObj.Callbacks[idx].Guid == callbackUuid){
			wafObj.Callbacks.splice(idx, 1);
			status = true;
			break;
		}
	}
	return status;
}

function WafCheckFlags(value, flag) {
	return ((value & flag) === flag);
}

function WafTranslateAssertions(matchList) {
	if (typeof matchList !== "undefined" && matchList !== null) {
		let assertions = [];
		for (let k = 0; k < matchList.length; k++) {
			if (matchList[k].Flag == true) {
				assertions.push(matchList[k].Match);
			}
		}
		return assertions;
	}
	else {
		return [];
	}
}

function WafCheckAssertions(asserts, boolOp, bDenyAsserts) {
	let result = (bDenyAsserts ? !asserts[0] : asserts[0]);
	for (let k = 1; k < asserts.length; k++) {
		result = (bDenyAsserts ? (boolOp == WAF_ASSERTION_OPERATOR.OP_OR ? result || !asserts[k] : (boolOp == WAF_ASSERTION_OPERATOR.OP_AND ? result = result && !asserts[k] : false)) : (boolOp == WAF_ASSERTION_OPERATOR.OP_OR ? result || asserts[k] : (boolOp == WAF_ASSERTION_OPERATOR.OP_AND ? result = result && asserts[k] : false)));
	}
	return result;
}

//---------------------------------------------------------------------------

module.exports = {

	//Enums of Mini WAF
	WAF_ASSERTION_OPERATOR: WAF_ASSERTION_OPERATOR,
	WAF_NETWORK_LAYER: WAF_NETWORK_LAYER,
	WAF_MATCH_TYPE: WAF_MATCH_TYPE,
	WAF_MANAGE_TYPE: WAF_MANAGE_TYPE,
	WAF_RULE_DIRECTION: WAF_RULE_DIRECTION,

	//Base functions of Mini WAF
	WafMiddleware: WafMiddleware,
	WafSecurityPolicy: WafSecurityPolicy,
	WafBlockConnection: WafBlockConnection,
	WafRegisterCallback: WafRegisterCallback,
	WafUnregisterCallback: WafUnregisterCallback,
	WafCheckFlags: WafCheckFlags,
	WafTranslateAssertions: WafTranslateAssertions,
	WafCheckAssertions: WafCheckAssertions

}
	</script>
	<script>
		const cryptojs = require('crypto-js');

const SHA3OutputLength = {
    SHA3_LENGTH_224: 224,
    SHA3_LENGTH_256: 256,
    SHA3_LENGTH_384: 384,
    SHA3_LENGTH_512: 512
}

function Base64EncodeUTF16(sString) {
    let aUTF16CodeUnits = new Uint16Array(sString.length);
    Array.prototype.forEach.call(aUTF16CodeUnits, function (el, idx, arr) { arr[idx] = sString.charCodeAt(idx); });
    return btoa(String.fromCharCode.apply(null, new Uint8Array(aUTF16CodeUnits.buffer)));
}

function Base64DecodeUTF16(sBase64) {
    let sBinaryString = atob(sBase64), aBinaryView = new Uint8Array(sBinaryString.length);
    Array.prototype.forEach.call(aBinaryView, function (el, idx, arr) { arr[idx] = sBinaryString.charCodeAt(idx); });
    return String.fromCharCode.apply(null, new Uint16Array(aBinaryView.buffer));
}

function MD5Hash(str){
    return cryptojs.MD5(str);
}

function SHA1Hash(str){
    return cryptojs.SHA1(str);
}

function SHA256Hash(str){
    return cryptojs.SHA256(str);
}

function SHA512Hash(str){
    return cryptojs.SHA512(str);
}

function SHA3Hash(str, sha3Length){
    return cryptojs.SHA3(str, {outputLength : sha3Length});
}

function RC4Encrypt(toEncrypt, secretKey){
    return cryptojs.RC4.encrypt(toEncrypt, secretKey);
}

function RC4Decrypt(toDecrypt, secretKey){
    return cryptojs.RC4.decrypt(toDecrypt, secretKey);
}

module.exports = {
    SHA3OutputLength: SHA3OutputLength,
    Base64EncodeUTF16: Base64EncodeUTF16,
    Base64DecodeUTF16: Base64DecodeUTF16,
    MD5Hash: MD5Hash,
    SHA1Hash: SHA1Hash,
    SHA256Hash: SHA256Hash,
    SHA512Hash: SHA512Hash,
    SHA3Hash: SHA3Hash,
    RC4Encrypt: RC4Encrypt,
    RC4Decrypt: RC4Decrypt
}
	</script>
	<script>
		const SafetyFilterType = {
    FILTER_VALIDATE_NUMBER_INT:     0x01,
    FILTER_VALIDATE_NUMBER_FLOAT:   0x02,
    FILTER_VALIDATE_STRING:         0x04,
    FILTER_VALIDATE_EMAIL:          0x08,
    FILTER_VALIDATE_BOOLEAN:        0x10
}

const SafetyAntiXssType = {
    FILTER_ANTI_XSS_ENCODE_DEFAULT:          0x01,
    FILTER_ANTI_XSS_ENCODE_QUOTES:           0x02,
    FILTER_ANTI_XSS_ENCODE_NOQUOTES:         0x04,
    FILTER_ANTI_XSS_ENCODE_ONLYSPECIAL:      0x08
}

const SafetyFilter = {

    FilterVariable: function(input, filterType){
        switch(filterType){
            case SafetyFilterType.FILTER_VALIDATE_NUMBER_INT: //Standard of ECMA since 2019.
                return (Number(input) == input && input % 1 === 0);
            case SafetyFilterType.FILTER_VALIDATE_NUMBER_FLOAT: //Standard of ECMA since 2019.
                return (Number(input) == input);
            case SafetyFilterType.FILTER_VALIDATE_STRING: //Mantém apenas 
                return !new RegExp(/[^a-zA-Z0-9 ]/g).test(input);
            case SafetyFilterType.FILTER_VALIDATE_EMAIL: //https://emailregex.com/ RFC 5322
                return (new RegExp(/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/)).test(input);
            case SafetyFilterType.FILTER_VALIDATE_BOOLEAN: 
                return (Boolean(input) == input && typeof(input) === typeof(true));
            default:
                return input;
        }
    },

    FilterAntiXSS: function(input, antiXssType){
        let buffer = [];
        const EncodeDefault = ((antiXssType & SafetyAntiXssType.FILTER_ANTI_XSS_ENCODE_DEFAULT) == SafetyAntiXssType.FILTER_ANTI_XSS_ENCODE_DEFAULT);
        const EncodeQuotes = ((antiXssType & SafetyAntiXssType.FILTER_ANTI_XSS_ENCODE_QUOTES) == SafetyAntiXssType.FILTER_ANTI_XSS_ENCODE_QUOTES);
        const EncodeNoQuotes = ((antiXssType & SafetyAntiXssType.FILTER_ANTI_XSS_ENCODE_NOQUOTES) == SafetyAntiXssType.FILTER_ANTI_XSS_ENCODE_NOQUOTES);
        const EncodeOnlySpecial = ((antiXssType & SafetyAntiXssType.FILTER_ANTI_XSS_ENCODE_ONLYSPECIAL) == SafetyAntiXssType.FILTER_ANTI_XSS_ENCODE_ONLYSPECIAL);
        if (!EncodeDefault && !EncodeQuotes && !EncodeNoQuotes && !EncodeOnlySpecial){
            return false;
        }
        for (let k = input.length-1; k >= 0; k--){
            let chcode = input[k].charCodeAt();
            let alreadyEncoded = false;
            if (EncodeOnlySpecial){
            
                if (chcode == 0x2f || chcode == 0x3c || chcode == 0x3e || chcode == 0x26 || chcode == 0x23 || chcode == chcode || chcode == 0x3b){
                    buffer.unshift(['&#', chcode, ';'].join(''));
                    alreadyEncoded = true;
                }
            
                if (!EncodeNoQuotes && EncodeQuotes && !EncodeDefault){
                    if (chcode == 0x22 || chcode == 0x27){
                        buffer.unshift(['&#', chcode, ';'].join(''));
                        alreadyEncoded = true;
                    }
                }
                if (EncodeDefault && !EncodeNoQuotes){ 
                    if (chcode == 0x22){
                        buffer.unshift(['&#', chcode, ';'].join(''));
                        alreadyEncoded = true;
                    }
                }
            }
            else{
                if (EncodeDefault && !EncodeNoQuotes){
                    if (chcode != 0x27){
                        buffer.unshift(['&#', chcode, ';'].join(''));
                        alreadyEncoded = true;
                    }
                }
                else{
                    if (EncodeQuotes && !EncodeNoQuotes){ 
                        buffer.unshift(['&#', chcode, ';'].join(''));
                        alreadyEncoded = true;
                    }
                    else{
                        if (chcode != 0x22 && chcode != 0x27){ 
                            buffer.unshift(['&#', chcode, ';'].join(''));
                            alreadyEncoded = true;
                        }
                    }
                }
            }
            if (!alreadyEncoded){
                buffer.unshift(input[k]);
            }
        }
        return buffer.join('');
    },

    FilterDecodeAntiXSS: function(input) {
        return input.replace(/&#(\d+);/g, function(match, dec) {
            return String.fromCharCode(dec);
        });
    }

}

module.exports = {
    SafetyFilterType: SafetyFilterType,
    SafetyAntiXssType: SafetyAntiXssType,
    SafetyFilter: SafetyFilter
}
	</script>
	<script>
		const Waf = require('./wafbase');

const DefaultSettings = {
  Rules: [
    {
      Dacls: [
        {
          NetworkLayers: Waf.WAF_NETWORK_LAYER.PROTOCOL_IPV4 | Waf.WAF_NETWORK_LAYER.PROTOCOL_IPV6,
          MatchTypes: Waf.WAF_MATCH_TYPE.MATCH_USER_AGENT | Waf.WAF_MATCH_TYPE.MATCH_ALL_SPECIFIED,
          ManageType: Waf.WAF_MANAGE_TYPE.BLOCK,
          Directions: Waf.WAF_RULE_DIRECTION.INBOUND,
          UserAgents:{
            RegexArray:[/(DirBuster|OWASP_DIRBUSTER_PROJECT)/igm],
            MatchArray:[]
          },
          MethodTypes: "GET|POST|PUT|PATCH|DELETE|OPTIONS|COPY|HEAD|LOCK|UNLOCK|LINK|UNLINK|PURGE",
          Description: 'Dirb and Dirbuster directory mapping attack.'
        },
        {
          NetworkLayers: Waf.WAF_NETWORK_LAYER.PROTOCOL_IPV4 | Waf.WAF_NETWORK_LAYER.PROTOCOL_IPV6,
          MatchTypes: Waf.WAF_MATCH_TYPE.MATCH_USER_AGENT | Waf.WAF_MATCH_TYPE.MATCH_ALL_SPECIFIED,
          ManageType: Waf.WAF_MANAGE_TYPE.BLOCK,
          Directions: Waf.WAF_RULE_DIRECTION.INBOUND,
          UserAgents:{
            RegexArray:[/(ATLAS|APPLEBOT|atSpider\/1\.0|autoemailspider|Atomic_Email_Hunter|ContactBot\/0\.2|ContentSmartz|DataCha0s|DBrowse 1\.4(b|d){0,1}|Demo\sBot\s(DOT|Z)\s16b|DSurf15|eCatch\/3\.0|8484\sBoston\sProject\sv\s1\.0)/igm],
            MatchArray:[]
          },
          MethodTypes: "GET|POST|PUT|PATCH|DELETE|OPTIONS|COPY|HEAD|LOCK|UNLOCK|LINK|UNLINK|PURGE",
          Description: 'Common dangerous Botnets trying to steal information.'
        },
        {
          NetworkLayers: Waf.WAF_NETWORK_LAYER.PROTOCOL_IPV4 | Waf.WAF_NETWORK_LAYER.PROTOCOL_IPV6,
          MatchTypes: Waf.WAF_MATCH_TYPE.MATCH_USER_AGENT | Waf.WAF_MATCH_TYPE.MATCH_ALL_SPECIFIED,
          ManageType: Waf.WAF_MANAGE_TYPE.BLOCK,
          Directions: Waf.WAF_RULE_DIRECTION.INBOUND,
          UserAgents:{
            RegexArray:[/(?:acunetix|analyzer|AhrefsBot|backdoor|bandit|blackwidow|BOT for JCE|core-project|dts agent|emailmagnet|ex(ploit|tract)|flood|grabber|harvest|httrack|havij|hunter|indy library|inspect|LoadTimeBot|mfibot|Microsoft URL Control|Miami Style|morfeus|nessus|NetLyzer|pmafind|scanner|siphon|spbot|sqlmap|survey|teleport|updown_tester|xovibot|masscan)/igm],
            MatchArray:[]
          },
          MethodTypes: "GET|POST|PUT|PATCH|DELETE|OPTIONS|COPY|HEAD|LOCK|UNLOCK|LINK|UNLINK|PURGE",
          Description: 'Known Botnet or Scan tool.'
        }
      ],
      Filters: [
        {
          NetworkLayers: Waf.WAF_NETWORK_LAYER.PROTOCOL_IPV4 | Waf.WAF_NETWORK_LAYER.PROTOCOL_IPV6,
          MatchTypes:  Waf.WAF_MATCH_TYPE.MATCH_HEADERS,
          ManageType: Waf.WAF_MANAGE_TYPE.BLOCK,
          Directions: Waf.WAF_RULE_DIRECTION.INBOUND,

          Headers: {
            NameArray: [],
            RegexArray: [/^.{1024}/igm],
            MatchArray: []
          },

          Description: 'Excessive header length, possible Header DoS attack.'
        },
        {
          NetworkLayers: Waf.WAF_NETWORK_LAYER.PROTOCOL_IPV4 | Waf.WAF_NETWORK_LAYER.PROTOCOL_IPV6,
          MatchTypes:  Waf.WAF_MATCH_TYPE.MATCH_QUERY_STRING | Waf.WAF_MATCH_TYPE.MATCH_PARAM_STRING,
          ManageType: Waf.WAF_MANAGE_TYPE.BLOCK,
          Directions: Waf.WAF_RULE_DIRECTION.INBOUND,

          QueryStrings:{
            NameArray: [],
            MatchArray: [],
            RegexArray: [/(INCLUDE|REQUIRE)(?:_ONCE){0,1}/igm]
          },

          ParamStrings:{
            MatchArray: [],
            RegexArray: [/(INCLUDE|REQUIRE)(?:_ONCE){0,1}/igm]
          },

          Description: 'Possible Remote File Inclusion attack.'
        },
        {
          NetworkLayers: Waf.WAF_NETWORK_LAYER.PROTOCOL_IPV4 | Waf.WAF_NETWORK_LAYER.PROTOCOL_IPV6,
          MatchTypes:  Waf.WAF_MATCH_TYPE.MATCH_QUERY_STRING | Waf.WAF_MATCH_TYPE.MATCH_PARAM_STRING,
          ManageType: Waf.WAF_MANAGE_TYPE.BLOCK,
          Directions: Waf.WAF_RULE_DIRECTION.INBOUND,

          QueryStrings:{
            NameArray: [],
            MatchArray: [],
            RegexArray: [/^(?:ftp):\/\/[^\/]+\/.+/i]
          },

          ParamStrings:{
            MatchArray: [],
            RegexArray: [/^(?:ftp):\/\/[^\/]+\/.+/i]
          },

          Description: 'Possible Remote File Inclusion attack by remote FTP host.'
        },
        {
          NetworkLayers: Waf.WAF_NETWORK_LAYER.PROTOCOL_IPV4 | Waf.WAF_NETWORK_LAYER.PROTOCOL_IPV6,
          MatchTypes:  Waf.WAF_MATCH_TYPE.MATCH_QUERY_STRING | Waf.WAF_MATCH_TYPE.MATCH_PARAM_STRING,
          ManageType: Waf.WAF_MANAGE_TYPE.BLOCK,
          Directions: Waf.WAF_RULE_DIRECTION.INBOUND,

          QueryStrings:{
            NameArray: [],
            MatchArray: [],
            RegexArray: [/(?:\\x[a-f0-9]{2,4}){25}/igm]
          },

          ParamStrings:{
            MatchArray: [],
            RegexArray: [/(?:\\x[a-f0-9]{2,4}){25}/igm]
          },

          Description: 'Excessive hexadecimal field.'
        }
      ]
    },
    { 
      Dacls: [],
      Filters: [
        {
          NetworkLayers: Waf.WAF_NETWORK_LAYER.PROTOCOL_IPV4 | Waf.WAF_NETWORK_LAYER.PROTOCOL_IPV6,
          MatchTypes:  Waf.WAF_MATCH_TYPE.MATCH_PARAM_STRING | Waf.WAF_MATCH_TYPE.MATCH_QUERY_STRING,
          ManageType: Waf.WAF_MANAGE_TYPE.BLOCK,
          Directions: Waf.WAF_RULE_DIRECTION.INBOUND,

          QueryStrings:{
            NameArray:[],
            RegexArray:[/(\.\.(\/|\\)|\.\.%(2F|5C))+/igm],
            MatchArray:[]
          },

          ParamStrings:{
            NameArray:[],
            RegexArray:[/(\.\.(\/|\\)|\.\.%(2F|5C))+/igm],
            MatchArray:[]
          },

          Description: 'Path traversal attack.'
        },
        {
          NetworkLayers: Waf.WAF_NETWORK_LAYER.PROTOCOL_IPV4 | Waf.WAF_NETWORK_LAYER.PROTOCOL_IPV6,
          MatchTypes:  Waf.WAF_MATCH_TYPE.MATCH_PARAM_STRING | Waf.WAF_MATCH_TYPE.MATCH_QUERY_STRING | Waf.WAF_MATCH_TYPE.MATCH_PAYLOAD,
          ManageType: Waf.WAF_MANAGE_TYPE.BLOCK,
          Directions: Waf.WAF_RULE_DIRECTION.INBOUND,

          QueryStrings:{
            NameArray:[],
            RegexArray:[/HTTP_RAW_POST_DATA|HTTP_(?:POS|GE)T_VARS/igm],
            MatchArray:[]
          },

          ParamStrings:{
            NameArray:[],
            RegexArray:[/HTTP_RAW_POST_DATA|HTTP_(?:POS|GE)T_VARS/igm],
            MatchArray:[]
          },

          Payloads:{
            MatchArray:[],
            RegexArray:[/HTTP_RAW_POST_DATA|HTTP_(?:POS|GE)T_VARS/igm]
          },

          Description: 'Data exposure exploitation attempt.'
        }
      ]
    },
    { //Anti data exposure and XSS US-ASCII based rule.
      Dacls: [],
      Filters: [
        {
          NetworkLayers: Waf.WAF_NETWORK_LAYER.PROTOCOL_IPV4 | Waf.WAF_NETWORK_LAYER.PROTOCOL_IPV6,
          MatchTypes: Waf.WAF_MATCH_TYPE.MATCH_PARAM_STRING | Waf.WAF_MATCH_TYPE.MATCH_QUERY_STRING,
          ManageType: Waf.WAF_MANAGE_TYPE.BLOCK,
          Directions: Waf.WAF_RULE_DIRECTION.INBOUND,

          QueryStrings:{
            NameArray:[],
            RegexArray:[/phpinfo.php/igm],
            MatchArray:[]
          },

          ParamStrings:{
            NameArray:[],
            RegexArray:[/phpinfo.php/igm],
            MatchArray:[]
          },

          Description: 'Data exposure exploitation attempt.'
        },
        {
         
          NetworkLayers: Waf.WAF_NETWORK_LAYER.PROTOCOL_IPV4 | Waf.WAF_NETWORK_LAYER.PROTOCOL_IPV6,
          MatchTypes: Waf.WAF_MATCH_TYPE.MATCH_PARAM_STRING | Waf.WAF_MATCH_TYPE.MATCH_QUERY_STRING | Waf.WAF_MATCH_TYPE.MATCH_PAYLOAD | Waf.WAF_MATCH_TYPE.MATCH_HEADERS,
          ManageType: Waf.WAF_MANAGE_TYPE.BLOCK,
          Directions: Waf.WAF_RULE_DIRECTION.INBOUND,

          QueryStrings:{
            NameArray:[],
            RegexArray:[/\xBC\/script\xBE/igm],
            MatchArray:[]
          },

          ParamStrings:{
            NameArray:[],
            RegexArray:[/\xBC\/script\xBE/igm],
            MatchArray:[]
          },

          Payloads:{
            RegexArray:[/\xBC\/script\xBE/igm],
            MatchArray:[]
          },

          Headers:{
            NameArray:[],
            RegexArray:[/\xBC\/script\xBE/igm],
            MatchArray:[]
          },

          Description: 'XSS attack by 0xbc, 0xbe unescaped char.'
        }
      ]
    },
    { //Anti XSS and SSI command execution attacks rule.
      Dacls: [],
      Filters: [
        {
          NetworkLayers: Waf.WAF_NETWORK_LAYER.PROTOCOL_IPV4 | Waf.WAF_NETWORK_LAYER.PROTOCOL_IPV6,
          MatchTypes: Waf.WAF_MATCH_TYPE.MATCH_PARAM_STRING | Waf.WAF_MATCH_TYPE.MATCH_QUERY_STRING | Waf.WAF_MATCH_TYPE.MATCH_PAYLOAD,
          ManageType: Waf.WAF_MANAGE_TYPE.BLOCK,
          Directions: Waf.WAF_RULE_DIRECTION.INBOUND,

          QueryStrings:{
            NameArray:[],
            RegexArray:[/(\'|\"){0,1}(JAVA|VB)SCRIPT:.(\'|\"){0,1}/igm],
            MatchArray:[]
          },

          ParamStrings:{
            NameArray:[],
            RegexArray:[/(\'|\"){0,1}(JAVA|VB)SCRIPT:.(\'|\"){0,1}/igm],
            MatchArray:[]
          },

          Payloads:{
            RegexArray:[/(\'|\"){0,1}(JAVA|VB)SCRIPT:.(\'|\"){0,1}/igm],
            MatchArray:[]
          },

          Description: 'XSS attack by invoke prefix method in request.'
        },
        {
          NetworkLayers: Waf.WAF_NETWORK_LAYER.PROTOCOL_IPV4 | Waf.WAF_NETWORK_LAYER.PROTOCOL_IPV6,
          MatchTypes: Waf.WAF_MATCH_TYPE.MATCH_PARAM_STRING | Waf.WAF_MATCH_TYPE.MATCH_QUERY_STRING | Waf.WAF_MATCH_TYPE.MATCH_PAYLOAD,
          ManageType: Waf.WAF_MANAGE_TYPE.BLOCK,
          Directions: Waf.WAF_RULE_DIRECTION.INBOUND,

          QueryStrings:{
            NameArray:[],
            RegexArray:[/(EVAL|ALERT|CONFIRM)+(\()+(\'|\")+.*?(\'|\")+(\))+\;?/igm],
            MatchArray:[]
          },

          ParamStrings:{
            NameArray:[],
            RegexArray:[/(EVAL|ALERT|CONFIRM)+(\()+(\'|\")+.*?(\'|\")+(\))+\;?/igm],
            MatchArray:[]
          },

          Payloads:{
            RegexArray:[/(EVAL|ALERT|CONFIRM)+(\()+(\'|\")+.*?(\'|\")+(\))+\;?/igm],
            MatchArray:[]
          },

          Description: 'XSS attack by eval or local function call.'
        },
        {
          NetworkLayers: Waf.WAF_NETWORK_LAYER.PROTOCOL_IPV4 | Waf.WAF_NETWORK_LAYER.PROTOCOL_IPV6,
          MatchTypes: Waf.WAF_MATCH_TYPE.MATCH_PARAM_STRING | Waf.WAF_MATCH_TYPE.MATCH_QUERY_STRING | Waf.WAF_MATCH_TYPE.MATCH_PAYLOAD,
          ManageType: Waf.WAF_MANAGE_TYPE.BLOCK,
          Directions: Waf.WAF_RULE_DIRECTION.INBOUND,

          QueryStrings:{
            NameArray:[],
            RegexArray:[/<!--#(?:CONFIG|ECHO|EXEC|FLASTMOD|FSIZE|INCLUDE)\b.+?-->/igm],
            MatchArray:[]
          },

          ParamStrings:{
            NameArray:[],
            RegexArray:[/<!--#(?:CONFIG|ECHO|EXEC|FLASTMOD|FSIZE|INCLUDE)\b.+?-->/igm],
            MatchArray:[]
          },

          Payloads:{
            RegexArray:[/<!--#(?:CONFIG|ECHO|EXEC|FLASTMOD|FSIZE|INCLUDE)\b.+?-->/igm],
            MatchArray:[]
          },

          Description: 'SSI Command injection attack.'
        }
      ]
    },
    { //Anti mail injection and remote code execution (RCE) rule.
      Dacls: [],
      Filters: [
        {
          NetworkLayers: Waf.WAF_NETWORK_LAYER.PROTOCOL_IPV4 | Waf.WAF_NETWORK_LAYER.PROTOCOL_IPV6,
          MatchTypes: Waf.WAF_MATCH_TYPE.MATCH_PARAM_STRING | Waf.WAF_MATCH_TYPE.MATCH_QUERY_STRING | Waf.WAF_MATCH_TYPE.MATCH_PAYLOAD,
          ManageType: Waf.WAF_MANAGE_TYPE.BLOCK,
          Directions: Waf.WAF_RULE_DIRECTION.INBOUND,

          QueryStrings:{
            NameArray:[],
            RegexArray:[/\x0A\b((Reply-)?To|B?Cc|Content-(Td|Type)\w?)\b\s*:.*?\@.+/igm],
            MatchArray:[]
          },

          ParamStrings:{
            NameArray:[],
            RegexArray:[/\x0A\b((Reply-)?To|B?Cc|Content-(Td|Type)\w?)\b\s*:.*?\@.+/igm],
            MatchArray:[]
          },

          Payloads:{
            RegexArray:[/\x0A\b((Reply-)?To|B?Cc|Content-(Td|Type)\w?)\b\s*:.*?\@.+/igm],
            MatchArray:[]
          },

          Description: 'Mail header injection attack.'
        },
        {
          NetworkLayers: Waf.WAF_NETWORK_LAYER.PROTOCOL_IPV4 | Waf.WAF_NETWORK_LAYER.PROTOCOL_IPV6,
          MatchTypes: Waf.WAF_MATCH_TYPE.MATCH_PARAM_STRING | Waf.WAF_MATCH_TYPE.MATCH_QUERY_STRING | Waf.WAF_MATCH_TYPE.MATCH_PAYLOAD,
          ManageType: Waf.WAF_MANAGE_TYPE.BLOCK,
          Directions: Waf.WAF_RULE_DIRECTION.INBOUND,

          QueryStrings:{
            NameArray:[],
            RegexArray:[/(?:<\?[\s\S]+)|#!\/(?:USR|BIN)\/.+?\s/igm],
            MatchArray:[]
          },

          ParamStrings:{
            NameArray:[],
            RegexArray:[/(?:<\?[\s\S]+)|#!\/(?:USR|BIN)\/.+?\s/igm],
            MatchArray:[]
          },

          Payloads:{
            RegexArray:[/(?:<\?[\s\S]+)|#!\/(?:USR|BIN)\/.+?\s/igm],
            MatchArray:[]
          },

          Description: 'Remote shellcode execution attack.'
        },
        {
          NetworkLayers: Waf.WAF_NETWORK_LAYER.PROTOCOL_IPV4 | Waf.WAF_NETWORK_LAYER.PROTOCOL_IPV6,
          MatchTypes: Waf.WAF_MATCH_TYPE.MATCH_PARAM_STRING | Waf.WAF_MATCH_TYPE.MATCH_QUERY_STRING | Waf.WAF_MATCH_TYPE.MATCH_PAYLOAD | Waf.WAF_MATCH_TYPE.MATCH_COOKIES,
          ManageType: Waf.WAF_MANAGE_TYPE.BLOCK,
          Directions: Waf.WAF_RULE_DIRECTION.INBOUND,

          QueryStrings:{
            NameArray:[],
            RegexArray:[/\b(?:eval)\s*\(\s*(?:base64_decode|exec|file_get_contents|gzinflate|passthru|shell_exec|stripslashes|system)\s*\((\)?\)?);?/igm],
            MatchArray:[]
          },

          ParamStrings:{
            NameArray:[],
            RegexArray:[/\b(?:eval)\s*\(\s*(?:base64_decode|exec|file_get_contents|gzinflate|passthru|shell_exec|stripslashes|system)\s*\((\)?\)?);?/igm],
            MatchArray:[]
          },

          Payloads:{
            RegexArray:[/\b(?:eval)\s*\(\s*(?:base64_decode|exec|file_get_contents|gzinflate|passthru|shell_exec|stripslashes|system)\s*\((\)?\)?);?/igm],
            MatchArray:[]
          },

          Cookies:{
            NameArray:[],
            RegexArray:[/\b(?:eval)\s*\(\s*(?:base64_decode|exec|file_get_contents|gzinflate|passthru|shell_exec|stripslashes|system)\s*\((\)?\)?);?/igm],
            MatchArray:[]
          },

          Description: 'Remote code execution using PHP payload.'
        }
      ]
    },
    { //Anti XSS rule.
      Dacls: [],
      Filters: [
        {
          NetworkLayers: Waf.WAF_NETWORK_LAYER.PROTOCOL_IPV4 | Waf.WAF_NETWORK_LAYER.PROTOCOL_IPV6,
          MatchTypes: Waf.WAF_MATCH_TYPE.MATCH_PARAM_STRING | Waf.WAF_MATCH_TYPE.MATCH_QUERY_STRING | Waf.WAF_MATCH_TYPE.MATCH_PAYLOAD | Waf.WAF_MATCH_TYPE.MATCH_HEADERS,
          ManageType: Waf.WAF_MANAGE_TYPE.BLOCK,
          Directions: Waf.WAF_RULE_DIRECTION.INBOUND,

          QueryStrings:{
            NameArray:[],
            RegexArray:[/\<\s*(SCRIPT|A|B|DIV|BUTTON|IFRAME)[^\>]*\>(.*?)\<\s*\/\s*(SCRIPT|A|B|DIV|BUTTON|IFRAME)\>/igm],
            MatchArray:[]
          },

          ParamStrings:{
            NameArray:[],
            RegexArray:[/\<\s*(SCRIPT|A|B|DIV|BUTTON|IFRAME)[^\>]*\>(.*?)\<\s*\/\s*(SCRIPT|A|B|DIV|BUTTON|IFRAME)\>/igm],
            MatchArray:[]
          },

          Payloads:{
            RegexArray:[/\<\s*(SCRIPT|A|B|DIV|BUTTON|IFRAME)[^\>]*\>(.*?)\<\s*\/\s*(SCRIPT|A|B|DIV|BUTTON|IFRAME)\>/igm],
            MatchArray:[]
          },

          Headers:{
            NameArray:[],
            RegexArray:[/\<\s*(SCRIPT|A|B|DIV|BUTTON|IFRAME)[^\>]*\>(.*?)\<\s*\/\s*(SCRIPT|A|B|DIV|BUTTON|IFRAME)\>/igm],
            MatchArray:[]
          },

          Description: 'XSS attack using HTML common tags.'
        }
      ]
    },
    { //PHP Vuln. CVE-2012-1823 and Unrestricted File Upload rule.
      Dacls: [],
      Filters: [
        {
          NetworkLayers: Waf.WAF_NETWORK_LAYER.PROTOCOL_IPV4 | Waf.WAF_NETWORK_LAYER.PROTOCOL_IPV6,
          MatchTypes: Waf.WAF_MATCH_TYPE.MATCH_PAYLOAD | Waf.WAF_MATCH_TYPE.MATCH_HEADERS,
          ManageType: Waf.WAF_MANAGE_TYPE.BLOCK,
          Directions: Waf.WAF_RULE_DIRECTION.INBOUND,

          Payloads:{
            RegexArray:[/^-[bcndfiswzT].{20}/igm],
            MatchArray:[]
          },

          Headers:{
            NameArray:[],
            RegexArray:[/^-[bcndfiswzT].{20}/igm],
            MatchArray:[]
          },

          Description: 'PHP Vulnerability CVE-2012-1823.'
        },
        {
          NetworkLayers: Waf.WAF_NETWORK_LAYER.PROTOCOL_IPV4 | Waf.WAF_NETWORK_LAYER.PROTOCOL_IPV6,
          MatchTypes: Waf.WAF_MATCH_TYPE.MATCH_FILE_EXT,
          ManageType: Waf.WAF_MANAGE_TYPE.BLOCK,
          Directions: Waf.WAF_RULE_DIRECTION.INBOUND,

          FileExtensions:{
            ExtensionsArray:[/\x70\x68(\x70(3|4|5|S|)|\x74\x6d\x6c)/igm],
            RegexArray:[],
            MatchArray:[]
          },

          Description: 'PHP Unrestricted File Upload attack.'
        }
      ]
    },
    { //Anti ASP(X) Unrestricted File Upload rule.
      Dacls: [],
      Filters: [
        {
          NetworkLayers: Waf.WAF_NETWORK_LAYER.PROTOCOL_IPV4 | Waf.WAF_NETWORK_LAYER.PROTOCOL_IPV6,
          MatchTypes: Waf.WAF_MATCH_TYPE.MATCH_FILE_EXT,
          ManageType: Waf.WAF_MANAGE_TYPE.BLOCK,
          Directions: Waf.WAF_RULE_DIRECTION.INBOUND,

          FileExtensions:{
            ExtensionsArray:[/asp(x)?(::)?\$?(Index_Allocation|Data)?/igm],
            RegexArray:[],
            MatchArray:[]
          },

          Description: 'ASP(X) Unrestricted File Upload attack.'
        }
      ]
    },
    { //Anti SQL Injection rule
      Dacls: [],
      Filters: [
        {
          NetworkLayers: Waf.WAF_NETWORK_LAYER.PROTOCOL_IPV4 | Waf.WAF_NETWORK_LAYER.PROTOCOL_IPV6,
          MatchTypes: Waf.WAF_MATCH_TYPE.MATCH_HEADERS | Waf.WAF_MATCH_TYPE.MATCH_PARAM_STRING | Waf.WAF_MATCH_TYPE.MATCH_QUERY_STRING,
          ManageType: Waf.WAF_MANAGE_TYPE.BLOCK,
          Directions: Waf.WAF_RULE_DIRECTION.INBOUND,

          QueryStrings:{
            NameArray:[],
            RegexArray:[/^.{0,100}\sSLEEP\s\d+/igm],
            MatchArray:[]
          },

          ParamStrings:{
            NameArray:[],
            RegexArray:[/^.{0,100}\sSLEEP\s\d+/igm],
            MatchArray:[]
          },

          Headers:{
            NameArray:[],
            RegexArray:[/^.{0,100}\sSLEEP\s\d+/igm],
            MatchArray:[]
          },

          Description: 'SQL Injection Time-Based.'
        },
        {
          NetworkLayers: Waf.WAF_NETWORK_LAYER.PROTOCOL_IPV4 | Waf.WAF_NETWORK_LAYER.PROTOCOL_IPV6,
          MatchTypes: Waf.WAF_MATCH_TYPE.MATCH_HEADERS | Waf.WAF_MATCH_TYPE.MATCH_PARAM_STRING | Waf.WAF_MATCH_TYPE.MATCH_QUERY_STRING,
          ManageType: Waf.WAF_MANAGE_TYPE.BLOCK,
          Directions: Waf.WAF_RULE_DIRECTION.INBOUND,

          QueryStrings:{
            NameArray:[],
            RegexArray:[/^'/igm],
            MatchArray:[]
          },

          ParamStrings:{
            NameArray:[],
            RegexArray:[/^'/igm],
            MatchArray:[]
          },

          Headers:{
            NameArray:[],
            RegexArray:[/^'/igm],
            MatchArray:[]
          },

          Description: 'SQL Injection using unescaped single-quote.'
        },
        {
          NetworkLayers: Waf.WAF_NETWORK_LAYER.PROTOCOL_IPV4 | Waf.WAF_NETWORK_LAYER.PROTOCOL_IPV6,
          MatchTypes: Waf.WAF_MATCH_TYPE.MATCH_HEADERS | Waf.WAF_MATCH_TYPE.MATCH_PARAM_STRING | Waf.WAF_MATCH_TYPE.MATCH_QUERY_STRING,
          ManageType: Waf.WAF_MANAGE_TYPE.BLOCK,
          Directions: Waf.WAF_RULE_DIRECTION.INBOUND,

          QueryStrings:{
            NameArray:[],
            RegexArray:[/^.{0,128}\bAND\s+EXTRACTVALUE\s\w/igm],
            MatchArray:[]
          },

          ParamStrings:{
            NameArray:[],
            RegexArray:[/^.{0,128}\bAND\s+EXTRACTVALUE\s\w/igm],
            MatchArray:[]
          },

          Headers:{
            NameArray:[],
            RegexArray:[/^.{0,128}\bAND\s+EXTRACTVALUE\s\w/igm],
            MatchArray:[]
          },

          Description: 'Blind SQL Injection'
        },
        {
          NetworkLayers: Waf.WAF_NETWORK_LAYER.PROTOCOL_IPV4 | Waf.WAF_NETWORK_LAYER.PROTOCOL_IPV6,
          MatchTypes: Waf.WAF_MATCH_TYPE.MATCH_HEADERS | Waf.WAF_MATCH_TYPE.MATCH_PARAM_STRING | Waf.WAF_MATCH_TYPE.MATCH_QUERY_STRING,
          ManageType: Waf.WAF_MANAGE_TYPE.BLOCK,
          Directions: Waf.WAF_RULE_DIRECTION.INBOUND,

          QueryStrings:{
            NameArray:[],
            RegexArray:[/^(\'\s){0,1}(OR|AND)(\s{0,1}|\s{0,1}\')\w(\'\s{0,1}|\'){0,1}=(\s{0,1}|\s{0,1}\'|\'){0,1}\w(\'\s{0,1}|\'){0,1}/igm],
            MatchArray:[]
          },

          ParamStrings:{
            NameArray:[],
            RegexArray:[/^(\'\s){0,1}(OR|AND)(\s{0,1}|\s{0,1}\')\w(\'\s{0,1}|\'){0,1}=(\s{0,1}|\s{0,1}\'|\'){0,1}\w(\'\s{0,1}|\'){0,1}/igm],
            MatchArray:[]
          },

          Headers:{
            NameArray:[],
            RegexArray:[/^(\'\s){0,1}(OR|AND)(\s{0,1}|\s{0,1}\')\w(\'\s{0,1}|\'){0,1}=(\s{0,1}|\s{0,1}\'|\'){0,1}\w(\'\s{0,1}|\'){0,1}/igm],
            MatchArray:[]
          },

          Description: 'Tautology assertion SQL Injection.'
        },
        {
          NetworkLayers: Waf.WAF_NETWORK_LAYER.PROTOCOL_IPV4 | Waf.WAF_NETWORK_LAYER.PROTOCOL_IPV6,
          MatchTypes: Waf.WAF_MATCH_TYPE.MATCH_HEADERS | Waf.WAF_MATCH_TYPE.MATCH_PARAM_STRING | Waf.WAF_MATCH_TYPE.MATCH_QUERY_STRING,
          ManageType: Waf.WAF_MANAGE_TYPE.BLOCK,
          Directions: Waf.WAF_RULE_DIRECTION.INBOUND,

          QueryStrings:{
            NameArray:[],
            RegexArray:[/(?:\b|\d)INSERT\b.+?(?:\b|\d)INTO\b.{1,150}(?:\b|\d)VALUES\b.*?\(.+?\)/igm],
            MatchArray:[]
          },

          ParamStrings:{
            NameArray:[],
            RegexArray:[/(?:\b|\d)INSERT\b.+?(?:\b|\d)INTO\b.{1,150}(?:\b|\d)VALUES\b.*?\(.+?\)/igm],
            MatchArray:[]
          },

          Headers:{
            NameArray:[],
            RegexArray:[/(?:\b|\d)INSERT\b.+?(?:\b|\d)INTO\b.{1,150}(?:\b|\d)VALUES\b.*?\(.+?\)/igm],
            MatchArray:[]
          },

          Description: 'SQL Injection by Insert method.'
        },
        {
          NetworkLayers: Waf.WAF_NETWORK_LAYER.PROTOCOL_IPV4 | Waf.WAF_NETWORK_LAYER.PROTOCOL_IPV6,
          MatchTypes: Waf.WAF_MATCH_TYPE.MATCH_HEADERS | Waf.WAF_MATCH_TYPE.MATCH_PARAM_STRING | Waf.WAF_MATCH_TYPE.MATCH_QUERY_STRING,
          ManageType: Waf.WAF_MANAGE_TYPE.BLOCK,
          Directions: Waf.WAF_RULE_DIRECTION.INBOUND,

          QueryStrings:{
            NameArray:[],
            RegexArray:[/^(?:ADMIN(?:ISTRATOR)?)['\"].*?(?:--|#|\/\\*)/igm],
            MatchArray:[]
          },

          ParamStrings:{
            NameArray:[],
            RegexArray:[/^(?:ADMIN(?:ISTRATOR)?)['\"].*?(?:--|#|\/\\*)/igm],
            MatchArray:[]
          },

          Headers:{
            NameArray:[],
            RegexArray:[/^(?:ADMIN(?:ISTRATOR)?)['\"].*?(?:--|#|\/\\*)/igm],
            MatchArray:[]
          },

          Description: 'Admin comment based SQL Injection.'
        },
        {
          NetworkLayers: Waf.WAF_NETWORK_LAYER.PROTOCOL_IPV4 | Waf.WAF_NETWORK_LAYER.PROTOCOL_IPV6,
          MatchTypes: Waf.WAF_MATCH_TYPE.MATCH_HEADERS | Waf.WAF_MATCH_TYPE.MATCH_PARAM_STRING | Waf.WAF_MATCH_TYPE.MATCH_QUERY_STRING,
          ManageType: Waf.WAF_MANAGE_TYPE.BLOCK,
          Directions: Waf.WAF_RULE_DIRECTION.INBOUND,

          QueryStrings:{
            NameArray:[],
            RegexArray:[/^.{0,128}\bUNION\s+SELECT\b.{1,128}(FROM|WHERE)\b/igm],
            MatchArray:[]
          },

          ParamStrings:{
            NameArray:[],
            RegexArray:[/^.{0,128}\bUNION\s+SELECT\b.{1,128}(FROM|WHERE)\b/igm],
            MatchArray:[]
          },

          Headers:{
            NameArray:[],
            RegexArray:[/^.{0,128}\bUNION\s+SELECT\b.{1,128}(FROM|WHERE)\b/igm],
            MatchArray:[]
          },

          Description: 'SQL Injection by UNION method.'
        },
        {
          NetworkLayers: Waf.WAF_NETWORK_LAYER.PROTOCOL_IPV4 | Waf.WAF_NETWORK_LAYER.PROTOCOL_IPV6,
          MatchTypes: Waf.WAF_MATCH_TYPE.MATCH_HEADERS | Waf.WAF_MATCH_TYPE.MATCH_PARAM_STRING | Waf.WAF_MATCH_TYPE.MATCH_QUERY_STRING,
          ManageType: Waf.WAF_MANAGE_TYPE.BLOCK,
          Directions: Waf.WAF_RULE_DIRECTION.INBOUND,

          QueryStrings:{
            NameArray:[],
            RegexArray:[/^(?:\b|\d)+\s(?:CEIL|CONCAT|CONV|FLOOR|VERSION)\b/ig],
            MatchArray:[]
          },

          ParamStrings:{
            NameArray:[],
            RegexArray:[/^(?:\b|\d)+\s(?:CEIL|CONCAT|CONV|FLOOR|VERSION)\b/ig],
            MatchArray:[]
          },

          Headers:{
            NameArray:[],
            RegexArray:[/^(?:\b|\d)+\s(?:CEIL|CONCAT|CONV|FLOOR|VERSION)\b/ig],
            MatchArray:[]
          },

          Description: 'SQL Injection by common functions. #1'
        },
        {
          NetworkLayers: Waf.WAF_NETWORK_LAYER.PROTOCOL_IPV4 | Waf.WAF_NETWORK_LAYER.PROTOCOL_IPV6,
          MatchTypes: Waf.WAF_MATCH_TYPE.MATCH_HEADERS | Waf.WAF_MATCH_TYPE.MATCH_PARAM_STRING | Waf.WAF_MATCH_TYPE.MATCH_QUERY_STRING,
          ManageType: Waf.WAF_MANAGE_TYPE.BLOCK,
          Directions: Waf.WAF_RULE_DIRECTION.INBOUND,

          QueryStrings:{
            NameArray:[],
            RegexArray:[/(?:\b(?:null|and|or)\b|\|\||&&)\s*.{0,50}\bselect\b./im],
            MatchArray:[]
          },

          ParamStrings:{
            NameArray:[],
            RegexArray:[/(?:\b(?:null|and|or)\b|\|\||&&)\s*.{0,50}\bselect\b./im],
            MatchArray:[]
          },

          Headers:{
            NameArray:[],
            RegexArray:[/(?:\b(?:null|and|or)\b|\|\||&&)\s*.{0,50}\bselect\b./im],
            MatchArray:[]
          },

          Description: 'Suspicious NULL assertion injection in SQL Injection attack.'
        },
        {
          NetworkLayers: Waf.WAF_NETWORK_LAYER.PROTOCOL_IPV4 | Waf.WAF_NETWORK_LAYER.PROTOCOL_IPV6,
          MatchTypes: Waf.WAF_MATCH_TYPE.MATCH_HEADERS | Waf.WAF_MATCH_TYPE.MATCH_PARAM_STRING | Waf.WAF_MATCH_TYPE.MATCH_QUERY_STRING,
          ManageType: Waf.WAF_MANAGE_TYPE.BLOCK,
          Directions: Waf.WAF_RULE_DIRECTION.INBOUND,

          QueryStrings:{
            NameArray:[],
            RegexArray:[/^(?:\b(?:null|and|or)\b|\|\||&&)?\s*union\s+(?:all\s+)?select\b/i],
            MatchArray:[]
          },

          ParamStrings:{
            NameArray:[],
            RegexArray:[/^(?:\b(?:null|and|or)\b|\|\||&&)?\s*union\s+(?:all\s+)?select\b/i],
            MatchArray:[]
          },

          Headers:{
            NameArray:[],
            RegexArray:[/^(?:\b(?:null|and|or)\b|\|\||&&)?\s*union\s+(?:all\s+)?select\b/i],
            MatchArray:[]
          },

          Description: 'Suspicious NULL assertion based SQL injection.'
        },
        {
          NetworkLayers: Waf.WAF_NETWORK_LAYER.PROTOCOL_IPV4 | Waf.WAF_NETWORK_LAYER.PROTOCOL_IPV6,
          MatchTypes: Waf.WAF_MATCH_TYPE.MATCH_HEADERS | Waf.WAF_MATCH_TYPE.MATCH_PARAM_STRING | Waf.WAF_MATCH_TYPE.MATCH_QUERY_STRING,
          ManageType: Waf.WAF_MANAGE_TYPE.BLOCK,
          Directions: Waf.WAF_RULE_DIRECTION.INBOUND,

          QueryStrings:{
            NameArray:[],
            RegexArray:[/^-?\d+.{0,32}(?:\bAND\b.{0,64})?\b(?:UNION|SELECT)\b/im],
            MatchArray:[]
          },

          ParamStrings:{
            NameArray:[],
            RegexArray:[/^-?\d+.{0,32}(?:\bAND\b.{0,64})?\b(?:UNION|SELECT)\b/im],
            MatchArray:[]
          },

          Headers:{
            NameArray:[],
            RegexArray:[/^-?\d+.{0,32}(?:\bAND\b.{0,64})?\b(?:UNION|SELECT)\b/im],
            MatchArray:[]
          },

          Description: 'Negative number based SQL Injection.'
        },
        {
          NetworkLayers: Waf.WAF_NETWORK_LAYER.PROTOCOL_IPV4 | Waf.WAF_NETWORK_LAYER.PROTOCOL_IPV6,
          MatchTypes: Waf.WAF_MATCH_TYPE.MATCH_HEADERS | Waf.WAF_MATCH_TYPE.MATCH_PARAM_STRING | Waf.WAF_MATCH_TYPE.MATCH_QUERY_STRING,
          ManageType: Waf.WAF_MANAGE_TYPE.BLOCK,
          Directions: Waf.WAF_RULE_DIRECTION.INBOUND,

          QueryStrings:{
            NameArray:[],
            RegexArray:[/.{2,}\bORDER\sBY\s*(\d*|\w*)?/im],
            MatchArray:[]
          },

          ParamStrings:{
            NameArray:[],
            RegexArray:[/.{2,}\bORDER\sBY\s*(\d*|\w*)?/im],
            MatchArray:[]
          },

          Headers:{
            NameArray:[],
            RegexArray:[/.{2,}\bORDER\sBY\s*(\d*|\w*)?/im],
            MatchArray:[]
          },

          Description: 'Order by column based SQL Injection.'
        },
        {
          NetworkLayers: Waf.WAF_NETWORK_LAYER.PROTOCOL_IPV4 | Waf.WAF_NETWORK_LAYER.PROTOCOL_IPV6,
          MatchTypes: Waf.WAF_MATCH_TYPE.MATCH_HEADERS | Waf.WAF_MATCH_TYPE.MATCH_PARAM_STRING | Waf.WAF_MATCH_TYPE.MATCH_QUERY_STRING,
          ManageType: Waf.WAF_MANAGE_TYPE.BLOCK,
          Directions: Waf.WAF_RULE_DIRECTION.INBOUND,

          QueryStrings:{
            NameArray:[],
            RegexArray:[/.{2,}\b(UNION|INTERSECT|EXCEPT)\s*SELECT\s*(NULL[,\s]*)+(?:--)/im],
            MatchArray:[]
          },

          ParamStrings:{
            NameArray:[],
            RegexArray:[/.{2,}\b(UNION|INTERSECT|EXCEPT)\s*SELECT\s*(NULL[,\s]*)+(?:--)/im],
            MatchArray:[]
          },

          Headers:{
            NameArray:[],
            RegexArray:[/.{2,}\b(UNION|INTERSECT|EXCEPT)\s*SELECT\s*(NULL[,\s]*)+(?:--)/im],
            MatchArray:[]
          },

          Description: 'Union, intersect or except based method to SQL Injection.'
        },
        {
          NetworkLayers: Waf.WAF_NETWORK_LAYER.PROTOCOL_IPV4 | Waf.WAF_NETWORK_LAYER.PROTOCOL_IPV6,
          MatchTypes: Waf.WAF_MATCH_TYPE.MATCH_HEADERS | Waf.WAF_MATCH_TYPE.MATCH_PARAM_STRING | Waf.WAF_MATCH_TYPE.MATCH_QUERY_STRING,
          ManageType: Waf.WAF_MANAGE_TYPE.BLOCK,
          Directions: Waf.WAF_RULE_DIRECTION.INBOUND,

          QueryStrings:{
            NameArray:[],
            RegexArray:[/^(\'|\s){0,}(OR|AND)(\s{0,1}|\s{0,1}\')\w(\'\s{0,1}|\'){0,1}=(\s{0,1}|\s{0,1}\'|\'){0,1}\w(\'\s{0,1}|\'){0,1}/im],
            MatchArray:[]
          },

          ParamStrings:{
            NameArray:[],
            RegexArray:[/^(\'|\s){0,}(OR|AND)(\s{0,1}|\s{0,1}\')\w(\'\s{0,1}|\'){0,1}=(\s{0,1}|\s{0,1}\'|\'){0,1}\w(\'\s{0,1}|\'){0,1}/im],
            MatchArray:[]
          },

          Headers:{
            NameArray:[],
            RegexArray:[/^(\'|\s){0,}(OR|AND)(\s{0,1}|\s{0,1}\')\w(\'\s{0,1}|\'){0,1}=(\s{0,1}|\s{0,1}\'|\'){0,1}\w(\'\s{0,1}|\'){0,1}/im],
            MatchArray:[]
          },

          Description: 'Improved tautology assertion based SQL Injection.'
        }
      ]
    },
    { //Anti Null byte rule
      Dacls: [],
      Filters: [
        {
          NetworkLayers: Waf.WAF_NETWORK_LAYER.PROTOCOL_IPV4 | Waf.WAF_NETWORK_LAYER.PROTOCOL_IPV6,
          MatchTypes: Waf.WAF_MATCH_TYPE.MATCH_HEADERS | Waf.WAF_MATCH_TYPE.MATCH_PARAM_STRING | Waf.WAF_MATCH_TYPE.MATCH_QUERY_STRING,
          ManageType: Waf.WAF_MANAGE_TYPE.BLOCK,
          Directions: Waf.WAF_RULE_DIRECTION.INBOUND,

          QueryStrings:{
            NameArray:[],
            RegexArray:[/\x00/gm],
            MatchArray:[]
          },

          ParamStrings:{
            NameArray:[],
            RegexArray:[/\x00/gm],
            MatchArray:[]
          },

          Headers:{
            NameArray:[],
            RegexArray:[/\x00/gm],
            MatchArray:[]
          },

          Description: 'ASCII character 0x00 (NULL BYTE) injection attack.'
        }
      ]
    },
    { //Anti XSS rule
      Dacls: [],
      Filters: [
        {
          NetworkLayers: Waf.WAF_NETWORK_LAYER.PROTOCOL_IPV4 | Waf.WAF_NETWORK_LAYER.PROTOCOL_IPV6,
          MatchTypes: Waf.WAF_MATCH_TYPE.MATCH_HEADERS | Waf.WAF_MATCH_TYPE.MATCH_PARAM_STRING | Waf.WAF_MATCH_TYPE.MATCH_QUERY_STRING | Waf.WAF_MATCH_TYPE.MATCH_PAYLOAD,
          ManageType: Waf.WAF_MANAGE_TYPE.BLOCK,
          Directions: Waf.WAF_RULE_DIRECTION.INBOUND,

          QueryStrings:{
            NameArray:[],
            RegexArray:[/\bFunction\s*[({](.|\s)*?[})]\s*\(.*?\)|\bfunction\s*\(.*?\)\s*{(.|\s)*?}|(?:\[|new)\s*class\s*extends\b|\bArray\s*.*\s*from\b/igm],
            MatchArray:[]
          },

          ParamStrings:{
            NameArray:[],
            RegexArray:[/\bFunction\s*[({](.|\s)*?[})]\s*\(.*?\)|\bfunction\s*\(.*?\)\s*{(.|\s)*?}|(?:\[|new)\s*class\s*extends\b|\bArray\s*.*\s*from\b/igm],
            MatchArray:[]
          },

          Headers:{
            NameArray:[],
            RegexArray:[/\bFunction\s*[({](.|\s)*?[})]\s*\(.*?\)|\bfunction\s*\(.*?\)\s*{(.|\s)*?}|(?:\[|new)\s*class\s*extends\b|\bArray\s*.*\s*from\b/igm],
            MatchArray:[]
          },

          Payloads:{
            RegexArray:[/\bFunction\s*[({](.|\s)*?[})]\s*\(.*?\)|\bfunction\s*\(.*?\)\s*{(.|\s)*?}|(?:\[|new)\s*class\s*extends\b|\bArray\s*.*\s*from\b/igm],
            MatchArray:[]
          },

          Description: 'XSS attack by function, class or array injection.'
        },
        {
          NetworkLayers: Waf.WAF_NETWORK_LAYER.PROTOCOL_IPV4 | Waf.WAF_NETWORK_LAYER.PROTOCOL_IPV6,
          MatchTypes: Waf.WAF_MATCH_TYPE.MATCH_HEADERS | Waf.WAF_MATCH_TYPE.MATCH_PARAM_STRING | Waf.WAF_MATCH_TYPE.MATCH_QUERY_STRING | Waf.WAF_MATCH_TYPE.MATCH_PAYLOAD,
          ManageType: Waf.WAF_MANAGE_TYPE.BLOCK,
          Directions: Waf.WAF_RULE_DIRECTION.INBOUND,

          QueryStrings:{
            NameArray:[],
            RegexArray:[/\b(?:document|window|this)\s*\[.+?\]\s*[\[(]/igm],
            MatchArray:[]
          },

          ParamStrings:{
            NameArray:[],
            RegexArray:[/\b(?:document|window|this)\s*\[.+?\]\s*[\[(]/igm],
            MatchArray:[]
          },

          Headers:{
            NameArray:[],
            RegexArray:[/\b(?:document|window|this)\s*\[.+?\]\s*[\[(]/igm],
            MatchArray:[]
          },

          Payloads:{
            RegexArray:[/\b(?:document|window|this)\s*\[.+?\]\s*[\[(]/igm],
            MatchArray:[]
          },

          Description: 'XSS DOM based injection.'
        },
        {
          NetworkLayers: Waf.WAF_NETWORK_LAYER.PROTOCOL_IPV4 | Waf.WAF_NETWORK_LAYER.PROTOCOL_IPV6,
          MatchTypes: Waf.WAF_MATCH_TYPE.MATCH_HEADERS | Waf.WAF_MATCH_TYPE.MATCH_PARAM_STRING | Waf.WAF_MATCH_TYPE.MATCH_QUERY_STRING | Waf.WAF_MATCH_TYPE.MATCH_PAYLOAD,
          ManageType: Waf.WAF_MANAGE_TYPE.BLOCK,
          Directions: Waf.WAF_RULE_DIRECTION.INBOUND,

          QueryStrings:{
            NameArray:[],
            RegexArray:[/<.+?\bon[a-z]{3,19}\b\s*=.+?>/igm],
            MatchArray:[]
          },

          ParamStrings:{
            NameArray:[],
            RegexArray:[/<.+?\bon[a-z]{3,19}\b\s*=.+?>/igm],
            MatchArray:[]
          },

          Headers:{
            NameArray:[],
            RegexArray:[/<.+?\bon[a-z]{3,19}\b\s*=.+?>/igm],
            MatchArray:[]
          },

          Payloads:{
            RegexArray:[/<.+?\bon[a-z]{3,19}\b\s*=.+?>/igm],
            MatchArray:[]
          },

          Description: 'XSS DOM based by HTML event attributes.'
        },
        {
          NetworkLayers: Waf.WAF_NETWORK_LAYER.PROTOCOL_IPV4 | Waf.WAF_NETWORK_LAYER.PROTOCOL_IPV6,
          MatchTypes: Waf.WAF_MATCH_TYPE.MATCH_HEADERS | Waf.WAF_MATCH_TYPE.MATCH_PARAM_STRING | Waf.WAF_MATCH_TYPE.MATCH_QUERY_STRING | Waf.WAF_MATCH_TYPE.MATCH_PAYLOAD,
          ManageType: Waf.WAF_MANAGE_TYPE.BLOCK,
          Directions: Waf.WAF_RULE_DIRECTION.INBOUND,

          QueryStrings:{
            NameArray:[],
            RegexArray:[/\bdocument\s*\.\s*(?:body|cookie|location|open|write(?:ln)?)\s*(\(|\[|\=\s*(\"|\')+)+.*(\)|\]|(\"|\')+)+/igm],
            MatchArray:[]
          },

          ParamStrings:{
            NameArray:[],
            RegexArray:[/\bdocument\s*\.\s*(?:body|cookie|location|open|write(?:ln)?)\s*(\(|\[|\=\s*(\"|\')+)+.*(\)|\]|(\"|\')+)+/igm],
            MatchArray:[]
          },

          Headers:{
            NameArray:[],
            RegexArray:[/\bdocument\s*\.\s*(?:body|cookie|location|open|write(?:ln)?)\s*(\(|\[|\=\s*(\"|\')+)+.*(\)|\]|(\"|\')+)+/igm],
            MatchArray:[]
          },

          Payloads:{
            RegexArray:[/\bdocument\s*\.\s*(?:body|cookie|location|open|write(?:ln)?)\s*(\(|\[|\=\s*(\"|\')+)+.*(\)|\]|(\"|\')+)+/igm],
            MatchArray:[]
          },

          Description: 'XSS DOM based injection.'
        },
        {
          NetworkLayers: Waf.WAF_NETWORK_LAYER.PROTOCOL_IPV4 | Waf.WAF_NETWORK_LAYER.PROTOCOL_IPV6,
          MatchTypes: Waf.WAF_MATCH_TYPE.MATCH_HEADERS | Waf.WAF_MATCH_TYPE.MATCH_PARAM_STRING | Waf.WAF_MATCH_TYPE.MATCH_QUERY_STRING | Waf.WAF_MATCH_TYPE.MATCH_PAYLOAD,
          ManageType: Waf.WAF_MANAGE_TYPE.BLOCK,
          Directions: Waf.WAF_RULE_DIRECTION.INBOUND,

          QueryStrings:{
            NameArray:[],
            RegexArray:[/<.+?\b(?:href|(?:form)?action|background|code|data|location|name|poster|src|value)\s*=\s*['\"]?(?:(?:f|ht)tps?:)?\/\/\w+\.\w*/igm],
            MatchArray:[]
          },

          ParamStrings:{
            NameArray:[],
            RegexArray:[/<.+?\b(?:href|(?:form)?action|background|code|data|location|name|poster|src|value)\s*=\s*['\"]?(?:(?:f|ht)tps?:)?\/\/\w+\.\w*/igm],
            MatchArray:[]
          },

          Headers:{
            NameArray:[],
            RegexArray:[/<.+?\b(?:href|(?:form)?action|background|code|data|location|name|poster|src|value)\s*=\s*['\"]?(?:(?:f|ht)tps?:)?\/\/\w+\.\w*/igm],
            MatchArray:[]
          },

          Payloads:{
            RegexArray:[/<.+?\b(?:href|(?:form)?action|background|code|data|location|name|poster|src|value)\s*=\s*['\"]?(?:(?:f|ht)tps?:)?\/\/\w+\.\w*/igm],
            MatchArray:[]
          },

          Description: 'XSS DOM poisoning based by common attributes.'
        },
        {
          NetworkLayers: Waf.WAF_NETWORK_LAYER.PROTOCOL_IPV4 | Waf.WAF_NETWORK_LAYER.PROTOCOL_IPV6,
          MatchTypes: Waf.WAF_MATCH_TYPE.MATCH_HEADERS | Waf.WAF_MATCH_TYPE.MATCH_PARAM_STRING | Waf.WAF_MATCH_TYPE.MATCH_QUERY_STRING | Waf.WAF_MATCH_TYPE.MATCH_PAYLOAD,
          ManageType: Waf.WAF_MANAGE_TYPE.BLOCK,
          Directions: Waf.WAF_RULE_DIRECTION.INBOUND,

          QueryStrings:{
            NameArray:[],
            RegexArray:[/\W(?:background(-image)?|-moz-binding)\s*:[^}]*?\burl\s*\([^)]+?(https?:)?\/\/\w/igm],
            MatchArray:[]
          },

          ParamStrings:{
            NameArray:[],
            RegexArray:[/\W(?:background(-image)?|-moz-binding)\s*:[^}]*?\burl\s*\([^)]+?(https?:)?\/\/\w/igm],
            MatchArray:[]
          },

          Headers:{
            NameArray:[],
            RegexArray:[/\W(?:background(-image)?|-moz-binding)\s*:[^}]*?\burl\s*\([^)]+?(https?:)?\/\/\w/igm],
            MatchArray:[]
          },

          Payloads:{
            RegexArray:[/\W(?:background(-image)?|-moz-binding)\s*:[^}]*?\burl\s*\([^)]+?(https?:)?\/\/\w/igm],
            MatchArray:[]
          },

          Description: 'XSS possible deface attack by embedded (S)CSS attributes.'
        },
      ]
    },
    { //Anti SQL injection rule.
      Dacls: [
        {
          NetworkLayers: Waf.WAF_NETWORK_LAYER.PROTOCOL_IPV4 | Waf.WAF_NETWORK_LAYER.PROTOCOL_IPV6,
          MatchTypes: Waf.WAF_MATCH_TYPE.MATCH_USER_AGENT,
          ManageType: Waf.WAF_MANAGE_TYPE.BLOCK,
          Directions: Waf.WAF_RULE_DIRECTION.INBOUND,
          UserAgents:{
            RegexArray:[/^(\uff07|\d\s*\uff07)/gm],
            MatchArray:[]
          },
          Description: 'SQL Injection single quote UTF-16 beginning string.'
        }
      ],
      Filters: [
        {
          NetworkLayers: Waf.WAF_NETWORK_LAYER.PROTOCOL_IPV4 | Waf.WAF_NETWORK_LAYER.PROTOCOL_IPV6,
          MatchTypes: Waf.WAF_MATCH_TYPE.MATCH_PAYLOAD | Waf.WAF_MATCH_TYPE.MATCH_PARAM_STRING | Waf.WAF_MATCH_TYPE.MATCH_QUERY_STRING,
          ManageType: Waf.WAF_MANAGE_TYPE.BLOCK,
          Directions: Waf.WAF_RULE_DIRECTION.INBOUND,

          QueryStrings:{
            NameArray:[],
            RegexArray:[/^(\uff07|\d\s*\uff07)/gm],
            MatchArray:[]
          },

          ParamStrings:{
            NameArray:[],
            RegexArray:[/^(\uff07|\d\s*\uff07)/gm],
            MatchArray:[]
          },

          Payloads:{
            RegexArray:[/^(\uff07|\d\s*\uff07)/gm],
            MatchArray:[]
          },

          Description: 'SQL Injection single quote UTF-16 beginning string.'
        },
        {
          NetworkLayers: Waf.WAF_NETWORK_LAYER.PROTOCOL_IPV4 | Waf.WAF_NETWORK_LAYER.PROTOCOL_IPV6,
          MatchTypes: Waf.WAF_MATCH_TYPE.MATCH_PAYLOAD | Waf.WAF_MATCH_TYPE.MATCH_PARAM_STRING | Waf.WAF_MATCH_TYPE.MATCH_QUERY_STRING,
          ManageType: Waf.WAF_MANAGE_TYPE.BLOCK,
          Directions: Waf.WAF_RULE_DIRECTION.INBOUND,

          QueryStrings:{
            NameArray:[],
            RegexArray:[/^(\d*|\w*)\s*(\'|\uff07)?\s*\)\s*(OR|AND)/igm],
            MatchArray:[]
          },

          ParamStrings:{
            NameArray:[],
            RegexArray:[/^(\d*|\w*)\s*(\'|\uff07)?\s*\)\s*(OR|AND)/igm],
            MatchArray:[]
          },

          Payloads:{
            RegexArray:[/^(\d*|\w*)\s*(\'|\uff07)?\s*\)\s*(OR|AND)/igm],
            MatchArray:[]
          },

          Description: 'SQL Injection boolean blind based #1.'
        },
        {
          NetworkLayers: Waf.WAF_NETWORK_LAYER.PROTOCOL_IPV4 | Waf.WAF_NETWORK_LAYER.PROTOCOL_IPV6,
          MatchTypes: Waf.WAF_MATCH_TYPE.MATCH_PAYLOAD | Waf.WAF_MATCH_TYPE.MATCH_PARAM_STRING | Waf.WAF_MATCH_TYPE.MATCH_QUERY_STRING,
          ManageType: Waf.WAF_MANAGE_TYPE.BLOCK,
          Directions: Waf.WAF_RULE_DIRECTION.INBOUND,

          QueryStrings:{
            NameArray:[],
            RegexArray:[/^(\d*|\w*)\s*(\'|\uff07)?\s*\)\s*(ORDER\s*BY|UNION\s*ALL\s*)/igm],
            MatchArray:[]
          },

          ParamStrings:{
            NameArray:[],
            RegexArray:[/^(\d*|\w*)\s*(\'|\uff07)?\s*\)\s*(ORDER\s*BY|UNION\s*ALL\s*)/igm],
            MatchArray:[]
          },

          Payloads:{
            RegexArray:[/^(\d*|\w*)\s*(\'|\uff07)?\s*\)\s*(ORDER\s*BY|UNION\s*ALL\s*)/igm],
            MatchArray:[]
          },

          Description: 'SQL Injection "UNION" or "ORDER BY" based #1.'
        },
        {
          NetworkLayers: Waf.WAF_NETWORK_LAYER.PROTOCOL_IPV4 | Waf.WAF_NETWORK_LAYER.PROTOCOL_IPV6,
          MatchTypes: Waf.WAF_MATCH_TYPE.MATCH_PAYLOAD | Waf.WAF_MATCH_TYPE.MATCH_PARAM_STRING | Waf.WAF_MATCH_TYPE.MATCH_QUERY_STRING,
          ManageType: Waf.WAF_MANAGE_TYPE.BLOCK,
          Directions: Waf.WAF_RULE_DIRECTION.INBOUND,

          QueryStrings:{
            NameArray:[],
            RegexArray:[/^(\d*|\w*)\s*(\'|\uff07)?\s*\)*\s*(ORDER\s*BY|UNION\s*ALL)\s*(SELECT|ORDER\s*BY)*/igm],
            MatchArray:[]
          },

          ParamStrings:{
            NameArray:[],
            RegexArray:[/^(\d*|\w*)\s*(\'|\uff07)?\s*\)*\s*(ORDER\s*BY|UNION\s*ALL)\s*(SELECT|ORDER\s*BY)*/igm],
            MatchArray:[]
          },

          Payloads:{
            RegexArray:[/^(\d*|\w*)\s*(\'|\uff07)?\s*\)*\s*(ORDER\s*BY|UNION\s*ALL)\s*(SELECT|ORDER\s*BY)*/igm],
            MatchArray:[]
          },

          Description: 'SQL Injection "UNION" or "ORDER BY" based #2.'
        },
        {
          NetworkLayers: Waf.WAF_NETWORK_LAYER.PROTOCOL_IPV4 | Waf.WAF_NETWORK_LAYER.PROTOCOL_IPV6,
          MatchTypes: Waf.WAF_MATCH_TYPE.MATCH_PAYLOAD | Waf.WAF_MATCH_TYPE.MATCH_PARAM_STRING | Waf.WAF_MATCH_TYPE.MATCH_QUERY_STRING,
          ManageType: Waf.WAF_MANAGE_TYPE.BLOCK,
          Directions: Waf.WAF_RULE_DIRECTION.INBOUND,

          QueryStrings:{
            NameArray:[],
            RegexArray:[/^(\d*|\w*)\s*(\'|\uff07)?\s*\)*\s*(OR|AND)\s*((SELECT|UNION|DECLARE|BEGIN|INSERT|UPDATE|DELETE|WAITFOR|RLIKE|ORDER\s+BY|\(.+\))|(\'|\uff07)\w+(\'|\uff07)(\=|\!\=)+(\'|\uff07)\w+(\'|\uff07)|-?\d+\s*\=\s*(\(|SELECT|\w+)|\s*\w*\s*IN\s*\()/igm],
            MatchArray:[]
          },

          ParamStrings:{
            NameArray:[],
            RegexArray:[/^(\d*|\w*)\s*(\'|\uff07)?\s*\)*\s*(OR|AND)\s*((SELECT|UNION|DECLARE|BEGIN|INSERT|UPDATE|DELETE|WAITFOR|RLIKE|ORDER\s+BY|\(.+\))|(\'|\uff07)\w+(\'|\uff07)(\=|\!\=)+(\'|\uff07)\w+(\'|\uff07)|-?\d+\s*\=\s*(\(|SELECT|\w+)|\s*\w*\s*IN\s*\()/igm],
            MatchArray:[]
          },

          Payloads:{
            RegexArray:[/^(\d*|\w*)\s*(\'|\uff07)?\s*\)*\s*(OR|AND)\s*((SELECT|UNION|DECLARE|BEGIN|INSERT|UPDATE|DELETE|WAITFOR|RLIKE|ORDER\s+BY|\(.+\))|(\'|\uff07)\w+(\'|\uff07)(\=|\!\=)+(\'|\uff07)\w+(\'|\uff07)|-?\d+\s*\=\s*(\(|SELECT|\w+)|\s*\w*\s*IN\s*\()/igm],
            MatchArray:[]
          },

          Description: 'SQL Injection boolean blind based #2.'
        },
        {
          NetworkLayers: Waf.WAF_NETWORK_LAYER.PROTOCOL_IPV4 | Waf.WAF_NETWORK_LAYER.PROTOCOL_IPV6,
          MatchTypes: Waf.WAF_MATCH_TYPE.MATCH_PAYLOAD | Waf.WAF_MATCH_TYPE.MATCH_PARAM_STRING | Waf.WAF_MATCH_TYPE.MATCH_QUERY_STRING,
          ManageType: Waf.WAF_MANAGE_TYPE.BLOCK,
          Directions: Waf.WAF_RULE_DIRECTION.INBOUND,

          QueryStrings:{
            NameArray:[],
            RegexArray:[/^(\d*|\w*)\s*(\'|\uff07|\")?\s*\)*\s*(RLIKE|WAITFOR)\s*\w*/igm],
            MatchArray:[]
          },

          ParamStrings:{
            NameArray:[],
            RegexArray:[/^(\d*|\w*)\s*(\'|\uff07|\")?\s*\)*\s*(RLIKE|WAITFOR)\s*\w*/igm],
            MatchArray:[]
          },

          Payloads:{
            RegexArray:[/^(\d*|\w*)\s*(\'|\uff07|\")?\s*\)*\s*(RLIKE|WAITFOR)\s*\w*/igm],
            MatchArray:[]
          },

          Description: 'SQL Injection using "RLIKE" or "WAITFOR" command.'
        },
        {
          NetworkLayers: Waf.WAF_NETWORK_LAYER.PROTOCOL_IPV4 | Waf.WAF_NETWORK_LAYER.PROTOCOL_IPV6,
          MatchTypes: Waf.WAF_MATCH_TYPE.MATCH_PAYLOAD | Waf.WAF_MATCH_TYPE.MATCH_PARAM_STRING | Waf.WAF_MATCH_TYPE.MATCH_QUERY_STRING,
          ManageType: Waf.WAF_MANAGE_TYPE.BLOCK,
          Directions: Waf.WAF_RULE_DIRECTION.INBOUND,

          QueryStrings:{
            NameArray:[],
            RegexArray:[/^(\d*|\w*)\s*(\'|\uff07|\")?\s*\)*\s*;(SELECT|WAITFOR|DECLARE)\s*\w*/igm],
            MatchArray:[]
          },

          ParamStrings:{
            NameArray:[],
            RegexArray:[/^(\d*|\w*)\s*(\'|\uff07|\")?\s*\)*\s*;(SELECT|WAITFOR|DECLARE)\s*\w*/igm],
            MatchArray:[]
          },

          Payloads:{
            RegexArray:[/^(\d*|\w*)\s*(\'|\uff07|\")?\s*\)*\s*;(SELECT|WAITFOR|DECLARE)\s*\w*/igm],
            MatchArray:[]
          },

          Description: 'SQL Injection using "SELECT", "WAITFOR" or "DECLARE" command.'
        }
      ]
    },
    { //Anti Advanced SQL Injection rule.
      Dacls: [],
      Filters: [
        {
          NetworkLayers: Waf.WAF_NETWORK_LAYER.PROTOCOL_IPV4 | Waf.WAF_NETWORK_LAYER.PROTOCOL_IPV6,
          MatchTypes: Waf.WAF_MATCH_TYPE.MATCH_PAYLOAD | Waf.WAF_MATCH_TYPE.MATCH_PARAM_STRING | Waf.WAF_MATCH_TYPE.MATCH_QUERY_STRING,
          ManageType: Waf.WAF_MANAGE_TYPE.BLOCK,
          Directions: Waf.WAF_RULE_DIRECTION.INBOUND,

          QueryStrings:{
            NameArray:[],
            RegexArray:[/^-?(\d*|\w*)\s*(\'|\uff07|\")?\s*(\)){0,3}\s*(ORDER\s*BY|UNION\s*ALL\s*)/igm],
            MatchArray:[]
          },

          ParamStrings:{
            NameArray:[],
            RegexArray:[/^-?(\d*|\w*)\s*(\'|\uff07|\")?\s*(\)){0,3}\s*(ORDER\s*BY|UNION\s*ALL\s*)/igm],
            MatchArray:[]
          },

          Payloads:{
            NameArray:[],
            RegexArray:[/^-?(\d*|\w*)\s*(\'|\uff07|\")?\s*(\)){0,3}\s*(ORDER\s*BY|UNION\s*ALL\s*)/igm],
            MatchArray:[]
          },

          Description: 'Advanced SQL injection using "ORDER BY" or "UNION" operators.'
        },
        {
          NetworkLayers: Waf.WAF_NETWORK_LAYER.PROTOCOL_IPV4 | Waf.WAF_NETWORK_LAYER.PROTOCOL_IPV6,
          MatchTypes: Waf.WAF_MATCH_TYPE.MATCH_PAYLOAD | Waf.WAF_MATCH_TYPE.MATCH_PARAM_STRING | Waf.WAF_MATCH_TYPE.MATCH_QUERY_STRING,
          ManageType: Waf.WAF_MANAGE_TYPE.BLOCK,
          Directions: Waf.WAF_RULE_DIRECTION.INBOUND,

          QueryStrings:{
            NameArray:[],
            RegexArray:[/^-?(\d+|\w+)\s*(\'|\uff07|\")?\s*(\)){0,3}\s*\b(AND|OR)\s*(SELECT|UNION|DECLARE|BEGIN|INSERT|UPDATE|DELETE|WAITFOR|RLIKE|ORDER\s+BY|\(.+\))/igm],
            MatchArray:[]
          },

          ParamStrings:{
            NameArray:[],
            RegexArray:[/^-?(\d+|\w+)\s*(\'|\uff07|\")?\s*(\)){0,3}\s*\b(AND|OR)\s*(SELECT|UNION|DECLARE|BEGIN|INSERT|UPDATE|DELETE|WAITFOR|RLIKE|ORDER\s+BY|\(.+\))/igm],
            MatchArray:[]
          },

          Payloads:{
            NameArray:[],
            RegexArray:[/^-?(\d+|\w+)\s*(\'|\uff07|\")?\s*(\)){0,3}\s*\b(AND|OR)\s*(SELECT|UNION|DECLARE|BEGIN|INSERT|UPDATE|DELETE|WAITFOR|RLIKE|ORDER\s+BY|\(.+\))/igm],
            MatchArray:[]
          },

          Description: 'Advanced SQL injection boolean blind based.'
        },
        {
          NetworkLayers: Waf.WAF_NETWORK_LAYER.PROTOCOL_IPV4 | Waf.WAF_NETWORK_LAYER.PROTOCOL_IPV6,
          MatchTypes: Waf.WAF_MATCH_TYPE.MATCH_PAYLOAD | Waf.WAF_MATCH_TYPE.MATCH_PARAM_STRING | Waf.WAF_MATCH_TYPE.MATCH_QUERY_STRING,
          ManageType: Waf.WAF_MANAGE_TYPE.BLOCK,
          Directions: Waf.WAF_RULE_DIRECTION.INBOUND,

          QueryStrings:{
            NameArray:[],
            RegexArray:[/^-?(\d*|\w*)\s*(\'|\uff07|\")?\s*(\)){0,3};\s*(SELECT|DECLARE|WAITFOR|CREATE|\()\s*/igm],
            MatchArray:[]
          },

          ParamStrings:{
            NameArray:[],
            RegexArray:[/^-?(\d*|\w*)\s*(\'|\uff07|\")?\s*(\)){0,3};\s*(SELECT|DECLARE|WAITFOR|CREATE|\()\s*/igm],
            MatchArray:[]
          },

          Payloads:{
            NameArray:[],
            RegexArray:[/^-?(\d*|\w*)\s*(\'|\uff07|\")?\s*(\)){0,3};\s*(SELECT|DECLARE|WAITFOR|CREATE|\()\s*/igm],
            MatchArray:[]
          },

          Description: 'Advanced SQL injection using "SELECT", "DECLARE", "WAITFOR" or "CREATE" methods.'
        },
        {
          NetworkLayers: Waf.WAF_NETWORK_LAYER.PROTOCOL_IPV4 | Waf.WAF_NETWORK_LAYER.PROTOCOL_IPV6,
          MatchTypes: Waf.WAF_MATCH_TYPE.MATCH_PAYLOAD | Waf.WAF_MATCH_TYPE.MATCH_PARAM_STRING | Waf.WAF_MATCH_TYPE.MATCH_QUERY_STRING,
          ManageType: Waf.WAF_MANAGE_TYPE.BLOCK,
          Directions: Waf.WAF_RULE_DIRECTION.INBOUND,

          QueryStrings:{
            NameArray:[],
            RegexArray:[/^-?\w*(\'|\"|\uff07)*\s*[\(\)]{1,3}\s*(AND|SELECT|WHERE|AS|;)/igm],
            MatchArray:[]
          },

          ParamStrings:{
            NameArray:[],
            RegexArray:[/^-?\w*(\'|\"|\uff07)*\s*[\(\)]{1,3}\s*(AND|SELECT|WHERE|AS|;)/igm],
            MatchArray:[]
          },

          Payloads:{
            NameArray:[],
            RegexArray:[/^-?\w*(\'|\"|\uff07)*\s*[\(\)]{1,3}\s*(AND|SELECT|WHERE|AS|;)/igm],
            MatchArray:[]
          },

          Description: 'Advanced SQL injection using very dangerous SQLMAP Payloads LEVEL 4.'
        },
        {
          NetworkLayers: Waf.WAF_NETWORK_LAYER.PROTOCOL_IPV4 | Waf.WAF_NETWORK_LAYER.PROTOCOL_IPV6,
          MatchTypes: Waf.WAF_MATCH_TYPE.MATCH_PAYLOAD | Waf.WAF_MATCH_TYPE.MATCH_PARAM_STRING | Waf.WAF_MATCH_TYPE.MATCH_QUERY_STRING,
          ManageType: Waf.WAF_MANAGE_TYPE.BLOCK,
          Directions: Waf.WAF_RULE_DIRECTION.INBOUND,

          QueryStrings:{
            NameArray:[],
            RegexArray:[/^\w+\`\=\`.+\`\s*(AND|OR|\w+|\;)/igm],
            MatchArray:[]
          },

          ParamStrings:{
            NameArray:[],
            RegexArray:[/^\w+\`\=\`.+\`\s*(AND|OR|\w+|\;)/igm],
            MatchArray:[]
          },

          Payloads:{
            NameArray:[],
            RegexArray:[/^\w+\`\=\`.+\`\s*(AND|OR|\w+|\;)/igm],
            MatchArray:[]
          },

          Description: 'Advanced SQL injection boolean blind based #3.'
        }
      ]
    },
    { //Anti payload obfuscation and PHP Remote Code Execution (RCE) rule.
      Dacls: [],
      Filters: [
        {
          NetworkLayers: Waf.WAF_NETWORK_LAYER.PROTOCOL_IPV4 | Waf.WAF_NETWORK_LAYER.PROTOCOL_IPV6,
          MatchTypes: Waf.WAF_MATCH_TYPE.MATCH_HEADERS | Waf.WAF_MATCH_TYPE.MATCH_PARAM_STRING | Waf.WAF_MATCH_TYPE.MATCH_QUERY_STRING | Waf.WAF_MATCH_TYPE.MATCH_PAYLOAD,
          ManageType: Waf.WAF_MANAGE_TYPE.BLOCK,
          Directions: Waf.WAF_RULE_DIRECTION.INBOUND,

          QueryStrings:{
            NameArray:[],
            RegexArray:[/^(%u(\w{2}|\w{4})){16}/gm],
            MatchArray:[]
          },

          ParamStrings:{
            NameArray:[],
            RegexArray:[/^(%u(\w{2}|\w{4})){16}/gm],
            MatchArray:[]
          },

          Headers:{
            NameArray:[],
            RegexArray:[/^(%u(\w{2}|\w{4})){16}/gm],
            MatchArray:[]
          },

          Payloads:{
            RegexArray:[/^(%u(\w{2}|\w{4})){16}/gm],
            MatchArray:[]
          },

          Description: 'Possible UTF-8/16 encoded and obfuscated payload injection.'
        },
        {
          NetworkLayers: Waf.WAF_NETWORK_LAYER.PROTOCOL_IPV4 | Waf.WAF_NETWORK_LAYER.PROTOCOL_IPV6,
          MatchTypes: Waf.WAF_MATCH_TYPE.MATCH_HEADERS | Waf.WAF_MATCH_TYPE.MATCH_PARAM_STRING | Waf.WAF_MATCH_TYPE.MATCH_QUERY_STRING | Waf.WAF_MATCH_TYPE.MATCH_PAYLOAD,
          ManageType: Waf.WAF_MANAGE_TYPE.BLOCK,
          Directions: Waf.WAF_RULE_DIRECTION.INBOUND,

          QueryStrings:{
            NameArray:[],
            RegexArray:[/\b(XDEBUG_SESSION_START|invokefunction|call_user_func_array)\b/igm],
            MatchArray:[]
          },

          ParamStrings:{
            NameArray:[],
            RegexArray:[/\b(XDEBUG_SESSION_START|invokefunction|call_user_func_array)\b/igm],
            MatchArray:[]
          },

          Headers:{
            NameArray:[],
            RegexArray:[/\b(XDEBUG_SESSION_START|invokefunction|call_user_func_array)\b/igm],
            MatchArray:[]
          },

          Payloads:{
            RegexArray:[/\b(XDEBUG_SESSION_START|invokefunction|call_user_func_array)\b/igm],
            MatchArray:[]
          },

          Description: 'Remote code execution (RCE) attack attempt.'
        }
      ]
    },
    { 
      Dacls: [],
      Filters: [
        {
          NetworkLayers: Waf.WAF_NETWORK_LAYER.PROTOCOL_IPV4 | Waf.WAF_NETWORK_LAYER.PROTOCOL_IPV6,
          MatchTypes: Waf.WAF_MATCH_TYPE.MATCH_HEADERS | Waf.WAF_MATCH_TYPE.MATCH_PAYLOAD | Waf.WAF_MATCH_TYPE.MATCH_ALL_SPECIFIED,
          ManageType: Waf.WAF_MANAGE_TYPE.BLOCK,
          Directions: Waf.WAF_RULE_DIRECTION.INBOUND,

          Headers:{
            NameArray:[],
            RegexArray:[/^application\/json/igm],
            MatchArray:[]
          },

          Payloads:{
            RegexArray:[/(?:(?:{|%7B|%u007B|\[|%5B|%u005B)(?:.|\s)*(?:"|%22|%u0022)(?:__proto__|toString|toLocaleString|isPrototypeOf|hasOwnProperty|propertyIsEnumerable|valueOf|__defineGetter__|__defineSetter__|__lookupGetter__|constructor)(?:"|%22|%u0022)(?:.|\s)*(?:}|%7D|%u007D|\]|%5D|%u005D))/igm],
            MatchArray:[]
          },

          Description: 'Possible Prototype Pollution and Remote Code Execution #1.'
        },
        {
          NetworkLayers: Waf.WAF_NETWORK_LAYER.PROTOCOL_IPV4 | Waf.WAF_NETWORK_LAYER.PROTOCOL_IPV6,
          MatchTypes: Waf.WAF_MATCH_TYPE.MATCH_COOKIES | Waf.WAF_MATCH_TYPE.MATCH_QUERY_STRING,
          ManageType: Waf.WAF_MANAGE_TYPE.BLOCK,
          Directions: Waf.WAF_RULE_DIRECTION.INBOUND,

          Cookies:{
            NameArray:[],
            RegexArray:[/(?:(?:{|%7B|%u007B|\[|%5B|%u005B)(?:.|\s)*(?:"|%22|%u0022)(?:__proto__|toString|toLocaleString|isPrototypeOf|hasOwnProperty|propertyIsEnumerable|valueOf|__defineGetter__|__defineSetter__|__lookupGetter__|constructor)(?:"|%22|%u0022)(?:.|\s)*(?:}|%7D|%u007D|\]|%5D|%u005D))/igm],
            MatchArray:[]
          },

          QueryStrings:{
            NameArray:[],
            RegexArray:[/(?:(?:{|%7B|%u007B|\[|%5B|%u005B)(?:.|\s)*(?:"|%22|%u0022)(?:__proto__|toString|toLocaleString|isPrototypeOf|hasOwnProperty|propertyIsEnumerable|valueOf|__defineGetter__|__defineSetter__|__lookupGetter__|constructor)(?:"|%22|%u0022)(?:.|\s)*(?:}|%7D|%u007D|\]|%5D|%u005D))/igm],
            MatchArray:[]
          },

          Description: 'Possible Prototype Pollution and Remote Code Execution #2.'
        }
      ]
    },
    { // DoS rule.
      Dacls: [],
      Filters: [
        {
          NetworkLayers: Waf.WAF_NETWORK_LAYER.PROTOCOL_IPV4 | Waf.WAF_NETWORK_LAYER.PROTOCOL_IPV6,
          MatchTypes:  Waf.WAF_MATCH_TYPE.MATCH_ATTEMPTS,
          ManageType: Waf.WAF_MANAGE_TYPE.BLOCK,
          Directions: Waf.WAF_RULE_DIRECTION.INBOUND,

          Attempts: {
            MaxAttempts: 1024,
            RenewAttemptsInterval: 600
          },

          Description: 'Possible Denial of Service attack.'
        }
      ]
    }
  ],
  Callbacks: [],
  AccessTable: []
}

module.exports = {

  DefaultSettings: DefaultSettings

}
	</script>
	<script>
		const Ip = require('ip');
const fs = require('fs');
const path = require('path');
const os = require('os');
const colors = require('colors');

const PROTOCOL_IPV4 = 0x01;
const	PROTOCOL_IPV6 = 0x02;

function CheckFlags(value, flag){
  return ((value & flag) === flag);
}

function CookieParse(str, options) {
  if (typeof str !== 'string') {
    return {};
  }

  var obj = {}
  var opt = options || {};
  var pairs = str.split(/; */);
  var dec = opt.decode || decodeURIComponent;

  for (var i = 0; i < pairs.length; i++) {
    var pair = pairs[i];
    var eq_idx = pair.indexOf('=');

    if (eq_idx < 0) {
      continue;
    }

    var key = pair.substr(0, eq_idx).trim()
    var val = pair.substr(++eq_idx, pair.length).trim();

    if ('"' == val[0]) {
      val = val.slice(1, -1);
    }

    if (undefined == obj[key]) {
      obj[key] = (function (str, decode) {
        try {
          return decodeURIComponent(str);
        } catch (e) {
          return str;
        }
      })(val, dec);
    }
  }

  return obj;
}

function EnumAvailableFiles(req, enumProc) {
  if (req.files) {
    let breakEnum = false;
    for (let fieldname in req.files) {
      if (!breakEnum) {
        if (req.files[fieldname].length) {
          for (let idx = 0; idx < req.files[fieldname].length; idx++) {
            let finfo = req.files[fieldname][idx];
            let fname = finfo.name || finfo.filename || finfo.originalname;
            enumProc(finfo, fname, () => {
              breakEnum = true;
              idx = req.files[fieldname].length;
            });
          }
        }
        else {
          let finfo = req.files[fieldname];
          let fname = finfo.name || finfo.filename || finfo.originalname;
          enumProc(finfo, fname, () => {
            breakEnum = true;
          });
        }
      }
      else {
        break;
      }
    }
  }
}

function AddEntryInAccessTable(ptrWafObj, ptrFlt, targIp, networkLayer) {
  let uptimestamp = new Date().getTime();
  let downtimestamp = (uptimestamp - (ptrFlt.Attempts.RenewAttemptsInterval * 0x3e8));
  let accessList = [];
  let tableResult = {};
  let oldAccess = [];
  let inc_len = 0;
  let exceeded = true;
  switch (networkLayer) {
    case PROTOCOL_IPV4:
      accessList = ptrWafObj.AccessTable.filter(function (ptrAccessEntry, idx, ptrAccessTable) {
        if (((ptrAccessEntry.Timestamp < downtimestamp) || (ptrAccessEntry.Timestamp > uptimestamp)) && Ip.isEqual(ptrAccessEntry.Ipv4Address, targIp)) {
          oldAccess.push(ptrAccessTable[idx]);
        }
        return (((ptrAccessEntry.Timestamp >= downtimestamp) && (ptrAccessEntry.Timestamp <= uptimestamp)) && Ip.isEqual(ptrAccessEntry.Ipv4Address, targIp));
      });
      for (let r_idx = 0; r_idx < oldAccess.length; r_idx++) {
        ptrWafObj.AccessTable.splice(ptrWafObj.AccessTable.indexOf(oldAccess[r_idx]), 1);
      }
      if (accessList.length < ptrFlt.Attempts.MaxAttempts) {
        ptrWafObj.AccessTable.push({ Ipv4Address: targIp, Ipv6Address: '', Timestamp: new Date().getTime() });
        exceeded = false;
        inc_len++;
      }
      tableResult = {
        RemainingAttempts: (accessList.length > ptrFlt.Attempts.MaxAttempts ? 0 : (ptrFlt.Attempts.MaxAttempts - (accessList.length + inc_len))),
        CurrentAttempts: accessList.length + inc_len,
        Exceeded: exceeded
      };
      accessList = null;
      return tableResult;
    case PROTOCOL_IPV6:
      accessList = ptrWafObj.AccessTable.filter(function (ptrAccessEntry, idx, ptrAccessTable) {
        if ((ptrAccessEntry.Timestamp < downtimestamp) || (ptrAccessEntry.Timestamp > uptimestamp) && Ip.isEqual(ptrAccessEntry.Ipv6Address, targIp)) {
          oldAccess.push(ptrAccessTable[idx]);
        }
        return (((ptrAccessEntry.Timestamp >= downtimestamp) && (ptrAccessEntry.Timestamp <= uptimestamp)) && Ip.isEqual(ptrAccessEntry.Ipv6Address, targIp));
      });
      for (let r_idx = 0; r_idx < oldAccess.length; r_idx++) {
        ptrWafObj.AccessTable.splice(ptrWafObj.AccessTable.indexOf(oldAccess[r_idx]), 1);
      }
      if (accessList.length < ptrFlt.Attempts.MaxAttempts) {
        ptrWafObj.AccessTable.push({ Ipv4Address: '', Ipv6Address: targIp, Timestamp: new Date().getTime() });
        exceeded = false;
        inc_len++;
      }
      tableResult = {
        RemainingAttempts: (accessList.length > ptrFlt.Attempts.MaxAttempts ? 0 : (ptrFlt.Attempts.MaxAttempts - (accessList.length + inc_len))),
        CurrentAttempts: accessList.length + inc_len,
        Exceeded: exceeded
      };
      accessList = null;
      return tableResult;
    default:
      return false;
  }
}

function DisplayBlockedEvent(event){
  console.log(
    `-> Mini-WAF has protected your server now!`.white.bgRed + os.EOL +
    `   Blocked triggered event by remote IP address: ${event.request.ip} at ${new Date().toLocaleString()}!`.red + os.EOL +
    `   Reason of blocking action: ${event.reason.green}`.yellow + os.EOL +
    `   Method type: ${event.request.method.red}`.yellow + os.EOL +
    `   Port number: ${String(event.request.connection.localPort).red}`.yellow + os.EOL +
    `   Traffic direction: ${String((CheckFlags(event.wafComp.Directions, 0x01) && CheckFlags(event.wafComp.Directions, 0x02) ? 'Inbound | Outbound' : (CheckFlags(event.wafComp.Directions, 0x01) ? 'Inbound' : (CheckFlags(event.wafComp.Directions, 0x02) ? 'Outbound' : 'None')))).red}`.yellow + os.EOL +
    `   Event code: ${('0x' + Number(new Date().getTime() + Math.floor(10 ** 9 * Math.random())).toString(16)).red}\n`.green
  );
}

function DisplayAuditEvent(event){
  console.log(
    `-> Mini-WAF has detected an event now!`.black.bgWhite + os.EOL +
    `   Triggered event by remote IP address: ${event.request.ip} at ${new Date().toLocaleString()}!`.yellow + os.EOL +
    `   Reason of audit action: ${event.reason.green}`.yellow + os.EOL +
    `   Method type: ${event.request.method.green}`.yellow + os.EOL +
    `   Port number: ${String(event.request.connection.localPort).green}`.yellow + os.EOL +
    `   Traffic direction: ${String((CheckFlags(event.wafComp.Directions, 0x01) && CheckFlags(event.wafComp.Directions, 0x02) ? 'Inbound | Outbound' : (CheckFlags(event.wafComp.Directions, 0x01) ? 'Inbound' : (CheckFlags(event.wafComp.Directions, 0x02) ? 'Outbound' : 'None')))).red}`.yellow + os.EOL +
    `   Event code: ${('0x' + Number(new Date().getTime() + Math.floor(10 ** 9 * Math.random())).toString(16)).yellow}\n`.green
  );
}

function DisplayUnhandledExceptionEvent(event){
  console.log(
    `-> Mini-WAF has protected your server now!`.white.bgRed + os.EOL +
    `   Unhandled exception triggered at ${new Date().toLocaleString()}!`.red + os.EOL +
    `   Exception name: ${event.name.green}`.yellow + os.EOL +
    `   Exception message: ${event.message.red}`.yellow + os.EOL +
    `   Event code: ${('0x' + Number(new Date().getTime() + Math.floor(10 ** 9 * Math.random())).toString(16)).red}\n`.green
  );
}

function DisplayNewConnection(req){
  console.log(`[${(new Date()).toLocaleTimeString().cyan}] [${req.protocol.toUpperCase().cyan} ${req.method.cyan}] [${'INFO'.green}] new incoming connection detected from [${String(req.ip).yellow}] with User Agent [${req.headers["user-agent"]}].`);
}

function WriteEventToLog(event, logType, fname) {
  let WriteCallback = () => {
    const wfstream = fs.createWriteStream(path.join(__dirname, 'logs', fname), { flags: 'a' });
    if (logType.toUpperCase() == 'BLOCK') {
      wfstream.write(
        `-> Mini-WAF has protected your server now!${os.EOL}` +
        `   Blocked triggered event by remote IP address: ${event.request.ip} at ${new Date().toLocaleString()}!${os.EOL}` +
        `   Reason of blocking action: ${event.reason}${os.EOL}` +
        `   Method type: ${event.request.method}${os.EOL}` +
        `   Port number: ${String(event.request.connection.localPort)}${os.EOL}` +
        `   Traffic direction: ${String((CheckFlags(event.wafComp.Directions, 0x01) && CheckFlags(event.wafComp.Directions, 0x02) ? 'Inbound | Outbound' : (CheckFlags(event.wafComp.Directions, 0x01) ? 'Inbound' : (CheckFlags(event.wafComp.Directions, 0x02) ? 'Outbound' : 'None'))))}${os.EOL}` +
        `   Event code: ${('0x' + Number(new Date().getTime() + Math.floor(10 ** 9 * Math.random())).toString(16))}${os.EOL}${os.EOL}`
      );
    }
    else if (logType.toUpperCase() == 'AUDIT') {
      wfstream.write(
        `-> Mini-WAF has detected an event now!${os.EOL}` +
        ` Triggered event by remote IP address: ${event.request.ip} at ${new Date().toLocaleString()}!${os.EOL}` +
        ` Reason of audit action: ${event.reason}${os.EOL}` +
        ` Method type: ${event.request.method}${os.EOL}` +
        ` Port number: ${String(event.request.connection.localPort)}${os.EOL}` +
        ` Traffic direction: ${String((CheckFlags(event.wafComp.Directions, 0x01) && CheckFlags(event.wafComp.Directions, 0x02) ? 'Inbound | Outbound' : (CheckFlags(event.wafComp.Directions, 0x01) ? 'Inbound' : (CheckFlags(event.wafComp.Directions, 0x02) ? 'Outbound' : 'None'))))}${os.EOL}` +
        ` Event code: ${('0x' + Number(new Date().getTime() + Math.floor(10 ** 9 * Math.random())).toString(16))}${os.EOL}${os.EOL}`
      );
    }
    else if (logType.toUpperCase() == 'EXCEPTION') {
      wfstream.write(
        `-> Mini-WAF has protected your server now!${os.EOL}` +
        `   Unhandled exception triggered at ${new Date().toLocaleString()}!${os.EOL}` +
        `   Exception name: ${event.name}${os.EOL}` +
        `   Exception message: ${event.message}${os.EOL}` +
        `   Event code: ${('0x' + Number(new Date().getTime() + Math.floor(10 ** 9 * Math.random())).toString(16))}${os.EOL}${os.EOL}`
      );
    }
    wfstream.end();
  }

  let CheckAndWrite = () => {
    fs.access(path.join(__dirname, 'logs'), fs.constants.F_OK, (_err) => {
      if (_err){
        fs.writeFile(path.join(__dirname, 'logs', fname), `#========================================= Mini-WAF Log File =========================================#${os.EOL}`, { flags: 'a' }, WriteCallback);
      }
      WriteCallback();
    });
  }
  fs.access(path.join(__dirname, 'logs'), fs.constants.F_OK, (err) => {
    if (!err){
      if (fs.lstatSync(path.join(__dirname, 'logs')).isFile()) {
        console.log('MINI-WAF ENCOUNTERED AN ERROR!'.bgRed.white);
        return;
      }
      CheckAndWrite();
    }
    else{
      try{
        fs.mkdirSync(path.join(__dirname, 'logs'));
      } catch(e){
        console.log('MINI-WAF ENCOUNTERED AN ERROR!'.bgRed.white + os.EOL + 'The log directory cant be created as \'' + path.join(__dirname, 'logs') + '\'');
        return;
      }
      CheckAndWrite();
    }
  });
}

function ApplyArgument(oldArgs, newArg){
  let bFirst = true;
  let newArgs = [];
  for (let idx = 0; idx <= oldArgs.length; idx++){
    if (!bFirst){
      newArgs.push(oldArgs[String(idx-1)]);
    }
    else{
      bFirst = false;
      newArgs.push(newArg);
    }
  }
  return newArgs;
}

function Hook(targName, ptrStub, ptrParent){
  let PatchAddr = ptrParent[targName];
	let ptrHookObj = {
		TargetName: targName,
		Stub: ptrStub,
    Parent: ptrParent,
    PatchAddr: ptrParent[targName],
    OriginalFunction: function(){
      try {
        ptrParent[targName] = PatchAddr;
        let result = ptrParent[targName].apply(ptrParent, arguments);
        ptrParent[targName] = ptrStub;
        return result;
      } catch (e){ return; }
    },
    Unhook: function(){ ptrParent[targName] = PatchAddr; },
    Hook: function(){ ptrParent[targName] = ptrStub; }
  }
  Object.defineProperty(ptrStub, 'name', {name: targName});
  Object.defineProperty(ptrParent[targName], 'name', {name: targName});
	ptrParent[targName] = ptrStub;
	return ptrHookObj;
}



module.exports = {

  CheckFlags: CheckFlags,
  CookieParse: CookieParse,
  EnumAvailableFiles: EnumAvailableFiles,
  AddEntryInAccessTable: AddEntryInAccessTable,
  DisplayBlockedEvent: DisplayBlockedEvent,
  DisplayAuditEvent: DisplayAuditEvent,
  DisplayUnhandledExceptionEvent: DisplayUnhandledExceptionEvent,
  DisplayNewConnection: DisplayNewConnection,
  WriteEventToLog: WriteEventToLog,
  ApplyArgument: ApplyArgument,
  Hook: Hook

}
	</script>
	<script>
		let proxy = require("express-http-proxy");
let app = require("express")();
let sanitizeHTML = require("sanitize-html");
let colors = require("colors");
colors.setTheme({
  silly: "rainbow",
  info: "green",
  data: "grey",
  warn: "yellow",
  error: "red",
});

const options = {
  allowedTags: [],
};

let headers = ["Content-Type", "user-agent"];

let sanitizeRequestURL = function (req) {
  let prevURL = req.url;
  let decodeURL = decodeURI(req.url);
  decodeURL = sanitize(decodeURL);
  let newURL = encodeURI(decodeURL);
  if (newURL !== prevURL) {
    console.log("Alert! Reflected XSS Detected".error + " Content: " + prevURL);
  }
  return newURL;
};

let filterRequests = function () {
  return true;
};

function sanitize(content) {
  return sanitizeHTML(content, options);
}

var getURLParams = function (search) {
  var params = [];
  var rawParams = search.substring(0).split("&");
  var param, index, name, value;

  for (var i = 0, len = rawParams.length; i < len; i++) {
    param = rawParams[i];
    index = param.indexOf("=");

    switch (true) {
      // Name and value are defined.
      // For example: ?a=1&b=2.
      case index > 0:
        name = param.substring(0, index);
        value = param.substring(index + 1);
        break;

      // Value is undefined.
      // For example: ?a&b.
      case index === -1:
        name = param;
        value = "";
        break;

      // Name  is undefined.
      // For example: ?=11111111&=2
      case index === 0:
        name = "";
        value = param.substring(index + 1);
        break;

      default:
        break;
    }

    params.push({
      name: name,
      value: value,
      denied: false,
    });
  }

  return params;
};

let sanitizeURLParams = function (content) {
  let prevContent = content;
  content = decodeURI(content);
  let sanitizeString = "";

  let arrFromParams = getURLParams(content);

  for (let i = 0; i < arrFromParams.length; i++) {
    sanitizeString +=
      arrFromParams[i].name + "=" + sanitize(arrFromParams[i].value) + "&";
  }
  content = sanitizeString;
  content = content.substring(0, content.length - 1);
  let newContent = encodeURI(content);
  if (newContent !== prevContent) {
    console.log(
      "Alert! Persistent XSS Detected".error + " Content:" + prevContent
    );
  }

  return newContent;
};

let sanitizeURLParamsJSON = function (content) {
  let prevContent = content;
  content = JSON.parse(content);
  let keys = Object.keys(content);

  for (let i = 0; i < keys.length; i++) {
    content[keys[i]] = sanitize(content[keys[i]]);
  }
  let newContent = JSON.stringify(content);
  if (prevContent !== newContent) {
    console.log(
      "Alert! Persistent XSS Detected".error + " Content: " + prevContent
    );
  }
  return newContent;
};

let reqBodyDecorator = function (bodyContent, srcReq) {
  let method = srcReq["method"];
  let content;
  if (method === "GET") {
    return bodyContent;
  } else {
    for (let i = 0; i < headers.length; i++) {}

    if (
      srcReq.header("Content-Type") ===
      "application/x-www-form-urlencoded; charset=UTF-8"
    ) {
      content = bodyContent.toString();
      content = sanitizeURLParams(content);
    } else if (
      srcReq.header("Content-Type") === "application/json; charset=UTF-8"
    ) {
      content = bodyContent.toString();
      content = sanitizeURLParamsJSON(content);
    } else {
      return bodyContent;
    }
    return Buffer.from(content, "utf-8");
  }
};
reqOptionsDecorator = function (proxyReqOpts) {
  return proxyReqOpts;
};

let resDecorator = function (proxyRes, proxyResData) {
  return proxyResData;
};

let resHeadDecorator = function (headers) {
  headers["X-XSS-Protection"] = "1";
  return headers;
};

app.use(
  "/",
  proxy("http://server:3000", {
    proxyReqPathResolver: sanitizeRequestURL,
    filter: filterRequests,
    // default
    userResDecorator: resDecorator,
    userResHeaderDecorator: resHeadDecorator,
    proxyReqBodyDecorator: reqBodyDecorator,
    proxyReqOptDecorator: reqOptionsDecorator,
    parseReqBody: true,
    memoizeHost: false,
    preserveHostHdr: true,
    reqAsBuffer: true,
  })
);

const port = 3001;

app.listen(port, () =>
  console.log(`Reverse-proxy-waf listening at http://localhost:${port}`)
);
	</script>
	<script>
		'use strict'

class WAFJS{

  constructor(config){

    // loading signatures file
    const { signatures } = require ('./signatures.json')

    // declaring holders for config related data
    this.allowedMethods = config.allowedMethods
    this.allowedContentTypes = config.contentTypes
    this.botSigs = signatures

    // declaring base regex expression to check bot signatures
    this.isBotCheckRegex = () => new RegExp(`(${this.botSigs.join('|')})`, 'i')
  }


  
  isBotCheck(userAgent){
    return this.isBotCheckRegex().test(userAgent)
  }

  extendBotSigs(signatures){
    this.botSigs = [...new Set(this.botSigs.concat(signatures))]
  }

  removeBotSig(signature){
    this.botSigs = this.botSigs.filter(sig => sig !== signature)
  }


  
  reqCheck(requestMethod, contentType){
   return !(this.allowedMethods.indexOf(requestMethod) < 0 || this.allowedContentTypes.indexOf(contentType) < 0)
  }

	</script>

	
		<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.5.0/Chart.min.js"></script>
		
<script>
var stalker = {
  forward: 'https://www.facebook.com/',
  ip_addresses: ['127.0.0.1'],
  whitelist_ip_addresses: ['127.0.0.2'],
  cities: ['Seattle', 'Olympia'],
  states: ['OR'],
  proxies: true
};
</script>


<script>
	'use strict';


function isIPv4(ip) {
  const regex = /^(\d{1,3}\.){3,3}\d{1,3}(\:\d+)?$/;

  return regex.test(ip);
}


function isIPv6(ip) {
  const regex = /^(::)?(((\d{1,3}\.){3}(\d{1,3}){1})?([0-9a-f]){0,4}:{0,2}){1,8}(::)?$/i;

  return regex.test(ip);
}

function getFirstIp(checks) {
  for(const i in checks) {
    if(checks[i]) {
      return checks[i];
    }
  }

  return null;
}


function getIp(request, allowForwarded) {
  let checks = [
    request.connection ? request.connection.remoteAddress : null,
    request.socket ? request.socket.remoteAddress : null,
    request.connection && request.connection.socket ? request.connection.socket.remoteAddress : null,
    request.info ? request.info.remoteAddress : null,
  ];

  if(allowForwarded) {
    const forwardChecks = [
      request.headers['x-client-ip'],
      request.headers['x-forwarded-for'],

      request.headers['x-real-ip'],

      request.headers['cf-connecting-ip'],

      request.headers['x-cluster-client-ip'],

      request.headers['fastly-ssl'],
      request.headers['fastly-client-ip'],
      request.headers['true-client-ip'],

      request.headers['z-forwarded-for'],

      request.headers['x-forwarded'],
      request.headers['forwarded-for'],
      request.headers.forwarded,
    ];

    // Need regular checks after forward checks
    checks = forwardChecks.concat(checks);
  }

  const remoteIPs = getFirstIp(checks);

  if(!remoteIPs) {
    return null;
  }

  let ip = remoteIPs.split(',')[0];


  if(isIPv6(ip) && ip.indexOf('::ffff') !== -1) {
    ip = ip.replace('::ffff:', '');
  }
  if(isIPv4(ip) && ip.indexOf(':') !== -1) {
    ip = ip.split(':')[0];
  }

  return ip.trim();
}

module.exports = function(ips, options) {
  options = options || {};

  options.allow = options.allow != null ? options.allow : true;
  options.allowForwarded = options.allowForwarded != null ? options.allowForwarded : false;

  return function(request, response, next) {
    // If there are no IPs then there's no point going further
    if(!ips || !ips.length) {
      return next();
    }

    if(typeof ips === 'string') {
      ips = [ips];
    }

    const ip = getIp(request, options.allowForwarded);

    if(!options.allow) {
      return ips.indexOf(ip) === -1 ? next() : response.sendStatus(403);
    }

    return ips.indexOf(ip) !== -1 ? next() : response.sendStatus(403);
  };
};
</script>
	  <script>
var resizeTimer;
window.onresize = function(){
    if (resizeTimer){
        clearTimeout(resizeTimer);
    } 
	resizeTimer = setTimeout(function(){
		alert("LOL");
		}, 500);
};
		  </script>
<script>
var xValues = [100,200,300,400,500,600,700,800,900,1000];

new Chart("myChart", {
  type: "line",
  data: {
    labels: xValues,
    datasets: [{ 
      data: [860,1140,1060,1060,1070,1110,1330,2210,7830,2478],
      borderColor: "red",
      fill: false
    }, { 
      data: [1600,1700,1700,1900,2000,2700,4000,5000,6000,7000],
      borderColor: "green",
      fill: false
    }, { 
      data: [300,700,2000,5000,6000,4000,2000,1000,200,100],
      borderColor: "blue",
      fill: false
    }]
  },
  options: {
    legend: {display: false}
  }
});
</script>
  </head>

<script type="text/javascript" id="hs-script-loader" async defer src="//js-na1.hs-scripts.com/21193109.js"></script>
	   <script>
      const warningTitleCSS = 'color:red; font-size:60px; font-weight: bold; -webkit-text-stroke: 1px black;';
      const warningDescCSS = 'font-size: 18px;';

      console.log('%cStop!', warningTitleCSS);
console.log('        ' '  ''            ''.-::::-::--'          '.-::::::////::--'            .-.'         '-:::/:::-///:////:.          '++/'  ''         '-///+/::::/::/://::'         .++:. ::--'.'        '-:++/:-----://::::::.         '++///os+-::---         ':o+/:------://:////:--.'''''.:+o+++os/--://:.         '-o+/:::://+ossys/++:::--://::/+ooo+oo/-::--:-          'smmds/ydmmdds++//+/''.-/ss+++oosssssso/:---:'           .hdho::+++::://+/+syoohmdysoosooossyysys/--+:'            /++o/////:://+++sydNNmds+//oo+oooshhhhy-:-..            .ooso+++o+/++++ohdNNNhyoo//oo++oossys+. '-..             -+osyosso+ooosdNNNNNdysys+oossyyyyy.    -..              '/o++/++ssoymNmNNNNmhyyhdyyyyyydmd-     '                sooooohddmNmhNNNNNNmhhhddhyydmNmy              -odmyoshddmNmddNNNNNNmmmmdsoyhhdmmd-            :hNNNNmhhyhdNNddmNNNNNNNhmNNmy+sddNhd+          'sNNNmNNNNNs:dNNmmNNNNNNNNmhdNNNhyddmmN+        '+dNNhshmNNNNmsNNNNNNNNmmddmNNhhmNmhdmmNms        yydNmhyyhmNNNNNmNNNNNNNmmmmmddmhsymdhmdmdd'       :m/oNNddhhdNNNNNNhmNmmmmmmmmmmmhddoohdhmddm+       yo/hNNNNmdmNNNNNNmhmdmddddmmmmmmhh+soshhmdhd.     ':o+oNNNNNNNmNNNNNmmdydhdmmmdhdmdmmyooysoyhmdmo    -oo+oyNNNNNdNNNNNmmNmmshdsmmmmdsdhmddso+ssohdhyh-  '+so++++ooydmmmNNNmmdNmdohhysdmmdoyhymmmy+o+oshhhss  /ss++++++ooooNNNNNNmymmmshhsyssddo+yhshmmh+o+osymmy.  +yys+++++oo+smhmmmmmhymmdsddsd+sdsoysyssydso++++hhhh:  -yshydhsooymmd.hmhmmdhydmhsdohy/oyosdoysoo+y+oooooysh/'   -dNNmdsydmmy. -mdhmmydoydds/oo++/oosoohodssosssoosysy/-    '/yhhyo:-.    oyyhmymooyss::+++/++/:ymyoyoo++++ooooo+o.       '           yhydhdy+ohso//+////+o+///ooo++//+hoooooo-                   :syydhsoyoso+++:--:/++yo/::/:::///osys/++                ':/++ss+s++ooosooo/::::/osys++so/:-:::/++++/                /so++o/+//+/::///os/:/o::/hd++dy++--//::::::                -hy++ooo+ss+++++sdmmy+/y+/:::::/:---/+++++++               ':+//+o//sh-:hmNNmmmmmmdsy///:::://:::/+++++:            '-///:::-:+/::/dmmNNNmmmmmmmmmyo/:--/++/++/:::+s          '+ddhy+//::--:/smmmmmmmmmmmmNNmmmmy/--:+//+o/:sdmd         'ymmmmmds/:/++ymmmmmdddmmmmmmNNmmmmmdy+-//+//odmmmd', warningTitleCSS);
      console.log("%cThis is a browser feature intended for developers. If someone asks you to copy and paste something here to enable or \"hack\" someone's account.", warningDescCSS);
    </script>
	<script>
var app = angular.module("myShoppingList", []); 
app.controller("myCtrl", function($scope) {
    $scope.products = ["Milk", "Bread", "Cheese"];
    $scope.addItem = function () {
        $scope.errortext = "";
        if (!$scope.addMe) {return;}
        if ($scope.products.indexOf($scope.addMe) == -1) {
            $scope.products.push($scope.addMe);
        } else {
            $scope.errortext = "The item is already in your shopping list.";
        }
    }
    $scope.removeItem = function (x) {
        $scope.errortext = "";    
        $scope.products.splice(x, 1);
    }
});
</script>

	 

<iframe width="560" height="315" src="https://www.youtube-nocookie.com/embed/45IFqrCXS9c?start=215" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe> <iframe width="560" height="315" src="https://www.youtube.com/embed/KeKnk8SOmgQ?start=155" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe><iframe width="560" height="315" src="https://www.youtube.com/embed/O0kNj8OwpOc?start=7" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
<iframe width="560" height="315" src="https://www.youtube.com/embed/tRZNldgZNtM?start=65" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>	
	
	 <img src="https://images.assets-landingi.com/XZpbH5ZB/dragon.webp" height="200" width="300">
	
			</div>
		</div>
	  <style>
    body {
      font-family: 'Press Start 2P', cursive;
      background: linear-gradient(45deg, #ffd800, #ff5520, #750cf2, #0cbcf2);
      min-height: 100vh;
    }
    h1 {
      text-align: center;
    }
    .container {
      position: relative;
      max-width: 770px;
      margin: 100px auto;
      padding: 27px;
      background: white;
    }
    .container:after {
      content: '';
      position: absolute;
      top: -10px;
      left: -10px;
      right: -10px;
      bottom: -10px;
      background: linear-gradient(270deg, #ffd800, #ff5520, #750cf2, #0cbcf2);
      z-index: -1;
    }
    .message {
      display: flex;
      align-items: center;
      margin-top: 2rem;
      margin-bottom: 2rem;
    }
    .nes-bcrikko {
      margin-top: 80px;
    }
    .message > div {
      margin-left: 2rem;
    }
    form {
      margin-top: 2rem;
    }
    .form-field + .form-field{
      margin-top: 2rem;
    }
    #main-modal > div {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      border: 5px solid black;
      background: white;
      padding: 24px;
    }
    #main-modal {
      content: "";
      position: fixed;
      top: 0;
      bottom: 0;
      left: 0;
      right: 0;
      background: rgba(0, 0, 0, 0.4);
    }
    .hide {
      display: none;
    }

    @media screen and (max-width: 980px) {
      .container {
        margin-left: 24px;
        margin-right: 24px;
      }
      .nes-bcrikko {
        margin-top: 0;
      }
      .message {
        flex-direction: column-reverse;
        align-items: flex-start;
      }
    }
	  </style>
	  
  <script type="text/javascript">
        setTimeout(function () {
            if (_satellite != undefined) {
                _satellite.pageBottom();
            }
        }, 1000);
    </script>
	  
	  <script>
		  (function () {
        function w() {
            window._satellite ? _satellite.pageBottom() : setTimeout(w, 100)
        }
        setTimeout(w, 300)
    })()
	  </script>
	      <script>

        window.addEventListener("load", setTimeout(function () {
            window.cookieconsent.initialise({
                "palette": {
                    "popup": {
                        "background": "#edeff5",
                        "text": "#838391"
                    },
                    "button": {
                        "background": "#4b81e8"
                    }
                },
                "content": {
                    "href": "https://abcjon.tk"
                },
                "position": "bottom-left"
            })
        }, 5000));
    </script>
				<script src="https://cdnjs.cloudflare.com/ajax/libs/iamdustan-smoothscroll/0.4.0/smoothscroll.min.js" integrity="sha256-IylDNWjip7FK2TJUYck237qBTBeSiwnSFDCjLG686D4=" crossorigin="anonymous"></script>
		<script src="https://unpkg.com/core-js-bundle@3.6.5/minified.js" integrity="sha384-TTVcaKdKKsLSvxkJU8mv/ZrkBlSMUiXn57PWhpGFzfeuzqQW/krdvVzW8yqtTqz5" crossorigin="anonymous"></script>

		<!-- libraries -->
		<script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.8.3/modernizr.min.js" integrity="sha256-0rguYS0qgS6L4qVzANq4kjxPLtvnp5nn2nB5G1lWRv4=" crossorigin="anonymous"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/waypoints/4.0.1/noframework.waypoints.min.js" integrity="sha384-zZbyq8BQ4BvQcv4xPxkJWWGPSVW6z+MufIHfxNTdnFQwc7J2Idz0zxeP6/bMqWJn" crossorigin="anonymous"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/waypoints/4.0.1/shortcuts/inview.min.js" integrity="sha384-nK4khbhvZ/TNQaGnwee6RVFCDRfxcrLKZZqKCVqk1rF9AT8Etq3UZYCXZ7CCAd0K" crossorigin="anonymous"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/Swiper/4.5.1/js/swiper.min.js" integrity="sha256-4sETKhh3aSyi6NRiA+qunPaTawqSMDQca/xLWu27Hg4=" crossorigin="anonymous"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/2.1.3/TweenLite.min.js" integrity="sha256-VV47uJSoHZUeiBcCs3FcBOQLMn++yeG/zqZvaUkvGZM=" crossorigin="anonymous"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/2.1.3/TimelineLite.min.js" integrity="sha256-nuhNsfXzBFR6G1lKP8bK77dakkQDqdHcQ4OCFZvk6Qo=" crossorigin="anonymous"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/2.1.3/plugins/CSSPlugin.min.js" integrity="sha256-LBjlnpPrM6Aig8LDFc9PJctPHLGUc6RaUvnmXE4hV5Y=" crossorigin="anonymous"></script>
<div class="footer-clients">
			
</body>
</html>

<!--       _
       .__(.)< (MEOW)
        \___)   
 ~~~~~~~~~~~~~~~~~~-->
<!--
